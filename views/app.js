
//'ngHandsontable','angular-medium-editor','angular-timeline', 'chart.js', ui.bootstrap, mgcrea.bootstrap.affix
var exambazaar = angular.module('exambazaar', ['angular-clipboard','angular-google-gapi','angular-loading-bar','duScroll','youtube-embed', 'material.svgAssetsCache', 'ngAnimate','ngAria','ngCookies', 'ngGeolocation', 'ngMap', 'ngMaterial', 'ngMaterialDatePicker', 'ngSanitize', 'ngSidebarJS', 'ngtweet','ngFacebook','oc.lazyLoad', '720kb.socialshare', 'ui.router', 'ui-notification', 'matchMedia', 'angularLazyImg', 'ngFileSaver']);
//,'ngHandsontable''ngHandsontable',,'ng','seo', 'angular-medium-editor-insert-plugin', 'htmlToPdfSave', ui.bootstrap
    (function() {
    'use strict';
    angular
    .module('exambazaar')
    .config(function($mdThemingProvider, $facebookProvider, NotificationProvider, $ocLazyLoadProvider) {
        $mdThemingProvider
            .theme("default")
            .primaryPalette("teal");
        
        $facebookProvider.setAppId('1236747093103286');
        $facebookProvider.setPermissions("public_profile,email"); //, user_education_history, publish_actions
        //$anchorScrollProvider.disableAutoScrolling();
        NotificationProvider.setOptions({
            delay: 10000,
            startTop: 20,
            startRight: 10,
            verticalSpacing: 20,
            horizontalSpacing: 20,
            positionX: 'right',
            positionY: 'bottom'
        });
        
        $ocLazyLoadProvider.config({
          modules: [
            {
              name: 'ngHandsontable',
              files: [
                    'handsontable.min.js',
                    'ngHandsontable.min.js',
                    'handsontable.full.css'
              ]
            },
            {
              name: 'mediumEditor',
              files: [
                    /*'jquery.min.js',*/
                    'https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.23.1/js/medium-editor.min.js',
                    'https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.23.1/css/medium-editor.min.css',
                    'https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.23.1/css/themes/tim.min.css',
                    'angular-medium-editor.js',
                    'medium-editor-tables.js',
                    'css/medium-editor-tables.css',

              ]
            },
            {
              name: 'angularTimeline',
              files: [
                    'angular-timeline.js',
                   /* '//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css',*/
                    'css/angular-timeline.css',
                    'css/angular-timeline-animations.css',
                    'css/angular-timeline-bootstrap.css',
              ]
            },
            {
              name: 'charting',
              files: [
                    'Chart.min.js',
                    'angular-chart.min.js'
              ]
            },
            {
              name: 'angularClipboard',
              files: [
                    'angular-clipboard.js',
              ]
            },
            {
              name: 'ngFileUpload',
              files: [
                    'jquery.min.js',
                    'ng-file-upload-shim.min.js',
                    'ng-file-upload.min.js',
              ]
            },
            {
              name: 'bootstrapAffix',
              files: [
                    'jquery.min.js',
                    'angular-bootstrap-affix.js',
              ]
            },
            {
              name: 'ngSticky',
              files: [
                    'sticky.min.js',
              ]
            },
            {
              name: 'angularTimer',
              files: [
                    'https://cdnjs.cloudflare.com/ajax/libs/humanize-duration/3.12.0/humanize-duration.js', 'https://cdnjs.cloudflare.com/ajax/libs/angular-timer/1.3.5/angular-timer.js',
              ]
            },
            {
              name: 'angularScreenfull',
              files: [
                    'screenfull.js',
                    'angular-screenfull.js'
              ]
            },  
            {
              name: 'angularFileSaver',
              files: [
                    'angular-file-saver.bundle.js'
              ]
            },
            {
              name: 'UICarousel',
              files: [
                    'ui-carousel.min.css',
                    'ui-carousel.min.js',
              ]
            },
            {
              name: 'infiniteScroll',
              files: [
                    /*'jquery.min.js',
                    'angular.min.js',*/
                    'ng-infinite-scroll.min.js',

              ]
            },  
            
          ]
        });
    })
    .controller('streamController', streamController);
    function streamController(streamList,$scope,$window,$http,$state, $document,OTPService,$cookies,categories, $rootScope,  $location) {
        $scope.hideLoginDialog();
        if($cookies.getObject('location')){
            $scope.location = $cookies.getObject('location'); 
        }
        $scope.streams = streamList.data;
        /*$rootScope.pageTitle = "Exambazaar: Select the stream you want to study";
        $rootScope.pageTitle = "Exambazaar is Indiaâ€™s biggest and largest education discovery platform and is the fastest way to discover best coaching classes in your city. Our easy-to-use website shows you all the coaching classes based on study streams, along with courses, photos, vidoes and results. Exambazaar also provides comprehensive information for test prep for entrance exams in India, colleges, courses, universities and career options. You can find information about more than 50 exams and coaching classes to succeed";*/
        $rootScope.pageTitle = 'Exambazaar: Select your Exam Stream';
        
        
        $rootScope.pageDescription = "Select your exam stream from Engineering, Medical, CA & CS, School, Mba, Law, Foreign Education, Civil Services, SSC, Bank, Defence, Insurance, Financial Certification";
        
        $rootScope.pageKeywords = "Exambazaar, Best Coaching India, Coaching Reviews, Engineering Coaching, Medical Coaching, CA & CS Coaching, NTSE Coaching, CAT Coaching, CLAT Coaching, SAT GMAT Coaching, IAS Coaching, SSC Coaching, Bank PO Coaching, Defence Coaching";
        
    };
    exambazaar.constant('cities',['Jaipur','Hyderabad','Noida','Ajmer','Alwar','Kota','Bikaner','Ganganagar','Sikar','Bhilwara','Juhnjhunu','New Delhi','Delhi','Lucknow','Indore','Bhopal','Roorkee','Thrissur','Mohali','Patiala','Ahmedabad','Vadodara','Surat','Rajkot','Ghaziabad','Agra','Dehradun','Meerut','Allahabad','Amritsar','Bangalore','Guwahati','Kolkata','Gwalior','Pune','Trivandrum','Mumbai','Rohtak','Nasik','Kurukshetra','Shimla','Kanpur','Ludhiana','Coimbatore','Ambala','Mathura','Patna','Mysore','Chandigarh','Chennai','Vishakhapatnam','Vellore']);
    
    exambazaar.constant('categories',[
        
        {
        displayname: "Engineering",
        name: "engineering",
        sub: "JEE Main, JEE Advanced, BITSAT, NATA, GATE and more",
        subcategory:[
            {name:"jee", displayname:"JEE Main & Advanced"},
            {name:"bitsat", displayname:"BITSAT"},
            {name:"nata", displayname:"NATA"},
            {name:"gate", displayname:"GATE"}
            ]
        },
        {
        displayname: "Medical",
        name: "medical",
        sub: "AIIMS, NEET UG, JIPMER, AFMC, PGIMER and more",
        subcategory:[
            {name:"aipmt", displayname:"NEET UG"},
            {name:"aiims", displayname:"AIIMS"},
            {name:"afmc", displayname:"AFMC"}
            //"NEET UG","AIIMS","AFMC","Manipal PMT","GPAT"
            ] //"JIPMER","PGIMER"

        },
        {
        displayname: "CA & CS",
        name: "cacs",
        sub: "CA CPT, CA IPCC, CA Final, CS Foundation Exam and more",
        subcategory:[
            {name:"ca cpt", displayname:"CA CPT"},
            {name:"cs foundation exam", displayname:"CS Foundation Exam"}
            ]//"CA IPCC","CA Final",
        },
        {
        displayname: "School",
        name: "school",
        sub: "NTSE, NSE, KVPY, IMO, NSO and more",
        subcategory:[
            {name:"ntse", displayname:"NTSE",description:"NTSE is a National Level scholarship program to identify and nurture talented students. Close to 500,000 students appear in this scholarship exam every year, and 1000 scholarships are awarded"}
            ] // "NSE", "KVPY", "IMO", "NSO"
        },
        {
        displayname: "MBA",
        name: "mba",
        sub: "CAT, XAT, CMAT, SNAP and more",
        subcategory:[
            {name:"cat", displayname:"CAT"},
            /*{name:"cmat", displayname:"CMAT"},*/
            {name:"xat", displayname:"XAT"},
            {name:"snap", displayname:"SNAP"}
            ]//"CAT", "XAT", "CMAT", "SNAP"
        },
        {
        displayname: "Law",
        name: "law",
        sub: "CLAT, AILET, LSAT, CBS and more",
        subcategory:[
            {name:"clat", displayname:"CLAT"},
            {name:"ailet", displayname:"AILET"},
            {name:"lsat", displayname:"LSAT"}
            ]//"CBS"
        },
        {
        displayname: "Foreign Education",
        name: "foreigneducation",
        sub: "IELTS, GRE, GMAT, SAT, TOEFL and more",
        subcategory:[
            {name:"sat", displayname:"SAT"},
            {name:"gmat", displayname:"GMAT"},
            {name:"gre", displayname:"GRE"},
            {name:"ielts", displayname:"IELTS"},
            {name:"toefl", displayname:"TOEFL"}
            ]
        },
        {
        displayname: "Civil Services",
        name: "civilservices",
        sub: "CSE, IPS Ltd. Competitive Exam, UPSC CAPF Exam, IES/ISS Exam, IFS Exam, SCRA and more",
        subcategory:[
            {name:"Civil Services Exam", displayname:"Civil Services Exam"},
            {name:"ies/iss exam", displayname:"IES/ISS Exam"},
            {name:"ifs exam", displayname:"IFS Exam"}
            ]
        },
        {
        displayname: "SSC",
        name: "ssc",
        sub: "SSC CPO (S.I) Exam, SSC CGLE, SSC JE, SSC CHSL Exam, SSC CMLE and more",
        subcategory:[
            {name:"ssc cpo", displayname:"SSC CPO (S.I) Exam"},
            {name:"ssc cgle", displayname:"SSC CGLE"},
            {name:"ssc je", displayname:"SSC JE"},
            {name:"ssc chsl", displayname:"SSC CHSL"},
            {name:"ssc cmle", displayname:"SSC CMLE"}
            ]
        },
        {
        displayname: "Bank",
        name: "bank",
        sub: "Bank Clerical Exam, Bank PO Exam, RBI Exam, SBI PO Exam, IBPS Clerk CWE and more",
        subcategory:[
            {name:"Bank Clerical Exam", displayname:"Bank Clerical Exam"},
            {name:"Bank PO Exam", displayname:"Bank PO Exam"},
            {name:"RBI Exam", displayname:"RBI Exam"},
            {name:"SBI PO Exam", displayname:"SBI PO Exam"},
            {name:"IBPS Clerk CWE", displayname:"IBPS Clerk CWE"}
            ]
        },
        {
        displayname: "Defense",
        name: "defense",
        sub: "CDS Exam, NDA Exam, AFCAT, I.A.F. Exam, I.N.A Exam and more",
        subcategory:[
            {name:"cds exam", displayname:"CDS Exam"},
            {name:"nda exam", displayname:"NDA Exam"},
            {name:"afcat", displayname:"AFCAT"},
            {name:"i.a.f. exam", displayname:"I.A.F. Exam"},
            {name:"i.n.a exam", displayname:"I.N.A Exam"}
            ]
        },
        {
        displayname: "Insurance",
        name: "insurance",
        sub: "IRDA Exam, G.I.C Exam, LIC, L.I.C D.O and more",
        subcategory:[
            {name:"IRDA Exam", displayname:"IRDA Exam"},
            {name:"G.I.C Exam", displayname:"G.I.C Exam"},
            {name:"LIC", displayname:"LIC"},
            {name:"L.I.C D.O", displayname:"L.I.C D.O"}
            ]
        }
        ]
       );
        
    exambazaar.service('UserService', ['$http', function($http) {
        this.procMon = function() {
            
            return $http.post('/api/users/procmon');
        };
        this.saveUser = function(user) {
            
            return $http.post('/api/users/save', user);
        };
        this.updateUser = function(user) {
            
            return $http.post('/api/users/update', user);
        };
        this.dailySummary = function() {
            return $http.get('/api/users/dailySummary');
        };
        this.hourlyHeatmap = function() {
            return $http.get('/api/users/hourlyHeatmap');
        };
        
        this.deliverVoucher = function(voucherForm) {
            
            return $http.post('/api/users/deliverVoucher', voucherForm);
        };
        
        this.sendReferrals = function(referralForm) {
            
            return $http.post('/api/users/sendReferrals', referralForm);
        };
        this.searchUsers = function(query) {
            return $http.get('/api/users/query/'+query, {query: query});
        };
        this.fbSave = function(user) {
            
            return $http.post('/api/users/fbSave', user);
        };
        this.verifyEmail = function(userId) {
            return $http.get('/api/users/verifyEmail/'+userId, {userId: userId});
        };
        this.markVerifiedEmail = function(userId) {
            return $http.get('/api/users/markVerifiedEmail/'+userId, {userId: userId});
        };
        this.getBlogger = function(userId) {
            return $http.get('/api/users/blogger/'+userId, {userId: userId});
        };
        
        this.activateBlogger = function(userId) {
            return $http.get('/api/users/activateBlogger/'+userId, {userId: userId});
        };
        this.deactivateBlogger = function(userId) {
            return $http.get('/api/users/deactivateBlogger/'+userId, {userId: userId});
        };
        this.activeUsers = function(nDays) {
            return $http.get('/api/users/activeUsers/'+nDays, {nDays: nDays});
        };
        this.activateIntern = function(userId) {
            return $http.get('/api/users/activateIntern/'+userId, {userId: userId});
        };
        this.deactivateIntern = function(userId) {
            return $http.get('/api/users/deactivateIntern/'+userId, {userId: userId});
        };
        this.closeInternship = function(userId) {
            return $http.get('/api/users/closeInternship/'+userId, {userId: userId});
        };
        
        this.getUser = function(userId) {
            return $http.get('/api/users/edit/'+userId, {userId: userId});
        };
        this.getAddedInstitutes = function(userId) {
            return $http.get('/api/users/addedInstitutes/'+userId, {userId: userId});
        };
        this.getFilledColleges = function(userId) {
            return $http.get('/api/users/filledColleges/'+userId, {userId: userId});
        };
        this.getAddedQuestions = function(userId) {
            return $http.get('/api/users/addedQuestions/'+userId, {userId: userId});
        };
        this.getEmails = function(userId) {
            return $http.get('/api/users/emails/'+userId, {userId: userId});
        };
        this.getPartner = function(userId) {
            return $http.get('/api/users/editPartner/'+userId, {userId: userId});
        };
        this.getUserBasic = function(userId) {
            return $http.get('/api/users/editBasic/'+userId, {userId: userId});
        };
        this.getUserShortlisted = function(userId) {
            return $http.get('/api/users/editShortlist/'+userId, {userId: userId});
        };
        this.getUserShortlistedInstitutes = function(userId) {
            return $http.get('/api/users/userShortlist/'+userId, {userId: userId});
        };
        this.getUsers = function() {
            return $http.get('/api/users');
        };
        this.properNames = function() {
            return $http.get('/api/users/properNames');
        };
        this.allBloggers = function() {
            return $http.get('/api/users/allBloggers');
        };
        this.getInterns = function() {
            return $http.get('/api/users/interns');
        };
        this.getEBTeam = function() {
            return $http.get('/api/users/ebteam');
        };
        
        this.getUserFilled = function(userId) {
            
            return $http.get('/api/users/editFilled/'+userId, {userId: userId});
        };
        this.userexists = function(mobile) {
            return $http.get('/api/users/userexists/'+mobile, {mobile: mobile});
        };
        this.referexists = function(mobile) {
            return $http.get('/api/users/referexists/'+mobile, {mobile: mobile});
        };
        this.markLogin = function(loginForm) {
            
            return $http.post('/api/users/markLogin',loginForm);
        };
        this.markLatLng = function(positionForm) {
            
            return $http.post('/api/users/markLatLng',positionForm);
        };
        this.saveEligibility = function(eligibilityForm) {
            
            return $http.post('/api/users/saveEligibility',eligibilityForm);
        };
        this.getEligibility = function(userId) {
            return $http.get('/api/users/getEligibility/'+userId, {userId: userId});
        };
        this.shortlistInstitute = function(shortListForm) {
            return $http.post('/api/users/shortlistInstitute', shortListForm);
        };
        this.addPic = function(newPicForm) {
            return $http.post('/api/users/addPic', newPicForm);
        };
        this.addBlogGalleryPic = function(newPicForm) {
            return $http.post('/api/users/addBlogGalleryPic', newPicForm);
        };
        this.removeBlogGalleryPic = function(newPicForm) {
            return $http.post('/api/users/removeBlogGalleryPic', newPicForm);
        };
        this.removeAllBlogGallery = function(newPicForm) {
            return $http.post('/api/users/removeAllBlogGallery', newPicForm);
        };
        this.getUsersCount = function() {
            return $http.get('/api/users/count');
        };
        this.getVerfiedUsersCount = function() {
            return $http.get('/api/users/verfiedCount');
        };
        this.getStudentCount = function() {
            return $http.get('/api/users/studentcount');
        };
        this.updatePassword = function(userPassword) {
            return $http.post('/api/users/updatePassword',userPassword);
        };
        this.saveUserLocation = function(locationForm) {
            return $http.post('/api/users/saveUserLocation', locationForm);
        };
        this.makePartner = function(locationForm) {
            return $http.post('/api/users/makePartner',locationForm);
        };
        this.unmakePartner = function(partnerUser) {
            return $http.post('/api/users/unmakePartner',partnerUser);
        };
        this.userMarketing = function(userList) {
            return $http.post('/api/users/userMarketing',userList);
        };
        this.userSurvey = function(userList) {
            return $http.post('/api/users/userSurvey',userList);
        };
    }]);
    exambazaar.service('cirfFactorService', ['$http', function($http) {
        this.saveCirfFactor = function(cirfFactor) {
            return $http.post('/api/cirffactors/save', cirfFactor);
        };
        this.getExamCirfFactors = function(examId) {
            
            return $http.get('/api/cirffactors/exam/'+examId, {examId: examId});
        };
        this.removeCirfFactor = function(cirffactorId) {
            return $http.get('/api/cirffactors/remove/'+cirffactorId, {cirffactorId: cirffactorId});
        };
    }]);    
    exambazaar.service('EmailService', ['$http', function($http) {
        this.getEmails = function() {
            return $http.get('/api/emails');
        };
        this.send = function(email) {
            return $http.post('/api/emails/send', email);
        };
        this.sendGrid = function(email) {
            return $http.post('/api/emails/sendGrid', email);
        };
        this.blogInvite = function() {
            return $http.post('/api/emails/blogInvite');
        };
        
        this.welcomeEmail = function(email) {
            return $http.post('/api/emails/welcomeEmail', email);
        };
        this.verifyEmail = function(email) {
            return $http.post('/api/emails/verifyEmail', email);
        };
        this.availDiscountEmail = function(email) {
            return $http.post('/api/emails/availDiscountEmail', email);
        };
        this.contactEmail = function(email) {
            return $http.post('/api/emails/contactEmail', email);
        };
        this.recruitmentEmail = function(email) {
            return $http.post('/api/emails/recruitmentEmail', email);
        };
        this.hundredblogEmail = function() {
            return $http.post('/api/emails/hundredblogEmail');
        };
        this.CATEmail = function() {
            return $http.post('/api/emails/CATEmail');
        };
        this.EventsEmail = function() {
            return $http.post('/api/emails/EventsEmail');
        };
        this.internshipEmail = function(emailForm) {
            return $http.post('/api/emails/internshipEmail', emailForm);
        };
        this.introductionofEB = function() {
            return $http.post('/api/emails/introductionofEB');
        };
    }]);  
        
    exambazaar.service('PublicationEmailService', ['$http', function($http) {
        
        this.publications = function(email) {
            return $http.post('/api/publicationemails/publications', email);
        };
        this.getPublicationEmails = function() {
            return $http.get('/api/publicationemails');
        };
        
    }]); 
    
    exambazaar.service('EligibilityService', ['$http', function($http) {
        this.bulksaveEligibility = function(eligibility) {
            return $http.post('/api/eligibilitys/bulksave', eligibility);
        };
        this.getEligibility = function(eligibilityId) {
            return $http.get('/api/eligibilitys/edit/'+eligibilityId, {eligibilityId: eligibilityId});
        };
        this.getEligibilities = function() {
            return $http.get('/api/eligibilitys');
        };
        
    }]);
    exambazaar.service('availDiscountService', ['$http', function($http) {
        this.saveAvailDiscount = function(availDiscount) {
            return $http.post('/api/availDiscounts/save', availDiscount);
        };
        this.findAvailDiscount = function(availDiscount) {
            return $http.post('/api/availDiscounts/find', availDiscount);
        };
        this.getAvailDiscounts = function() {
            return $http.get('/api/availDiscounts');
        };
        this.getAvailDiscount = function(availDiscountId) {
            return $http.get('/api/availDiscounts/edit/'+availDiscountId, {availDiscountId: availDiscountId});
        };
    }]);
    exambazaar.service('qviewService', ['$http', function($http) {
        this.saveQView = function(qview) {
            return $http.post('/api/qviews/save', qview);
        };
        this.getUserQViews = function(userId) {
            
            return $http.get('/api/qviews/user/'+userId, {userId: userId});
        };
        this.removeQView = function(qviewId) {
            return $http.get('/api/qviews/remove/'+qviewId, {qviewId: qviewId});
        };
    }]);
    exambazaar.service('qmarkforreviewService', ['$http', function($http) {
        this.saveQMarkforReview = function(qmarkforreview) {
            return $http.post('/api/qmarkforreviews/save', qmarkforreview);
        };
        this.getUserQMarkforReviews = function(userId) {
            
            return $http.get('/api/qmarkforreviews/user/'+userId, {userId: userId});
        };
        this.removeQMarkforReview = function(qmarkforreviewId) {
            return $http.get('/api/qmarkforreviews/remove/'+qmarkforreviewId, {qmarkforreviewId: qmarkforreviewId});
        };
    }]);
    exambazaar.service('questionresponseService', ['$http', function($http) {
        this.saveQuestionResponse = function(questionresponse) {
            return $http.post('/api/questionresponses/save', questionresponse);
        };
        this.getUserQuestionResponses = function(userId) {
            
            return $http.get('/api/questionresponses/user/'+userId, {userId: userId});
        };
        this.removeQuestionResponse = function(questionresponseId) {
            return $http.get('/api/questionresponses/remove/'+questionresponseId, {questionresponseId: questionresponseId});
        };
    }]);
        
    exambazaar.service('assessmentService', ['$http', function($http) {
        this.saveAssessment = function(assessment) {
            return $http.post('/api/assessments/save', assessment);
        };
        this.getUserAssessments = function(userId) {
            
            return $http.get('/api/assessments/user/'+userId, {userId: userId});
        };
        this.getAssessment = function(assessment) {
            return $http.post('/api/assessments/edit', assessment);
        };
        this.removeAssessment = function(assessment) {
            return $http.post('/api/assessments/removeAssessment', assessment);
        };
        
        this.getAssessments = function() {
            return $http.get('/api/assessments/');
        };
        this.submitAssessment = function(assessment) {
            return $http.post('/api/assessments/submit', assessment);
        };
        this.bulkEnded = function() {
            return $http.post('/api/assessments/bulkEnded');
        };
        this.userevaluate = function(assessment) {
            return $http.post('/api/assessments/userevaluate', assessment);
        };
    }]);
        
    exambazaar.service('questionService', ['$http', function($http) {
        this.saveQuestion = function(question) {
            return $http.post('/api/questions/save', question);
        };
        
        this.markSection = function(sectionForm) {
            return $http.post('/api/questions/markSection', sectionForm);
        };
        this.changeUser = function(testId) {
            return $http.get('/api/questions/changeUser');
        };
        this.getTestQuestions = function(testId) {
            return $http.get('/api/questions/testQuestions/'+testId, {testId: testId});
        };
        this.markCreator = function(testId) {
            return $http.get('/api/questions/markCreator');
        };
        this.getQuestion = function(questionId) {
            return $http.get('/api/questions/edit/'+questionId, {questionId: questionId});
        };
        this.randomQuestion = function(examId) {
            return $http.get('/api/questions/exam/randomQuestion/'+examId, {examId: examId});
        };
        this.removeQuestion = function(questionId) {
            return $http.get('/api/questions/remove/'+questionId, {questionId: questionId});
        };
        this.getQuestions = function() {
            return $http.get('/api/questions');
        };
        this.markMCQs = function() {
            return $http.get('/api/questions/markMCQs');
        };
        
        this.markAnswerExists = function() {
            return $http.get('/api/questions/markAnswerExists');
        };
        
        this.getExamQuestions = function(examId) {
            return $http.get('/api/questions/exam/'+examId, {examName: examId});
        };
        this.questionToPost = function(examArray) {
            return $http.post('/api/questions/questionToPost',examArray);
        };
        this.buildPostSchedule = function(buildParams) {
            return $http.post('/api/questions/buildPostSchedule',buildParams);
        };
    }]);
    
    exambazaar.service('contactService', ['$http', function($http) {
        this.saveContact = function(contact) {
            return $http.post('/api/contacts/save', contact);
        };
        this.getContact = function(contactId) {
            return $http.get('/api/contacts/edit/'+contactId, {contactId: contactId});
        };
        this.removeContact = function(contactId) {
            return $http.get('/api/contacts/remove/'+contactId, {contactId: contactId});
        };
        this.getContacts = function() {
            return $http.get('/api/contacts');
        };
    }]);
    exambazaar.service('testService', ['$http', function($http) {
        this.saveTest = function(test) {
            return $http.post('/api/tests/save', test);
        };
        this.testpdf = function(test) {
            return $http.post('/api/tests/testpdf', test, { responseType : 'arraybuffer' });
        };
        
        this.customMarking = function(customMarkingForm) {
            return $http.post('/api/tests/customMarking', customMarkingForm);
        };
        
        this.getk21Test = function() {
            return $http.get('/api/tests/k21');
        };
        this.markSimulate = function(testIds) {
            return $http.post('/api/tests/markSimulate', testIds);
        };
        this.testsWithQuestions = function() {
            return $http.get('/api/tests/testsWithQuestions');
        };
        
        this.getTest = function(testId) {
            return $http.get('/api/tests/edit/'+testId, {testId: testId});
        };
        this.answerKey = function(testId) {
            return $http.get('/api/tests/answerKey/'+testId, {testId: testId});
        };
        
        this.readTest = function(testId) {
            return $http.get('/api/tests/readTest/'+testId, {testId: testId});
        };
        this.removeTest = function(testId) {
            return $http.get('/api/tests/remove/'+testId, {testId: testId});
        };
        this.getTests = function() {
            return $http.get('/api/tests');
        };
        this.getExamTests = function(examId) {
            return $http.get('/api/tests/exam/'+examId, {examId: examId});
        };
        this.getExamTestsByExamName = function(examName) {
            return $http.get('/api/tests/examByName/'+examName, {examName: examName});
        };
        this.officialPapersByExamName = function(examName) {
            return $http.get('/api/tests/officialPapers/'+examName, {examName: examName});
        };
        this.officialPapersStreamExam = function() {
            return $http.get('/api/tests/officialPapersStreamExam');
        };
        
        this.markWatermarked = function() {
            return $http.get('/api/tests/markWatermarked');
        };
        this.flipwatermarked = function(testId) {
            return $http.get('/api/tests/flipwatermarked/'+testId, {testId: testId});
        };
    }]);
    
    exambazaar.service('ExamService', ['$http', function($http) {
        this.saveExam = function(exam) {
            return $http.post('/api/exams/save', exam);
        };
        this.getExam = function(examId) {
            return $http.get('/api/exams/edit/'+examId, {examId: examId});
        };
        this.streamexam = function(examId) {
            return $http.get('/api/exams/streamexam');
        };
        this.getExams = function() {
            return $http.get('/api/exams');
        };
        this.getExamsBasic = function() {
            return $http.get('/api/exams/basic');
        };
        this.markTrueFalse = function() {
            return $http.get('/api/exams/markTrueFalse');
        };
        this.getStreamExams = function(streamName) {
            return $http.get('/api/exams/stream/'+streamName, {streamName: streamName});
        };
        this.getExamByName = function(examName) {
            return $http.get('/api/exams/exam/'+examName, {examName: examName});
        };
        this.getExamBasicByName = function(examName) {
            return $http.get('/api/exams/exambasic/'+examName, {examName: examName});
        };
        this.getExamPatternByName = function(examName) {
            return $http.get('/api/exams/pattern/'+examName, {examName: examName});
        };
        this.getExamBooksByName = function(examName) {
            return $http.get('/api/exams/books/'+examName, {examName: examName});
        };
        this.getDegreesByName = function(examName) {
            return $http.get('/api/exams/degrees/'+examName, {examName: examName});
        };
        this.addLogo = function(newLogoForm) {
            return $http.post('/api/exams/addLogo',newLogoForm);
        };
        this.addCoverPhoto = function(newCoverPhotoForm) {
            return $http.post('/api/exams/addCoverPhoto',newCoverPhotoForm);
        };
        
        this.getExamPapers = function() {
            return $http.get('/api/exams/papers');
        };
    }]);
        
    exambazaar.service('SendGridService', ['$http', function($http) {
        this.saveSendGridCredential = function(SendGridCredential) {
            return $http.post('/api/sendGridCredentials/save', SendGridCredential);
        };
        
        this.getSendGridCredential = function(sendGridCredentialId) {
            return $http.get('/api/sendGridCredentials/edit/'+sendGridCredentialId, {sendGridCredentialId: sendGridCredentialId});
        };
        this.getOneSendGridCredential = function() {
            return $http.get('/api/sendGridCredentials/getOne');
        };
        this.getSendGridCredentials = function() {
            return $http.get('/api/sendGridCredentials');
        };
        
        
    }]); 
       
    exambazaar.service('subscriberService', ['$http', function($http) {
        this.saveSubscribers = function(subscriberList) {
            return $http.post('/api/subscribers/bulksave', subscriberList);
        };
        this.sendReviewInvites = function(reviewInviteForm) {
            
            return $http.post('/api/subscribers/sendReviewInvites', reviewInviteForm);
        };
        this.getSubscriber = function(subscriberId) {
            return $http.get('/api/subscribers/edit/'+subscriberId, {subscriberId: subscriberId});
        };
        this.getSubscribers = function() {
            return $http.get('/api/subscribers');
        };
        
        
    }]);    
    exambazaar.service('AwsCredentialService', ['$http', function($http) {
        this.saveAwsCredential = function(awsCredential) {
            return $http.post('/api/awsCredentials/save', awsCredential);
        };
        
        this.getAwsCredential = function(awsCredentialId) {
            return $http.get('/api/awsCredentials/edit/'+awsCredentialId, {awsCredentialId: awsCredentialId});
        };
        this.getActiveAwsCredential = function() {
            return $http.get('/api/awsCredentials/getOne');
        };
        this.getAwsCredentials = function() {
            return $http.get('/api/awsCredentials');
        };
        
        
    }]);
        
    exambazaar.service('socialMediaCredentialService', ['$http', function($http) {
        this.saveSocialMediaCredential = function(socialMediaCredential) {
            return $http.post('/api/socialMediaCredentials/save', socialMediaCredential);
        };
        
        this.getSocialMediaCredential = function(socialMediaCredentialId) {
            return $http.get('/api/socialMediaCredentials/edit/'+socialMediaCredentialId, {socialMediaCredentialId: socialMediaCredentialId});
        };
        this.getActiveSocialMediaCredential = function() {
            return $http.get('/api/socialMediaCredentials/getOne');
        };
        this.getSocialMediaCredentials = function() {
            return $http.get('/api/socialMediaCredentials');
        };
        
        
    }]);     
    
    exambazaar.service('MediaTagService', ['$http', function($http) {
       
        this.saveMediaTags = function(mediaTags) {
            return $http.post('/api/mediaTags/bulksave', mediaTags);
        };
        this.getMediaTag = function(mediaTagId) {
            return $http.get('/api/mediaTags/edit/'+mediaTagId, {mediaTagId: mediaTagId});
        };
        this.getMediaTagByType = function(mediaType) {
            return $http.get('/api/mediaTags/mediaType/'+mediaType, {mediaType: mediaType});
        };
        this.getMediaTags = function() {
            return $http.get('/api/mediaTags');
        };
        this.getMediaTypes = function() {
            return $http.get('/api/mediaTags/mediaTypes/');
        };
        
    }]);
    
    exambazaar.service('GroupService', ['$http', function($http) {
       
        this.saveGroups = function(groups) {
            return $http.post('/api/groups/bulksave', groups);
        };
        this.getGroup = function(groupId) {
            return $http.get('/api/groups/edit/'+groupId, {groupId: groupId});
        };
        this.getGroups = function() {
            return $http.get('/api/groups');
        };
        
    }]);    
        
    exambazaar.service('cisavedService', ['$http', function($http) {
       
        this.savecisaved = function(cisavedForm) {
            return $http.post('/api/cisaveds/save', cisavedForm);
        };
        this.institutesSaved = function() {
            return $http.get('/api/cisaveds/institutesSaved');
        };
        this.savedCount = function() {
            return $http.get('/api/cisaveds/savedCount');
        };
        this.getcisaved = function(cisavedId) {
            return $http.get('/api/cisaveds/edit/'+cisavedId, {cisavedId: cisavedId});
        };
        this.getcisaveds = function() {
            return $http.get('/api/cisaveds');
        };
        
    }]);
        
        
    exambazaar.service('ipService', ['$http', function($http) {
        this.getip = function() {
            return $http.get('https://freegeoip.net/json/');
        };
        
    }]);
    exambazaar.service('viewService', ['$http', function($http) {
       
        this.saveview = function(viewForm) {
            return $http.post('/api/views/save', viewForm);
        };
        this.masterViewSummary = function() {
            return $http.get('/api/views/masterViewSummary');
        };
        this.dailySummary = function() {
            return $http.get('/api/views/dailySummary');
        };
        this.blogDailySummary = function() {
            return $http.get('/api/views/blogDailySummary');
        };
        this.hourlyHeatmap = function() {
            return $http.get('/api/views/hourlyHeatmap');
        };
        this.getview = function(viewId) {
            return $http.get('/api/views/edit/'+viewId, {viewId: viewId});
        };
        this.getviews = function() {
            return $http.get('/api/views');
        };
        this.getuserviews = function(userId) {
            return $http.get('/api/views/user/'+userId, {userId: userId});
        };
        this.getuserBlogviews = function(userId) {
            return $http.get('/api/views/userBlog/'+userId, {userId: userId});
        };
        this.getinstituteviews = function(instituteId) {
            return $http.get('/api/views/institute/'+instituteId, {instituteId: instituteId});
        };
    }]);
        
    exambazaar.service('tofillcollegeService', ['$http', function($http) {
       
        this.save = function(toFillCollegesForm) {
            return $http.post('/api/tofillcolleges/save', toFillCollegesForm);
        };
        this.tofilluser = function(toFillCollegesForm) {
            return $http.post('/api/tofillcolleges/tofilluser', toFillCollegesForm);
        };
        this.getAllIds = function(tofillcollegeId) {
            return $http.get('/api/tofillcolleges/AllIds');
        };
        this.markDone = function(tofillcollegeForm) {
            return $http.post('/api/tofillcolleges/markDone', tofillcollegeForm);
        };
        
        this.markNotDone = function(tofillcollegeForm) {
            return $http.post('/api/tofillcolleges/markNotDone', tofillcollegeForm);
        };
        this.findAssigned = function(instituteIds) {
            return $http.post('/api/tofillcolleges/findAssigned', instituteIds);
        };
        this.filledCount = function() {
            return $http.get('/api/tofillcolleges/filledCount');
        };
        this.institutesFilled = function() {
            return $http.get('/api/tofillcolleges/institutesFilled');
        };
        this.gettofillcollege = function(tofillcollegeId) {
            return $http.get('/api/tofillcolleges/edit/'+tofillcollegeId, {tofillcollegeId: tofillcollegeId});
        };
        this.prevFilled = function(groupName) {
            return $http.get('/api/tofillcolleges/prevFilled/'+groupName, {groupName: groupName});
        };
        this.removeAssigned = function(tofillcollegeId){
            $http.get('/api/tofillcolleges/remove/'+tofillcollegeId, {tofillcollegeId: tofillcollegeId});
        };
        this.gettofillcolleges = function() {
            return $http.get('/api/tofillcolleges');
        };
        this.getusertofillcolleges = function(userId) {
            return $http.get('/api/tofillcolleges/user/'+userId, {userId: userId});
        };
    }]);
        
    exambazaar.service('tofillciService', ['$http', function($http) {
       
        this.sendEmails = function() {
            return $http.get('/api/tofillcis/sendEmails');
        };
        this.savetofillci = function(tofillciForm) {
            return $http.post('/api/tofillcis/save', tofillciForm);
        };
        
        this.markDone = function(tofillciForm) {
            return $http.post('/api/tofillcis/markDone', tofillciForm);
        };
        this.findAssigned = function(instituteIds) {
            return $http.post('/api/tofillcis/findAssigned', instituteIds);
        };
        this.filledCount = function() {
            return $http.get('/api/tofillcis/filledCount');
        };
        this.institutesFilled = function() {
            return $http.get('/api/tofillcis/institutesFilled');
        };
        this.gettofillci = function(tofillciId) {
            return $http.get('/api/tofillcis/edit/'+tofillciId, {tofillciId: tofillciId});
        };
        this.prevFilled = function(groupName) {
            return $http.get('/api/tofillcis/prevFilled/'+groupName, {groupName: groupName});
        };
        this.removeAssigned = function(tofillciId){
            $http.get('/api/tofillcis/remove/'+tofillciId, {tofillciId: tofillciId});
        };
        this.gettofillcis = function() {
            return $http.get('/api/tofillcis');
        };
        this.getusertofillcis = function(userId) {
            return $http.get('/api/tofillcis/user/'+userId, {userId: userId});
        };
    }]);
        
    exambazaar.service('resultService', ['$http', function($http) {
       
        this.saveresult = function(resultForm) {
            return $http.post('/api/results/save', resultForm);
        };
        this.existingResult = function(userInstituteForm) {
            return $http.post('/api/results/existingResult', userInstituteForm);
        };
        this.groupResults = function(groupResultForm) {
            return $http.post('/api/results/groupResults', groupResultForm);
        };
        
        this.resultsCount = function() {
            return $http.get('/api/results/resultsCount');
        };
        this.getresult = function(resultId) {
            return $http.get('/api/results/edit/'+resultId, {resultId: resultId});
        };
        this.removeresult = function(resultId){
            $http.get('/api/results/remove/'+resultId, {resultId: resultId});
        };
        this.getresults = function() {
            return $http.get('/api/results');
        };
        this.getuserResults = function(userId) {
            return $http.get('/api/results/user/'+userId, {userId: userId});
        };
    }]);
        
    exambazaar.service('commentService', ['$http', function($http) {
        this.savecomment = function(commentForm) {
            return $http.post('/api/comments/save', commentForm);
        };
        this.commentsCount = function() {
            return $http.get('/api/comments/commentsCount');
        };
        this.getcomment = function(commentId) {
            return $http.get('/api/comments/edit/'+commentId, {commentId: commentId});
        };
        this.removecomment = function(commentId){
            $http.get('/api/comments/remove/'+commentId, {commentId: commentId});
        };
        this.disablecomment = function(commentId) {
            return $http.get('/api/comments/disable/'+commentId, {commentId: commentId});
        };
        this.enablecomment = function(commentId) {
            return $http.get('/api/comments/enable/'+commentId, {commentId: commentId});
        };
        this.getcomments = function() {
            return $http.get('/api/comments/');
        };
        this.blogpostComments = function(blogpostId) {
            return $http.get('/api/comments/blogpostComments/'+blogpostId, {blogpostId: blogpostId});
        };
        this.userBlogpostcomment = function(commentForm) {
            return $http.post('/api/comments/userBlogpostcomment', commentForm);
        };
    }]);
        
    exambazaar.service('blogTagService', ['$http', function($http) {
        this.saveblogTag = function(blogTagForm) {
            return $http.post('/api/blogTags/save', blogTagForm);
        };
        this.blogTagsCount = function() {
            return $http.get('/api/blogTags/blogTagsCount');
        };
        this.blogTagsSummary = function() {
            return $http.get('/api/blogTags/blogTagsSummary');
        };
        this.getblogTag = function(blogTagId) {
            return $http.get('/api/blogTags/edit/'+blogTagId, {blogTagId: blogTagId});
        };
        this.removeblogTag = function(blogTagId){
            return $http.get('/api/blogTags/remove/'+blogTagId, {blogTagId: blogTagId});
        };
        this.usedinBlogs = function(blogTagId){
            return $http.get('/api/blogTags/usedinBlogs/'+blogTagId, {blogTagId: blogTagId});
        };
        this.disableblogTag = function(blogTagId) {
            return $http.get('/api/blogTags/disable/'+blogTagId, {blogTagId: blogTagId});
        };
        this.enableblogTag = function(blogTagId) {
            return $http.get('/api/blogTags/enable/'+blogTagId, {blogTagId: blogTagId});
        };
        this.getblogTags = function() {
            return $http.get('/api/blogTags/');
        };
    }]);    
    exambazaar.service('blogpostService', ['$http', function($http) {
        this.slugExists = function(query) {
            return $http.get('/api/blogposts/slugExists/'+query, {query: query});
        };
        
        this.blogAnalytics = function(analyticsForm) {
            return $http.post('/api/blogposts/blogAnalytics', analyticsForm);
        };
        this.allblogsbasic = function(analyticsForm) {
            return $http.get('/api/blogposts/allblogsbasic');
        };
        this.oneOff = function() {
            return $http.get('/api/blogposts/oneOff');
        };
        this.saveblogpost = function(blogpostForm) {
            return $http.post('/api/blogposts/save', blogpostForm);
        };
        this.cloneblogpost = function(cloneForm) {
            return $http.post('/api/blogposts/clone', cloneForm);
        };
        this.existingBlogpost = function(userInstituteForm) {
            return $http.post('/api/blogposts/existingBlogpost', userInstituteForm);
        };
        this.groupBlogposts = function(groupBlogposts) {
            return $http.post('/api/blogposts/groupBlogposts', groupBlogposts);
        };
        this.changeCover = function(coverPicForm) {
            return $http.post('/api/blogposts/changeCover', coverPicForm);
        };
        this.blogpostsCount = function() {
            return $http.get('/api/blogposts/blogpostsCount');
        };
        this.getblogpost = function(blogpostId) {
            return $http.get('/api/blogposts/edit/'+blogpostId, {blogpostId: blogpostId});
        };
        this.recommenedBlogs = function(blogpostId) {
            return $http.get('/api/blogposts/recommenedBlogs/'+blogpostId, {blogpostId: blogpostId});
        };
        
        
        this.getblogpostFromSlug = function(blogpostSlug) {
            return $http.get('/api/blogposts/getblogpostFromSlug/'+blogpostSlug, {blogpostSlug: blogpostSlug});
        };
        this.disableblogpost = function(blogpostId) {
            return $http.get('/api/blogposts/disable/'+blogpostId, {blogpostId: blogpostId});
        };
        this.enableblogpost = function(blogpostId) {
            return $http.get('/api/blogposts/enable/'+blogpostId, {blogpostId: blogpostId});
        };
        this.removeblogpost = function(blogpostId){
            return $http.get('/api/blogposts/remove/'+blogpostId, {blogpostId: blogpostId});
        };
        this.markEdbites = function(blogpostId){
            return $http.get('/api/blogposts/markEdbites/'+blogpostId, {blogpostId: blogpostId});
        };
        this.unmarkEdbites = function(blogpostId){
            return $http.get('/api/blogposts/unmarkEdbites/'+blogpostId, {blogpostId: blogpostId});
        };
        
        this.getUserBlogposts = function(userId) {
            return $http.get('/api/blogposts/userblogs/'+userId, {userId: userId});
        };
        this.getblogs = function() {
            return $http.get('/api/blogposts/getblogs');
        };
        this.blogstream = function(streamInfo) {
            return $http.post('/api/blogposts/blogstream', streamInfo);
        };
        this.infographicstream = function(streamInfo) {
            return $http.post('/api/blogposts/infographicstream', streamInfo);
        };
        
        this.EdBitesstream = function(streamInfo) {
            return $http.post('/api/blogposts/EdBitesstream', streamInfo);
        };
        this.suggestedblogstream = function(streamInfo) {
            return $http.post('/api/blogposts/suggestedblogstream', streamInfo);
        };
        this.streamblogstream = function(streamInfo) {
            return $http.post('/api/blogposts/streamblogstream', streamInfo);
        };
        this.inspirationblogstream = function(streamInfo) {
            return $http.post('/api/blogposts/inspirationblogstream', streamInfo);
        };
        this.suggestedblogs = function(examName) {
            return $http.get('/api/blogposts/suggestedblogs/'+examName, {examName: examName});
        };
        this.topCoaching = function(examName) {
            return $http.get('/api/blogposts/topCoaching/'+examName, {examName: examName});
        };
        this.headerBlogs = function() {
            return $http.get('/api/blogposts/headerBlogs');
        };
        this.sanitizeblogposts = function() {
            return $http.get('/api/blogposts/sanitizeblogposts');
        };
        this.markAllEdbites = function() {
            return $http.get('/api/blogposts/markAllEdbites');
        };
        this.markAllExpertReviews = function() {
            return $http.get('/api/blogposts/markAllExpertReviews');
        };
        this.markAllExamPatterns = function() {
            return $http.get('/api/blogposts/markAllExamPatterns');
        };
        this.getuserBlogposts = function(userId) {
            return $http.get('/api/blogposts/user/'+userId, {userId: userId});
        };
        this.setToLastSavedVersion = function(blogpostId) {
            return $http.get('/api/blogposts/setToLastSavedVersion/'+blogpostId, {blogpostId: blogpostId});
        };
    }]);
        
    exambazaar.service('reviewService', ['$http', function($http) {
       
        this.savereview = function(reviewForm) {
            return $http.post('/api/reviews/save', reviewForm);
        };
        this.existingReview = function(userInstituteForm) {
            return $http.post('/api/reviews/existingReview', userInstituteForm);
        };
        this.groupReviews = function(groupReviews) {
            return $http.post('/api/reviews/groupReviews', groupReviews);
        };
        this.dailySummary = function() {
            return $http.get('/api/reviews/dailySummary');
        };
        this.reviewsCount = function() {
            return $http.get('/api/reviews/reviewsCount');
        };
        this.getreview = function(reviewId) {
            return $http.get('/api/reviews/edit/'+reviewId, {reviewId: reviewId});
        };
        this.disablereview = function(reviewId) {
            return $http.get('/api/reviews/disable/'+reviewId, {reviewId: reviewId});
        };
        this.enablereview = function(reviewId) {
            return $http.get('/api/reviews/enable/'+reviewId, {reviewId: reviewId});
        };
        this.removereview = function(reviewId){
            $http.get('/api/reviews/remove/'+reviewId, {reviewId: reviewId});
        };
        this.getreviews = function() {
            return $http.get('/api/reviews');
        };
        this.getuserReviews = function(userId) {
            return $http.get('/api/reviews/user/'+userId, {userId: userId});
        };
    }]);
        
    exambazaar.service('upvoteService', ['$http', function($http) {
       
        this.saveupvote = function(upvoteForm) {
            return $http.post('/api/upvotes/save', upvoteForm);
        };
        this.removeupvote = function(removeupvoteForm) {
            return $http.post('/api/upvotes/removeupvote/', removeupvoteForm);
        };
        this.blogpostUpvoteCount = function(blogpostSlug) {
            return $http.get('/api/upvotes/blogpostUpvoteCount/'+blogpostSlug, {blogpostSlug: blogpostSlug});
        };
        this.allBlogsUpvotesCount = function() {
            return $http.get('/api/upvotes/allBlogsUpvotesCount');
        };
        this.blogpostUserUpvotes = function(userId) {
            return $http.get('/api/upvotes/blogpostUserUpvotes/'+userId, {userId: userId});
        };
        this.randomUpvotes = function(randomUpvoteForm) {
            return $http.post('/api/upvotes/randomUpvotes', randomUpvoteForm);
        };
    }]);
        
    exambazaar.service('rateInstituteService', ['$http', function($http) {
       
        this.saverateInstitute = function(rateInstituteForm) {
            return $http.post('/api/rateInstitutes/save', rateInstituteForm);
        };
        
        this.markDone = function(rateInstituteForm) {
            return $http.post('/api/rateInstitutes/markDone', rateInstituteForm);
        };
        this.ratedCount = function() {
            return $http.get('/api/rateInstitutes/ratedCount');
        };
        this.institutesRated = function() {
            return $http.get('/api/rateInstitutes/institutesRated');
        };
        this.getrateInstitute = function(rateInstituteId) {
            return $http.get('/api/rateInstitutes/edit/'+rateInstituteId, {rateInstituteId: rateInstituteId});
        };
        this.prevRated = function(groupName) {
            return $http.get('/api/rateInstitutes/prevRated/'+groupName, {groupName: groupName});
        };
        this.removeAssigned = function(rateInstituteId){
            $http.get('/api/rateInstitutes/remove/'+rateInstituteId, {rateInstituteId: rateInstituteId});
        };
        this.getrateInstitutes = function() {
            return $http.get('/api/rateInstitutes');
        };
        this.getuserrateInstitute = function(userId) {
            return $http.get('/api/rateInstitutes/user/'+userId, {userId: userId});
        };
    }]);
    exambazaar.service('addContactInfoService', ['$http', function($http) {
       
        this.saveaddContactInfo = function(addContactInfoForm) {
            return $http.post('/api/addContactInfos/save', addContactInfoForm);
        };
        
        this.markDone = function(addContactInfoForm) {
            return $http.post('/api/addContactInfos/markDone', addContactInfoForm);
        };
        this.changeUser = function() {
            return $http.get('/api/addContactInfos/changeUser');
        };
        this.verifiedCount = function() {
            return $http.get('/api/addContactInfos/verifiedCount');
        };
        this.institutesFilled = function() {
            return $http.get('/api/addContactInfos/institutesFilled');
        };
        this.getaddContactInfo = function(addContactInfoId) {
            return $http.get('/api/addContactInfos/edit/'+addContactInfoId, {addContactInfoId: addContactInfoId});
        };
        this.removeAssigned = function(addContactInfoId){
            $http.get('/api/addContactInfos/remove/'+addContactInfoId, {addContactInfoId: addContactInfoId});
        };
        this.getaddContactInfos = function() {
            return $http.get('/api/addContactInfos');
        };
        this.getuseraddContactInfos = function(userId) {
            return $http.get('/api/addContactInfos/user/'+userId, {userId: userId});
        };
    }]);    
        
    exambazaar.service('toverifyciService', ['$http', function($http) {
       
        this.savetoverifyci = function(toverifyciForm) {
            return $http.post('/api/toverifycis/save', toverifyciForm);
        };
        
        this.markDone = function(toverifyciForm) {
            return $http.post('/api/toverifycis/markDone', toverifyciForm);
        };
        this.changeUser = function() {
            return $http.get('/api/toverifycis/changeUser');
        };
        this.verifiedCount = function() {
            return $http.get('/api/toverifycis/verifiedCount');
        };
        this.institutesFilled = function() {
            return $http.get('/api/toverifycis/institutesFilled');
        };
        this.gettoverifyci = function(toverifyciId) {
            return $http.get('/api/toverifycis/edit/'+toverifyciId, {toverifyciId: toverifyciId});
        };
        this.removeAssigned = function(toverifyciId){
            $http.get('/api/toverifycis/remove/'+toverifyciId, {toverifyciId: toverifyciId});
        };
        this.gettoverifycis = function() {
            return $http.get('/api/toverifycis');
        };
        this.getusertoverifycis = function(userId) {
            return $http.get('/api/toverifycis/user/'+userId, {userId: userId});
        };
    }]);
    
        
    exambazaar.service('suggestCoachingService', ['$http', function($http) {
       
        this.savesuggestCoaching = function(suggestCoachingForm) {
            return $http.post('/api/suggestCoachings/save', suggestCoachingForm);
        };
        
        this.markDone = function(suggestCoachingForm) {
            return $http.post('/api/suggestCoachings/markDone', suggestCoachingForm);
        };
        this.getsuggestCoaching = function(suggestCoachingId) {
            return $http.get('/api/suggestCoachings/edit/'+suggestCoachingId, {suggestCoachingId: suggestCoachingId});
        };
        
        this.getsuggestCoachings = function() {
            return $http.get('/api/suggestCoachings');
        };
        this.getusersuggestCoachings = function(userId) {
            return $http.get('/api/suggestCoachings/user/'+userId, {userId: userId});
        };
    }]);      
        
    exambazaar.service('LocationService', ['$http', function($http) {
        this.saveLocation = function(location) {
            return $http.post('/api/locations/save', location);
        };
        this.saveLocations = function(newlocations) {
            return $http.post('/api/locations/bulksave', newlocations);
        };
        
        this.getLocation = function(examId) {
            return $http.get('/api/locations/edit/'+examId, {examId: examId});
        };
        this.getLocations = function() {
            return $http.get('/api/locations');
        };
        this.getCityLocations = function(cityName) {
            return $http.get('/api/locations/city/'+cityName, {cityName: cityName});
        };
        this.getCities = function() {
            return $http.get('/api/locations/cities/');
        };
        
        
    }]);
       
    exambazaar.service('ImageService', ['$http', function($http) {
        this.saveImage = function(image) {
            return $http.post('/api/images/save', image);
        };
        
        this.s3Credentials = function(fileInfo) {
            return $http.post('/api/images/s3Credentials', fileInfo);
        };
        
        this.saveImages = function(newlocations) {
            return $http.post('/api/images/bulksave', newlocations);
        };
        
        this.getImage = function(imageId) {
            return $http.get('/api/images/edit/'+imageId, {imageId: imageId});
        };
        this.getImages = function() {
            return $http.get('/api/images');
        };
        
        
        
    }]);
    exambazaar.service('s3UtilsService', ['$http', function($http) {   
        this.download = function(fileInfo) {
            return $http.post('/api/s3Utils/download', fileInfo);
        };
        this.upload = function(fileInfo) {
            return $http.post('/api/s3Utils/upload', fileInfo);
        };
        this.downloadFromURLS = function(fileInfo) {
            return $http.post('/api/s3Utils/downloadFromURLS');
        };
    }]);
        
    exambazaar.service('couponService', ['$http', function($http) {
        this.saveCoupon = function(coupon) {
            return $http.post('/api/coupons/save', coupon);
        };
        this.getCoupon = function(couponId) {
            return $http.get('/api/coupons/edit/'+couponId, {couponId: couponId});
        };
        this.nameExists = function(name) {
            return $http.post('/api/coupons/nameExists/', name);
        };
        this.getOneActiveCouponCode = function(couponForm) {
            return $http.post('/api/coupons/getOneActiveCouponCode/', couponForm);
        };
        this.deliver = function(deliverForm) {
            return $http.post('/api/coupons/deliver/', deliverForm);
        };
        this.getCoupons = function() {
            return $http.get('/api/coupons');
        };
        this.databaseServices = function() {
            return $http.get('/api/coupons/databaseServices');
        };
        this.getAllCodes = function() {
            return $http.get('/api/coupons/allCodes');
        };
        this.couponsCount = function() {
            return $http.get('/api/coupons/couponsCount');
        };
        this.issuedcouponsCount = function() {
            return $http.get('/api/coupons/issuedcouponsCount');
        };
        this.getOneOfEachActiveCoupon = function() {
            return $http.get('/api/coupons/oneOfEachActiveCoupon');
        };
        
        this.getProviderCoupons = function(providerId) {
            return $http.get('/api/coupons/providerCoupons/'+providerId, {providerId: providerId});
        };
        this.getCouponByName = function(couponName) {
            return $http.get('/api/coupons/coupon/'+couponName, {couponName: couponName});
        };
    }]);
    
    exambazaar.service('offerService', ['$http', function($http) {
        this.saveOffer = function(offer) {
            return $http.post('/api/offers/save', offer);
        };
        this.getOffer = function(offerId) {
            return $http.get('/api/offers/edit/'+offerId, {offerId: offerId});
        };
        this.activate = function(offerId) {
            return $http.get('/api/offers/activate/'+offerId, {offerId: offerId});
        };
        this.deactivate = function(offerId) {
            return $http.get('/api/offers/deactivate/'+offerId, {offerId: offerId});
        };
        this.nameExists = function(name) {
            return $http.post('/api/offers/nameExists/', name);
        };
        this.getOffers = function() {
            return $http.get('/api/offers');
        };
        this.getActiveOffers = function() {
            return $http.get('/api/offers/activeOffers');
        };
        this.getActiveOffersBasic = function() {
            return $http.get('/api/offers/activeOffersBasic');
        };
        this.getActiveOffersMedium = function() {
            return $http.get('/api/offers/activeOffersMedium');
        };
        this.getProviderOffers = function(providerId) {
            return $http.get('/api/offers/providerOffers/'+providerId, {providerId: providerId});
        };
        this.getOfferByName = function(offerName) {
            return $http.get('/api/offers/offer/'+offerName, {offerName: offerName});
        };
        
        
    }]);
        
    
        
    exambazaar.service('StreamService', ['$http', function($http) {
        this.saveStream = function(stream) {
            return $http.post('/api/streams/save', stream);
        };
        this.getStream = function(streamId) {
            return $http.get('/api/streams/edit/'+streamId, {streamId: streamId});
        };
        this.getStreams = function() {
            return $http.get('/api/streams');
        };
        this.getAllStreams = function() {
            return $http.get('/api/streams/all');
        };
        this.getStreamByName = function(streamName) {
            return $http.get('/api/streams/stream/'+streamName, {streamName: streamName});
        };
        this.addLogo = function(newLogoForm) {
            return $http.post('/api/streams/addLogo',newLogoForm);
        };
        
    }]);
    exambazaar.service('ProviderService', ['$http', function($http) {
        this.getProviders = function(city) {
            return $http.get('/api/providers/'+city, {city: city});
        };
        this.removeDuplicates = function(city) {
            return $http.get('/api/providers/edit/removeDuplicates/'+city, {city: city});
        };
        
    }]);
    exambazaar.service('collegeService', ['$http', function($http) {
        this.getUnassignedColleges = function(collegesForm) {
            return $http.post('/api/colleges/unassigned', collegesForm);
        };
        this.getAssignedColleges = function(collegesForm) {
            return $http.post('/api/colleges/assigned', collegesForm);
        };
        this.getColleges = function(collegesForm) {
            return $http.post('/api/colleges/', collegesForm);
        };
        this.getCount = function() {
            return $http.get('/api/colleges/count');
        };
        this.getCollege = function(collegeId) {
            return $http.get('/api/colleges/edit/'+collegeId, {collegeId: collegeId});
        };
        this.getAllEmails = function() {
            return $http.get('/api/colleges/getAllEmails');
        };
        this.getEmails = function(collegeId) {
            return $http.get('/api/colleges/getEmails/'+collegeId, {collegeId: collegeId});
        };
        this.saveCollege = function(college) {
            return $http.post('/api/colleges/save',college);
        };
    }]); 
    exambazaar.service('targetStudyProviderService', ['$http', function($http) {
        this.oneOff = function() {
            return $http.get('/api/targetStudyProviders/oneOff');
        };
        this.getProviders = function(city) {
            return $http.get('/api/targetStudyProviders/city/'+city, {city: city});
        };
        this.contacts = function() {
            return $http.get('/api/targetStudyProviders/contacts');
        };
        this.sanitizeMobiles = function() {
            return $http.get('/api/targetStudyProviders/sanitizeMobiles');
        };
        this.dailySummary = function() {
            return $http.get('/api/targetStudyProviders/dailySummary');
        };
        this.p5Analytics = function(analyticsForm) {
            return $http.post('/api/targetStudyProviders/p5Analytics', analyticsForm);
        };
        this.allResults = function(examId) {
            return $http.get('/api/targetStudyProviders/allResults/'+examId, {examId: examId});
        };
        this.getProvidersWithAreas = function() {
            return $http.get('/api/targetStudyProviders/providersWithAreas');
        };
        this.coachingAddressService = function() {
            return $http.get('/api/targetStudyProviders/coachingAddressService');
        };
        this.searchProviders = function(query) {
            return $http.get('/api/targetStudyProviders/query/'+query, {query: query});
        };
        this.searchCoachingGroupProviders = function(query) {
            return $http.get('/api/targetStudyProviders/coachingGroupQuery/'+query, {query: query});
        };
        this.searchBlogCoachingGroupProviders = function(query) {
            return $http.get('/api/targetStudyProviders/blogCoachingGroupQuery/'+query, {query: query});
        };
        this.addExamsToAll = function(groupExamForm) {
            return $http.post('/api/targetStudyProviders/addExamsToAll',groupExamForm);
        };
        this.setLogoForAll = function(groupLogoForm) {
            return $http.post('/api/targetStudyProviders/setLogoForAll',groupLogoForm);
        };
        this.setEmailForAll = function(groupExamForm) {
            return $http.post('/api/targetStudyProviders/setEmailForAll',groupExamForm);
        };
        this.setWebsiteForAll = function(groupWebsiteForm) {
            return $http.post('/api/targetStudyProviders/setWebsiteForAll',groupWebsiteForm);
        };
        
        this.renameAllCoaching = function(groupNameForm) {
            return $http.post('/api/targetStudyProviders/renameAllCoaching',groupNameForm);
        };
        this.renameAllGroupName = function(groupNameForm) {
            return $http.post('/api/targetStudyProviders/renameAllGroupName',groupNameForm);
        };
        this.removeExamsFromAll = function(groupExamForm) {
            return $http.post('/api/targetStudyProviders/removeExamsFromAll',groupExamForm);
        };
        this.commonExamsInAll = function(groupExamForm) {
            return $http.post('/api/targetStudyProviders/commonExamsInAll',groupExamForm);
        };
        this.searchCityProviders = function(cityQueryForm) {
            return $http.post('/api/targetStudyProviders/cityQuery',cityQueryForm);
        };
        this.showGroupHelper = function(cityCoachingForm) {
            return $http.post('/api/targetStudyProviders/showGroupHelper',cityCoachingForm);
        };
        this.showGroupHelperById = function(coachingId) {
            return $http.post('/api/targetStudyProviders/showGroupHelperById',coachingId);
        };
        this.searchCityReviewProviders = function(cityQueryForm) {
            return $http.post('/api/targetStudyProviders/cityReviewQuery',cityQueryForm);
        };
        this.cityGroupExamQueryForm = function(cityGroupExamQueryForm) {
            return $http.post('/api/targetStudyProviders/cityGroupExamQuery',cityGroupExamQueryForm);
        };
        this.aroundme = function(queryForm) {
            return $http.post('/api/targetStudyProviders/aroundme',queryForm);
        };
        this.bulkSaveLatLng = function(LatLngForm) {
            return $http.post('/api/targetStudyProviders/bulkSaveLatLng',LatLngForm);
        };
        this.setLocOfAll = function() {
            return $http.post('/api/targetStudyProviders/setLocofAll');
        };
        this.checkLogo = function(pageNumber) {
            return $http.get('/api/targetStudyProviders/checkLogo/'+pageNumber, {pageNumber: pageNumber});
        };
        this.bulkCheckLogos = function(checkLogoForm) {
            return $http.post('/api/targetStudyProviders/bulkCheckLogos',checkLogoForm);
        };
        this.bulkDisableProviders = function(disableForm) {
            return $http.post('/api/targetStudyProviders/bulkDisableProviders',disableForm);
        };
        this.cirf = function(cirfForm) {
            return $http.post('/api/targetStudyProviders/cirf',cirfForm);
        };
        this.groupProviders = function(query) {
            return $http.get('/api/targetStudyProviders/group/'+query, {query: query});
        };
        this.addFaculty = function(newFacultyForm) {
            return $http.post('/api/targetStudyProviders/addFaculty',newFacultyForm);
        };
        this.addManagement = function(newManagementForm) {
            return $http.post('/api/targetStudyProviders/addManagement',newManagementForm);
        };
        this.removeManagement = function(newManagementForm) {
            return $http.post('/api/targetStudyProviders/removeManagement',newManagementForm);
        };
        
        this.addPrimaryManagement = function(newManagementForm) {
            return $http.post('/api/targetStudyProviders/addPrimaryManagement',newManagementForm);
        };
        this.addResult = function(newResultForm) {
            return $http.post('/api/targetStudyProviders/addResult',newResultForm);
        };
        this.bulkAddResult = function(bulkResult) {
            return $http.post('/api/targetStudyProviders/bulkAddResult',bulkResult);
        };
        this.suggestedcoachings = function(examUserinfo) {
            return $http.post('/api/targetStudyProviders/suggestedcoachings', examUserinfo);
        };
        
        
        this.addPhoto = function(newPhotoForm) {
            return $http.post('/api/targetStudyProviders/addPhoto',newPhotoForm);
        };
        
        this.addLogo = function(newLogoForm) {
            return $http.post('/api/targetStudyProviders/addLogo',newLogoForm);
        };
        this.addResultPic = function(newResultPicForm) {
            return $http.post('/api/targetStudyProviders/addResultPic',newResultPicForm);
        };
        
        this.addVideo = function(newVideoForm) {
            return $http.post('/api/targetStudyProviders/addVideo',newVideoForm);
        };
        this.changeProvidersStartingWith = function(startsWith) {
            return $http.get('/api/targetStudyProviders/changeProvidersStartingWith/'+startsWith, {startsWith: startsWith});
        };
        this.getCourseProviders = function(cityCourse) {
            return $http.post('/api/targetStudyProviders/cityCourse',cityCourse);
        };
        this.CoachingStream = function(streamInfo) {
            return $http.post('/api/targetStudyProviders/CoachingStream', streamInfo);
        };
        this.getProvider = function(coachingId) {
            return $http.get('/api/targetStudyProviders/coaching/'+coachingId, {coachingId: coachingId});
        };
        this.titleCaseName = function(coachingId) {
            return $http.get('/api/targetStudyProviders/titleCaseName/'+coachingId, {coachingId: coachingId});
        };
        this.getClaimProvider = function(coachingId) {
            return $http.get('/api/targetStudyProviders/claimcoaching/'+coachingId, {coachingId: coachingId});
        };
        this.getProviderReview = function(coachingId) {
            return $http.get('/api/targetStudyProviders/coachingreview/'+coachingId, {coachingId: coachingId});
        };
        this.getGroupInfo = function(coachingId) {
            return $http.get('/api/targetStudyProviders/getGroupInfo/'+coachingId, {coachingId: coachingId});
        };
        this.getGroupCity = function(groupCity) {
            return $http.post('/api/targetStudyProviders/coachingGroup/',groupCity);
        };
        this.getProviderBasic = function(coachingId) {
            return $http.get('/api/targetStudyProviders/basiccoaching/'+coachingId, {coachingId: coachingId});
        };
        this.getGroupName = function(coachingId) {
            return $http.get('/api/targetStudyProviders/getGroupName/'+coachingId, {coachingId: coachingId});
        };
        this.getProviderFillSummary = function(coachingId) {
            return $http.get('/api/targetStudyProviders/fillSummary/'+coachingId, {coachingId: coachingId});
        };
        this.cisavedUsers = function(coachingId) {
            return $http.get('/api/targetStudyProviders/cisavedUsers/'+coachingId, {coachingId: coachingId});
        };
        this.setEBVerifyState = function(verifyForm) {
            return $http.post('/api/targetStudyProviders/setEBVerifyState',verifyForm);
        };
        this.setEBContactInfoState = function(verifyForm) {
            return $http.post('/api/targetStudyProviders/setEBContactInfoState',verifyForm);
        };
        this.saveProvider = function(provider) {
            return $http.post('/api/targetStudyProviders/savecoaching',provider);
        };
        this.removeProvider = function(coachingId) {
            return $http.get('/api/targetStudyProviders/removecoaching/'+coachingId, {coachingId: coachingId});
        };
        this.bulkSaveProviders = function(providers) {
            return $http.post('/api/targetStudyProviders/bulksavecoaching',providers);
        };
        this.getCount = function() {
            return $http.get('/api/targetStudyProviders/count');
        };
        this.getCityCount = function() {
            return $http.get('/api/targetStudyProviders/cityCount');
        };
        this.getCityProviderCount = function(city) {
            return $http.get('/api/targetStudyProviders/cityProviderCount/'+city, {city: city});
        };
        this.getCities = function() {
            return $http.get('/api/targetStudyProviders/cities');
        };
        
        this.providercities = function(query) {
            return $http.get('/api/targetStudyProviders/providercities/'+query, {query: query});
        };
        this.getWebsites = function() {
            return $http.get('/api/targetStudyProviders/websites');
        };
        this.uprank = function(targetStudyProviderId) {
            return $http.get('/api/targetStudyProviders/uprank/'+targetStudyProviderId, {targetStudyProviderId: targetStudyProviderId});
        };
        this.downrank = function(targetStudyProviderId) {
            return $http.get('/api/targetStudyProviders/downrank/'+targetStudyProviderId, {targetStudyProviderId: targetStudyProviderId});
        };
        this.cleanTargetstudyurls = function() {
            return $http.get('/api/targetStudyProviders/cleanTargetstudyurls');
        };
        this.rank0 = function() {
            return $http.get('/api/targetStudyProviders/setRank0');
        };
        this.logoService = function() {
            return $http.get('/api/targetStudyProviders/logoService');
        };
        this.databaseService = function() {
            return $http.get('/api/targetStudyProviders/databaseService');
        };
        this.cityStateService = function() {
            return $http.get('/api/targetStudyProviders/cityStateService');
        };
        this.cityStateService2 = function() {
            return $http.get('/api/targetStudyProviders/cityStateService2');
        };
        this.emailService = function() {
            return $http.get('/api/targetStudyProviders/emailService');
        };
        this.groupSummaryService = function() {
            return $http.get('/api/targetStudyProviders/groupSummaryService');
        };
        this.citySummaryService = function() {
            return $http.get('/api/targetStudyProviders/citySummaryService');
        };
        this.cacsService = function() {
            return $http.get('/api/targetStudyProviders/cacsService');
        };
        this.sandbox2Service = function(city) {
            return $http.get('/api/targetStudyProviders/sandbox2Service/'+city, {city: city});
        };
        this.UniqueLogoService = function() {
            return $http.get('/api/targetStudyProviders/UniqueLogoService');
        };
        this.allDistinct = function() {
            return $http.get('/api/targetStudyProviders/allDistinct');
        };
        this.getAllCourses = function() {
            return $http.get('/api/targetStudyProviders/getAllCourses');
        };
        this.removeDuplicates = function(city) {
            return $http.get('/api/targetStudyProviders/edit/removeDuplicates/'+city, {city: city});
        };
    }]);      
     
    exambazaar.service('NotificationService', ['$http', function($http) {
        this.markRead = function(notification) {
            return $http.post('/api/notifications/markRead', notification);
        };
    }]);
    
    exambazaar.service('MasterService', ['$http', function($http) {
        
        this.addIntern = function(intern) {
            return $http.post('/api/masters/addIntern/',intern);
        };
        this.extractEmails = function(providerIds) {
            return $http.post('/api/masters/extractEmails/',providerIds);
        };
        this.knowyourcollege = function(providerIds) {
            return $http.post('/api/masters/knowyourcollege/',providerIds);
        };
        this.googlePlaces = function() {
            return $http.get('/api/masters/googlePlaces/');
        };
        this.bulkSaveLatLng = function() {
            return $http.get('/api/masters/bulkSaveLatLng/');
        };
        this.latLngSummary = function() {
            return $http.get('/api/masters/latLngSummary/');
        };
    }]);    
        
    exambazaar.service('StudentService', ['$http', function($http) {
        this.saveStudent = function(student) {
            return $http.post('/api/students/save', student);
        };
        this.saveStudents = function(students) {
            return $http.post('/api/students/bulksave', students);
        };
        
        this.getStudent = function(studentId) {
            return $http.get('/api/students/edit/'+studentId, {studentId: studentId});
        };
        this.getStudentAttendance = function(studentId) {
            return $http.get('/api/students/attendance/'+studentId, {studentId: studentId});
        };
        this.getStudentNotification = function(studentId) {
            return $http.get('/api/students/notification/'+studentId, {studentId: studentId});
        };
        
        this.getStudents = function() {
            return $http.get('/api/students');
        };
        this.getStudentsCount = function() {
            return $http.get('/api/students/count');
        };
    }]);
    
    exambazaar.service('SMSService', ['$http', function($http) {
        this.sendSMS = function(sms) {
            return $http.post('/api/smss/send', sms);
        };
    }]);
    exambazaar.service('sitemapService', ['$http', function($http) {
        this.getp0 = function() {
            return $http.post('/api/sitemaps/p0');
        };
        this.getp1 = function() {
            return $http.post('/api/sitemaps/p1');
        };
        this.getp2 = function() {
            return $http.post('/api/sitemaps/p2');
        };
        this.getp3 = function() {
            return $http.post('/api/sitemaps/p3');
        };
        this.getp3Aggregate = function() {
            return $http.post('/api/sitemaps/p3Aggregate');
        };
        this.getp5 = function() {
            return $http.post('/api/sitemaps/p5');
        };
        this.getblogurls = function() {
            return $http.post('/api/sitemaps/blogurls');
        };
        this.getblogrss = function() {
            return $http.post('/api/sitemaps/blogrss');
        };
        this.getexams = function() {
            return $http.post('/api/sitemaps/exams');
        };
        
        
    }]);
    exambazaar.service('OTPService', ['$http', function($http) {
        this.generateOTP= function(otp) {
            return $http.post('/api/otps/generate', otp);
        };
    }]);
    exambazaar.service('ProfilePicService', ['$http', function($http) {
        this.saveProfilePic = function(profilePic) {
            
            return $http.post('/api/profilePics/add', profilePic);
        };
    }]); 
        
        
    exambazaar.controller("signupController", 
        [ '$scope','$stateParams','$cookies','$state','OTPService','UserService', '$mdDialog', function($scope,$stateParams,$cookies,$state,OTPService,UserService, $mdDialog){
        $mdDialog.hide();
            
        $scope.button1 = "Start";
        $scope.button2 = "Verify";
        $scope.button3 = "Finish";
        $scope.step1 = true;
        $scope.step2 = false;
        $scope.step3 = false;
        $scope.verifyPhone = function(){
            $scope.generateUserOTP();
            
        };
        $scope.verifyOTP = function(){
            if($scope.newUser.OTP == $scope.setOTP){
                $scope.step2 = false;
                $scope.step3 = true;
            }else{
                $scope.OTPmessage = 'The OTP you have entered is incorrect.';
            }
        };
        $scope.addUser = function(){
            $scope.newUser.userType = 'Student';
            $scope.newUser.verified = true;
            var saveUser = UserService.saveUser($scope.newUser).success(function (data, status, headers) {
                var fulluser = data;
                
                var sessionuser = {
                    userId: fulluser._id,
                    masterId: fulluser._id,
                    facebookId: fulluser.facebookId,
                    userType: fulluser.userType,
                    basic: fulluser.basic,
                    image: fulluser.image,
                    mobile: fulluser.mobile,
                    email: fulluser.email,
                    
                };
                $cookies.putObject('sessionuser', sessionuser);
                
                $state.go('main');
                
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
        $scope.generateUserOTP = function(){
                UserService.userexists($scope.newUser.contact.mobile).success(function (data, status, headers) {
                    var userExists = data;
                    console.log(userExists);
                    if(userExists){
                        $scope.userExistMessage = "User with mobile " + $scope.newUser.contact.mobile + ' already exists!';    
                    }else{
                        var thisOTP = {
                            mobile:$scope.newUser.contact.mobile,
                            otp: generateOtp(),
                            reason : 'Signup'
                        };
                        OTPService.generateOTP(thisOTP).success(function (data, status, headers) {
                            $scope.enterOTP = true;
                            $scope.setOTP = data.otp;
                            console.log("OTP sent to mobile " + thisOTP.mobile);
                        })
                        .error(function (data, status, header, config) {

                        });
                        $scope.OTPgenerated=true;
                        $scope.step1 = false;
                        $scope.step2 = true;
                        $scope.enterOTP = false;
                    }
                    //$state.go('main');

                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            
        };
            
    }]); 
    exambazaar.controller("categoryController", 
        [ '$scope','$stateParams','$cookies','$state','categories','$rootScope','examList',  function($scope,$stateParams,$cookies,$state,categories,$rootScope,examList){
        $scope.hideLoginDialog();
        $scope.exams = examList.data;
            $scope.categoryName = $stateParams.categoryName;
        if($scope.exams[0].stream){
            $scope.category = $scope.exams[0].stream;
        }
        var examNames = '';
        var examNamesCoaching = '';
        $scope.exams.forEach(function(thisExam, examIndex){
            examNames += thisExam.displayname;
            examNamesCoaching += thisExam.displayname + ' Coaching';
            if(examIndex < $scope.exams.length - 1){
                examNames += ', ';
                examNamesCoaching += ', ';
            }
        });
        
        
        $rootScope.pageTitle = "Choose exam within " + $scope.category.displayname + " Stream";
        $rootScope.pageDescription = "Study for " + examNames + " at the best coaching classes across 90 cities of India | Exambazaar - results, fees, faculty, photos, vidoes, reviews of Coaching Classes in India";
        var streamKeywords = "Exambazaar " + $scope.category.displayname + " Coaching, "+ "Best " + $scope.category.displayname + " Coaching Classes, " + "Top " + $scope.category.displayname + " Coaching Centre, " + $scope.category.displayname + " Coaching in India, ";
        $rootScope.pageKeywords = "Exambazaar, " + streamKeywords + examNamesCoaching;
            
    }]); 
    exambazaar.controller("p0Controller", 
        [ '$scope','$cookies','$state','$rootScope', '$mdDialog', '$location', '$anchorScroll', function($scope, $cookies, $state, $rootScope, $mdDialog, $location, $anchorScroll){
            //var allExams = examList.data;
            
            //console.log(streamExams);
            $scope.hideLoginDialog();

            $rootScope.pageTitle = 'Best Coaching Classes in India for more than 50 exams | Exambazaar.com';
            $rootScope.pageDescription = "Search and apply to the best coaching classes and get the education that you deserve. Browse through courses, photos, videos and results for 26000+ institutes in 90+ cities";
            $rootScope.pageKeywords = "Exambazaar, Exambazaar.com, Best Coaching Classes, Best Coaching, Top Coaching Classes, Coaching Reviews, Engineering Coaching, Medical Coaching, CA & CS Coaching, NTSE Coaching, CAT Coaching, CLAT Coaching, SAT Coaching, GMAT Coaching, IAS Coaching, SSC Coaching, Bank PO Coaching, Defence Coaching";

            $scope.scrollPageDown = function(){
                $location.hash('page2');
                $anchorScroll();      
            };

            /*$scope.goToCity = function(subcategory){ 
                $cookies.putObject('subcategory', subcategory);
                $state.go('city');
            };*/
        
            
          
            
    }]);
    
    exambazaar.controller("topCoachingController", 
        [ '$scope', '$stateParams', '$cookies', '$state', '$rootScope','$mdDialog','thisStream','thisExam', 'topCoachings',  function($scope, $stateParams, $cookies,$state, $rootScope, $mdDialog, thisStream, thisExam, topCoachings){
        
            $scope.exam = thisExam.data;
            $scope.topCoachings = topCoachings.data;
            $scope.stream = thisStream.data;
            $rootScope.pageTitle = "Top Coachings for " + $scope.exam.seoname + " in India";
            
            var sanitize = function(){
                $scope.topCoachings.forEach(function(thisCoaching, cIndex){
                    thisCoaching.allcenters = 0;
                    thisCoaching.coachings.forEach(function(thisCity, tIndex){
                        thisCoaching.allcenters += thisCity.count;
                    });
                    //thisCoaching.coachings.city.sort();
                });
                
                
            };
            sanitize();
            console.log($scope.topCoachings);
            //$rootScope.pageDescription = "Search for " + $scope.subcategory.displayname + " coaching classes in " + cityNames + " and 90 other cities in India | Exambazaar - results, fees, faculty, photos, vidoes, reviews of Coaching Classes in India";

            //var examKeywords = "Exambazaar " + $scope.subcategory.displayname + " Coaching, "+ "Best " + $scope.subcategory.displayname + " Coaching Classes, " + "Top " + $scope.subcategory.displayname + " Coaching Centre, " + $scope.subcategory.displayname + " Coaching in India, ";
            //$rootScope.pageKeywords = "Exambazaar, " + examKeywords + cityNamesCoaching;
            
    }]);
        
    exambazaar.controller("cityController", 
        [ '$scope','$stateParams','$cookies','$state','cities','$rootScope','categories','$mdDialog','thisStream','thisExam',  function($scope,$stateParams,$cookies,$state,cities,$rootScope,categories,$mdDialog,thisStream,thisExam){
        $scope.hideLoginDialog();
        $scope.rankedCities = [
            "Delhi","Mumbai","New Delhi","Ahmedabad","Chennai","Kolkata","Hyderabad","Pune","Bangalore","Chandigarh","Jaipur",
            "Agartala", 
            "Agra", 
            "Ajmer", 
            "Aligarh", 
            "Allahabad", 
            "Alwar", 
            "Ambala", 
            "Amritsar", 
            "Bareilly", 
            "Belgaum", 
            "Bhilwara", 
            "Bhopal", 
            /*"Bhubaneshwar", */
            "Bhubaneswar", 
            "Bikaner", 
            "Bilaspur", 
            "Coimbatore", 
            "Davanagere", 
            "Dehradun", 
            "Dhanbad", 
            "Dibrugarh", 
            "Faridabad", 
            "Ganganagar", 
            "Ghaziabad", 
            "Gorakhpur", 
            "Guntur", 
            "Gurgaon", 
            "Guwahati", 
            "Gwalior", 
            "Hosur", 
            "Hubli", 
            "Indore", 
            "Jabalpur", 
            "Jalandhar", 
            "Jammu", 
            "Jamshedpur", 
            "Jhansi", 
            "Jodhpur", 
            "Kannur", 
            "Kanpur", 
            "Kochi", 
            "Kolar", 
            "Kolhapur", 
            "Kota", 
            "Kozhikode", 
            "Kurukshetra", 
            "Lucknow", 
            "Ludhiana", 
            "Madurai", 
            "Malappuram", 
            "Mangalore", 
            "Mathura", 
            "Meerut", 
            "Mohali", 
            "Moradabad", 
            "Mysore", 
            "Nagpur", 
            "Nainital", 
            "Nashik", 
            "Noida", 
            "Panipat", 
            "Patiala", 
            "Patna", 
            "Pondicherry", 
            "Raipur", 
            "Rajkot", 
            "Ranchi", 
            "Rohtak", 
            "Roorkee", 
            "Saharanpur", 
            "Secunderabad", 
            "Shimla", 
            "Sikar", 
            "Solapur", 
            "Srinagar", 
            "Surat", 
            "Thrissur", 
            "Tiruvananthapuram", 
            "Trichy", 
            "Trissur", 
            "Trivandrum", 
            "Tumakuru", 
            "Udaipur", 
            "Ujjain", 
            "Vadodara", 
            "Varanasi", 
            "Vellore", 
            "Vijayawada",
            "Visakhapatnam", 
            
            "Warangal", 
        ];
        
        $scope.cities = cities;
        $scope.exam = thisExam.data;
        $scope.category = thisStream.data;
        $scope.categoryName = $stateParams.categoryName;
        $scope.subCategoryName = $stateParams.subCategoryName;
        
        $scope.subcategory = $scope.exam;
        
        
            
        $scope.showCoaching = function(city){ 
            $cookies.putObject('city', city);
            $state.go('findCoaching', {cityName: city});
        };
        
        $scope.showPrerenderedDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#myDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.cancel = function() {
          $mdDialog.cancel();
        }; 
            
        var cityNames = '';
        var cityNamesCoaching = '';
        $scope.rankedCities.forEach(function(thisCity, cityIndex){
            
            if(cityIndex < 11){
                cityNames += thisCity;
                cityNamesCoaching += "Best " + $scope.subcategory.displayname + " Coaching in " + thisCity;
                if(cityIndex < 10){
                cityNames += ', ';
                cityNamesCoaching += ', ';
                }
            }
        });
        
          
        
        $rootScope.pageTitle = $scope.subcategory.displayname + ": Select city to study";
        $rootScope.pageDescription = "Search for " + $scope.subcategory.displayname + " coaching classes in " + cityNames + " and 90 other cities in India | Exambazaar - results, fees, faculty, photos, vidoes, reviews of Coaching Classes in India";
        
        var examKeywords = "Exambazaar " + $scope.subcategory.displayname + " Coaching, "+ "Best " + $scope.subcategory.displayname + " Coaching Classes, " + "Top " + $scope.subcategory.displayname + " Coaching Centre, " + $scope.subcategory.displayname + " Coaching in India, ";
        $rootScope.pageKeywords = "Exambazaar, " + examKeywords + cityNamesCoaching;
            
    }]);    
    
    exambazaar.controller("p4Controller", 
    [ '$scope','$rootScope', 'targetStudyProviderService', 'cities', '$state', '$stateParams', '$cookies', 'thisStream', 'thisExam','streamExams', '$mdDialog', '$geolocation', 'CoachingStream', 'SuggestedBlogStream', function($scope,$rootScope, targetStudyProviderService, cities, $state, $stateParams, $cookies,  thisStream, thisExam, streamExams, $mdDialog, $geolocation, CoachingStream, SuggestedBlogStream){
        $scope.categoryName = $stateParams.categoryName;
        $scope.subCategoryName = $stateParams.subCategoryName;
        $scope.city = $stateParams.cityName;
        $scope.category = thisStream.data;
        $scope.subcategory = thisExam.data;
        console.log($scope.subcategory);
        var streamExamsData = streamExams.data;
        var streamExamsIds = streamExamsData.map(function(a) {return a._id;});
        $scope.streamExams = streamExams.data.map(function(a) {return a.name;});
        
        /* Starting of User Info */
        if($cookies.getObject('sessionuser')){
            var user = $cookies.getObject('sessionuser');
            if(user.userType=='Master'){
                $scope.editable = true;
            }
        }
        $scope.userPosition = null;     
        if($cookies.getObject('userlocation')){
            $scope.userlocation = $cookies.getObject('userlocation');
            //console.log($scope.userlocation);
            if(!$scope.userPosition || $scope.userPosition.length < 4){
                //console.log('Empty object');
                $geolocation.getCurrentPosition({
                timeout: 60000
                 }).then(function(position) {
                    $cookies.putObject('userlocation', position);
                    $scope.userlocation = position;
                    if($scope.userlocation && $scope.userlocation.coords && $scope.userlocation.coords.latitude &&  $scope.userlocation.coords.longitude){
                        $scope.userlatlng = new google.maps.LatLng($scope.userlocation.coords.latitude, $scope.userlocation.coords.longitude);
                        $scope.userPosition = $scope.userlocation.coords.latitude.toString() + "," + $scope.userlocation.coords.longitude.toString();
                        //console.log($scope.userPosition);
                        
                    }
                 });
            }
            
            if($scope.userlocation && $scope.userlocation.coords && $scope.userlocation.coords.latitude &&  $scope.userlocation.coords.longitude){
                $scope.userlatlng = new google.maps.LatLng($scope.userlocation.coords.latitude, $scope.userlocation.coords.longitude);
                console.log($scope.userlatlng);
                
                $scope.userPosition = $scope.userlocation.coords.latitude.toString() + "," + $scope.userlocation.coords.longitude.toString();
                $cookies.putObject('userlocation', $scope.userlocation);
                $cookies.putObject('userPosition', $scope.userPosition);
                console.log($scope.userPosition);
            }
            
        }else{
            $geolocation.getCurrentPosition({
            timeout: 60000
             }).then(function(position) {
                $cookies.putObject('userlocation', position);
                $scope.userlocation = position;
                if($scope.userlocation && $scope.userlocation.coords && $scope.userlocation.coords.latitude &&  $scope.userlocation.coords.longitude){
                    $scope.userlatlng = new google.maps.LatLng($scope.userlocation.coords.latitude, $scope.userlocation.coords.longitude); 
                }
                
             });
        }
        /* Ending of User Info */
        var dIndex = null;
        var distances = [];
        var distancesValues = [];
        var directionsService = new google.maps.DirectionsService;
        var getDrivingDistance = function(origin, destination, index){
            
            directionsService.route({
              origin: origin,
              destination: destination,
              travelMode: 'DRIVING'
            }, function(response, status) {
                if (status === 'OK') {
                    if(!$scope.allCoachings.items[index].distances){
                        $scope.allCoachings.items[index].distances = [];
                    }
                    $scope.allCoachings.items[index].distances.push(response.routes[0].legs[0].distance);
                    
                    distances = [];
                    $scope.allCoachings.items[index].distances.forEach(function(thisDistance, dindex){
                        distancesValues = distances.map(function(a) {return a.value;});
                        dIndex = distancesValues.indexOf(thisDistance.value);
                        if(dIndex == -1){
                            distances.push(thisDistance);
                        }
                    });
                    $scope.allCoachings.items[index].distances = distances;
                }
                else if (status == google.maps.GeocoderStatus.OVER_QUERY_LIMIT){
                    setTimeout(function() {
                        getDrivingDistance(origin, destination, index);
                    }, 10 );
                }
                else {
                    console.log("Geocode was not successful for the following reason: " + status);
                }
            });
        };
        var origins = [];
        var destinations = [];
        var streamInfo = {
            categoryName: $scope.categoryName,
            subCategoryName: $scope.subCategoryName,
            cityName: $scope.city,
        };
        $scope.allCoachings = new CoachingStream(streamInfo);
        $scope.allBlogs = new SuggestedBlogStream(streamInfo);
        
        $scope.uniqueProviders = [];
        $scope.uniqueInstitutes = [];
        var coachingGroupNames = '';
        var coachingGroupNamesCity = '';
        var howmany = 5;
        var howmany2 = 5;
        
        $scope.$watch('allCoachings.items', function (newValue, oldValue, scope){
            if(newValue && newValue.length > 0 && newValue != oldValue){
             $scope.allCoachings.items.forEach(function(thisGroup, gindex){
                if(!thisGroup.examsOffered || thisGroup.examsOffered.length == 0){
                    thisGroup.examsOffered = [];
                    thisGroup.exams.forEach(function(thisExam, eIndex){
                        var examIndex = streamExamsIds.indexOf(thisExam);
                        if(examIndex != -1){
                        thisGroup.examsOffered.push(streamExamsData[examIndex]);
                        }
                    });
                }
                if($scope.userlatlng){
                if(thisGroup.latlngs){
                if(!thisGroup.distances || (thisGroup.distances && thisGroup.distances.length == 0)){
                  
                    thisGroup.latlngs.forEach(function(thisLatLng, index){
                        if(thisLatLng && thisLatLng.lat && thisLatLng.lng && thisLatLng.lat !='' && thisLatLng.lng !=''){
                            var gLatLng = new google.maps.LatLng(thisLatLng.lat, thisLatLng.lng);
                            var distance = google.maps.geometry.spherical.computeDistanceBetween($scope.userlatlng, gLatLng)/1000;
                            origins.push($scope.userlatlng);
                            destinations.push(gLatLng);
                            var origin1 = $scope.userlatlng;
                            var destination1 = gLatLng;
                            getDrivingDistance(origin1, destination1, gindex);
                        };
                    });
                }
                }
                }
                 
                if(gindex < howmany && coachingGroupNames ==''){
                    coachingGroupNames += thisGroup.groupName;
                    if(gindex < howmany - 1){
                        coachingGroupNames += ", ";
                    }
                }
                if(gindex < howmany2 && coachingGroupNames ==''){
                    coachingGroupNamesCity += thisGroup.groupName + " " + $scope.city;
                    if(gindex < howmany2 - 1){
                        coachingGroupNamesCity += ", ";
                    }
                }
            }); 
            }
        }, true);
        
        //$scope.providersList = targetStudyProvidersList.data;
        
        
        
        
        /* Starting of SEO Meta Data */
        
        var seoExamName = $scope.subcategory.seoname;
        $rootScope.pageTitle = "Best " + seoExamName + " Coaching in " + $scope.city + " for " + seoExamName + " Preparation";
        $rootScope.pageDescription = "Find best " + seoExamName + " Coaching in " + $scope.city + " | Explore Courses, Fees, Reviews, Past Results, Faculty, Photos and Videos for " + seoExamName + " Preparation";
        var coachingKeywordArray = [];
        coachingKeywordArray.push(seoExamName + " Coaching in " + $scope.city);
        coachingKeywordArray.push("Best " + seoExamName + " Coaching in " + $scope.city);
        coachingKeywordArray.push("Top " + seoExamName + " Coaching in " + $scope.city);
        coachingKeywordArray.push(seoExamName + " Coaching Classes in " + $scope.city);
        coachingKeywordArray.push(seoExamName + " Coaching Institutes in " + $scope.city);
        coachingKeywordArray.push(seoExamName + " Classes in " + $scope.city);
        coachingKeywordArray.push(seoExamName + " Courses in " + $scope.city);
        coachingKeywordArray.push(seoExamName + " Online Coaching");
        coachingKeywordArray.push(seoExamName + " Exam");
        coachingKeywordArray.push("How to prepare for " + seoExamName);
        coachingKeywordArray.push(seoExamName + " Preparation");
        coachingKeywordArray.push(seoExamName + " Tests");
        coachingKeywordArray.push(coachingGroupNamesCity);
        var coachingKeywords = "";
        coachingKeywordArray.forEach(function(thisKeyword, kindex){
            coachingKeywords += thisKeyword;
            if(kindex < coachingKeywordArray.length - 1){
                coachingKeywords += ", ";
            }
        });
        $rootScope.pageKeywords = coachingKeywords;
        /* End of SEO Meta Data */
        
    }]); 
    
    function AppCtrl(SidebarJS) {
      this.toggleSidebarJS = toggleSidebarJS;
      this.sidebarIsVisible = isVisibleSidebarJS;
      this.onSidebarOpen = onSidebarOpen;
      this.onSidebarClose = onSidebarClose;
      this.changePosition = changePosition;
      function toggleSidebarJS(sidebarName) {
        SidebarJS.toggle(sidebarName);
      }
      function isVisibleSidebarJS(sidebarName) {
        return SidebarJS.isVisible(sidebarName);
      }
      function onSidebarOpen() {
        console.log('is open!');
      }
      function onSidebarClose() {
        console.log('is close!');
      }
      function changePosition(newPosition) {
        SidebarJS.setPosition(newPosition);
      }
    }
    
    exambazaar.controller("verifyEmailController", 
    [ '$scope', '$rootScope', 'EmailService','UserService', '$stateParams', '$cookies', 'Notification', 'thisUserEmailVerification', function($scope, $rootScope, EmailService, UserService, $stateParams, $cookies, Notification, thisUserEmailVerification){
        $rootScope.pageTitle = 'Verify Email';
        $scope.userId = $stateParams.userId;
        console.log($scope.userId);
        $scope.thisUserEmailVerification = thisUserEmailVerification.data;
        
        $scope.verifyEmail = function(){ 
            UserService.markVerifiedEmail($scope.userId).success(function (data, status, headers) {
                var done = data;
                $scope.thisUserEmailVerification = done;
                if(done){
                    
                    UserService.getUserBasic($scope.userId).success(function (data, status, headers) {
                        var thisUser = data;
                        console.log(thisUser);
                        if(thisUser.email){
                            /*$scope.email = {
                                to: thisUser.email,
                                templateName: 'Welcome Email',
                                username: thisUser.basic.name
                            };
                            EmailService.welcomeEmail($scope.email).success(function (data, status, headers) {
                            var response = data;
                                Notification.primary({message: "Great! Your email has been verified. Login to start using EB!",  positionY: 'top', positionX: 'right', delay: 5000});

                            })
                            .error(function (data, status, header, config) {
                                console.log('Error ' + data + ' ' + status);
                                Notification.warning({message: "Oops! Something went wrong. Please retry.",  positionY: 'top', positionX: 'right', delay: 5000});
                            });*/
                            $scope.email = {
                                to: thisUser.email,
                                templateName: 'Welcome Email',
                                username: thisUser.basic.name,
                            };
                            EmailService.welcomeEmail($scope.email).success(function (data, status, headers) {
                            var response = data;
                                Notification.primary({message: "Great! We have sent you a welcome email at " + thisUser.email,  positionY: 'top', positionX: 'right', delay: 5000});

                            })
                            .error(function (data, status, header, config) {
                                console.log('Error ' + data + ' ' + status);
                                Notification.warning({message: "Oops! Something went wrong. Please retry.",  positionY: 'top', positionX: 'right', delay: 5000});
                            });
                        }
                        
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                    
                    
                }else{
                    Notification.warning({message: "Oops! Something went wrong. Please retry.",  positionY: 'top', positionX: 'right', delay: 5000});
                }

            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
                
        };
        $scope.resendVerifyEmail = function(){ 
            UserService.getUserBasic($scope.userId).success(function (data, status, headers) {
                var thisUser = data;
                console.log(thisUser);
                if(thisUser.email){
                    
                    $scope.email = {
                        to: thisUser.email,
                        templateName: 'Verification Email',
                        username: thisUser.basic.name,
                        userid: thisUser._id
                    };
                    EmailService.verifyEmail($scope.email).success(function (data, status, headers) {
                    var response = data;
                        Notification.primary({message: "Great! We have resent you a verification email at " + thisUser.email,  positionY: 'top', positionX: 'right', delay: 5000});

                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                        Notification.warning({message: "Oops! Something went wrong. Please retry.",  positionY: 'top', positionX: 'right', delay: 5000});
                    });
                }

            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
                
        };
        if(!$scope.thisUserEmailVerification){
            $scope.verifyEmail();
        }
        
    }]);
    
    
    exambazaar.controller("verifyClaimController", 
    [ '$scope', '$rootScope', 'targetStudyProviderService',  'OTPService','UserService', 'thisProvider', '$state', '$stateParams', '$cookies', '$mdDialog', '$timeout', function($scope, $rootScope, targetStudyProviderService, OTPService, UserService, thisProvider , $state, $stateParams, $cookies, $mdDialog, $timeout){
        $scope.provider = thisProvider.data;
        $scope.currStep = 1;
        if($scope.provider.mobile.length > 0)
            $scope.verifyMobile = $scope.provider.mobile[0];
        $scope.update = function(mobile){
            $scope.verifyMobile = mobile;
            $scope.currStep = 1;
        };
        $scope.enterOTP = [];
        $scope.userPassword ='';
        $scope.verifyPassword ='';
        $scope.sendOTP = function(){
            //var mobile = $scope.verifyMobile;
            var thisOTP = {
                mobile: $scope.verifyMobile,
                otp: generateOtp(),
                reason : 'Claiming ' + $scope.provider._id
            };
            //console.log(JSON.stringify(thisOTP));
            
            OTPService.generateOTP(thisOTP).success(function (data, status, headers) {
                $scope.serverOTP = data.otp;
                $scope.currStep = 2;
            })
            .error(function (data, status, header, config) {
                console.log();
            });
        };
        $scope.incorrectOTP = false;
        $scope.verifyOTP = function(){
            
            if($scope.enterOTP[0] && $scope.enterOTP[1] && $scope.enterOTP[2] && $scope.enterOTP[3]){
                var enterOTP = $scope.enterOTP[0].toString() + $scope.enterOTP[1].toString() + $scope.enterOTP[2].toString() + $scope.enterOTP[3].toString();
                console.log(enterOTP + " " + $scope.serverOTP);
                if(enterOTP == $scope.serverOTP){
                    $scope.currStep = 3;
                    $scope.incorrectOTP = false;
                    console.log('OTP verified');
                }else{
                    $scope.incorrectOTP = true;
                    console.log('OTP incorrect');
                    $scope.currStep = 2;
                }
                console.log($scope.currStep);
            }
        };
        $scope.updateUserPassword = function(userPassword){
            $scope.userPassword = userPassword;
        };
        $scope.updateVerifyPassword = function(verifyPassword){
            $scope.verifyPassword = verifyPassword;
        };
        $scope.createProvider = function(){
            
            var instituteId = $scope.provider._id;
            var mobile = $scope.verifyMobile;
            var userPassword = $scope.userPassword;
            var verifyPassword = $scope.verifyPassword;
            
            if(userPassword == verifyPassword){
                $scope.newUser = {
                    basic: {
                        name: $scope.provider.name     
                    },
                    partner: $scope.provider._id,
                    userType: 'Partner',
                    verified: true,
                    contact: {
                        mobile: mobile,
                    },
                    password: $scope.userPassword
                };
                var saveUser = UserService.saveUser($scope.newUser).success(function (data, status, headers) {
                    var fulluser = data;
                    $scope.userlogin.mobile = mobile;
                    $scope.userlogin.password = $scope.userPassword;
                    $scope.login();
                    /*var sessionuser = {
                        userId: fulluser._id,
                        masterId: fulluser._id,
                        facebookId: fulluser.facebookId,
                        userType: fulluser.userType,
                        basic: fulluser.basic,
                        image: fulluser.image,
                        mobile: fulluser.mobile,
                        email: fulluser.email,
                        
                    };
                    if(sessionuser.userType == 'Partner'){
                        sessionuser.partner = fulluser.partner;
                    }
                    $cookies.putObject('sessionuser', sessionuser);
                    
                    $state.go('partner-dashboard', {userId: sessionuser.userId});*/

                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }
            
        };
        
        $scope.$watch('enterOTP[3]', function (newValue, oldValue, scope) {
            //Do anything with $scope.letters
            if(newValue != null){
                $scope.verifyOTP();
            }
            
        }, true);
    }]);
    
    
    exambazaar.controller("eligibilityController", 
        [ '$scope', '$http','$state', '$stateParams', '$rootScope', '$cookies', 'UserService', 'availDiscountService', 'EmailService', '$mdDialog', '$timeout', 'Notification', 'examList', 'streamList', 'eligibilityList', function($scope,$http,$state, $stateParams, $rootScope, $cookies, UserService, availDiscountService, EmailService, $mdDialog, $timeout, Notification, examList, streamList, eligibilityList){
        $scope.col1Width = 40;
        $scope.col1WidthAcademic = 20;
        $scope.exams = examList.data;
        $scope.streams = streamList.data;
        $scope.eligibilityList = eligibilityList.data;
            
        $scope.setPage = function(pageName){
             $scope.components.forEach(function(thisCategory, index){
                if(thisCategory.name == pageName){
                    thisCategory.active = true;
                    $scope.activeCategory = thisCategory;
                    $scope.currentSubcategories = thisCategory.subcategories;
                    
                    $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
                }else{
                    thisCategory.active = false;
                }
            });
        };
        $scope.newemail = null;
        $scope.newmobile = null;
        $scope.components = [
            {
                name: 'Personal Details',
                active: false,
                state: 'academics',
                subcategories: [
                    {
                        name: 'Personal Details',
                    },
                ],
            },
            {
                name: 'Academic Details',
                active: false,
                state: 'academics',
                subcategories: [
                    {
                        name: 'Academic Details',
                    },
                ],
                /*subcategories: [
                    {
                        name: 'Education Level',
                    },
                    {
                        name: 'School Class XII',
                    },
                    {
                        name: 'Undergraduate',
                    },
                    {
                        name: 'Postgraduate',
                    },
                ],*/
            },
            {
                name: 'Your Exams',
                active: false,
                state: 'reviewed',
                subcategories: [
                    {
                        name: 'Your Exams',
                    },
                ],
            }
        ];
        $scope.setPage('Personal Details');
        
        $scope.categoryOptions = ["general","sc","st","obc"];
        $scope.educationLevels = [
            {
                level: 0,
                name: "I-X"
            },
            {
                level: 2,
                name: "XI / XII / After XII"
            },
            /*{
                level: 2,
                name: "After XII (Drop Year)"
            },*/
            {
                level: 3,
                name: "In UG or equivalent"
            },
            {
                level: 4,
                name: "During or After Final Year of UG"
            },
            {
                level: 5,
                name: "During or After Final Year of PG"
            },
        ];
        $scope.class12Subjects = [
            {
                name: "english",
                displayname: "English"
            },
            {
                name: "physics",
                displayname: "Physics"
            },
            {
                name: "chemistry",
                displayname: "Chemistry"
            },
            {
                name: "mathematics",
                displayname: "Mathematics"
            },
            {
                name: "biology",
                displayname: "Biology"
            },
            {
                name: "biotechnology",
                displayname: "Biotechnology"
            },
            {
                name: "others",
                displayname: "Others"
            },
        ];
        $scope.undergradMajors = [
            {
                name: "btech",
                displayname: "B.Tech.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "be",
                displayname: "B.E.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "mbbs",
                displayname: "M.B.B.S.",
                stream:{
                    name: "medical",
                    displayname: "Medical",
                },
            },
            {
                name: "bds",
                displayname: "B.D.S.",
                stream:{
                    name: "medical",
                    displayname: "Medical",
                },
            },
            {
                name: "bsc",
                displayname: "B.Sc.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "ba",
                displayname: "B.A.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "bftech",
                displayname: "NIFT B.F.Tech.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "bcom",
                displayname: "B.Com.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },	
            {
                name: "barch",
                displayname: "B. Arch.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "llb",
                displayname: "LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "others",
                displayname: "Others"
            },
            {
                name: "fiveyearballb",
                displayname: "Five Year B.A. LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "fiveyearintegratedllb",
                displayname: "Five Year Integrated LL.B. (Hons.)",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            
            {
                name: "lawdegreeequivalenttollb",
                displayname: "Law Degree equivalent to LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "professionalcourseequivalenttobtech",
                displayname: "Professional Courses equivalent to B.E. / B.Tech.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },

        ];
        $scope.postgradMajors = [
            {
                name: "mba",
                displayname: "M.B.A."
            },
            {
                name: "ms",
                displayname: "M.S."
            },
            {
                name: "mtech",
                displayname: "M.Tech."
            },
            {
                name: "mcom",
                displayname: "M.Com."
            },
            {
                name: "msc",
                displayname: "M.Sc."
            },
            {
                name: "ma",
                displayname: "M.A."
            },
            {
                name: "mca",
                displayname: "M.C.A."
            },
            {
                name: "llm",
                displayname: "LL.M."
            },
            {
                name: "others",
                displayname: "Others"
            },

        ];
        $scope.sanitizeEligibility = function(){
            if($scope.user.eligibility){
                if($scope.user.eligibility.age){
                    $scope.user.eligibility.age = Number($scope.user.eligibility.age);
                }
                if($scope.user.eligibility.class12Percentage){
                    $scope.user.eligibility.class12Percentage = Number($scope.user.eligibility.class12Percentage);
                }
                if($scope.user.eligibility.undergradPercentage){
                    $scope.user.eligibility.undergradPercentage = Number($scope.user.eligibility.undergradPercentage);
                }
                if($scope.user.eligibility.postgradPercentage){
                    $scope.user.eligibility.postgradPercentage = Number($scope.user.eligibility.postgradPercentage);
                }
            }
        };    
        
           
        if($cookies.getObject('sessionuser')){
            var sessionuser = $cookies.getObject( 'sessionuser');
            if(sessionuser && sessionuser._id){
                UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                    $scope.user = data;
                    
                    $rootScope.pageTitle = 'Exam Eligibility for ' + $scope.user.basic.name;
                    
                    UserService.getEligibility($scope.user._id).success(function (data, status, headers) {
                        if(data && data.eligibility){
                            $scope.user.eligibility = data.eligibility;
                            
                            
                            Notification.primary({message: "Welcome " + $scope.user.basic.name + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                            Notification.primary("Hurray! We have loaded your qualifications!");
                            $scope.sanitizeEligibility();
                            $scope.elgInput = $scope.user.eligibility;
                            checkEligibility();
                            
                        }


                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                    
                    
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                $cookies.remove("sessionuser");
                $rootScope.$emit("ForcedLogin", {});
            }
            
        }else{
            $cookies.remove("sessionuser");
            $rootScope.$emit("ForcedLogin", {});
        }
        
        
        $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
        
        $scope.setActiveSubcategory = function(subcategoryName){
            $scope.activeCategory.subcategories.forEach(function(thisSubcategory, index){
                if(thisSubcategory.name == subcategoryName){
                    $scope.activeSubcategory = thisSubcategory;
                }
            });
        };
        
        
        $scope.setNextActiveSubcategory = function(){
            var thisIndex = null;
            var nSubcategories = $scope.activeCategory.subcategories.length;
            $scope.activeCategory.subcategories.forEach(function(thisSubcategory, index){
                if(thisSubcategory.name == $scope.activeSubcategory.name){
                    thisIndex = index;
                }
            });
            if(thisIndex != null){
                if(thisIndex == nSubcategories - 1){
                    console.log('Do nothing');
                }else{

                    $scope.activeSubcategory = $scope.activeCategory.subcategories[thisIndex + 1];
                }
            }
        };
        $scope.setPreviousActiveCategory = function(){
            var thisIndex = null;
            var nCategories = $scope.components.length;
            $scope.components.forEach(function(thisCategory, index){
                if(thisCategory.name == $scope.activeCategory.name){
                    thisIndex = index;
                }
            });
            if(thisIndex != null){
                if(thisIndex == 0){
                    console.log('Do nothing');
                }else{
                    $scope.activeCategory = $scope.components[thisIndex - 1];
                    
                    $scope.currentSubcategories = $scope.activeCategory.subcategories;
                    $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
                }
            }
        }; 
        $scope.setNextActiveCategory = function(){
            var thisIndex = null;
            var nCategories = $scope.components.length;
            $scope.components.forEach(function(thisCategory, index){
                if(thisCategory.name == $scope.activeCategory.name){
                    thisIndex = index;
                }
            });
            if(thisIndex != null){
                if(thisIndex == nCategories - 1){
                    console.log('Do nothing');
                }else{
                    if(thisIndex == 0){
                        $scope.saveUser();
                    }
                    if(thisIndex == 1){
                        $scope.saveUser();
                        $scope.saveEligibility();
                        checkEligibility(thisIndex);
                    }
                    
                    $scope.activeCategory = $scope.components[thisIndex + 1];

                    $scope.currentSubcategories = $scope.activeCategory.subcategories;
                    $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
                    
                }
            }
        };    
            
        $scope.elgInput = {
            category: {
                general: true,
                sc: false,
                st: false,
                obc: false,
                pwd: false,
            },
            age: null,
            educationLevel:{
                level: null,
                name: null
            },
            class12Subjects:{
                biology: false,
                chemistry: false,
                biotechnology: false,
                physics: false,
                mathematics: false,
                english: false,
                others: false
            },
            class12Percentage: null,
            undergradMajor:{
                mbbs: false,
                bds: false,
                bsc: false,
                bftech: false,
                be: false,
                btech: false,
                bcom: false,
                ba: false,
                barch: false,
                llb: false,
                fiveyearintegratedllb: false,
                fiveyearballb: false,
                lawdegreeequivalenttollb: false,
                others: false,
            },
            undergradPercentage: null,
            postgradMajor:{
                mcom: false,
                msc: false,
                ma: false,
                mca: false,
                mtech: false,
                mba: false,
                ms: false,
                llm: false,
                others: false,
            },
            postgradPercentage: null,
            
        };    
        $scope.userVariables ={
            genders: [
                "Male",
                "Female",
            ],
            categories:[
                'GENERAL',    
                'OBC-NCL',    
                'SC',
                'ST',
            ],
        };
        $scope.setGender = function(gender){
            console.log(gender);
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            $scope.user.basic.gender = gender;
        };
        $scope.setCategory = function(caste){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            $scope.user.basic.category = caste;
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.category){
                $scope.user.eligibility.category = {};
            }
            if(caste == 'GENERAL'){
                $scope.user.eligibility.category.general = true;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = false;
            }
            if(caste == 'OBC-NCL'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = true;
            }
            if(caste == 'SC'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = true;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = false;
            }
            if(caste == 'ST'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = true;
                $scope.user.eligibility.category.obc = false;
            }
        };    
        $scope.setPwD = function(PwD){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.category){
                $scope.user.eligibility.category = {};
            }
            $scope.user.basic.PwD = PwD;
            $scope.user.eligibility.category.pwd = PwD;
        };  
        $scope.setAge = function(){
            if($scope.user.basic && $scope.user.basic.dob){
                var dob = moment($scope.user.basic.dob);
                var age = moment().diff(dob, 'years');
                if(!$scope.user.eligibility){
                    $scope.user.eligibility = {};
                }
                $scope.user.eligibility.age = age;
            }
        };
            
        $scope.sanitizeEligibility2 = function(eligibility){
            if(eligibility && eligibility.educationLevel){
                var eLevel = eligibility.educationLevel.level;
                if(eLevel == 0){
                    if(eligibility.class12Subjects){
                        for (var property in eligibility.class12Subjects) {
                            eligibility.class12Subjects[property] = null;
                        }
                    }
                    eligibility.class12Percentage = '';
                }
                if(eLevel < 3){
                    if(eligibility.undergradMajor){
                        for (var property in eligibility.undergradMajor) {
                            eligibility.undergradMajor[property] = null;
                        }
                    }
                    eligibility.undergradPercentage = '';
                }
                if(eLevel < 5){
                    if(eligibility.postgradMajor){
                        for (var property in eligibility.postgradMajor) {
                            eligibility.postgradMajor[property] = null;
                        }
                    }
                    eligibility.postgradPercentage = '';
                }
            }
        }; 
        $scope.setEducationLevel = function(educationLevel){
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.educationLevel){
                $scope.user.eligibility.educationLevel = {};
            }
            
            $scope.user.eligibility.educationLevel = educationLevel;
            $scope.sanitizeEligibility2($scope.user.eligibility);
            /*if($scope.user.eligibility.educationLevel.name == 'I-X'){
                console.log('I am here');
                $scope.components[0].subcategories = [];
            }
            if($scope.user.eligibility.educationLevel.name == 'XI / XII / After XII'){
                $scope.components[0].subcategories = [];
                $scope.components[0].subcategories.push({name: 'School Class XII'});
            }
            if($scope.user.eligibility.educationLevel.name == 'In UG or equivalent' || $scope.user.eligibility.educationLevel.name == 'During or After Final Year of UG'){
                $scope.components[0].subcategories = [];
                $scope.components[0].subcategories.push({name: 'School Class XII'});
                $scope.components[0].subcategories.push({name: 'Undergraduate'});
            }
            if($scope.user.eligibility.educationLevel.name == 'During or After Final Year of PG'){
                $scope.components[0].subcategories = [];
                $scope.components[0].subcategories.push({name: 'School Class XII'});
                $scope.components[0].subcategories.push({name: 'Undergraduate'});
                $scope.components[0].subcategories.push({name: 'Postgraduate'});
            }*/
            
            
            /*if($scope.user.eligibility.educationLevel.name == 'I-X'){
                console.log('I am here');
                $scope.components[0].subcategories = [];
            }
            if($scope.user.eligibility.educationLevel.name == 'XI / XII / After XII'){
                $scope.components[0].subcategories = [];
                $scope.components[0].subcategories.push({name: 'School Class XII'});
            }
            if($scope.user.eligibility.educationLevel.name == 'In UG or equivalent' || $scope.user.eligibility.educationLevel.name == 'During or After Final Year of UG'){
                $scope.components[0].subcategories = [];
                $scope.components[0].subcategories.push({name: 'School Class XII'});
                $scope.components[0].subcategories.push({name: 'Undergraduate'});
            }
            if($scope.user.eligibility.educationLevel.name == 'During or After Final Year of PG'){
                $scope.components[0].subcategories = [];
                $scope.components[0].subcategories.push({name: 'School Class XII'});
                $scope.components[0].subcategories.push({name: 'Undergraduate'});
                $scope.components[0].subcategories.push({name: 'Postgraduate'});
            }*/
            
            
        }; 
        $scope.setClass12Subjects = function(subjectName){
            //console.log($scope.user.eligibility.class12Subjects);
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.class12Subjects){
                $scope.user.eligibility.class12Subjects = {};
            }
            
            if(!$scope.user.eligibility.class12Subjects[subjectName]){
                $scope.user.eligibility.class12Subjects[subjectName] = true;
            }else{
                $scope.user.eligibility.class12Subjects[subjectName] = false;
            }
        };     
        $scope.setUndergradMajor = function(degreeName){
            
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.undergradMajor){
                $scope.user.eligibility.undergradMajor = {};
            }
            $scope.undergradMajors.forEach(function(thisDegree, index){
                if(thisDegree.name == degreeName){
                    if(!$scope.user.eligibility.undergradMajor[degreeName]){
                        $scope.user.eligibility.undergradMajor[degreeName] = true;
                    }else{
                        $scope.user.eligibility.undergradMajor[degreeName] = false;
                    }
                    
                }else{
                    $scope.user.eligibility.undergradMajor[thisDegree.name] = false;   
                }
            });
            
        };  
        $scope.setPostgradMajor = function(degreeName){
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.postgradMajor){
                $scope.user.eligibility.postgradMajor = {};
            }
            $scope.postgradMajors.forEach(function(thisDegree, index){
                if(thisDegree.name == degreeName){
                    if(!$scope.user.eligibility.postgradMajor[degreeName]){
                        $scope.user.eligibility.postgradMajor[degreeName] = true;
                    }else{
                        $scope.user.eligibility.postgradMajor[degreeName] = false;
                    }
                    
                }else{
                    $scope.user.eligibility.postgradMajor[thisDegree.name] = false;   
                }
            });
            
        };
        
        $scope.scrollTop = function(){
            document.body.scrollTop = document.documentElement.scrollTop = 0;
        };    
        var checkEligibility = function(thisIndex){
            //
            $scope.elgInput = $scope.user.eligibility;
            var error = false;
            var errorClass12Subjects = true;
            var errorUnderGradMajor = true;
            var errorPostGradMajor = true;
            var errorMessages = [];
            
            //console.log($scope.user.eligibility);
            if(!$scope.user.eligibility.category.general){
                $scope.user.eligibility.category.general = true;
            }
            if(!$scope.elgInput.age){
                error = true;
                errorMessages.push("Please select your age");
            }
            
            if($scope.elgInput.educationLevel.level == null){
                error = true;
                errorMessages.push("Please select your current education level");
            }
           
            
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=1){
                
                $scope.class12Subjects.forEach(function(thisSubject, index){
                    if($scope.elgInput.class12Subjects[thisSubject.name]){
                        errorClass12Subjects = false;
                    }
                    
                });
            }
            
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=1 && errorClass12Subjects){
                error = true;
                errorMessages.push("Please select your Class XII Subjects");
            }
            
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=3){
                if(!$scope.elgInput.class12Percentage){
                    error = true;
                    errorMessages.push("Please select your Class XII Percentage");
                }
            }
            
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=3){
                $scope.undergradMajors.forEach(function(thisMajor, index){
                    if($scope.elgInput.undergradMajor[thisMajor.name]){
                        errorUnderGradMajor = false;
                    }
                    if(index == $scope.undergradMajors.length - 1 && errorUnderGradMajor){
                        error = errorUnderGradMajor;
                        errorMessages.push("Please select your Undergraduate Major");
                    }
                });
            }
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=4){
                if(!$scope.elgInput.undergradPercentage){
                    error = true;
                    errorMessages.push("Please select your Undergraduate Percentage (or equivalent CGPA)");
                }
            }
            
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=5){
                $scope.postgradMajors.forEach(function(thisMajor, index){
                    if($scope.elgInput.postgradMajor[thisMajor.name]){
                        errorPostGradMajor = false;
                    }
                    if(index == $scope.postgradMajors.length - 1 && errorPostGradMajor){
                        error = errorPostGradMajor;
                        errorMessages.push("Please select your Postgraduate Major");
                    }
                });
            }
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=5){
                if(!$scope.elgInput.postgradPercentage){
                    error = true;
                    errorMessages.push("Please select your achieved or expected Postgraduate Percentage (or equivalent CGPA)");
                }
            }
            if(error){
                
                Notification.warning({message: "Please fill all academic details to proceed ahead!",  positionY: 'top', positionX: 'right', delay: 1000});
                return false;
            }else{
                $scope.saveEligibility();
                //return true;
                
                $scope.setPage('Your Exams');
                
                
                
                
                
                
                $scope.elgVerified = true;    
                $scope.validEligibilities = [];    
                $scope.uniqueValidEligibilities = [];
                //var checkExamIds = ['58ad20045401f52440af6f24'];
                $scope.eligibilityList.forEach(function(thisEligibility, index){
                
                var checkCategory = thisEligibility.category.applicable;
                var checkAge = thisEligibility.age.applicable;
                var checkClass12Subjects = thisEligibility.class12Subjects.applicable;
                var checkClass12Percentage = thisEligibility.class12Percentage.applicable;
                var checkUndergradMajor = thisEligibility.undergradMajor.applicable;
                var checkUndergradPercentage = thisEligibility.undergradPercentage.applicable;
                var checkPostgradMajor = thisEligibility.postgradMajor.applicable;
                var checkPostgradPercentage = thisEligibility.postgradPercentage.applicable;
                    
                
                var valid = true;
                if(checkCategory){
                    var categoryBool = false;
                    $scope.categoryOptions.forEach(function(thisItem, itemIndex){
                        if(thisEligibility.category[thisItem] && $scope.elgInput.category[thisItem]){
                            categoryBool = true;
                            //console.log(index + " " + valid + " " + thisItem + " " + thisEligibility._id);
                        }
                    });
                    if(!categoryBool){
                        valid = false;
                            /*if(checkExamIds.indexOf(thisEligibility.exam._id) != -1){
                                console.log(index + " " + valid + " " + thisItem + " " + thisEligibility._id);
                            }*/
                    }

                }
                if(checkAge){
                    if($scope.elgInput.age < thisEligibility.age.minage || $scope.elgInput.age > thisEligibility.age.maxage){
                        valid = false;
                        /*if(checkExamIds.indexOf(thisEligibility.exam._id) != -1){
                            console.log(index + " " + valid + " " + thisEligibility._id);
                        }*/
                        //console.log(index + " " + valid + " " + thisEligibility._id);
                    }
                }
                if(checkClass12Subjects){

                    if($scope.elgInput.educationLevel.level < 1){
                        valid = false;
                    }
                    $scope.class12Subjects.forEach(function(thisItem, itemIndex){
                        if(thisEligibility.class12Subjects[thisItem.name] && !$scope.elgInput.class12Subjects[thisItem.name]){
                            valid = false;
                            /*if(checkExamIds.indexOf(thisEligibility.exam._id) != -1){
                                console.log(index + " " + valid + " " + thisItem.name + " " + thisEligibility._id);
                            }*/
                            //console.log(index + " " + valid + " " + thisItem.name + " " + thisEligibility._id);
                        }
                    });
                }    
                if(checkClass12Percentage){
                    if(thisEligibility.class12Percentage.minPercentage && $scope.elgInput.class12Percentage < thisEligibility.class12Percentage.minPercentage){
                        valid = false;
                        //console.log(index + " " + valid + " " + thisEligibility._id);
                    }
                    if($scope.elgInput.class12Percentage == null || $scope.elgInput.class12Percentage == 0){
                        valid = false;
                    }
                }    
                if(checkUndergradMajor){
                    var undergradBool = false;
                    if($scope.elgInput.educationLevel.level < 3){
                        valid = false;
                    }
                    $scope.undergradMajors.forEach(function(thisItem, itemIndex){
                        if(thisEligibility.undergradMajor[thisItem.name] && $scope.elgInput.undergradMajor[thisItem.name]){
                            undergradBool = true;
                            //console.log(index + " " + valid + " " + thisItem.name + " "+ thisEligibility._id);
                        }
                    });
                    if(!undergradBool){
                        valid = false;
                        //console.log(index + " " + valid + " " + thisEligibility._id);
                   }
                }
                if(checkUndergradPercentage){
                    if(thisEligibility.undergradPercentage.minPercentage && $scope.elgInput.undergradPercentage < thisEligibility.undergradPercentage.minPercentage){
                        valid = false;
                        //console.log(index + " " + valid + " " + thisEligibility._id);
                    }
                    if($scope.elgInput.undergradPercentage == null || $scope.elgInput.undergradPercentage == 0){
                        valid = false;
                    }
                }    
                if(checkPostgradMajor){
                    var postgradBool = false;
                    if($scope.elgInput.educationLevel.level < 5){
                        valid = false;
                    }
                    $scope.postgradMajors.forEach(function(thisItem, itemIndex){
                       
                        if(thisEligibility.postgradMajor && thisEligibility.postgradMajor[thisItem.name] && $scope.elgInput.postgradMajor &&  $scope.elgInput.postgradMajor[thisItem.name]){
                            postgradBool = true;
                        }
                    });
                    if(!postgradBool){
                        valid = false;
                        //console.log(index + " " + valid + " " + thisEligibility._id);
                   }
                }    
                if(checkPostgradPercentage){
                    if(thisEligibility.postgradPercentage.minPercentage && $scope.elgInput.postgradPercentage < thisEligibility.postgradPercentage.minPercentage){
                        valid = false;
                        //console.log(index + " " + valid + " " + thisEligibility._id);
                    }
                    if($scope.elgInput.postgradPercentage == null || $scope.elgInput.postgradPercentage == 0){
                        valid = false;
                    }
                } 

                if(valid){
                    //console.log(thisEligibility.level + " " + $scope.elgInput.educationLevel.level);
                    if(thisEligibility.level >= $scope.elgInput.educationLevel.level){
                        $scope.validEligibilities.push(thisEligibility);
                    }

                }

                });

                $scope.validStreamExams = [];
                var uniqueStreamIds = [];
                var uniqueExamIds = [];

                $scope.validEligibilities.forEach(function(thisEligibility, eligIndex){
                    var streamId = thisEligibility.exam.stream._id;
                    var examId = thisEligibility.exam._id;

                    var sIndex = uniqueStreamIds.indexOf(streamId);
                    if(sIndex == -1){
                        uniqueStreamIds.push(streamId);
                        var streamexam = {
                            stream: thisEligibility.exam.stream,
                            examEligs: []
                        };
                        var newExamElig = {
                            exam: thisEligibility.exam,
                            eligibilitys: [thisEligibility]
                        };
                        streamexam.examEligs.push(newExamElig);
                        $scope.validStreamExams.push(streamexam);
                    }else{

                        var thisStreamExam = $scope.validStreamExams[sIndex];
                        var eIndex = -1;
                        thisStreamExam.examEligs.forEach(function(thisExamElig, examEligIndex){
                            if(thisExamElig.exam._id == examId){
                                eIndex = examEligIndex;
                            }
                        });

                        if(eIndex != -1){
                            thisStreamExam.examEligs[eIndex].eligibilitys.push(thisEligibility);
                        }else{
                            var newExamElig = {
                                exam: thisEligibility.exam,
                                eligibilitys: [thisEligibility]
                            };
                            thisStreamExam.examEligs.push(newExamElig);
                        }

                    }
                });

                //console.log($scope.validStreamExams);
                $scope.scrollTop(); 
                
                
                
            }
            
        };
        
        
        $scope.activeExamEligibility = null;
        
        $scope.showExamEligibility = function(examElig){
            $scope.activeExamEligibility = examElig;
            $scope.showExamEligDialog();
        };
        $scope.showExamEligDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#examEligDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
            
        $scope.saveUser = function(thisIndex){
            
            $scope.setAge();
            UserService.updateUser($scope.user).success(function (data, status, headers) {
                if(thisIndex == 0){
                    Notification.success({message: "Your contact details are saved!",  positionY: 'top', positionX: 'right', delay: 1000});
                }
                
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });    
        };
            
        $scope.saveEligibility = function(){
            if($scope.user && $scope.user._id){
                var eligibilityForm = {
                    user: $scope.user._id,
                    eligibility: $scope.elgInput
                };
                UserService.saveEligibility(eligibilityForm).success(function (data, status, headers) {
                    //Notification.success({message: "Your academic details are saved!",  positionY: 'top', positionX: 'right', delay: 1000});
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }   
        };   
    }]);      
        
    exambazaar.controller("availDiscountController", 
        [ '$scope', '$http','$state', '$stateParams', '$rootScope', '$cookies', 'UserService', 'availDiscountService', 'EmailService', '$mdDialog', '$timeout', 'Notification', 'thisGroup', 'thisExam', function($scope,$http,$state, $stateParams, $rootScope, $cookies, UserService, availDiscountService, EmailService, $mdDialog, $timeout, Notification, thisGroup, thisExam){
        $scope.col1Width = 40;
        $scope.col1WidthAcademic = 20;
        $scope.groupName = $stateParams.groupName;
            
        $scope.exam = thisExam.data;    
        $scope.coachingGroup = thisGroup.data;
        $scope.coachingLogo = null;
            
        $scope.coachingGroup.forEach(function(thisCoaching, cindex){
            if(thisCoaching.logo && !$scope.coachingLogo){
                $scope.coachingLogo = thisCoaching.logo;
            }
            
        });
            //console.log($scope.coachingGroup);
        $scope.setPage = function(pageName){
             $scope.components.forEach(function(thisCategory, index){
                if(thisCategory.name == pageName){
                    thisCategory.active = true;
                    $scope.activeCategory = thisCategory;
                    $scope.currentSubcategories = thisCategory.subcategories;
                    
                    $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
                }else{
                    thisCategory.active = false;
                }
            });
        };
        $scope.newemail = null;
        $scope.newmobile = null;
        $scope.components = [
            {
                name: 'Personal Details',
                active: false,
                state: 'profile',
                subcategories: [
                    {
                        name: 'Contact Information',
                    },
                ],
            },
            {
                name: 'Academic Details',
                active: false,
                state: 'academics',
                subcategories: [
                    {
                        name: 'Academic Details',
                    },
                ],
                /*subcategories: [
                    {
                        name: 'Education Level',
                    },
                    {
                        name: 'School Class XII',
                    },
                    {
                        name: 'Undergraduate',
                    },
                    {
                        name: 'Postgraduate',
                    },
                ],*/
            },
            {
                name: 'Course Preferences',
                active: false,
                state: 'reviewed',
                subcategories: [
                    {
                        name: 'Course Preferences',
                    },
                ],
            },
            {
                name: 'Acknowledgment',
                active: false,
                state: 'userInstitutes',
                subcategories: [
                    {
                        name: 'Thank you',
                    },
                ],
            },
        ];
        $scope.setPage('Personal Details');
        
            
        $scope.educationLevels = [
            {
                level: 0,
                name: "I-X"
            },
            {
                level: 2,
                name: "XI / XII / After XII"
            },
            /*{
                level: 2,
                name: "After XII (Drop Year)"
            },*/
            {
                level: 3,
                name: "In UG or equivalent"
            },
            {
                level: 4,
                name: "During or After Final Year of UG"
            },
            {
                level: 5,
                name: "During or After Final Year of PG"
            },
        ];
        $scope.class12Subjects = [
            {
                name: "english",
                displayname: "English"
            },
            {
                name: "physics",
                displayname: "Physics"
            },
            {
                name: "chemistry",
                displayname: "Chemistry"
            },
            {
                name: "mathematics",
                displayname: "Mathematics"
            },
            {
                name: "biology",
                displayname: "Biology"
            },
            {
                name: "biotechnology",
                displayname: "Biotechnology"
            },
            {
                name: "others",
                displayname: "Others"
            },
        ];
        $scope.undergradMajors = [
            {
                name: "btech",
                displayname: "B.Tech.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "be",
                displayname: "B.E.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "mbbs",
                displayname: "M.B.B.S.",
                stream:{
                    name: "medical",
                    displayname: "Medical",
                },
            },
            {
                name: "bds",
                displayname: "B.D.S.",
                stream:{
                    name: "medical",
                    displayname: "Medical",
                },
            },
            {
                name: "bsc",
                displayname: "B.Sc.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "ba",
                displayname: "B.A.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "bftech",
                displayname: "NIFT B.F.Tech.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "bcom",
                displayname: "B.Com.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },	
            {
                name: "barch",
                displayname: "B. Arch.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "llb",
                displayname: "LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "others",
                displayname: "Others"
            },
            {
                name: "fiveyearballb",
                displayname: "Five Year B.A. LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "fiveyearintegratedllb",
                displayname: "Five Year Integrated LL.B. (Hons.)",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            
            {
                name: "lawdegreeequivalenttollb",
                displayname: "Law Degree equivalent to LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "professionalcourseequivalenttobtech",
                displayname: "Professional Courses equivalent to B.E. / B.Tech.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },

        ];
        $scope.postgradMajors = [
            {
                name: "mba",
                displayname: "M.B.A."
            },
            {
                name: "ms",
                displayname: "M.S."
            },
            {
                name: "mtech",
                displayname: "M.Tech."
            },
            {
                name: "mcom",
                displayname: "M.Com."
            },
            {
                name: "msc",
                displayname: "M.Sc."
            },
            {
                name: "ma",
                displayname: "M.A."
            },
            {
                name: "mca",
                displayname: "M.C.A."
            },
            {
                name: "llm",
                displayname: "LL.M."
            },
            {
                name: "others",
                displayname: "Others"
            },

        ];
        $scope.sanitizeEligibility = function(){
            if($scope.user.eligibility){
                if($scope.user.eligibility.age){
                    $scope.user.eligibility.age = Number($scope.user.eligibility.age);
                }
                if($scope.user.eligibility.class12Percentage){
                    $scope.user.eligibility.class12Percentage = Number($scope.user.eligibility.class12Percentage);
                }
                if($scope.user.eligibility.undergradPercentage){
                    $scope.user.eligibility.undergradPercentage = Number($scope.user.eligibility.undergradPercentage);
                }
                if($scope.user.eligibility.postgradPercentage){
                    $scope.user.eligibility.postgradPercentage = Number($scope.user.eligibility.postgradPercentage);
                }
            }
        };    
        
        $scope.availDiscount = {};    
        if($cookies.getObject('sessionuser')){
            var sessionuser = $cookies.getObject( 'sessionuser');
            if(sessionuser && sessionuser._id){
                UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                    $scope.user = data;
                    $scope.sanitizeEligibility();
                    Notification.primary({message: "Welcome " + $scope.user.basic.name + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                    $rootScope.pageTitle = 'Avail Discount at ' + $stateParams.groupName;
                    $scope.availDiscount = {
                        user: $scope.user._id,
                        exam: $scope.exam._id,
                        course: {
                            city: $stateParams.cityName,
                            groupname: $stateParams.groupName,
                            name: '',
                            duration: ''
                        }
                    };
                    availDiscountService.findAvailDiscount($scope.availDiscount).success(function (thisData, status, headers) {
                        if(!thisData){
                            
                        }else{
                            $scope.availDiscount = thisData;
                            $scope.setPage('Acknowledgment');
                            Notification.success({message: "Great we have registered your interest in " + $scope.groupName +". We are following up with them!",  positionY: 'top', positionX: 'right', delay: 10000});
                        }
                        //Notification.primary({message: "Great we will reach out to " + $scope.groupName + ' for you!',  positionY: 'top', positionX: 'right', delay: 1000});

                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                $cookies.remove("sessionuser");
                $rootScope.$emit("CallBlogLogin", {});
            }
            
        }else{
            $cookies.remove("sessionuser");
        }
        
        $scope.saveAvailDiscount = function(){
            availDiscountService.saveAvailDiscount($scope.availDiscount).success(function (data, status, headers) {
                $scope.availDiscount = data;
                var emailForm = {
                    templateName: 'Avail Discount Receipt',
                    student: {
                        name: $scope.user.basic.name,
                        email: $scope.user.email,
                        mobile: $scope.user.mobile,
                    },
                    coaching: {
                        name: $stateParams.groupName,
                        city: $stateParams.cityName,
                        exam: $scope.exam.seoname,
                    },
                    course: {
                        name: $scope.availDiscount.course.name,
                        duration: $scope.availDiscount.course.duration,
                    }
                };
                //console.log(emailForm);
                EmailService.availDiscountEmail(emailForm).success(function (thisData, status, headers) {
                    
                    Notification.primary({message: "Great we will reach out to " + $scope.groupName + ' for you!',  positionY: 'top', positionX: 'right', delay: 10000});

                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
        };
        
        $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
        
        $scope.setActiveSubcategory = function(subcategoryName){
            $scope.activeCategory.subcategories.forEach(function(thisSubcategory, index){
                if(thisSubcategory.name == subcategoryName){
                    $scope.activeSubcategory = thisSubcategory;
                }
            });
        };
        
        
        $scope.setNextActiveSubcategory = function(){
            var thisIndex = null;
            var nSubcategories = $scope.activeCategory.subcategories.length;
            $scope.activeCategory.subcategories.forEach(function(thisSubcategory, index){
                if(thisSubcategory.name == $scope.activeSubcategory.name){
                    thisIndex = index;
                }
            });
            if(thisIndex != null){
                if(thisIndex == nSubcategories - 1){
                    console.log('Do nothing');
                }else{

                    $scope.activeSubcategory = $scope.activeCategory.subcategories[thisIndex + 1];
                }
            }
        };
        $scope.setPreviousActiveCategory = function(){
            var thisIndex = null;
            var nCategories = $scope.components.length;
            $scope.components.forEach(function(thisCategory, index){
                if(thisCategory.name == $scope.activeCategory.name){
                    thisIndex = index;
                }
            });
            if(thisIndex != null){
                if(thisIndex == 0){
                    console.log('Do nothing');
                }else{
                    $scope.activeCategory = $scope.components[thisIndex - 1];
                    
                    $scope.currentSubcategories = $scope.activeCategory.subcategories;
                    $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
                }
            }
        }; 
        $scope.setNextActiveCategory = function(){
            var thisIndex = null;
            var nCategories = $scope.components.length;
            $scope.components.forEach(function(thisCategory, index){
                if(thisCategory.name == $scope.activeCategory.name){
                    thisIndex = index;
                }
            });
            if(thisIndex != null){
                if(thisIndex == nCategories - 1){
                    console.log('Do nothing');
                }else{
                    var validTransition = true;
                    if(thisIndex == 0){
                        if($scope.user.newemail && $scope.user.newemail != ''){
                            $scope.user.email = $scope.user.newemail;
                        }
                        if($scope.user.newmobile && $scope.user.newmobile != ''){
                            $scope.user.mobile = $scope.user.newmobile;
                        }
                        if(!$scope.user.basic.name){
                            validTransition = false;
                            Notification.warning({message: "Please mention your name!",  positionY: 'top', positionX: 'right', delay: 5000});
                        }
                        if(!$scope.user.mobile){
                            validTransition = false;
                            Notification.warning({message: "Please mention your mobile number!",  positionY: 'top', positionX: 'right', delay: 5000});
                        }
                        if(!$scope.user.email){
                            validTransition = false;
                            Notification.warning({message: "Please mention your email address!",  positionY: 'top', positionX: 'right', delay: 5000});
                        }
                    }
                    
                    
                    
                    if(thisIndex == 2){
                        if($scope.user.newemail && $scope.user.newemail != ''){
                            $scope.user.email = $scope.user.newemail;
                        }
                        if($scope.user.newmobile && $scope.user.newmobile != ''){
                            $scope.user.mobile = $scope.user.newmobile;
                        }
                        if(!$scope.user.basic.name){
                            validTransition = false;
                        }
                        if(!$scope.user.mobile){
                            validTransition = false;
                        }
                        if(!$scope.user.email){
                            validTransition = false;
                        }
                    }
                    
                    if(validTransition){
                        var nextMove = false;
                        if(thisIndex == 0){
                            nextMove = true;
                            $scope.saveUser(thisIndex);
                        }
                        if(thisIndex == 1){
                            if(checkEligibility(thisIndex)){
                                nextMove = true;
                            }
                        }
                        if(thisIndex == 2){
                            nextMove = true;
                            if(!$scope.availDiscount.course.name || $scope.availDiscount.course.name.length < 2){
                                nextMove = false;
                            }
                            if(!$scope.availDiscount.course.duration || $scope.availDiscount.course.duration.length < 2){
                                nextMove = false;
                            }
                            if(nextMove){
                                $scope.saveAvailDiscount();
                            }else{
                                Notification.warning({message: "Please fill the course details at " + $scope.groupName + ", you want to buy!" ,  positionY: 'top', positionX: 'right', delay: 10000});
                            }
                            
                        }
                        
                        if(nextMove){
                            $scope.activeCategory = $scope.components[thisIndex + 1];

                            $scope.currentSubcategories = $scope.activeCategory.subcategories;
                            $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
                            
                        }
                        
                    }
                    
                }
            }
        };    
            
        $scope.elgInput = {
            category: {
                general: true,
                sc: false,
                st: false,
                obc: false,
                pwd: false,
            },
            age: null,
            educationLevel:{
                level: null,
                name: null
            },
            class12Subjects:{
                biology: false,
                chemistry: false,
                biotechnology: false,
                physics: false,
                mathematics: false,
                english: false,
                others: false
            },
            class12Percentage: null,
            undergradMajor:{
                mbbs: false,
                bds: false,
                bsc: false,
                bftech: false,
                be: false,
                btech: false,
                bcom: false,
                ba: false,
                barch: false,
                llb: false,
                fiveyearintegratedllb: false,
                fiveyearballb: false,
                lawdegreeequivalenttollb: false,
                others: false,
            },
            undergradPercentage: null,
            postgradMajor:{
                mcom: false,
                msc: false,
                ma: false,
                mca: false,
                mtech: false,
                mba: false,
                ms: false,
                llm: false,
                others: false,
            },
            postgradPercentage: null,
            
        };    
        $scope.userVariables ={
            genders: [
                "Male",
                "Female",
            ],
            categories:[
                'GENERAL',    
                'OBC-NCL',    
                'SC',
                'ST',
            ],
        };
        $scope.setGender = function(gender){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            $scope.user.basic.gender = gender;
        };
        $scope.setCategory = function(caste){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            $scope.user.basic.category = caste;
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.category){
                $scope.user.eligibility.category = {};
            }
            if(caste == 'GENERAL'){
                $scope.user.eligibility.category.general = true;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = false;
            }
            if(caste == 'OBC-NCL'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = true;
            }
            if(caste == 'SC'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = true;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = false;
            }
            if(caste == 'ST'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = true;
                $scope.user.eligibility.category.obc = false;
            }
        };    
        $scope.setPwD = function(PwD){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.category){
                $scope.user.eligibility.category = {};
            }
            $scope.user.basic.PwD = PwD;
            $scope.user.eligibility.category.pwd = PwD;
        };
        
        $scope.setAge = function(){
            if($scope.user.basic && $scope.user.basic.dob){
                var dob = moment($scope.user.basic.dob);
                var age = moment().diff(dob, 'years');
                if(!$scope.user.eligibility){
                    $scope.user.eligibility = {};
                }
                $scope.user.eligibility.age = age;
            }
        };
        
        $scope.setEducationLevel = function(educationLevel){
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.educationLevel){
                $scope.user.eligibility.educationLevel = {};
            }
            
            $scope.user.eligibility.educationLevel = educationLevel;
            
            /*if($scope.user.eligibility.educationLevel.name == 'I-X'){
                console.log('I am here');
                $scope.components[0].subcategories = [];
            }
            if($scope.user.eligibility.educationLevel.name == 'XI / XII / After XII'){
                $scope.components[0].subcategories = [];
                $scope.components[0].subcategories.push({name: 'School Class XII'});
            }
            if($scope.user.eligibility.educationLevel.name == 'In UG or equivalent' || $scope.user.eligibility.educationLevel.name == 'During or After Final Year of UG'){
                $scope.components[0].subcategories = [];
                $scope.components[0].subcategories.push({name: 'School Class XII'});
                $scope.components[0].subcategories.push({name: 'Undergraduate'});
            }
            if($scope.user.eligibility.educationLevel.name == 'During or After Final Year of PG'){
                $scope.components[0].subcategories = [];
                $scope.components[0].subcategories.push({name: 'School Class XII'});
                $scope.components[0].subcategories.push({name: 'Undergraduate'});
                $scope.components[0].subcategories.push({name: 'Postgraduate'});
            }*/
            
            
        };
            
        $scope.setClass12Subjects = function(subjectName){
            //console.log($scope.user.eligibility.class12Subjects);
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.class12Subjects){
                $scope.user.eligibility.class12Subjects = {};
            }
            
            if(!$scope.user.eligibility.class12Subjects[subjectName]){
                $scope.user.eligibility.class12Subjects[subjectName] = true;
            }else{
                $scope.user.eligibility.class12Subjects[subjectName] = false;
            }
        };     
        $scope.setUndergradMajor = function(degreeName){
            
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.undergradMajor){
                $scope.user.eligibility.undergradMajor = {};
            }
            $scope.undergradMajors.forEach(function(thisDegree, index){
                if(thisDegree.name == degreeName){
                    if(!$scope.user.eligibility.undergradMajor[degreeName]){
                        $scope.user.eligibility.undergradMajor[degreeName] = true;
                    }else{
                        $scope.user.eligibility.undergradMajor[degreeName] = false;
                    }
                    
                }else{
                    $scope.user.eligibility.undergradMajor[thisDegree.name] = false;   
                }
            });
            
        };  
            
        $scope.setPostgradMajor = function(degreeName){
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.postgradMajor){
                $scope.user.eligibility.postgradMajor = {};
            }
            $scope.postgradMajors.forEach(function(thisDegree, index){
                if(thisDegree.name == degreeName){
                    if(!$scope.user.eligibility.postgradMajor[degreeName]){
                        $scope.user.eligibility.postgradMajor[degreeName] = true;
                    }else{
                        $scope.user.eligibility.postgradMajor[degreeName] = false;
                    }
                    
                }else{
                    $scope.user.eligibility.postgradMajor[thisDegree.name] = false;   
                }
            });
            
        };
            
        var checkEligibility = function(thisIndex){
            if(!$scope.user.eligibility){
                 $scope.user.eligibility = $scope.elgInput;
            }
            $scope.elgInput = $scope.user.eligibility;
            var error = false;
            var errorClass12Subjects = true;
            var errorUnderGradMajor = true;
            var errorPostGradMajor = true;
            var errorMessages = [];
            
            if(!$scope.elgInput.age){
                error = true;
                errorMessages.push("Please select your age");
            }
            
            if($scope.elgInput.educationLevel){
            if($scope.elgInput.educationLevel.level == null){
                error = true;
                errorMessages.push("Please select your current education level");
            }
           
            
                
            
            if($scope.elgInput.educationLevel.level>=1){
                
                $scope.class12Subjects.forEach(function(thisSubject, index){
                    if($scope.elgInput.class12Subjects && $scope.elgInput.class12Subjects[thisSubject.name]){
                        errorClass12Subjects = false;
                    }
                    
                });
            }
            
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=1 && errorClass12Subjects){
                error = true;
                errorMessages.push("Please select your Class XII Subjects");
            }
            
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=3){
                if(!$scope.elgInput.class12Percentage){
                    error = true;
                    errorMessages.push("Please select your Class XII Percentage");
                }
            }
            
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=3){
                $scope.undergradMajors.forEach(function(thisMajor, index){
                    if($scope.elgInput.undergradMajor && $scope.elgInput.undergradMajor[thisMajor.name]){
                        errorUnderGradMajor = false;
                    }
                    if(index == $scope.undergradMajors.length - 1 && errorUnderGradMajor){
                        error = errorUnderGradMajor;
                        errorMessages.push("Please select your Undergraduate Major");
                    }
                });
            }
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=4){
                if(!$scope.elgInput.undergradPercentage){
                    error = true;
                    errorMessages.push("Please select your Undergraduate Percentage (or equivalent CGPA)");
                }
            }
            
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=5){
                $scope.postgradMajors.forEach(function(thisMajor, index){
                    if($scope.elgInput.postgradMajor[thisMajor.name]){
                        errorPostGradMajor = false;
                    }
                    if(index == $scope.postgradMajors.length - 1 && errorPostGradMajor){
                        error = errorPostGradMajor;
                        errorMessages.push("Please select your Postgraduate Major");
                    }
                });
            }
            if($scope.elgInput.educationLevel.level && $scope.elgInput.educationLevel.level>=5){
                if(!$scope.elgInput.postgradPercentage){
                    error = true;
                    errorMessages.push("Please select your achieved or expected Postgraduate Percentage (or equivalent CGPA)");
                }
            }
            
            }else{
                error = true;
                errorMessages.push("Please select your current education level");
            }
            
            
            //console.log(error);
            //console.log(errorMessages);
            if(error){
                
                Notification.warning({message: "Please fill all academic details to proceed ahead!",  positionY: 'top', positionX: 'right', delay: 1000});
                return false;
            }else{
                $scope.saveEligibility();
                return true;
            
            }
            
        };
            
        $scope.saveUser = function(thisIndex){
            
            $scope.setAge();
            UserService.updateUser($scope.user).success(function (data, status, headers) {
                if(thisIndex == 0){
                    Notification.success({message: "Your contact details are saved!",  positionY: 'top', positionX: 'right', delay: 1000});
                }
                
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });    
        };
            
        $scope.saveEligibility = function(){
            if($scope.user && $scope.user._id){
                var eligibilityForm = {
                    user: $scope.user._id,
                    eligibility: $scope.elgInput
                };
                UserService.saveEligibility(eligibilityForm).success(function (data, status, headers) {
                    Notification.success({message: "Your academic details are saved!",  positionY: 'top', positionX: 'right', delay: 1000});
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }   
        };   
    }]);  
        
    
   
    exambazaar.controller("p5Controller", 
    [ '$scope','$rootScope', 'targetStudyProviderService', 'thisGroup', 'thisStream', 'thisExam', 'streamList', 'examList', '$state','$stateParams', '$cookies', 'UserService', '$mdDialog', '$timeout',  'viewService', 'reviewService','thisGroupResults', function($scope,$rootScope, targetStudyProviderService,thisGroup, thisStream, thisExam, streamList, examList,$state,$stateParams, $cookies, UserService, $mdDialog, $timeout,  viewService, reviewService,thisGroupResults){
        $rootScope.reviewStream = null;
        $rootScope.reviewExam = null;
        $rootScope.reviewCity = null;
        $rootScope.reviewInstitute = null;
        $mdDialog.hide();
        
        $scope.cancel = function() {
          $mdDialog.cancel();
        };
        
        $scope.thisGroupR = thisGroupResults.data;
        if(!$scope.thisGroupR){
            $scope.thisGroupR = [];
        }
        $scope.group = thisGroup.data;
        var groupDisabled = $scope.group.map(function(a) {return a.disabled;});
        var groupIds = $scope.group.map(function(a) {return a._id;});
        
        $scope.exam = thisExam.data;
        $scope.thisExam = $scope.exam;
        $scope.category = thisStream.data;
        $scope.categoryName = $stateParams.categoryName;
        $scope.groupName = $stateParams.groupName;
        $scope.subCategoryName = $stateParams.subCategoryName;
        $scope.subcategory = $scope.exam;
        $scope.city = $stateParams.cityName; 
        $scope.allExams = examList.data;
        $scope.allStreams = streamList.data;
        $scope.playerVars = {
            controls: 1,
            showinfo: 0
        };
        //console.log($scope.allExams);
        if($cookies.getObject('sessionuser')){
            $scope.user = $cookies.getObject('sessionuser');
             UserService.getUserShortlistedInstitutes($scope.user.userId).success(function (data, status, headers) {
                 var allShortlistData = data;
                 var allShortlistedIds = allShortlistData.map(function(a) {return a.institute._id;});
                 $scope.shortlistedIds = [];
                 $scope.shortlistDetails = [];
                 groupIds.forEach(function(thisGroupId, gindex){
                     var sIndex = allShortlistedIds.indexOf(thisGroupId);
                     if(sIndex != -1){
                     $scope.shortlistedIds.push(thisGroupId); $scope.shortlistDetails.push(allShortlistData[sIndex]);
                     }
                 });
                if($scope.shortlistedIds.indexOf($scope.provider._id) != -1){
                    $scope.shortlisted = true;
                }
            })
            .error(function (data, status, header, config) {
                console.log('Shortlist Error' + status + " " + data);    
            }); 
            
            if($scope.user.userType=='Master' || $scope.user.userType=='Intern - Business Development'){
                $scope.ebuser = true;
            }
            
            /*if($scope.user.userType=='Master'){
                $scope.editable = true;
                $scope.verifiedUser = true;
                $scope.ebuser = true;
            }
            if($scope.user.userType=='Intern - Business Development'){
                $scope.editable = true;
                $scope.verifiedUser = true;
                $scope.ebuser = true;
                //$scope.showClaimDialog();
            }
            if($scope.user.userType=='Partner'){
                $scope.verifiedUser = true;
                $scope.ebuser = false;
                if($scope.user.partner.indexOf($scope.provider._id) != -1){
                    if(!$scope.provider.primaryManagement || $scope.provider.primaryManagement.name =='' || $scope.provider.primaryManagement.mobile ==''){
                        
                        $scope.editable = false;
                        $scope.showAddPrimaryManagement();
                    }else{
                        $scope.editable = true;
                    }
                    
                    
                    
                }else{
                    $scope.editable = false;
                    $scope.showUnauthorizedAccess();
                    
                }
                
            }*/
        }else{
            
            $scope.signupNeeded = true;
            //user is not allowed to access this page
            /*var viewForm = {
                institute: $scope.provider._id,
                claim: true
            };
            if($cookies.getObject('ip')){
                var ip = $cookies.getObject('ip');
                viewForm.ip = ip;
            }
            viewService.saveview(viewForm).success(function (data, status, headers) {
                console.log('View Marked');
            })
            .error(function (data, status, header, config) {
                console.log();
            });*/
        }
        
        if(!$scope.user || !$scope.user.userId){
            $scope.showLoginForm();
        }
        
        $scope.overviewIcons = [
            {
                icon:'images/icons/centre.png',
                text:'Centres',
                data: '1'
            },
            {
                icon:'images/icons/city.png',
                text:'Cities',
                data: '1'
            },
            {
                icon:'images/icons/students.png',
                text:'Students',
                data: '100'
            },
            {
                icon:'images/icons/faculty.png',
                text:'Faculty',
                data: '10'
            }
        ];
        $scope.components = [
            /*'Overview',*/
            'Contact',
            'Exams',
            'Results',
            'Courses',
            'Photos',
            'Videos',
            'Faculty',
            'Location',
            'Reviews'
        ];
        $scope.rankCategories = [
            'GENERAL',    
            'OBC-NCL',    
            'SC/ST',    
            'PwD'   
        ];
        $scope.resultYears = [
            '2017',    
            '2016',    
            '2015',    
            '2014',    
            '2013',    
            '2012',    
            '2011',    
            '2010',    
            '2009',    
            '2008',    
            '2007',    
            '2006',    
            '2005',    
            '2004',    
            '2003'    
        ];
        
        $scope.provider = {
            name: $stateParams.groupName,
            city: $stateParams.cityName
        };
        $scope.groupExams = [];
        $scope.groupStreams = [];
        $scope.groupPhotos = [];
        $scope.groupVideos = [];
        $scope.groupResults = [];
        $scope.groupCourses = [];
        $scope.groupFaculties = [];
        var groupExamIds = [];
        var groupStreamIds = [];
        var examTitle = ' for ';
        $scope.currStreamExams = [];
        $scope.group.forEach(function(thisGroup, index){
            if(thisGroup.latlng){
                thisGroup.mapAddress = [thisGroup.latlng.lat, thisGroup.latlng.lng];
                //console.log(thisGroup.mapAddress);
            }
            if(thisGroup.logo){
                $scope.provider.logo = thisGroup.logo;
            }
            var thisGroupExams = thisGroup.exams;
            thisGroupExams.forEach(function(thisExam, index){
                groupExamIds = $scope.groupExams.map(function(a) {return a.exam._id;});
                var eIndex = groupExamIds.indexOf(thisExam._id);
                
                if(eIndex == -1){
                    var newGroupExam = {
                        exam: thisExam,
                        centre: [thisGroup]
                    };
                    var thisStream = thisExam.stream;
                    groupStreamIds = $scope.groupStreams.map(function(a) {return a._id;});
                    if(groupStreamIds.indexOf(thisStream._id) == -1){ $scope.groupStreams.push(thisStream);
                    }
                    $scope.groupExams.push(newGroupExam);
                    if($scope.category._id.toString() == thisExam.stream._id.toString()){
                        $scope.currStreamExams.push(thisExam);
                    }
                }else{
                    var groupExam = $scope.groupExams[eIndex];
                    groupExam.centre.push(thisGroup);
                }
            });
            var thisGroupPhoto = thisGroup.photo;
            //var thisGroupResults = thisGroup.results;
            var thisGroupResults = $scope.thisGroupR;
            var thisGroupVideo = thisGroup.video;
            var thisGroupFaculty = thisGroup.faculty;
            var thisGroupCourse = thisGroup.course;
            $scope.groupPhotos = $scope.groupPhotos.concat(thisGroupPhoto);
            $scope.groupVideos = $scope.groupVideos.concat(thisGroupVideo);
            $scope.groupFaculties = $scope.groupFaculties.concat(thisGroupFaculty);
            $scope.groupResults = $scope.groupResults.concat(thisGroupResults);
            $scope.groupCourses = $scope.groupCourses.concat(thisGroupCourse);
        });
        
        $scope.groupExamsOnly = $scope.groupExams.map(function(a) {return a.exam;});
        //console.log($scope.groupResults);
        
        $scope.showPhotoDialog = function(ev,index) {
            $scope.activePhotoIndex = index;
            $scope.activePhoto = $scope.groupPhotos[index];
            var indexPair = startEndIndex(index, $scope.groupPhotos.length);
            $scope.startPhotoIndex = indexPair.start;
            $scope.endPhotoIndex = indexPair.end;
            
            $mdDialog.show({
              contentElement: '#photoDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        function startEndIndex (index, arrayLength){
            
            var showLength = 6;
            var indexPair = {
                start: 0,
                end: arrayLength
            };
            
            if(index - showLength/2 <=0){
                indexPair.start = 0;
                indexPair.end = Math.min(indexPair.start + showLength, arrayLength);
            }else{
                if(index + showLength/2 >= arrayLength){
                    indexPair.end = arrayLength;
                    indexPair.start = Math.max(0, indexPair.end - showLength);
                    
                }else{
                    indexPair.start = index -showLength/2;
                    indexPair.end = Math.min(indexPair.start + showLength, arrayLength);
                }
                
            }
            return (indexPair);
        };
        
        $scope.prevPhoto = function(){
            var index = $scope.activePhotoIndex - 1;
            $scope.changePhotoImage(index);
        };
         $scope.nextPhoto = function(){
            var index = $scope.activePhotoIndex + 1;
            $scope.changePhotoImage(index);
        };
        $scope.changePhotoImage = function(index){
            var arrayLength = $scope.groupPhotos.length;
            if(index >=0 && index < arrayLength){
                $scope.activePhotoIndex = index;
                $scope.activePhoto = $scope.groupPhotos[index];
                var indexPair = startEndIndex(index, $scope.groupPhotos.length);
                //console.log(JSON.stringify(indexPair));
                $scope.startPhotoIndex = indexPair.start;
                $scope.endPhotoIndex = indexPair.end;
            }
            
        };
        $scope.showFacultyDialog = function(ev,index) {
            $scope.activeFacultyIndex = index;
            $scope.activeFaculty = $scope.groupFaculties[index];
            var indexPair = startEndIndex(index, $scope.groupFaculties.length);
            $scope.startFacultyIndex = indexPair.start;
            $scope.endFacultyIndex = indexPair.end;
            
            $mdDialog.show({
              contentElement: '#facultyDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        
        $scope.getShortlistSelectedColour = function(thisGroup){
            var className = "notselected";
            if($scope.shortlistedIds){
                var sIndex = $scope.shortlistedIds.indexOf(thisGroup._id);
                if(sIndex == -1){
                }else{
                    className = "selected";
                }
            }
            
            
            
            return className;
        };
        
        
        $scope.updateShortlistInstitute = function(thisGroup){
            var sIndex = $scope.shortlistedIds.indexOf(thisGroup._id);
            
            if(sIndex == -1){
                $scope.shortlistedIds.push(thisGroup._id);
                $scope.shortlistInstitute(thisGroup._id);
            }else{
                //$scope.shortlistedIds.splice(sIndex, 1);
            }
            
        };
        
        
        $scope.shortlistInstitute = function(instituteId){
            //console.log($scope.shortlistedIds);
            //$scope.showSelectShortlistCentreDialog();
            if($scope.user.userId && instituteId){
                var shortListForm = {
                    userId: $scope.user.userId,
                    instituteId: instituteId
                };
                UserService.shortlistInstitute(shortListForm).success(function (data, status, headers) {
                    console.log('Institute Shortlisted');
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log('Shortlist error: ' + status + " " + data);    
                });  
            }
              
        };
        $scope.prevFaculty = function(){
            var index = $scope.activeFacultyIndex - 1;
            $scope.changeFacultyImage(index);
        };
         $scope.nextFaculty = function(){
            var index = $scope.activeFacultyIndex + 1;
            $scope.changeFacultyImage(index);
        };
        $scope.changeFacultyImage = function(index){
            var arrayLength = $scope.groupFaculties.length;
            if(index >=0 && index < arrayLength){
                $scope.activeFacultyIndex = index;
                $scope.activeFaculty = $scope.groupFaculties[index];
                var indexPair = startEndIndex(index,$scope.groupFaculties.length);
                $scope.startFacultyIndex = indexPair.start;
                $scope.endFacultyIndex = indexPair.end;
            }
            
        };
        
        $scope.showResultDialog = function(ev, index, examResult) {
            $scope.activeResultIndex = index;
            $scope.activeResult = $scope.groupResults[index];
            var indexPair = startEndIndex(index, $scope.groupResults.length);
            
            $scope.startResultIndex = indexPair.start;
            $scope.endResultIndex = indexPair.end;
            $scope.dialogExamResult = examResult;
            
            $mdDialog.show({
              contentElement: '#resultsDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        
        $scope.prevResult = function(){
            var index = $scope.activeResultIndex - 1;
            $scope.changeResultImage(index);
        };
         $scope.nextResult = function(){
            var index = $scope.activeResultIndex + 1;
            $scope.changeResultImage(index);
        };
        $scope.changeResultImage = function(index){
            var arrayLength = $scope.groupResults.length
            if(index >=0 && index < arrayLength){
                $scope.activeResultIndex = index;
                $scope.activeResult = $scope.groupResults[index];
                var indexPair = startEndIndex(index,$scope.groupResults.length);
                $scope.startResultIndex = indexPair.start;
                $scope.endResultIndex = indexPair.end;
            }
        };
        
        
        var instituteIds = []; //$scope.group.map(function(a) {return a._id;});
        
        $scope.group.forEach(function(thisGroup, index){
            if(thisGroup.city == $stateParams.cityName){
                instituteIds.push(thisGroup._id);
            }
        });
        $scope.user = $cookies.getObject('sessionuser');
        var viewForm = {
            institutes: instituteIds,
            state: $state.current.name,
            //user: $scope.user.userId,
            claim: false
        };
        if($scope.user && $scope.user.userId){
            viewForm.user = $scope.user.userId
        }
        if($cookies.getObject('ip')){
            var ip = $cookies.getObject('ip');
            viewForm.ip = ip;
        }
        viewService.saveview(viewForm).success(function (data, status, headers) {
            //console.log('View Marked');
        })
        .error(function (data, status, header, config) {
            console.log();
        });
        
        var examNamesKeywords = "";
        
        $scope.groupExams.forEach(function(thisExam, index){
            examNamesKeywords += $stateParams.groupName + " " + $stateParams.cityName + " for " + thisExam.exam.displayname;
            if(index < $scope.groupExams.length - 1){
                examNamesKeywords += ", ";
            }
        });
        var thisCity = $scope.city;
        $scope.cityCenters = [];
        $scope.group.forEach(function(thisGroup, gindex){
            if(thisGroup.city == thisCity){
                $scope.cityCenters.push(thisGroup);
            }
        });
        var instituteDefinerLower = ["coaching", "classes"];
        var instituteDefiner = [];//"Coaching", "Classes"
        var groupNameLowerCase = $stateParams.groupName.toLowerCase();
        if(groupNameLowerCase.indexOf('coaching') == -1){
            instituteDefiner.push("Coaching");
        }
        if(groupNameLowerCase.indexOf('class') == -1 && groupNameLowerCase.indexOf('classes') == -1){
            instituteDefiner.push("Classes");
        }
        var instituteDefinerString = '';
        instituteDefiner.forEach(function(thisDefiner, dindex){
            if(dindex == 0){
                instituteDefinerString += " ";
            }
            instituteDefinerString += thisDefiner + " ";
        });
        //console.log(instituteDefinerString);
        
        /*
        $rootScope.pageTitle = $stateParams.groupName + instituteDefinerString + ' in ' + $stateParams.cityName + ' for ' + $stateParams.subCategoryName + " Exam";
        $rootScope.pageDescription = $stateParams.groupName + ", " +$scope.city +  " has " + $scope.cityCenters.length + " " +   $scope.subcategory.displayname + " Coaching Centers in " + $scope.city + ". | Find fees, photos and reviews of " + $stateParams.groupName;
        
        var groupKeywords = $stateParams.groupName + ", Top " + $stateParams.subCategoryName + " Coaching in " + $stateParams.cityName + ", " + $stateParams.groupName + ' in ' + $stateParams.cityName + ' for ' + $stateParams.subCategoryName + ", " + $scope.cityCenters.length + " " + $stateParams.groupName + " Centers in " + $scope.city + ", ";
        $rootScope.pageKeywords = groupKeywords + examNamesKeywords;
        */
        
        /*
        Title: <CI Name> | <Exam Name> Coaching in <City> for <Exam Name> Preparation
        Description: <CI Name> <Exam Name> Coaching in <City> for <Exam Name> Preparation | <ncenter> centers | <CI Name> Courses, Fees, Reviews, Results, Faculty, Photos and <Exam Name> Tests
        Keywords
        <CI Name> Coaching in <City>
        <CI Name> Coaching for <Exam Name>
        <CI Name> <City>
        <CI Name> <City> Reviews
        <CI Name> <City> Tests
        <CI Name> <City> Courses
        <CI Name> Photos
        <CI Name> Videos
        <CI Name> How to prepare for <Exam Name>
        <CI Name> Online Coaching
        <CI Name> <Exam Name> Preparation
        <CI Name> Online Test Series
        <CI Name> Coaching in <Locality>
        <Exam Name> Coaching Classes in <City>

        */
        var nCentersCity = $scope.cityCenters.length;
        var nCentersTotal = $scope.group.length;
        var centerText = " Centre";
        if(nCentersCity > 1){
            centerText = " Centres"
        }
        var nCentersCityText = nCentersCity + " " + $stateParams.groupName + " " + centerText + " in " + $stateParams.cityName;
        var nCentersCityKeyword = nCentersCity + " " + $stateParams.groupName + centerText + " in " + $stateParams.cityName;    
        
        $rootScope.pageTitle = $stateParams.groupName + " | " + $scope.subcategory.seoname + ' Coaching in ' + $stateParams.cityName + " | " + nCentersCityText;
        //+ " for " + $scope.subcategory.seoname + " Preparation"
        
        
        
        $rootScope.pageDescription = $stateParams.groupName + " " + $scope.subcategory.seoname + " Coaching in " + $stateParams.cityName + " for " + $scope.subcategory.seoname + " | " + nCentersCityText + " | " + $stateParams.groupName + " Courses, Fees, Reviews, Results, Faculty, Photos and " + $scope.subcategory.seoname + " Tests";
        
        /*<CI Name> Coaching in <City>
        <CI Name> Coaching for <Exam Name>
        <CI Name> <City>
        <CI Name> <City> Reviews
        <CI Name> <City> Tests
        <CI Name> <City> Courses
        <CI Name> <City> Photos
        <CI Name> <City> Videos
        <CI Name> How to prepare for <Exam Name>
        <CI Name> Online Coaching
        <CI Name> <Exam Name> Preparation
        <CI Name> Online Test Series
        <CI Name> Coaching in <Locality>
        <Exam Name> Coaching Classes in <City>*/

        
        var coachingKeywordArray = [];
        coachingKeywordArray.push($stateParams.groupName + " Coaching in " + $scope.city);
        coachingKeywordArray.push($stateParams.groupName + " Coaching for " + $scope.subcategory.seoname);
        coachingKeywordArray.push($stateParams.groupName + " " + $stateParams.cityName);
        coachingKeywordArray.push(nCentersCityKeyword);
        coachingKeywordArray.push($stateParams.groupName + " " + $stateParams.cityName + " Reviews");
        coachingKeywordArray.push($stateParams.groupName + " " + $stateParams.cityName + " " + $scope.subcategory.seoname +  " Reviews");
        coachingKeywordArray.push($stateParams.groupName + " " + $stateParams.cityName + " Tests");
        coachingKeywordArray.push($stateParams.groupName + " " + $scope.subcategory.seoname + " Tests");
        coachingKeywordArray.push($stateParams.groupName + " " + $stateParams.cityName + " Courses");
        coachingKeywordArray.push($stateParams.groupName + " " + $stateParams.cityName + " Photos");
        coachingKeywordArray.push($stateParams.groupName + " " + $stateParams.cityName + " Videos");
        var thisKeyword1 = "";
        var thisKeyword2 = "";
        var thisKeyword3 = "";
        var thisKeyword4 = "";
        $scope.cityCenters.forEach(function(thisCenter, cindex){
            thisKeyword1 = $stateParams.groupName + " Coaching in ";
            thisKeyword2 = $scope.subcategory.seoname + " Coaching in ";
            thisKeyword3 = $stateParams.groupName + " Coaching in ";
            thisKeyword4 = $scope.subcategory.seoname + " Coaching in ";
            if(thisCenter.location && thisCenter.location.area){
                thisKeyword1 = thisKeyword1 + thisCenter.location.area;
                thisKeyword2 = thisKeyword2 + thisCenter.location.area;
                thisKeyword3 = thisKeyword3 + thisCenter.location.area + ", " + $stateParams.cityName;
                thisKeyword4 = thisKeyword4 + thisCenter.location.area + ", " + $stateParams.cityName;
            }else{
                thisKeyword1 = thisKeyword1 + thisCenter.address;
                thisKeyword2 = thisKeyword2 + thisCenter.address;
                thisKeyword3 = thisKeyword3 + thisCenter.address + " " + $stateParams.cityName;
                thisKeyword4 = thisKeyword4 + thisCenter.address + " " + $stateParams.cityName;
            }
            //coachingKeywordArray.push(thisKeyword1);
            //coachingKeywordArray.push(thisKeyword2);
            coachingKeywordArray.push(thisKeyword3);
            coachingKeywordArray.push(thisKeyword4);
        });
        //console.log(coachingKeywordArray.length);
        if(coachingKeywordArray.length < 20){
            coachingKeywordArray.push($stateParams.groupName + " How to prepare for " + $scope.subcategory.seoname);
            coachingKeywordArray.push($stateParams.groupName + " Online Coaching");
            coachingKeywordArray.push($stateParams.groupName + " " + $scope.subcategory.seoname + " Preparation");
            coachingKeywordArray.push($stateParams.groupName + " Online Test Series");
            coachingKeywordArray.push($scope.subcategory.seoname + " Coaching in " + $stateParams.cityName);
        }
        
        
        //console.log($scope.cityCenters);
        
        //thisGroup.location
        
        
        var coachingKeywords = "";
        coachingKeywordArray.forEach(function(thisKeyword, kindex){
            coachingKeywords += thisKeyword;
            if(kindex < coachingKeywordArray.length - 1){
                coachingKeywords += ", ";
            }
        });
        //console.log(coachingKeywords);
        $rootScope.pageKeywords = coachingKeywords;
        
        
        
        $scope.years = ["2017","2016","2015","2014","2013","2012","2011","2010","2009","2008","2007","2006","2005","2004","2003"];
        $scope.reviewTags = ["Great Faculty", "Supportive Administration", "Value for Money", "Tech Powered", "Exhaustive Content", "Effective Test Series"];
        $scope.addRemoveReviewTag = function(reviewTag){
            if(!$scope.userReview.tags){
                $scope.userReview.tags = [];
            }
            var rIndex = $scope.userReview.tags.indexOf(reviewTag);
            if(rIndex == -1){
                $scope.userReview.tags.push(reviewTag);
            }else{
                $scope.userReview.tags.splice(rIndex, 1);
            }
        };
        $scope.setReviewTagColor = function(reviewTag){
            var className = "unfilledTag";
            var rIndex = $scope.userReview.tags.indexOf(reviewTag);
            if(rIndex -= -1){
                className = "filledTag";
            }
            return className;
        };
        
        $scope.updateUserReviewYear = function(year){
            if($scope.userReview){
                UserService.year_of_start = year;
            }
        };
        $scope.userReviewMode = false;
        
        $scope.showUserReviewDialog = function(ev,index) {
            $mdDialog.show({
              contentElement: '#userReviewDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            }).finally(function() {
                $scope.userReviewMode = true;
            });
        };
        
        
        
        $scope.editUserReviewMode = function(){
            $scope.userReviewMode = !$scope.userReviewMode;
        };
        reviewService.groupReviews(groupIds).success(function (data, status, headers) {
            $scope.otherReviews = data;
            $scope.otherReviews.forEach(function(thisReview, rindex){
                var instituteId = thisReview.institute;
                var iIndex = groupIds.indexOf(instituteId);
                thisReview.institute = $scope.group[iIndex];
                
                $scope.reviewParams.forEach(function(thisParam, index){
                                
                var pIndex = $scope.reviews.indexOf(parseFloat(thisReview[thisParam.name]));
                    
                //console.log(thisReview[thisParam.name] + " "+ parseFloat(thisReview[thisParam.name]) + " " + pIndex);
                $scope.setReview(thisParam.name,parseFloat(thisReview[thisParam.name]), $scope.otherReviews[rindex]);

                });
                
                
                
            });
            
            
        })
        .error(function (data, status, header, config) {
            console.log('Error ' + data + ' ' + status);
        });
        //groupIds
        $scope.updateReviewInstitute = function(thisGroup){
            $scope.userReview.institute = thisGroup._id;
            console.log($scope.userReview.institute);
        };
        $scope.reviewParams = [
            {name: "faculty", displayname:"Faculty and Teaching Experience", hoverVal: -1},
            {name: "competitive_environment", displayname:"Competitive Environment", hoverVal: -1},
            {name: "quality_of_material", displayname:"Quality of material", hoverVal: -1},
            {name: "infrastructure", displayname:"Infrastructure", hoverVal: -1},
        ];
        
        $scope.userReview = {
            institute: null,
            exam: $scope.exam._id,
            stream: $scope.category._id,
            text: '',
            tags:[]
        };
        if($scope.user && $scope.user.userId){
            $scope.userReview.user = $scope.user.userId;
        }
        $scope.reviewParams.forEach(function(thisParam, index){
            $scope.userReview[thisParam.name] = null;
        });
        var noReview = false;
        var reviewsQueried = false;
        $scope.$watch('user.userId', function (newValue, oldValue, scope) {
            if(newValue && !reviewsQueried){
                reviewsQueried = true;
                var userInstituteForm = {
                    user: newValue,   
                    instituteIdArray: groupIds,   
                }; reviewService.existingReview(userInstituteForm).success(function (data, status, headers) {
                    if(data && data.length > 0){
                        $scope.userReview = data[0];
                        
                        if($scope.userReview){
                            $scope.reviewParams.forEach(function(thisParam, index){
                                
                            var pIndex = $scope.reviews.indexOf(parseFloat($scope.userReview[thisParam.name]));
                            $scope.setReview(thisParam.name,parseFloat($scope.userReview[thisParam.name]), $scope.userReview);
                                
                            });
                        }
                        
                    }else{
                        //console.log('Here');
                        if($scope.user){
                            //$scope.showUserReviewDialog();
                        }
                    } 
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                }); 
            }else{
            }
        }, true);
        $scope.reviews = [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0];
        $scope.reviewsClasses = ["review1","review2","review3","review4","review5","review6","review7","review8","review9"];
        $scope.minTextLength = 70;
        
        $scope.placeholder = "Tip: A great review covers information about Faculty, Peer Interaction, Quality of material and Infrastructure. Got recommendations for your favorite faculty and employees, or something everyone should know about " + $scope.provider.name +", " + $scope.provider.city + "? Include that too! And remember, your review needs to be atleast " + $scope.minTextLength + " characters long. The best review will be featured on our main page :)";
        
        var paramNames = $scope.reviewParams.map(function(a) {return a.name;});
        
        $scope.getBackgroundColour = function(reviewParam,  paramIndex, userReview){
            var pIndex = paramNames.indexOf(reviewParam.name);
            var className = "noreview";
            
            var propName = $scope.reviewParams[pIndex].name;
            
            if(userReview && userReview[propName]){
                var review = userReview[propName];
                var rIndex = $scope.reviews.indexOf(review);
                //console.log(rIndex);
                if(paramIndex <= rIndex){
                    var rIndex2 = rIndex + 1;
                    className = "review" + rIndex2;    
                }
            }
            
            if($scope.reviewParams[pIndex].hoverVal >= 0){
                className = "noreview";
            };
            
            if($scope.reviewParams[pIndex].hoverVal >= paramIndex){
                
                var paramIndex2 = paramIndex + 1;
                className = "review" + paramIndex2;
            }
            
            
            return className;
        };
        
        
        $scope.getReviewSelectedColour = function(thisGroup){
            var className = "notselected";
            if($scope.userReview && $scope.userReview.institute && $scope.userReview.institute == thisGroup._id){
                className = "selected";
            }
            
            return className;
        };
        $scope.logMouseEvent = function(reviewParam,  paramIndex) {
            switch (event.type) {
              case "mouseenter":
                    console.log("Hey Mouse Entered");
                    break;
              case "mouseover":{
                    var pIndex = paramNames.indexOf(reviewParam.name);
                    $scope.reviewParams[pIndex].hoverVal = paramIndex;
                    break;
              }
              case "mouseout":{
                    var pIndex = paramNames.indexOf(reviewParam.name);
                    $scope.reviewParams[pIndex].hoverVal = -1;
                    break;
              }
                    
              case "mouseleave":
                console.log("Mouse Gone");
                break;

              default:
                console.log(event.type);
                break;
            };
        };
        $scope.reviewCentreError = false;
        $scope.showSelectReviewCentreDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#selectReviewCentreDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.showSelectShortlistCentreDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#selectShortlistCentreDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.showSavedReviewDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#savedReviewDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        
        $scope.selectReviewCentre = function(){
            if($scope.group.length > 1){
                $scope.showSelectReviewCentreDialog();
            }else{
                $scope.updateReviewInstitute($scope.group[0]);
                $scope.submitReview();
            }
        };
        $scope.cancelSelectReviewCentre = function(){
            $scope.reviewCentreError = false;
            $mdDialog.hide();
        };
        $scope.submitReview = function(){
            if(!$scope.userReview.institute){
                $scope.reviewCentreError = true;
            }else{
                if($scope.userReview.user){
                    reviewService.savereview($scope.userReview).success(function (data, status, headers) {
                        var reviewId = data;
                        $scope.showSavedReviewDialog();
                        
                        $state.go('availOffer', {userId: $scope.user.userId, reviewId: reviewId});
                        
                        //$state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                }else{
                    console.log('No user set');
                    $scope.showLoginForm();
                }
            }
            
            
        };
        $scope.checkReview = function(reviewParam, rateVal) {   
            if($scope.userReview[reviewParam.name] >=rateVal){return true;}else{return false;}
        }
        $scope.setReview = function(param, value, userReview){
            //console.log(userReview);
            if(userReview){
                userReview[param] = value;
            }
            
        };
        $scope.invalidSubmit = function(){
            var invalid = false;
            
            $scope.reviewParams.forEach(function(thisParam, index){
                if(!$scope.userReview || !$scope.userReview[thisParam.name]){
                    invalid = true;
                }
            });
            if($scope.userReview){
                $scope.userReview.text = $scope.userReview.text.trim();
                $scope.userReview.text = $scope.userReview.text.replace(/\s+/g, " ");

                var textLength = $scope.userReview.text.length;
                //console.log(textLength);
                if(textLength < $scope.minTextLength){
                    invalid = true;
                }
            }
            if(!$scope.userReview.exam ||  !$scope.userReview.stream ||  !$scope.userReview.year_of_start){
                invalid = true;
            }
            
            return invalid;
        };
        
        
        $scope.availDiscount = function(ev){
            $scope.discountForm = {
                email: null,
                mobile: null,
            };
            if($scope.user._id){
                if($scope.user.email){
                    $scope.discountForm.email = $scope.user.email;
                }
                if($scope.user.mobile){
                    $scope.discountForm.mobile = $scope.user.mobile;
                }
            }
            $mdDialog.show({
              contentElement: '#availDiscountDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        
        $scope.availDiscount2 = function(){
            alert('Here');
        };
        
        
    }]);
        
        
        
    function onlyUnique(value, index, self) { 
        return self.indexOf(value) === index;
    }       
    /*exambazaar.controller("offersController", 
    [ '$scope', '$rootScope', 'targetStudyProviderService', 'thisProvider', '$state', '$stateParams', '$cookies', '$mdDialog', '$timeout', 'thisGroupInfo', 'offersList', 'couponsList', 'offerService', 'couponService', 'UserService', function($scope,$rootScope, targetStudyProviderService, thisProvider, $state,$stateParams, $cookies,$mdDialog, $timeout, thisGroupInfo, offersList, couponsList, offerService, couponService, UserService){
        $scope.provider = thisProvider.data;
        $scope.provideroffers = offersList.data;
        //console.log($scope.provideroffers);
        $scope.provideroffers.forEach(function(thisoffer, pIndex){
            var couponNames = thisoffer.coupons.map(function(a) {return a.name;});
            thisoffer.couponNames = couponNames.filter(onlyUnique);
            //console.log(thisoffer.couponNames);
        });
        
        $scope.uniqueOffers = $scope.provideroffers;
        $scope.couponsList = couponsList.data;
        $scope.groupInfo = thisProvider.groupInfo;
        if($cookies.getObject('sessionuser')){
            $scope.user = $cookies.getObject('sessionuser');
        }
        var today = moment();
        var sixMonths = moment().add(6, "months");
        var threeMonths = moment().add(3, "months");
        var offerName = $scope.provider.name + " - " + today.format('DD MMM YY');
        $scope.newoffer = {
            name: offerName,
            provider: $scope.provider._id,
            primaryContact: {},
            otheremails: [],
            othermobiles: [],
            _start: today,
            _end: sixMonths,
            active: true,
            couponBuilder: [],
            offerNameError: '',
        };
        $scope.addEmail = function(){
            if(!$scope.newoffer.otheremails){
                $scope.newoffer.otheremails = [];
            }
            $scope.newoffer.otheremails.push('');
        };
        $scope.addMobile = function(){
            if(!$scope.newoffer.othermobiles){
                $scope.newoffer.othermobiles = [];
            }
            $scope.newoffer.othermobiles.push('');
        };
        $scope.showDeleteMobileConfirm = function(ev) {
        var len = $scope.newoffer.othermobiles.length;
            if(len > 0){
                var lastMobile = $scope.newoffer.othermobiles[len-1];
                if(lastMobile == ''){
                    $scope.newoffer.othermobiles.pop();
                }else{
                    var confirm = $mdDialog.confirm()
                        .title('Would you like to delete ' + lastMobile + '?')
                        .textContent('You will not be able to recover it after deleting!')
                        .ariaLabel('Lucky day')
                        .targetEvent(ev)
                        .clickOutsideToClose(true)
                        .ok('Confirm')
                        .cancel('Cancel');
                        $mdDialog.show(confirm).then(function() {
                          $scope.newoffer.othermobiles.pop();
                        }, function() {
                          //nothing
                        });
                    }
                }
        };
        $scope.showDeleteEmailConfirm = function(ev) {
        var len = $scope.newoffer.otheremails.length;
            if(len > 0){
                var lastEmail = $scope.newoffer.otheremails[len-1];
                if(lastEmail == ''){
                    $scope.newoffer.otheremails.pop();
                }else{
                    var confirm = $mdDialog.confirm()
                        .title('Would you like to delete ' + lastEmail + '?')
                        .textContent('You will not be able to recover it after deleting!')
                        .ariaLabel('Lucky day')
                        .targetEvent(ev)
                        .clickOutsideToClose(true)
                        .ok('Confirm')
                        .cancel('Cancel');
                        $mdDialog.show(confirm).then(function() {
                          $scope.newoffer.otheremails.pop();
                        }, function() {
                          //nothing
                        });
                    }
                }
        };
        
        if($scope.provider.primaryManagement){
            if($scope.provider.primaryManagement.name){
                $scope.newoffer.primaryContact.name = $scope.provider.primaryManagement.name;
            }
            if($scope.provider.primaryManagement.email){
                $scope.newoffer.primaryContact.email = $scope.provider.primaryManagement.email;
                $scope.newoffer.otheremails.push($scope.provider.primaryManagement.email);
            }
            if($scope.provider.primaryManagement.mobile){
                $scope.newoffer.primaryContact.mobile = $scope.provider.primaryManagement.mobile;
                $scope.newoffer.othermobiles.push($scope.provider.primaryManagement.mobile);
            }
        }
            
        $scope.discountTypes = ['Percentage Discount','Flat Discount'];
        $scope.validityTypes = ['From date of issue by Exambazaar','Fixed Expiry Date'];
        var generatedByProvider = "Generated by " + $scope.provider.name;
        $scope.generationTypes = ['Generated by Exambazaar'];
        $scope.generationTypes.push(generatedByProvider);
        //$scope.offer = $scope.newoffer;
        $scope.addOffer = function(){
            $scope.offer = $scope.newoffer;
            $scope.existingOffer = null;
        };
        $scope.setExistingOffer = function(offer){
            $scope.existingOffer = offer;
            $scope.offer = null;
        };
        
        if($scope.provideroffers.length > 0){
            $scope.setExistingOffer($scope.provideroffers[0]);
        }
        
        
        $scope.$watch('existingOffer.coupons', function (newValue, oldValue, scope) {
            
            if(newValue && newValue.length > 0){
                newValue.forEach(function(thisCoupon, cindex){
                if(thisCoupon.user && !thisCoupon.user._id){
                    var userId = thisCoupon.user;
                    UserService.getUserBasic(userId).success(function (data, status, headers) {
                        //console.log(data);
                        thisCoupon.user = data;
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });



                }
                    
                });
            }

        }, true);
        
        $scope.addCoupon = function(){
            var steps = [];
            steps.push('Go to ' + $scope.provider.website);
            steps.push('Choose the product (test series, correspondence course) you want to purchase');
            steps.push('Enter exclusive promo code (if applicable) at checkout on ' + $scope.provider.website);
            
            var providerEmailText = '';
            if($scope.offer.otheremails.length > 0){
                providerEmailText = " or " +  $scope.offer.otheremails[0];
            }
            
            steps.push('For any help email: always@exambazaar.com' + providerEmailText);
            
            var newCouponTemplate = {
                name: '',
                discountType: 'Percentage Discount',
                validfor: 'All Courses',
                validityType: 'Fixed Expiry Date',
                generationType: generatedByProvider,
                flatDiscount: '500',
                percentageDiscount: '40',
                validtyDuration: '30',
                fixedExpiryDate: threeMonths,
                nCoupons: 1000,
                percentageSocialShareBenefit: 15,
                flatSocialShareBenefit: 250,
                steps: steps,
                couponCodes: [],
                couponNameError: '',
            };
            $scope.offer.couponBuilder.push(newCouponTemplate);
        };
        
        
        $scope.updateDiscountType = function(coupon, discountType){
            coupon.discountType = discountType;
        };
        $scope.updateValidityType = function(coupon, validityType){
            coupon.validityType = validityType;
            //console.log(coupon.validityType);
        };
        $scope.updateGenerationType = function(coupon, generationType){
            coupon.generationType = generationType;
            //console.log(coupon.validityType);
        };
        
        $scope.readyToAddCoupons = function(couponTemplate){
            //console.log(couponTemplate);
            var disabled = false;
            var properties = ["name", "discountType", "validfor", "validityType", "generationType"];
            //"flatDiscount", "percentageDiscount", "validtyDuration", "fixedExpiryDate"
            properties.forEach(function(thisProperty, pIndex){
                if(!couponTemplate[thisProperty] || couponTemplate[thisProperty] == ''){
                    disabled = true;
                }
            });
            if(couponTemplate.discountType && couponTemplate.discountType == 'Percentage Discount'){
                if(!couponTemplate.percentageDiscount || couponTemplate.percentageDiscount == ''){
                    disabled = true;
                }
            }
            if(couponTemplate.discountType && couponTemplate.discountType == 'Flat Discount'){
                if(!couponTemplate.flatDiscount || couponTemplate.flatDiscount == ''){
                    disabled = true;
                }
            }
            if(couponTemplate.validityType && couponTemplate.validityType == 'From date of issue by Exambazaar'){
                if(!couponTemplate.validtyDuration || couponTemplate.validtyDuration == ''){
                    disabled = true;
                }
            }
            if(couponTemplate.validityType && couponTemplate.validityType == 'Fixed Expiry Date'){
                if(!couponTemplate.fixedExpiryDate || couponTemplate.fixedExpiryDate == ''){
                    disabled = true;
                }
            }
            return disabled;
            
        };
        
        
        $scope.generateCoupons = function(couponTemplate){
            var nCoupons = couponTemplate.nCoupons;
            var genCodes = uniqueCodeGenerator(nCoupons*2, $scope.couponsList);
            
            $scope.couponsList = $scope.couponsList.concat(genCodes);
            
            var nLength = genCodes.length;
            var codesArray = genCodes.splice(0,nCoupons);
            var socialCodesArray = genCodes;
            codesArray.forEach(function(thisCode, cIndex){
                var codePair = {
                    code: codesArray[cIndex],
                    socialShareCode: socialCodesArray[cIndex],
                };
                couponTemplate.couponCodes.push(codePair);
            });
            
            //console.log(couponTemplate.couponCodes);
        };
        $scope.removeCouponBuilder = function($index, ev) {
            var couponBuilder = $scope.offer.couponBuilder[$index];
            var confirm = $mdDialog.confirm()
                .title('Would you like to remove ' + couponBuilder.name + '?')
                .textContent('You will not be able to recover the changes in your coupon builder!')
                .ariaLabel('Lucky day')
                .targetEvent(ev)
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.offer.couponBuilder.splice($index, 1);
                    //$state.reload();
                }, function() {
                  //nothing
                });
            
        };
        $scope.showUploadCouponsDialog = function(couponBuilder, ev) {
            $scope.uploadCouponBuilder = couponBuilder;
            $mdDialog.show({
              contentElement: '#uploadCouponsDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.cancelDialog = function(){
            $mdDialog.hide();
        };
        $scope.uploadedCoupons = [];
        
        function correctCode(code){
            var ALPHABET = '23456789ABDEGJKMNPQRVWXYZ';
            var conforms = true;
            
            return conforms;
        };
        
        $scope.submitUploadedCoupons = function(couponTemplate){
            var excelCodesArray = $scope.uploadedCoupons.map(function(a) {return a.code;});
            var excelSocialCodesArray = $scope.uploadedCoupons.map(function(a) {return a.socialShareCode;});
            
            $scope.uploadErrorMessages = null;
            var codesArray = [];
            var socialCodesArray = [];
            
            excelCodesArray.forEach(function(thisCode, cIndex){
                if(thisCode ){//&& thisCode!= ''
                    codesArray.push(thisCode);
                    
                }else{
                    if(cIndex < excelSocialCodesArray.length-1){
                        codesArray.push(thisCode);
                    }
                    
                }
            });
            excelSocialCodesArray.forEach(function(thisCode, cIndex){
                if(thisCode && thisCode!= ''){
                    if(correctCode(thisCode)){
                        socialCodesArray.push(thisCode);
                    }else{
                        if(!$scope.uploadErrorMessages){
                            $scope.uploadErrorMessages = [];
                        }
                        $scope.uploadErrorMessages.push('Incorrect Social Share Code: ' + thisCode);
                    }
                }
            });
            
            if(!$scope.uploadErrorMessages && codesArray.length > 0 && socialCodesArray.length > 0 && codesArray.length == socialCodesArray.length){
                console.log('We are set to add coupons');
                codesArray.forEach(function(thisCode, cIndex){
                    var codePair = {
                        code: codesArray[cIndex],
                        socialShareCode: socialCodesArray[cIndex],
                    };
                    couponTemplate.couponCodes.push(codePair);
                });
                $mdDialog.hide();
            }else{
                if(!$scope.uploadErrorMessages){
                    $scope.uploadErrorMessages = [];
                }
                console.log(codesArray.length + " " +  socialCodesArray.length);
                $scope.uploadErrorMessages.push('Please add equal valid normal and social coupon codes before submitting');
            }
            $scope.uploadedCoupons = [];
            console.log();  
        };
        
        $scope.removeCodes = function($index, ev) {
            var couponBuilder = $scope.offer.couponBuilder[$index];
            var confirm = $mdDialog.confirm()
                .title('Would you like to remove ' + couponBuilder.couponCodes.length + ' coupons for ' + couponBuilder.name + '?')
                .textContent('You can regenerate the codes in your coupon builder!')
                .ariaLabel('Lucky day')
                .targetEvent(ev)
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.uploadedCoupons = [];
                    couponBuilder.couponCodes = [];
                    //$state.reload();
                }, function() {
                  //nothing
                });
            
        };
        
        $scope.disabledAddOffer = function(){
            var disabled = false;
        };
        
        $scope.saveOffer = function(offer){
            $scope.saveOfferError = null;
            if(offer.couponBuilder.length == 0){
                if(!$scope.saveOfferError){
                    $scope.saveOfferError = [];
                }
                $scope.saveOfferError.push('Add atleast one coupon builder and coupon codes');
            }else if(offer.offerNameError != ''){
                console.log(offer.offerNameError);
                if(!$scope.saveOfferError){
                    $scope.saveOfferError = [];
                }
                $scope.saveOfferError.push("Offer Name already exists! Choose another name");
            }else if(offer.couponBuilder.length > 0){
                
                offer.couponBuilder.forEach(function(thisCouponBuilder, index){
                    console.log(thisCouponBuilder.steps);
                    thisCouponBuilder.steps.forEach(function(thisStep, sindex){
                        console.log(thisStep.trim());
                        if(thisStep.trim() == ''){
                            thisCouponBuilder.steps.splice(sindex, 1);
                        }
                    });
                    if(thisCouponBuilder.couponCodes.length == 0){
                        if(!$scope.saveOfferError){
                            $scope.saveOfferError = [];
                        }
                        $scope.saveOfferError.push('Generate or upload atleast one coupon code for ' + thisCouponBuilder.name);
                    }
                    if(thisCouponBuilder.couponNameError != ''){
                        $scope.saveOfferError.push("Coupon Name already exists! Choose another name: " + thisCouponBuilder.name);
                        
                    }
                });
                
                if(!$scope.saveOfferError){
                    console.log($scope.offer);
                    var saveOffer = offerService.saveOffer($scope.offer).success(function (data, status, headers) {
                        //console.log(data);
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                    
                    
                }
            }
        };
        
        function uniqueCodeGenerator(count, previous){
            var ALPHABET = '23456789ABDEGJKMNPQRVWXYZ';
            var ALPHABET_LENGTH = ALPHABET.length;
            var ID_LENGTH = 6;
            var UNIQUE_RETRIES = 9999;
            var HashID = {};
            HashID.generate = function() {
              var rtn = '';
              for (var i = 0; i < ID_LENGTH; i++) {
                rtn += ALPHABET.charAt(Math.floor(Math.random() * ALPHABET_LENGTH));
              }
              return rtn;
            };

            HashID.generateUnique = function(previous) {
              previous = previous || [];
              var retries = 0;
              var id;

              // Try to generate a unique ID,
              // i.e. one that isn't in the previous.
              while(!id && retries < UNIQUE_RETRIES) {
                id = HashID.generate();
                if(previous.indexOf(id) !== -1) {
                  id = null;
                  retries++;
                }
              }

              return id;
            };
            var codesArray = [];

            while (codesArray.length < count) {
                var newCode = "EB" + HashID.generateUnique(codesArray);
                codesArray.push(newCode);
            }
            return codesArray;

        };
        
        
        $scope.$watch('offer.name', function (newValue, oldValue, scope) {
            if(newValue != null && newValue != '' && newValue!=oldValue){
                //$scope.offerNameError = '';
                var nameForm = {
                    name: newValue
                };
                offerService.nameExists(nameForm).success(function (data, status, headers) {
                    if(data){
                        $scope.offer.offerNameError = "Offer Name already exists! Choose another name";
                    }else{
                        $scope.offer.offerNameError = ''
                    }

                    $scope.fetching = false;
                }).error(function (data, status, header, config) {
                    console.log("Error ");
                });
            }
        }, true);
        
        $scope.$watch('offer.couponBuilder', function (newValue, oldValue, scope) {
            if(newValue != null && newValue != '' && newValue.length > 0 &&  newValue!=oldValue){
                
            newValue.forEach(function(thisCouponBuilder, index){
                //thisCouponBuilder.couponNameError = '';
                var nameForm = {
                    name: thisCouponBuilder.name
                };
                if(!oldValue[index] || thisCouponBuilder.name != oldValue[index].name){
                    couponService.nameExists(nameForm).success(function (data, status, headers) {
                    //console.log(data);
                    if(data){
                        thisCouponBuilder.couponNameError = "Coupon Name already exists! Choose another name";
                        
                        }else{
                            thisCouponBuilder.couponNameError = '';
                        }

                        $scope.fetching = false;
                    }).error(function (data, status, header, config) {
                        console.log("Error ");
                    }); 
                    
                }
                
                
            });
                
            }
        }, true);
        
    }]);  
    */
    
    
    
    
    
    exambazaar.controller("claimController", 
    [ '$scope', '$rootScope', 'targetStudyProviderService', 'ImageService', 'LocationService', 'OTPService','UserService', 'cisavedService', 'tofillciService', 'viewService', 'Upload', 'thisProvider', 'imageMediaTagList', 'videoMediaTagList', 'examList', 'streamList', 'cisavedUsersList' , '$state', '$stateParams', '$cookies', '$mdDialog', '$timeout', 'toverifyciService',  'thisGroupInfo', 'addContactInfoService', 'rateInstituteService', 'screenSize', '$location', function($scope,$rootScope, targetStudyProviderService, ImageService, LocationService, OTPService, UserService, cisavedService, tofillciService, viewService, Upload, thisProvider, imageMediaTagList, videoMediaTagList,  examList,streamList, cisavedUsersList , $state,$stateParams, $cookies,$mdDialog, $timeout, toverifyciService,  thisGroupInfo, addContactInfoService, rateInstituteService, screenSize, $location){
        
        $scope.thisUrl = $location.absUrl();
        if (screenSize.is('xs, sm')){
            $scope.smallScreen = true;
        }else{
            $scope.smallScreen = false;
        }
        
        $scope.provider = thisProvider.data;
        $scope.thisGroupInfo = thisGroupInfo.data;
        
        if(!$scope.provider || !$scope.thisGroupInfo){
            $state.go('error');
        }
        
        $scope.imageTags = imageMediaTagList.data.mediaTypeTags;
        $scope.imageTypes = imageMediaTagList.data.distinctTypes;
        $scope.videoTags = videoMediaTagList.data.mediaTypeTags;
        $scope.videoTypes = videoMediaTagList.data.distinctTypes;
        
        
        
        /*console.log($scope.videoTags);
        console.log($scope.videoTypes);*/
        
        $scope.resultSet = [
        ];
        $scope.showHeaderLogin = function() {
            $rootScope.$emit("CallShowLogin", {});
        };
        //OTP Related Functions
        
        
        
        $scope.verifyingOTP = false;
        $scope.verifyByOTP = function(){
            $scope.verifyingOTP = true;
            $scope.nMobiles = $scope.provider.mobile.length;
            $scope.verifyStep = 1;
        };
        $scope.newMobileMode = false;
        $scope.verifyStep = 0;
        $scope.addClaimMobile = function(){
            $scope.newMobileMode = true;
            $scope.verifyStep = 1;
        };
        $scope.selectMobile = function(mobile){
            $scope.OTPMobile = mobile;
        };
        $scope.sendOTP = function(mobile){
            $scope.verificationMobile = mobile;
            //mobile ='9829685919';
            var thisOTP = {
                mobile:mobile,
                otp: generateOtp(),
                reason : 'Claiming ' + $scope.provider._id
            };
            //console.log(JSON.stringify(thisOTP));
            OTPService.generateOTP(thisOTP).success(function (data, status, headers) {
                $scope.serverOTP = data.otp;
                
            })
            .error(function (data, status, header, config) {
                console.log();
            });
            $scope.verifyStep = 2;
        };
        $scope.verifyOTP = function(){
            if($scope.serverOTP == $scope.userOTP){
                alert('Success');
                $scope.createUserBool = true;
                $scope.verifyStep = 3;
                
            }else{
                alert('You have entered an incorrect OTP.');
            }
        };
        
        
        $scope.$watch('[provider.address, provider.city]', function (newValue, oldValue, scope) {
            if(newValue != null && newValue[0] != '' && newValue[1] != ''){
                var address = newValue[0];
                var city = newValue[0];
                var state = $scope.provider.state;
                
                $timeout(function() {
                    
                    GMaps.geocode({
                    address: address + ", " + city + " " + state,
                    callback: function(results, status) {
                        if (status == 'OK') {
                           
                            var latlng = {
                                lat: results[0].geometry.location.lat(),
                                lng: results[0].geometry.location.lng()
                            };
                            
                            
                            if(!$scope.provider.latlng || $scope.provider.latlng.lat != latlng.lat || $scope.provider.latlng.lng != latlng.lng){
                                $scope.editLocation = true; 
                                $scope.provider.latlng = latlng;
                                console.log($scope.provider.latlng);
                            }
                            
                            
                        }else{
                            //console.log(status + ' ' + $scope.provider._id);

                            if(status == 'ZERO_RESULTS'){
                            $scope.provider.latlngna = true; 
                            }
                        }

                    }
                });  
                    
                    
                    
                }, 250);
            }

            }, true);
        
        $scope.markLatlng = function(){
            var address = $scope.provider.address + ", " + $scope.provider.city;
            console.log(address);
            GMaps.geocode({
                address: address,
                callback: function(results, status) {
                    
                    if (status == 'OK') {
                        //console.log(results[0].geometry.location.lat() + ", " + results[0].geometry.location.lng());
                        $scope.provider.latlng = {
                            lat: results[0].geometry.location.lat(),
                            lng: results[0].geometry.location.lng()
                        };
                        $scope.showLatLngDialog();
                        console.log($scope.provider.latlng);
                    }else{
                        console.log(status + ' ' + $scope.provider._id);
                        $scope.showNoLatLngDialog();
                        if(status == 'ZERO_RESULTS'){
                        $scope.provider.latlngna = true; 
                        
                        }
                    }

                }
            });  
            
        };
        
        $scope.overviewIcons = [
            {
                icon:'images/icons/centre.png',
                text:'Centres',
                data: '1'
            },
            {
                icon:'images/icons/city.png',
                text:'Cities',
                data: '1'
            },
            {
                icon:'images/icons/students.png',
                text:'Students',
                data: '100'
            },
            {
                icon:'images/icons/faculty.png',
                text:'Faculty',
                data: '10'
            }
        ];
        
        
        $scope.rankCategories = [
            'GENERAL',    
            'OBC-NCL',    
            'SC/ST',    
            'PwD'   
        ];
        $scope.resultYears = [
            '2017',    
            '2016',    
            '2015',    
            '2014',    
            '2013',    
            '2012',    
            '2011',    
            '2010',    
            '2009',    
            '2008',    
            '2007',    
            '2006',    
            '2005',    
            '2004',    
            '2003'    
        ];
        $scope.ebVerifyStates = ["Verified", "No Response", "Does not Exist", "Not Verified"];
        
        
        $scope.components = [
            /*'Overview',*/
            'Contact',
            'Exams',
            'Results',
            'Courses',
            'Photos',
            'Videos',
            'Faculty',
            
        ];
        if($scope.provider && $scope.provider.type != 'Online Coaching'){
            $scope.components.push('Location');
        }
        
        //console.log($scope.thisGroupInfo);
        $scope.verifyClaim = function(){
            
            $state.go('verifyClaim', {coachingId: $scope.provider._id});
        };
        $scope.cisavedUsersList = cisavedUsersList.data;
        //console.log($scope.cisavedUsersList);
        $scope.showClaimDialog = function(ev) {
            $mdDialog.show({
                contentElement: '#claimDialog',
                parent: angular.element(document.body),
                targetEvent: ev,
                clickOutsideToClose: false,
                escapeToClose: false,
            });
        };
        
        $scope.shortlisted = false;
        
        $scope.showDisabled = function(ev) {
            $mdDialog.show({
              contentElement: '#disabledDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: false
            });
        };
        
        
        $scope.disabled = $scope.provider.disabled;
        
        if($scope.disabled){
            $scope.showDisabled();
        }
        
        $scope.editable = false;
        $scope.verifiedUser = false;
        $scope.ebuser = false;
        $scope.masteruser = false;
        $scope.showAddPrimaryManagement = function(ev) {
            $mdDialog.show({
              contentElement: '#addPrimaryManagementDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: false
            });
        };
        $scope.showUnauthorizedAccess = function(ev) {
            $mdDialog.show({
              contentElement: '#unauthorizedAccessDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: false
            });
        };
        
        if($cookies.getObject('sessionuser')){
            $scope.user = $cookies.getObject('sessionuser');
            var viewForm = {
                institutes: [$scope.provider._id],
                state: $state.current.name,
                state2: 'logged in',
                user: $scope.user.userId,
                claim: true
            };
            if($cookies.getObject('ip')){
                var ip = $cookies.getObject('ip');
                //console.log(ip);
                viewForm.ip = ip;
            }
            viewService.saveview(viewForm).success(function (data, status, headers) {
                //console.log('View Marked');
            })
            .error(function (data, status, header, config) {
                console.log();
            });
            UserService.getUserShortlisted($scope.user.userId).success(function (data, status, headers) {
                var shortlistedIds = data.map(function(a) {return a._id;});
                if(shortlistedIds.indexOf($scope.provider._id) != -1){
                    $scope.shortlisted = true;
                }
                //console.log(data);
            })
            .error(function (data, status, header, config) {
                console.log('Shortlist Error' + status + " " + data);    
            }); 
            
            if($scope.user.userType=='Master'){
                $scope.editable = true;
                $scope.verifiedUser = true;
                $scope.ebuser = true;
                $scope.masteruser = true;
            }
            if($scope.user._id == '5a1831f0bd2adb260055e352'){
                $scope.masteruser = true;
            }
            if($scope.user.userType=='Intern - Business Development'){
                $scope.editable = true;
                $scope.verifiedUser = true;
                $scope.ebuser = true;
                //$scope.showClaimDialog();
            }
            if($scope.user.userType=='Partner'){
                $scope.verifiedUser = true;
                $scope.ebuser = false;
                if($scope.user.partner.indexOf($scope.provider._id) != -1){
                    if(!$scope.provider.primaryManagement || $scope.provider.primaryManagement.name =='' || $scope.provider.primaryManagement.mobile ==''){
                        
                        $scope.editable = false;
                        $scope.showAddPrimaryManagement();
                    }else{
                        $scope.editable = true;
                    }
                    
                    
                    
                }else{
                    $scope.editable = false;
                    $scope.showUnauthorizedAccess();
                    
                }
                
            }
        }else{
            //user is not allowed to access this page
            var viewForm = {
                institutes: [$scope.provider._id],
                state: $state.current.name,
                state2: 'not logged in',
                claim: true
            };
            if($cookies.getObject('ip')){
                var ip = $cookies.getObject('ip');
                viewForm.ip = ip;
            }
            viewService.saveview(viewForm).success(function (data, status, headers) {
                console.log('View Marked');
            })
            .error(function (data, status, header, config) {
                console.log();
            });
            $scope.showClaimDialog();
        }
        
        
        $scope.markPrimaryManagement = function(){
            $state.go('partner-dashboard', {userId: $scope.user.userId});
        };
        
        var city =  $scope.provider.city;
        LocationService.getCityLocations(city).success(function (data, status, headers) {
            $scope.cityLocations = data;
            //console.log($scope.cityLocations);
        })
        .error(function (data, status, header, config) {
            console.log("Error ");
        });
        
        $scope.allExams = examList.data;
        $scope.allStreams = streamList.data;
        $scope.streamIds=[];
        $scope.streams=[];
        $scope.preview = {
            stream: null,
            exam: null,
        };
        $scope.provider.exams.forEach(function(thisExam, index){
            if(!$scope.preview.exam){
                $scope.preview.exam = thisExam.name;
                $scope.preview.stream = thisExam.stream.name;
            }
            if($scope.streamIds.indexOf(thisExam.stream._id)==-1){
                $scope.streamIds.push(thisExam.stream._id);
                $scope.streams.push(thisExam.stream);
            }
        });
        //console.log($scope.preview);
        $scope.providerExamIds = $scope.provider.exams.map(function(a) {return a._id;});
        $scope.editExam = false;
        
        $scope.setEBVerifyState = function(verifyState){
            //$scope.editExam = true;
            if($scope.editable){
                $scope.provider.ebVerifyState = verifyState;
                var ebVerfiyForm = {
                    provider: $scope.provider._id,
                    state: verifyState,
                    user: $scope.user.userId
                };
                //console.log(ebVerfiyForm);
                targetStudyProviderService.setEBVerifyState(ebVerfiyForm).success(function (data, status, headers) {
                    
                    var toverifyciForm = {
                        institute: $scope.provider._id
                    };
                    //GHI
                    $scope.verifiedStateMarked = verifyState;
                    console.log(toverifyciForm);
                    toverifyciService.markDone(toverifyciForm)
                    .success( function (data, status, headers) {
                        $scope.showVerifiedDoneDialog();
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    
                })
                .error(function (data, status, header, config) {
                    console.log("Error");
                });
            }else{
                alert('Cannot Edit without logging in or verifying identity');
                $scope.showClaimDialog();
            }
        };
        
        $scope.contactInfoStates = ["Found & Added", "Website not found"];
        $scope.setEBContactInfoState = function(contactInfoState){
            //$scope.editExam = true;
            if($scope.editable){
                $scope.provider.addContactInfoDone = true;
                var contactInfoForm = {
                    provider: $scope.provider._id,
                    contactInfoState: contactInfoState,
                    user: $scope.user.userId
                };
                console.log(contactInfoForm);
                targetStudyProviderService.setEBContactInfoState(contactInfoForm).success(function (data, status, headers) {
                    
                    var addContactInfoForm = {
                        institute: $scope.provider._id
                    };
                    addContactInfoService.markDone(addContactInfoForm)
                    .success( function (data, status, headers) {
                        $scope.showContactInfoAddedDialog();
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    
                })
                .error(function (data, status, header, config) {
                    console.log("Error");
                });
            }else{
                alert('Cannot Edit without logging in or verifying identity');
                $scope.showClaimDialog();
            }
        };
        
        $scope.showDisableConfirm = function(provider, ev) {
        
            var confirm = $mdDialog.confirm()
                .title('Would you like to diable ' + provider.name + '?')
                .textContent('Address: ' + provider.address + ', ' + provider.city + '!')
                .ariaLabel('Lucky day')
                .targetEvent(ev)
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.disableProvider(provider);
                    $state.reload();
                }, function() {
                  //nothing
                });
            
        };
        
        $scope.disableProvider = function(provider){
            if(provider._id){
                var instituteIds = [provider._id];
                var disableForm = {
                    instituteIds: instituteIds,
                    user: $scope.user.userId
                };
                targetStudyProviderService.bulkDisableProviders(disableForm).success(function (data, status, headers) {
                    $scope.showSavedDialog();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            }
        };
        
        $scope.removeProviderConfirm = function(provider){
            console.log('I am here');
            console.log(provider.name);
            var confirm = $mdDialog.confirm()
            .title('Would you like to remove coaching named ' + provider.name + ', located at ' +  provider.address + ', ' + provider.city + '?')
            .textContent('You will not be able to revert it later')
            .ariaLabel('Lucky day')
            .targetEvent()
            .clickOutsideToClose(true)
            .ok('Confirm')
            .cancel('Cancel');
            $mdDialog.show(confirm).then(function() {
                $scope.removeProvider(provider);
            }, function() {
              //nothing
                $scope.showExamDialog();
            });     
        };
        $scope.removeProvider = function(provider){
             targetStudyProviderService.removeProvider(provider._id).success(function (data, status, headers) {
                if(data){
                    $scope.showSavedDialog();
                }else{
                    console.log('Something went wrong');   
                }
            })
            .error(function (data, status, header, config) {
            console.log('Error ' + data + ' ' + status);
            });  
        };
        
        $scope.addExam = function(exam){
            //$scope.editExam = true;
            if($scope.editable){
            if($scope.provider.exams.indexOf(exam) == -1){
                $scope.provider.exams.push(exam);
                $scope.providerExamIds = $scope.provider.exams.map(function(a) {return a._id;});
                $scope.saveProvider();
            }
            }else{
                alert('Cannot Edit without logging in or verifying identity');
                $scope.showClaimDialog();
            }
        };
        $scope.modes=[
            'Class Room', 'Online Classes', 'Test Series', 'Distance Education', 'Satellite Classes', 'Weekend Classroom'
        ];
        $scope.durations=[
            '1 Month','2 Months','3 Months', '4 Months', '5 Months', '6 Months', '9 Months', '1 Year', '2 Year','3 Year', '4 Year'  
        ];
        $scope.feeTypes = [
            'In Lumpsum',    
            'In Installments',        
        ];
        $scope.editContact = false;
        $scope.editEBVerify = false;
        $scope.editEBRating = false;
        
        $scope.editContacts= function(){
            $scope.editContact = true;
        };
        $scope.preAddPhoneLength = $scope.provider.phone.length;
        $scope.addPhone = function(){
            $scope.provider.phone.push('');
        };
        
        $scope.shortlistInstitute = function(){

            if($scope.user.userId){
                var shortListForm = {
                    userId: $scope.user.userId,
                    instituteId: $scope.provider._id
                };
                UserService.shortlistInstitute(shortListForm).success(function (data, status, headers) {
                    console.log('Institute Shortlisted');
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log('Shortlist error: ' + status + " " + data);    
                });  
            }
              
        };
        
        
        $scope.showDeletePhoneConfirm = function(ev) {
        var len = $scope.provider.phone.length;
            if(len > 0){
                var lastPhone = $scope.provider.phone[len-1];
                if(lastPhone == ''){
                    $scope.provider.phone.pop();
                }else{
                var confirm = $mdDialog.confirm()
                    .title('Would you like to delete ' + lastPhone + '?')
                    .textContent('You will not be able to recover it after deleting!')
                    .ariaLabel('Lucky day')
                    .targetEvent(ev)
                    .clickOutsideToClose(true)
                    .ok('Confirm')
                    .cancel('Cancel');
                    $mdDialog.show(confirm).then(function() {
                      $scope.provider.phone.pop();
                    }, function() {
                      //nothing
                    });
                    }
                }
        };
        
        $scope.showSpreadsheetConfirm = function(ev) {
            var spreadSheetEdited = false;
            $scope.examPivotResults.forEach(function(thisExamResult, index){
                
                if(thisExamResult.pivot !='null'){
                    //console.log(JSON.stringify(thisExamResult));
                    //console.log('--' + thisExamResult.result.length + ' ' + thisExamResult.initialLength);
                    if(thisExamResult.result.length != thisExamResult.initialLength + 1){
                        spreadSheetEdited = true;
                    }
                }
            }); 
            if(spreadSheetEdited){ 
                var confirm = $mdDialog.confirm()
                .title('Do you not want to save the changes in Results?')
                .textContent('You will not be able to recover the changes you have made!')
                .ariaLabel('Lucky day')
                .targetEvent(ev)
                .clickOutsideToClose(true)
                .ok('I will do it later!')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                  $scope.editResult = false;
                }, function() {
                  //nothing
                }); 
            }else{
                $scope.editResult = false;
            }
        };
         
        $scope.addMobile = function(){
            $scope.provider.mobile.push('');
        }; 
        $scope.showDeleteMobileConfirm = function(ev) {
        var len = $scope.provider.mobile.length;
            if(len > 0){
                var lastMobile = $scope.provider.mobile[len-1];
                if(lastMobile == ''){
                    $scope.provider.mobile.pop();
                }else{
                    var confirm = $mdDialog.confirm()
                        .title('Would you like to delete ' + lastMobile + '?')
                        .textContent('You will not be able to recover it after deleting!')
                        .ariaLabel('Lucky day')
                        .targetEvent(ev)
                        .clickOutsideToClose(true)
                        .ok('Confirm')
                        .cancel('Cancel');
                        $mdDialog.show(confirm).then(function() {
                          $scope.provider.mobile.pop();
                        }, function() {
                          //nothing
                        });
                    }
                }
        };
        $scope.addEmail = function(){
            $scope.provider.email.push('');
        };
        $scope.addEmailSuggestion = function(emailId){
            var emailExists = false;
            $scope.provider.email.forEach(function(thisEmail, eindex){
                if(thisEmail == emailId){
                    emailExists = true;
                }
            });
            if(!emailExists){
                $scope.provider.email.push(emailId);
            }else{
                console.log('Email Exists');
            }
            
        };
        $scope.addWebsiteSuggestion = function(website){
            var websiteExists = false;
            $scope.provider.website.forEach(function(thisWebsite, eindex){
                if(thisWebsite == website){
                    websiteExists = true;
                }
            });
            if(!websiteExists){
                $scope.provider.website.push(website);
            }else{
                console.log('Website Exists');
            }
            
        };
        
        $scope.showDeleteEmailConfirm = function(ev) {
        var len = $scope.provider.email.length;
            if(len > 0){
                var lastEmail = $scope.provider.email[len-1];
                if(lastEmail == ''){
                    $scope.provider.email.pop();
                }else{
                    var confirm = $mdDialog.confirm()
                        .title('Would you like to delete ' + lastEmail + '?')
                        .textContent('You will not be able to recover it after deleting!')
                        .ariaLabel('Lucky day')
                        .targetEvent(ev)
                        .clickOutsideToClose(true)
                        .ok('Confirm')
                        .cancel('Cancel');
                        $mdDialog.show(confirm).then(function() {
                          $scope.provider.email.pop();
                        }, function() {
                          //nothing
                        });
                    }
                }
        };
        
        $scope.addWebsite = function(){
            $scope.provider.website.push('');
        };
        $scope.showDeleteWebsiteConfirm = function(ev) {
        var len = $scope.provider.website.length;
            if(len > 0){
                var lastWebsite = $scope.provider.website[len-1];
                if(lastWebsite == ''){
                    $scope.provider.website.pop();
                }else{
                    var confirm = $mdDialog.confirm()
                        .title('Would you like to delete ' + lastWebsite + '?')
                        .textContent('You will not be able to recover it after deleting!')
                        .ariaLabel('Lucky day')
                        .targetEvent(ev)
                        .clickOutsideToClose(true)
                        .ok('Confirm')
                        .cancel('Cancel');
                        $mdDialog.show(confirm).then(function() {
                          $scope.provider.website.pop();
                        }, function() {
                          //nothing
                        });
                    }
                }
        };
        /*if(!$scope.provider.otherlistings){
            $scope.provider.otherlistings=[];
            $scope.provider.otherlistings.push('');
        }*/
        
        $scope.addOtherListings = function(){
            if(!$scope.provider.otherlistings){
                $scope.provider.otherlistings=[];
            }
            $scope.provider.otherlistings.push('');
        };
        $scope.showDeleteOtherListingsConfirm = function(ev) {
        var len = $scope.provider.otherlistings.length;
            if(len > 0){
                var lastOtherlistings = $scope.provider.otherlistings[len-1];
                if(lastOtherlistings == ''){
                    $scope.provider.otherlistings.pop();
                }else{
                    var confirm = $mdDialog.confirm()
                        .title('Would you like to delete ' + lastOtherlistings + '?')
                        .textContent('You will not be able to recover it after deleting!')
                        .ariaLabel('Lucky day')
                        .targetEvent(ev)
                        .clickOutsideToClose(true)
                        .ok('Confirm')
                        .cancel('Cancel');
                        $mdDialog.show(confirm).then(function() {
                          $scope.provider.otherlistings.pop();
                        }, function() {
                          //nothing
                        });
                    }
                }
        };
        
        $scope.saveContacts= function(){
            $scope.saveProvider();
            $scope.editContact = false; 
        };
        
        $scope.setLocation = function(location){
            $scope.provider.location = location;
        };
        
        $scope.addingCourse = false;
        $scope.preAddCourseLength = $scope.provider.course.length;
        $scope.setCourseDuration = function(course, duration){
            course.duration = duration;    
        };
        $scope.setFeeType = function(course, feeType){
            course.feeType = feeType;    
        };
        $scope.setCourseStudyMode = function(course, mode){
            course.mode = mode; 
        };
        
        $scope.deleteCourse = function(course){
            var spliceIndex = -1;
            $scope.provider.course.forEach(function(thisCourse, index){
                if(course._id == thisCourse._id){
                    spliceIndex = index;
                }
                if(!course._id && course.name == thisCourse.name){
                    spliceIndex = index;
                }
            });
            if(spliceIndex != -1){
                $scope.provider.course.splice(spliceIndex, 1);
                //$scope.saveProvider();  
            }
        };
        
        $scope.editCourse = false;
        $scope.editCourses= function(){
            $scope.editCourse = true;
        };
        
        $scope.addCourse = function(exam){
            $scope.preAddCourseLength = $scope.provider.course.length;
            var newCourse = {
                exam: exam._id,
                name:'',
                fees: '',
                idealFor:'',
                mode: ''
            };
            $scope.provider.course.push(newCourse);
            console.log(JSON.stringify($scope.provider.course));
            
        };
        $scope.removeExam = function(exam){
            //$scope.editExam = true;
            if($scope.editable){
                var examIndex = -1;
                $scope.provider.exams.forEach(function(thisExam, index){
                    if(thisExam._id == exam._id){
                        examIndex = index;
                    }
                });
                if(examIndex != -1){
                    $scope.provider.exams.splice(examIndex, 1);
                    $scope.providerExamIds = $scope.provider.exams.map(function(a) {return a._id;});
                    $scope.saveProvider();
                }
            }else{
                alert('Cannot Edit without logging in or verifying identity');
                $scope.showClaimDialog();
            }
            
        };
        
        $scope.removeAllExams = function(){
            
            if($scope.editable){
                
                var confirm = $mdDialog.confirm()
                .title('Do you want to remove all exams for this coaching?')
                .textContent('Be very careful. You will not be able to revert this!')
                .ariaLabel('Lucky day')
                .targetEvent(ev)
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.provider.exams = [];
                    $scope.saveProvider();
                }, function() {
                  //nothing
                }); 
                
                
            }else{
                alert('Cannot Edit without logging in or verifying identity');
                $scope.showClaimDialog();
            }
        };
        $scope.deleteFaculty = function(faculty){
            faculty.active = false;
            $scope.provider.faculty.forEach( function(thisFaculty, index){
                if(thisFaculty._id == faculty._id){
                    $scope.provider.faculty.splice(index, 1);
                }
            });
            //$scope.saveProvider();
        };
        $scope.playerVars = {
            controls: 1,
            showinfo: 0
        };
        $scope.deleteVideo = function(video){
            video.active = false;
            $scope.provider.video.forEach( function(thisVideo, index){
                if(thisVideo._id == video._id){
                    $scope.provider.video.splice(index, 1);
                }
            });
            //$scope.saveProvider();
        };
        
        $scope.deletePhoto = function(photo){
            photo.active = false;
            
            $scope.provider.photo.forEach( function(thisPhoto, index){
                if(thisPhoto._id == photo._id){
                    $scope.provider.photo.splice(index, 1);
                }
            });
            //$scope.saveProvider();
        };
        $scope.deleteResultPhoto = function(examResult, photo){
            
            examResult.newresultphotos.forEach( function(thisPhoto, index){
                if(thisPhoto.link == photo.link){
                    examResult.newresultphotos.splice(index, 1);
                }
            });
            //$scope.saveProvider();
        };
        $scope.saveProvider = function(){
            console.log($scope.provider);
            var saveProvider = {
                targetStudyProvider:$scope.provider,
                user: $scope.user.userId
            };
            targetStudyProviderService.saveProvider(saveProvider).success(function (data, status, headers) {
                $scope.showSavedDialog();
                $state.reload();
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.provider.faculty.forEach(function(thisFaculty, facultyIndex){
            if(thisFaculty.name || thisFaculty.subject || thisFaculty.yearsExperience || thisFaculty.qualification || thisFaculty.description){
                thisFaculty.infoAvailable = 1;
            }else{
                thisFaculty.infoAvailable = 0;
            }
        });
        
        $scope.provider.results.forEach(function(thisResult, resultIndex){
            
        });
        
        $scope.provider.results.forEach(function(thisResult, resultIndex){
            
            var addPic = "<button class='btn-primary editFont' ng-controller='claimController' ng-click='popHi()' >Add Pic</button>";
            //thisResult.imageShow = "<img src='" + thisResult.image + "' width='100'>" + addPic;
            thisResult.imageShow = addPic;
            
            //ngf-select='uploadResultPic(newResultPic, examResult.result)' ng-model='newResultPic' ngf-accept=''image/*''
            
            
                                
            
        });
        
        $scope.editResult = false;
        $scope.editResults= function(){
            $scope.editResult = true;
        };
        $scope.unEditResults= function(){
            $scope.examPivotResults.forEach(function(thisExamResult, index){
                 
                if(thisExamResult.result.lenth != thisExamResult.initialLength){
                    spreadSheetEdited = true;
                    
                }
            });
            
            $scope.editResult = false;
        };
        $scope.resultHelper = function(pivot, pivotValPreset){
            var lenPivotVal = pivotValPreset.length;
            var counter = 0;
            var nLength = $scope.provider.results.length;
            var pivotVals = pivotValPreset;
            pivotVals.push('null');
            var pivotResult = [];
            pivotVals.forEach(function(thisPivotVal, pivotValIndex){
                var newpivotResult = {
                    pivot: thisPivotVal,
                    result: []
                };
                
                if(pivot =='exam'){
                    var eIndex = $scope.providerExamIds.indexOf(thisPivotVal);
                    //console.log(eIndex);
                    if(eIndex !=-1){
                        newpivotResult.exam = $scope.provider.exams[eIndex];
                    }
                    
                }
                pivotResult.push(newpivotResult);
            });
            
            $scope.provider.results.forEach(function(thisResult, resultIndex){
                
                var pivotIndex = pivotVals.indexOf(thisResult[pivot]._id);
                if(thisResult[pivot] && pivotIndex == -1){
                    pivotVals.push(thisResult[pivot]);
                    var newpivotResult = {
                        pivot: thisResult[pivot],
                        result: [thisResult]
                    };
                    pivotResult.push(newpivotResult);
                }else{
                    if(!thisResult[pivot]){
                        console.log('Pivot not set');
                        pivotResult[lenPivotVal].result.push(thisResult);
                    }else{                              
                        pivotResult[pivotIndex].result.push(thisResult);
                    }    
                }
                counter = counter + 1;
                if(counter == nLength){
                    pivotResult.forEach(function(thisPivotResult, pivotIndex){
                        thisPivotResult.initialLength = thisPivotResult.result.length;
                    });
                    $scope.pivotResult = pivotResult;
                }
            });
            if(nLength == 0){
                    pivotResult.forEach(function(thisPivotResult, pivotIndex){
                        thisPivotResult.initialLength = 0;
                    });
                    $scope.pivotResult = pivotResult;
            }
        };
        $scope.resultPicHelper = function(){
            var counter = 0;
            var nResults = $scope.provider.results.length;
            var resultWithImages = [];
            var examArray = [];
            $scope.provider.results.forEach( function (thisResult, resultIndex){
                var exam;
                counter = counter + 1;
                if(thisResult.exam){
                    exam = thisResult.exam._id || thisResult.exam;
                    if(thisResult.image){
                        var examIndex = examArray.indexOf(exam);
                        if(examIndex == -1){
                            examArray.push(exam);
                            var newResultExamPair = {
                                exam: exam,
                                result: [thisResult]
                            }
                            resultWithImages.push(newResultExamPair);
                        }else{
                            resultWithImages[examIndex].result.push(thisResult);
                            
                        }
                    
                    }else{
                        //No image. Ignore this.
                    }
                    
                    
                }else{
                    exam='';
                }
                if(counter == nResults){
                    
                    $scope.resultWithImages = resultWithImages;
                    //console.log(resultWithImages);
                }
            });  
        };
        
        $scope.resultPicHelper();
        $scope.examWiseResult = [];
        $scope.resultSortExamYear = function(){
            var counter = 0;
            var nLength = $scope.provider.results.length;
            var examPivot = $scope.provider.exams;
            var yearPivot = $scope.resultYears;
            var examWiseResult = [];
            examPivot.forEach(function(thisExam, examIndex){
                var thisExamResult = {
                    exam: thisExam._id,
                    yearResult: []
                };
                yearPivot.forEach(function(thisYear, yearIndex){
                    var newResultSet = {
                        year: thisYear,
                        result: []
                    };
                    thisExamResult.yearResult.push(newResultSet);
                });
                examWiseResult.push(thisExamResult);
                //console.log('Here ' + JSON.stringify(examWiseResult));
            });
            $scope.provider.results.forEach(function(thisResult, resultIndex){
                var year = thisResult.year;
                var exam;
                if(thisResult.exam){
                    exam = thisResult.exam._id || thisResult.exam;   
                }else{
                    exam='';
                }
                 
                counter = counter + 1;
                var yearResult=[];
                examWiseResult.forEach(function(thisExamResult, examResultIndex){
                    if(thisExamResult.exam == exam){
                     yearResult = thisExamResult.yearResult;
                    //console.log(yearResult);
                    yearResult.forEach(function(thisYearResult, yearResultIndex){
                        if(thisYearResult.year == year){
                            thisYearResult.result.push(thisResult);
                        }
                    });
                    }
                });
                if(counter == nLength){
                    $scope.examWiseResult = examWiseResult;
                    //console.log($scope.examWiseResult);
                }
            });
            if(nLength ==0){
                $scope.examWiseResult = examWiseResult;
            }
        };
        
        $scope.resultHelper('exam',$scope.providerExamIds);
        $scope.examPivotResults =$scope.pivotResult;
        //console.log($scope.examPivotResults);
        $scope.resultSortExamYear();
        //console.log($scope.examWiseResult);
        
        $scope.yearWiseResult = [];
        $scope.resultSortYearExam = function(){
            var counter = 0;
            var nLength = $scope.provider.results.length;
            var yearPivot = $scope.resultYears;
            var examPivot = $scope.provider.exams;
            
            var yearWiseResult =[];
            yearPivot.forEach(function(thisYear, yearIndex){
                var thisYearResult = {
                    year: thisYear,
                    examResult: []
                };
                examPivot.forEach(function(thisExam, examIndex){
                    var newExamResult = {
                        exam: thisExam._id,
                        result: []
                    };
                    thisYearResult.examResult.push(newExamResult);
                });
                yearWiseResult.push(thisYearResult);
                
            });
            
            $scope.provider.results.forEach(function(thisResult, resultIndex){
                var year = thisResult.year;
                var exam = thisResult.exam._id || thisResult.exam;
                counter = counter + 1;
                var yearResult=[];
                yearWiseResult.forEach(function(thisYearResult, yearResultIndex){
                    if(thisYearResult.year == year){
                     yearResult = thisYearResult.examResult;
                    //console.log(yearResult);
                    yearResult.forEach(function(thisYearResult, yearResultIndex){
                        if(thisYearResult.exam == exam){
                            thisYearResult.result.push(thisResult);
                        }
                    });
                    }
                });
                
                
                
                //console.log(year + ' ' + exam);
                if(counter == nLength){
                    //console.log(pivotResult);
                    $scope.yearWiseResult = yearWiseResult;
                }
            });
        };
       
        $scope.markasdone = function(){
            
            
            var cisavedForm = {
                institute: $scope.provider._id,
                user: $scope.user.userId
            };
            console.log(cisavedForm);
            cisavedService.savecisaved(cisavedForm).success(function (data, status, headers) {
                tofillciService.markDone(cisavedForm)
                .success( function (data, status, headers) {
                    $scope.showMarkedDialog();
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.updateResultPhoto = function(result, photo, examResult, ev){
            //console.log(examResult.result);
            
            
            if(result.image && result.image != ''){
                
                var confirm = $mdDialog.confirm()
                .title('Do you not want to change image for ' + result.name + '?')
                .textContent('There is already an image set, you will not be able to recover the old image!')
                .ariaLabel('Lucky day')
                .targetEvent(ev)
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    examResult.result.forEach(function(thisResult, index){
                
                        if(thisResult.image == photo.link){
                            thisResult.image = '';
                        }
                    });
                    result.image = photo.link;
                }, function() {
                  //nothing
                }); 
            }else{
                examResult.result.forEach(function(thisResult, index){
                
                    if(thisResult.image == photo.link){
                        thisResult.image = '';
                    }
                });
                result.image = photo.link;
            }
            
            
        };
        
        $scope.saveProvider = function(){
                console.log($scope.provider);
                var saveProvider = {
                    targetStudyProvider:$scope.provider,
                    user: $scope.user.userId
                };
                targetStudyProviderService.saveProvider(saveProvider).success(function (data, status, headers) {
                    //console.log($scope.editResult + ' ' + $scope.editResult);
                    if($scope.editResult || $scope.editResult){
                        $scope.addExamResult();
                    }else{
                        $scope.showSavedDialog();
                        $state.reload();
                        console.log("Done");
                    }
                    
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
        
        $scope.cirf = function(examId){
            var cirfForm = {
                instituteIds: [$scope.provider._id],
                examId: examId,
            };
            targetStudyProviderService.cirf(cirfForm).success(function (data, status, headers) {
                if(data && data.length > 0){
                    $scope.statements = data;
                    $scope.showStatementsDialog();
                }
                //console.log(data);
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });    
        };
        
        $scope.showStatementsDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#statementsDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        
        $scope.addExamResult = function(){
            var providerId = $scope.provider._id;
            var finalExamResult = {
                providerId: providerId,
                examResults: [],
                
            };
            var properties = [
                /*'year',*/
                'name',
                
            ];
            /*'rank',
                'category'*/
            $scope.examPivotResults.forEach(function(examResult, index){
                var newExamResult = {
                    exam: examResult.pivot,
                    result: []
                };
                if(examResult.pivot != "null"){
                    finalExamResult.examResults.push(newExamResult);
                }
                  
            });
            var examResultIds =  finalExamResult.examResults.map(function(a) {return a.exam;});
            $scope.examPivotResults.forEach(function(examResult, index){
                var eIndex = examResultIds.indexOf(examResult.pivot);
                examResult.result.forEach(function(thisExamResult, examResultIndex){
                    var valid = true;
                    properties.forEach(function(thisProperty, propertyIndex){
                        if(thisExamResult[thisProperty] == null){
                            if(!thisExamResult._id){
                                valid = false;
                            }

                        }
                    });   
                    if(valid && eIndex != -1){
                        finalExamResult.examResults[eIndex].result.push(thisExamResult);
                        
                        //finalExamResult.result.push(thisExamResult);
                    }
                });
                
            }); targetStudyProviderService.bulkAddResult(finalExamResult).success(function (data, status, headers) {
                //console.log("Done");
                if(data == 'Done'){
                    var refreshedProvider = targetStudyProviderService.getProvider(providerId).success(function (refreshedProvider, status, headers) {
                    $scope.provider = refreshedProvider;
                     $scope.resultHelper('exam',$scope.providerExamIds);
                    $scope.examPivotResults =$scope.pivotResult;
                    //console.log(JSON.stringify($scope.examPivotResults));
                    $scope.resultSortExamYear();
                    $scope.editResult = false;

                    }).error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    
                    
                    $scope.showSavedDialog();
                    $state.reload();
                }
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.saveResults= function(){
            $scope.saveProvider();
            $scope.editResult = false;
            
        };
        $scope.preUploadResultLength = $scope.provider.results.length;
        
        $scope.prevResult = function(){
            var index = $scope.activeResultIndex - 1;
            $scope.changeResultImage(index, $scope.provider.results.length);
        };
         $scope.nextResult = function(){
            var index = $scope.activeResultIndex + 1;
            $scope.changeResultImage(index);
        };
        $scope.changeResultImage = function(index){
            var arrayLength = $scope.provider.results.length
            if(index >=0 && index < arrayLength){
                $scope.activeResultIndex = index;
                $scope.activeResult = $scope.provider.results[index];
                var indexPair = startEndIndex(index,$scope.provider.results.length);
                $scope.startResultIndex = indexPair.start;
                $scope.endResultIndex = indexPair.end;
            }
        };
        
        $scope.editVideo = false;
        $scope.preUploadVideoLength = $scope.provider.video.length;
        $scope.editVideos= function(){
            $scope.editVideo = true;
            /*if($scope.provider.video.length == 0){
                $scope.addVideos();
            }*/
        };
        $scope.saveVideos= function(){
            $scope.saveProvider();
            $scope.editVideo = false;
            
        };
        
        $scope.addVideos = function(){
            var newVideo = {
                link: ''
            };
            $scope.provider.video.push(newVideo);
            $scope.editVideo = true;
        };
        $scope.restoreVideo = function(video){
            video.active = true;
            $scope.saveProvider();
        };
        
        $scope.editPhoto = false;
        $scope.preUploadPhotoLength = $scope.provider.photo.length;
        $scope.editPhotos= function(){
            $scope.editPhoto = true;
        };
        $scope.editResultPhotos= function(){
            $scope.editResultPhoto = true;
        };
        $scope.savePhotos= function(){
            $scope.saveProvider();
            $scope.editPhoto = false;
            
        };
        $scope.dontsaveChanges= function(){
            $state.reload();
        };
        $scope.cancelChanges = function(){
            $scope.cancel();
        };
        
        
        $scope.editFaculty = false;
        $scope.editFaculties= function(){
            $scope.editFaculty = true;
        };
        
        $scope.saveFaculties= function(){
            $scope.saveProvider();
            $scope.editFaculty = false;
            
        };
        
        $scope.preUploadFacultyLength = $scope.provider.faculty.length;
        
        $scope.prevFaculty = function(){
            var index = $scope.activeFacultyIndex - 1;
            $scope.changeFacultyImage(index, $scope.provider.faculty.length);
        };
         $scope.nextFaculty = function(){
            var index = $scope.activeFacultyIndex + 1;
            $scope.changeFacultyImage(index);
        };
        $scope.changeFacultyImage = function(index){
            var arrayLength = $scope.provider.faculty.length;
            if(index >=0 && index < arrayLength){
                $scope.activeFacultyIndex = index;
                $scope.activeFaculty = $scope.provider.faculty[index];
                var indexPair = startEndIndex(index,$scope.provider.faculty.length);
                $scope.startFacultyIndex = indexPair.start;
                $scope.endFacultyIndex = indexPair.end;
            }
            
        };
        function startEndIndex (index, arrayLength){
            
            var showLength = 6;
            var indexPair = {
                start: 0,
                end: arrayLength
            };
            
            if(index - showLength/2 <=0){
                indexPair.start = 0;
                indexPair.end = Math.min(indexPair.start + showLength, arrayLength);
            }else{
                if(index + showLength/2 >= arrayLength){
                    indexPair.end = arrayLength;
                    indexPair.start = Math.max(0, indexPair.end - showLength);
                    
                }else{
                    indexPair.start = index -showLength/2;
                    indexPair.end = Math.min(indexPair.start + showLength, arrayLength);
                }
                
            }
            return (indexPair);
        };
        
        $scope.prevPhoto = function(){
            var index = $scope.activePhotoIndex - 1;
            $scope.changePhotoImage(index, $scope.provider.faculty.length);
        };
         $scope.nextPhoto = function(){
            var index = $scope.activePhotoIndex + 1;
            $scope.changePhotoImage(index);
        };
        $scope.changePhotoImage = function(index){
            var arrayLength = $scope.provider.photo.length;
            if(index >=0 && index < arrayLength){
                $scope.activePhotoIndex = index;
                $scope.activePhoto = $scope.provider.photo[index];
                var indexPair = startEndIndex(index, $scope.provider.photo.length);
                //console.log(JSON.stringify(indexPair));
                $scope.startPhotoIndex = indexPair.start;
                $scope.endPhotoIndex = indexPair.end;
            }
            
        };
        
        $scope.editLocation = false;
        $scope.editLocations= function(){
            $scope.editLocation = true;
        };
        $scope.saveLocations = function(){
            $scope.saveProvider();
            $scope.editLocation = false;
        };
        $scope.editDescription = false;
        $scope.addeditDescription = function(){
            $scope.editDescription = true;
            
            
        };
        
        $scope.editEBnote = false;
        $scope.addebNote = function(){
            $scope.editEBnote = true;
            $scope.preAddNotesLength = $scope.provider.ebNote.length;
            var newebNote = {
                note: '',
                user: $scope.user.userId
            };
            $scope.provider.ebNote.push(newebNote);
            console.log(JSON.stringify($scope.provider.ebNote));
            
        };
        
        $scope.saveEBNotes = function(){
            $scope.saveProvider();
            $scope.editLocation = false;
        };
        $scope.addPhotoTag = function(tag){
            if($scope.tagThisPhoto.tags.indexOf(tag._id) == -1){
                $scope.tagThisPhoto.tags.push(tag._id);
            }
            
        };
        $scope.addVideoTag = function(tag){
            //console.log(JSON.stringify($scope.tagThisVideo));
            if($scope.tagThisVideo.tags.indexOf(tag._id) == -1){
                $scope.tagThisVideo.tags.push(tag._id);
            }
            
        };
        
        $scope.removeVideoTag = function(tag){
            //console.log(JSON.stringify($scope.tagThisVideo));
            var vIndex = $scope.tagThisVideo.tags.indexOf(tag._id);
            if(vIndex != -1){
                
                $scope.tagThisVideo.tags.splice(vIndex, 1);
            }
            
        };
        
        $scope.addFacultyTag = function(tag){
            if($scope.tagThisFaculty.tags.indexOf(tag._id) == -1){
                $scope.tagThisFaculty.tags.push(tag._id);
            }
            
        };
        $scope.showFacultyTagDialog = function(ev, faculty) {
            $scope.tagThisFaculty = faculty;
            $mdDialog.show({
              contentElement: '#tagFacultyDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.showAddResultDialog = function(ev, exam) {
            $scope.resultExam = exam;
            $mdDialog.show({
              contentElement: '#addResultDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        
        
        $scope.showFacultyExamDialog = function(ev, faculty) {
            $scope.tagThisFaculty = faculty;
            $scope.facultyExamIds = $scope.tagThisFaculty.exams.map(function(a) {return a._id;});
            
            $mdDialog.show({
              contentElement: '#examFacultyDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        
        $scope.addFacultyExam = function(exam){
            if($scope.tagThisFaculty.exams.indexOf(exam) == -1){
                $scope.tagThisFaculty.exams.push(exam);
                $scope.facultyExamIds = $scope.tagThisFaculty.exams.map(function(a) {return a._id;});
            }
        };
        $scope.removeFacultyExam = function(exam){
            var examIndex = -1;
            $scope.tagThisFaculty.exams.forEach(function(thisExam, index){
                if(thisExam._id == exam._id){
                    examIndex = index;
                }
            });
            if(examIndex != -1){
                $scope.tagThisFaculty.exams.splice(examIndex, 1);
                $scope.providerExamIds = $scope.facultyExamIds = $scope.tagThisFaculty.exams.map(function(a) {return a._id;});
            }
        };
        
        $scope.showResultExamDialog = function(ev, result) {
            $scope.tagThisResult = result;
            $mdDialog.show({
              contentElement: '#resultExamDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.setExamForResult = function(exam, result){
            if(exam._id){
                result.exam = exam._id;
            }else{
                result.exam = exam;
            }
            
            $scope.editResult2 = true;
        };
        $scope.setResultExam = function(exam){
            if(exam._id){
                $scope.tagThisResult.exam = exam._id;
            }else{
                $scope.tagThisResult.exam = exam;
            }
            $scope.cancel();
        };
        $scope.setResultRankCategory = function(result,category){
            result.category = category;
        };
        $scope.setResultYear = function(result,year){
            result.year = year;
        };
        
        $scope.showPhotoTagDialog = function(ev, photo) {
            $scope.tagThisPhoto = photo;
            $mdDialog.show({
              contentElement: '#tagPhotoDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        //JHI
        $scope.showVideoTagDialog = function(ev, video) {
            $scope.tagThisVideo = video;
            $mdDialog.show({
              contentElement: '#tagVideoDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        
        $scope.showSavedDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#savedDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        $scope.showLatLngDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#latlngDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        $scope.showNoLatLngDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#nolatlngDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },3000)
        };
        $scope.showMarkedDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#markedDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        $scope.showVerifiedDoneDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#verifiedDoneDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        
        $scope.showRatingDoneDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#ratingDoneDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        
        $scope.showContactInfoAddedDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#contactInfoAddedDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        $scope.showMarkLocationDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#markLocationDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        
        $scope.showRemoveLastPhoneDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#removeLastPhoneDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.showPhotoDialog = function(ev,index) {
            $scope.activePhotoIndex = index;
            $scope.activePhoto = $scope.provider.photo[index];
            var indexPair = startEndIndex(index, $scope.provider.photo.length);
            $scope.startPhotoIndex = indexPair.start;
            $scope.endPhotoIndex = indexPair.end;
            
            $mdDialog.show({
              contentElement: '#photoDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.showFacultyDialog = function(ev,index) {
            $scope.activeFacultyIndex = index;
            $scope.activeFaculty = $scope.provider.faculty[index];
            var indexPair = startEndIndex(index, $scope.provider.faculty.length);
            $scope.startFacultyIndex = indexPair.start;
            $scope.endFacultyIndex = indexPair.end;
            
            $mdDialog.show({
              contentElement: '#facultyDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        
        $scope.showResultDialog = function(ev, index, examResult) {
            $scope.activeResultIndex = index;
            $scope.activeResult = examResult.result[index];
            var indexPair = startEndIndex(index, examResult.result.length);
            console.log(index + ' ' + examResult.result.length); 
            console.log(JSON.stringify(indexPair));
            $scope.startResultIndex = indexPair.start;
            $scope.endResultIndex = indexPair.end;
            $scope.dialogExamResult = examResult;
            
            $mdDialog.show({
              contentElement: '#resultsDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        
        $scope.cancel = function() {
          $mdDialog.cancel();
        };    
        
        
        if($scope.provider.latlng){
            $scope.provider.mapAddress = [$scope.provider.latlng.lat, $scope.provider.latlng.lng];
        }else{
            if($scope.provider.pincode){
                $scope.provider.mapAddress = $scope.provider.name + ', ' + $scope.provider.address + ' ' +
                $scope.provider.city + ' ' +
                $scope.provider.pincode;
            }else{
                $scope.provider.mapAddress = $scope.provider.name + ', ' + $scope.provider.address + ' ' + $scope.provider.city;   
            }
        }
        //console.log($scope.provider.mapAddress);
        /*if($scope.provider.pincode){
            $scope.provider.mapAddress = $scope.provider.name + ', ' + $scope.provider.address + ' ' +
            $scope.provider.city + ' ' +
            $scope.provider.pincode;
        }else{
            $scope.provider.mapAddress = $scope.provider.name + ', ' + $scope.provider.address + ' ' + $scope.provider.city;   
        }*/
        
        $scope.uploadPhotos = function (photos) {
            //var photos = $scope.photos;
            var nFiles = photos.length;
            $scope.showAddPhotosForm = false;
            var providerId = $scope.provider._id;
            var counter = 0;
            $scope.photoProgess = 0;
            if (photos && photos.length) {
            photos.forEach(function(thisFile, index){
                
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            };
             ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                thisFile.link = $(resp.data).find('Location').text();
                thisFile.newPhoto = {
                    image: thisFile.link
                };
                var newPhotoForm ={
                    photo: thisFile.newPhoto,
                    providerId: providerId
                }; targetStudyProviderService.addPhoto(newPhotoForm).success(function (data, status, headers) {
                    counter = counter + 1;
                    if(counter == nFiles){
                        $scope.showAddPhotosForm = true;
                        $scope.preUploadPhotoLength = $scope.provider.photo.length;
                        var refreshedProvider = targetStudyProviderService.getProvider(providerId).success(function (refreshedProvider, status, headers) {
                            $scope.provider = refreshedProvider;
                            $scope.editPhotos();
                        }).error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    $scope.photoProgess = 0;
                    thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                    photos.forEach(function(thisPhoto, index){
                        console.log(index + ' ' + thisPhoto.uploadProgress + ' ' + nFiles);
                        if(!thisPhoto.uploadProgress){
                            thisPhoto.uploadProgress = 0;
                        }
                        $scope.photoProgess += thisPhoto.uploadProgress;
                        //console.log($scope.photoProgess);
                    });
                    $scope.photoProgess = $scope.photoProgess / nFiles;
                    //console.log('progress: ' + thisFile.uploadProgress + '% ' + thisFile.name);
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
         };
        
        $scope.uploadResultPhotos = function (newresultphotos, examResult) {
            console.log(examResult.newresultphotos);
            //var newresultphotos = $scope.newresultphotos;
            var nFiles = newresultphotos.length;
            var providerId = $scope.provider._id;
            var counter = 0;
            console.log(nFiles);
            $scope.ResultPhotoProgess = 0;
            if (newresultphotos && newresultphotos.length) {
            newresultphotos.forEach(function(thisFile, index){
                
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            };
             ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                thisFile.link = $(resp.data).find('Location').text();
                
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    /*$scope.ResultPhotoProgess = 0;
                    thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                    newresultphotos.forEach(function(thisPhoto, index){
                        //console.log(index + ' ' + thisPhoto.uploadProgress + ' ' + nFiles);
                        if(!thisPhoto.uploadProgress){
                            thisPhoto.uploadProgress = 0;
                        }
                        $scope.ResultPhotoProgess += thisPhoto.uploadProgress;
                        //console.log($scope.photoProgess);
                    });
                    $scope.ResultPhotoProgess = $scope.ResultPhotoProgess / nFiles;
                    //console.log('progress: ' + thisFile.uploadProgress + '% ' + thisFile.name);*/
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
         };
        
        
        $scope.uploadResultPic = function (newresultpic,result) {
            //var logo = $scope.newlogo;
            //alert('Hi');
            var logo = [newresultpic];
            var nFiles = logo.length;
            
            var counter = 0;
            var providerId = $scope.provider._id;
            var resultId = result._id;
            if (logo && logo.length) {
            
            logo.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var logoLink = $(resp.data).find('Location').text();
                
                var newResultPicForm ={
                    image: logoLink,
                    resultId: resultId,
                    providerId: providerId
                }; targetStudyProviderService.addResultPic(newResultPicForm).success(function (data, status, headers) {
                    counter = counter + 1;
                    if(counter == nFiles){
                        
                        var refreshedProvider = targetStudyProviderService.getProvider(providerId).success(function (refreshedProvider, status, headers) {
                            $scope.provider = refreshedProvider;
                            $scope.provider = refreshedProvider;
                            $scope.resultHelper('exam',$scope.providerExamIds);
                            $scope.examPivotResults =$scope.pivotResult;
                            //console.log(JSON.stringify($scope.examPivotResults));
                            $scope.resultSortExamYear();
                            $scope.editResult = false;
                            
                            
                            $scope.showSavedDialog();
                            //$state.reload();
                        }).error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                       
                        
                        
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
         };
        
        $scope.uploadLogo = function (newlogo) {
            //var logo = $scope.newlogo;
            var logo = [newlogo];
            var nFiles = logo.length;
            
            var counter = 0;
            var providerId = $scope.provider._id;
            if (logo && logo.length) {
            
            logo.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var logoLink = $(resp.data).find('Location').text();
                
                var newLogoForm ={
                    logo: logoLink,
                    providerId: providerId
                }; targetStudyProviderService.addLogo(newLogoForm).success(function (data, status, headers) {
                    counter = counter + 1;
                    if(counter == nFiles){
                        
                        var refreshedProvider = targetStudyProviderService.getProvider(providerId).success(function (refreshedProvider, status, headers) {
                            $scope.showSavedDialog();
                            $scope.provider = refreshedProvider;
                        }).error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                       
                        
                        
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
         };
        
        $scope.uploadResults = function (results) {
            //var results = $scope.results;
            var nFiles = results.length;
            $scope.showAddResultsForm = false;
            var providerId = $scope.provider._id;
            var counter = 0;
            $scope.resultProgess = 0;
            if (results && results.length) {
            results.forEach(function(thisFile, index){
                
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            };
            console.log(JSON.stringify(fileInfo)); ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                thisFile.link = $(resp.data).find('Location').text();
                thisFile.newResult = {
                    image: thisFile.link
                };
                var newResultForm ={
                    result: thisFile.newResult,
                    providerId: providerId
                }; targetStudyProviderService.addResult(newResultForm).success(function (data, status, headers) {
                    counter = counter + 1;
                    if(counter == nFiles){
                        $scope.showAddResultsForm = true;
                        $scope.preUploadResultLength = $scope.provider.results.length;
                        var refreshedProvider = targetStudyProviderService.getProvider(providerId).success(function (refreshedProvider, status, headers) {
                            $scope.provider = refreshedProvider;
                            $scope.editResults();
                        }).error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    $scope.resultProgess = 0;
                    thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                    results.forEach(function(thisFile, index){
                        $scope.resultProgess += thisFile.uploadProgress;
                    });
                    $scope.resultProgess = $scope.resultProgess / nFiles;
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
         };
        
        $scope.uploadFaculties = function (faculties) {
            //var faculties = $scope.faculties;
            var nFiles = faculties.length;
            $scope.showAddFacultiesForm = false;
            var providerId = $scope.provider._id;
            var counter = 0;
            $scope.facultyProgess = 0;
            if (faculties && faculties.length) {
            faculties.forEach(function(thisFile, index){
                
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            };
            console.log(JSON.stringify(fileInfo)); ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                thisFile.link = $(resp.data).find('Location').text();
                thisFile.newFaculty = {
                    image: thisFile.link
                };
                var newFacultyForm ={
                    faculty: thisFile.newFaculty,
                    providerId: providerId
                }; targetStudyProviderService.addFaculty(newFacultyForm).success(function (data, status, headers) {
                    counter = counter + 1;
                    if(counter == nFiles){
                        $scope.showAddFacultysForm = true;
                        $scope.preUploadFacultyLength = $scope.provider.faculty.length;
                        var refreshedProvider = targetStudyProviderService.getProvider(providerId).success(function (refreshedProvider, status, headers) {
                            $scope.provider = refreshedProvider;
                            $scope.editFaculties();
                        }).error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    $scope.facultyProgess = 0;
                    thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                    faculties.forEach(function(thisFile, index){
                        if(!thisFile.uploadProgress){
                            thisFile.uploadProgress = 0;
                        }
                        $scope.facultyProgess += thisFile.uploadProgress;
                    });
                    $scope.facultyProgess = $scope.facultyProgess / nFiles;
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
         };
        
        
        
        
        
        $scope.ratingParams = [
            {
                name: "n_centers",
                displayname: "No. of Centres",
                options: ["> 20","10 - 20","5 - 10","2 - 5","1"],
                
            },
            {
                name: "n_exams",
                displayname: "No. of Exams",
                options: ["> 5","4","3","2","1"],
                
            },
            {
                name: "total_students",
                displayname: "Total Students",
                options: ["> 1000","500 - 1000","250 - 500","100 - 250","< 100"],
                
            },
            {
                name: "avg_batch_strength",
                displayname: "Average Batch Strength",
                options: ["20 - 30","30 - 50","50 - 70","70 - 100","> 100"],
                
            },
            {
                name: "student_to_faculty_ratio",
                displayname: "Student to Faculty Ratio",
                options: ["< 20","20 - 30","30 - 50","50 - 100","> 100"],
                
            },
            {
                name: "avg_teacher_experience",
                displayname: "Average Teacher Experience (years)",
                options: ["> 15","10 - 15","5 - 10","2 - 5","< 2"],
                
            },
            
        ];
        
        $scope.ratingFacilities = [
            {name:"printed_notes",displayname:"Printed Notes/ Study Material",description:"Does the CI supply printed notes?",},
            {name:"test_series",displayname:"Test Series",description:"Does the CI have its own test series?",},
            {name:"dlp",displayname:"DLP",description:"Does the CI have Distance Learning Program?",},
            {name:"hostel",displayname:"Hostel",description:"Does the CI have hostel facilities?",},
            {name:"doubt_sessions",displayname:"Doubt sessions",description:"Does the CI have periodic doubt sessions?",},
            {name:"periodic_performance_tests",displayname:"Periodic Performance Tests",description:"Does the CI have periodic performance tests?",},
            {name:"online_lectures",displayname:"Online Lectures",description:"Does the CI have online lectures?",},
            {name:"n_classrooms",displayname:"Classrooms > 5",description:"Does the CI have more than 5 classrooms in the centre?",},
            {name:"counselling",displayname:"Counselling",description:"Does the CI offer counselling?",},
            {name:"entrance_test",displayname:"Entrance Test",description:"Does the CI have an entrance test?",},

        ];
        
        $scope.examRatingParams = [
            {
                name: "percent_students_selected",
                displayname: "% of students selected in the Exam",
                options: ["> 50%","25% - 50%","10% - 25%","5% - 10%","< 5%"],
                
            },
            {
                name: "ranks_top100",
                displayname: "Ranks of students in top 100",
                options: ["> 25","15 - 25","10 - 15","5 - 10","1 - 5","0"],
                
            },
            {
                name: "ranks_top1000",
                displayname: "Ranks of students in top 1000",
                options: ["> 200","100 - 200","50 - 100","10 - 50","< 10", "0"],
                
            },
        ];
        
        $scope.editRating = false;
        $scope.editRatings = function(){
            $scope.editRating = true;
        };
        
        $scope.ratingParamValues = {};
        $scope.ratingParamEstimate = {};
        $scope.ratingParamValue = {};
        
        $scope.examRatingParamValues = [];
        $scope.ratingFacilitiesValues = {};
        
        $scope.ratingParams.forEach(function(thisRP, rpIndex){
            $scope.ratingParamValues[thisRP.name] = null;
            $scope.ratingParamEstimate[thisRP.name] = false;
            $scope.ratingParamValue[thisRP.name] = '';
        });
        
        $scope.ratingFacilities.forEach(function(thisF, fIndex){
            $scope.ratingFacilitiesValues[thisF.name] = false;
            
        });
        
        $scope.setExamRatingResultType = function (examRatingResultType, examRatingParamValue){
            examRatingParamValue.resultType = examRatingResultType;
        };
        $scope.examRatingResultTypes = ['CLP only','CLP+DLP'];
        
        $scope.provider.exams.forEach(function(thisExam, examIndex){
            var examRating = {
                exam: thisExam,
                resultType: 'CLP+DLP',
                rating: {
                },
            };
            /*var ratingParam = {
                    option: null, 
                    estimate: false, 
                    value: '',
            },*/
            $scope.examRatingParams.forEach(function(thisRP, rpIndex){
                examRating.rating[thisRP.name] = {
                    option: null, 
                    estimate: false, 
                    value: '',
                };
            });
            $scope.examRatingParamValues.push(examRating);
        });
        //console.log($scope.examRatingParamValues);
        
        if($scope.provider.rating){
            for (var property in $scope.ratingParamValues) {
                if($scope.provider.rating[property]){
                    $scope.ratingParamValues[property] = $scope.provider.rating[property].option;
                    $scope.ratingParamEstimate[property] = $scope.provider.rating[property].estimate;
                    $scope.ratingParamValue[property] = $scope.provider.rating[property].value;
                }
            }
            
            if($scope.provider.rating.examRating && $scope.provider.rating.examRating.length > 0){
                //console.log('Am here');
                $scope.examRatingParamValues = $scope.provider.rating.examRating;
                
                var existingExamIds = $scope.examRatingParamValues.map(function(a) {return a.exam._id.toString();});
                console.log(existingExamIds);
                console.log($scope.examRatingParamValues);
                $scope.provider.exams.forEach(function(thisExam, examIndex){
                    if(existingExamIds.indexOf(thisExam._id.toString()) == -1){
                        var examRating = {
                            exam: thisExam,
                            resultType: 'CLP+DLP',
                            rating: {
                            },
                        };
                         $scope.examRatingParams.forEach(function(thisRP, rpIndex){
                            examRating.rating[thisRP.name] = {
                                option: null, 
                                estimate: false, 
                                value: '',
                            };
                        });
                        $scope.examRatingParamValues.push(examRating);
                    }
                    
                    
                });
                console.log($scope.examRatingParamValues);
                
            }
            
            if($scope.provider.rating.facilities){
                $scope.ratingFacilitiesValues = $scope.provider.rating.facilities;
            }
            
        }
        
        
        $scope.setRatingParam = function(ratingParam, option){
            $scope.ratingParamValues[ratingParam.name] = option;
        };
        $scope.setRatingFacility = function(ratingFacility){
            $scope.ratingFacilitiesValues[ratingFacility.name] = true;
        };
        $scope.unsetRatingFacility = function(ratingFacility){
            $scope.ratingFacilitiesValues[ratingFacility.name] = false;
        };
        $scope.setExamRatingParam = function(examRatingParamValue, examRatingParam, option){
            examRatingParamValue.rating[examRatingParam.name].option = option;
            //console.log($scope.examRatingParamValues);
        };
        
        
        
        $scope.checkRatingFilled = function(){
            var disabled = false;
            for (var property in $scope.ratingParamValues) {
                if(!$scope.ratingParamValues[property]){
                    disabled = true;
                }
            } /*$scope.examRatingParamValues.forEach(function(examRatingParamValue, erpIndex){
                for (var property in examRatingParamValue.rating) {
                    if(!examRatingParamValue.rating[property]){
                        disabled = true;
                    }
                }
            });*/
            return disabled;
        };
        
        
        
        
        $scope.saveProviderRating = function (){
            if(!$scope.provider.rating){
                $scope.provider.rating = {};
            }
            //console.log($scope.examRatingParamValues);
            $scope.ratingParams.forEach(function(thisRP, rpIndex){
                var ratingObj = {
                    option: $scope.ratingParamValues[thisRP.name], 
                    estimate: $scope.ratingParamEstimate[thisRP.name], 
                    value: $scope.ratingParamValue[thisRP.name],
                };
                $scope.provider.rating[thisRP.name] = ratingObj;
                /*
                $scope.ratingParamValues[thisRP.name] = null;
                $scope.ratingParamEstimate[thisRP.name] = false;
                $scope.ratingParamValue[thisRP.name] = '';*/
            });
            
            /*for (var property in $scope.ratingParamValues) {
                $scope.provider.rating[property] = $scope.ratingParamValues[property];
            }*/
            
            $scope.provider.rating.facilities = $scope.ratingFacilitiesValues;
            
            $scope.provider.rating.examRating = [];
            $scope.examRatingParamValues.forEach(function(examRatingParamValue, erpIndex){
                //console.log(examRatingParamValue);
                var examRatingElem = {
                    exam: examRatingParamValue.exam._id,
                    rating: examRatingParamValue.rating,
                }
                //console.log(examRatingElem);
                $scope.provider.rating.examRating.push(examRatingElem);
            });
            
            
            var saveProvider = {
                targetStudyProvider:$scope.provider,
                user: $scope.user.userId
            };
            
            targetStudyProviderService.saveProvider(saveProvider).success(function (data, status, headers) {
                
                var rateInstituteForm = {
                    institute: $scope.provider._id
                };
                console.log(rateInstituteForm);
                rateInstituteService.markDone(rateInstituteForm)
                .success( function (data, status, headers) {
                    $scope.showRatingDoneDialog();
                    //$state.reload();
                    console.log("Rating Marked");
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                
                
                
                
                
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
             
            
            
            //$scope.saveProvider();
        };
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        $rootScope.pageTitle = $scope.provider.name;
        var pageTitle = $scope.provider.name + ' listing in ' + $scope.provider.city + ' - Claim Now';
        
        var examNames = '';
        $scope.provider.exams.forEach(function(thisExam, examIndex){
            examNames += thisExam.displayname;
            if(examIndex < $scope.provider.exams.length - 1){
                examNames += ', ';
            }
        });
        
        var pageDescription = "Study at " + $scope.provider.name + ", " +$scope.city +  " for " + examNames+ ". | Exambazaar - results, fees, faculty, photos, vidoes, reviews of " + $stateParams.groupName;
        $rootScope.pageDescription = pageDescription;
        
        
    }]);     
   
    exambazaar.controller("showCoachingController", 
    [ '$scope','$rootScope', 'targetStudyProviderService','thisProvider','$state','$stateParams', '$cookies','thisStream','thisExam', '$document', function($scope,$rootScope, targetStudyProviderService,thisProvider,$state,$stateParams, $cookies,thisStream,thisExam,$document){
        $scope.hideLoginDialog();
        $scope.category = thisStream.data;
        $scope.subcategory = thisExam.data;
        $scope.city = $stateParams.cityName;
        $scope.editable = false;
        if($cookies.getObject('sessionuser')){
            var user = $cookies.getObject('sessionuser');
            if(user.userType=='Master'){
                $scope.editable = true;
            }
        }
        $scope.components = [
            /*'Overview',*/
            'Contact',
            'Results',
            'Courses',
            'Photos',
            'Videos',
            'Faculty',
            'Location'
        ];
        $scope.provider = thisProvider.data;
        
        if($scope.provider.pincode){
            $scope.provider.mapAddress = $scope.provider.name + ', ' + $scope.provider.address + ' ' +
            $scope.provider.city + ' ' +
            $scope.provider.pincode;
        }else{
            $scope.provider.mapAddress = $scope.provider.name + ', ' + $scope.provider.address + ' ' + $scope.provider.city;   
        }
        $scope.exams = $scope.provider.exams;
        
        $scope.streamIds=[];
        $scope.streams=[];
        $scope.exams.forEach(function(thisExam, index){
            if($scope.streamIds.indexOf(thisExam.stream._id)==-1){
                $scope.streamIds.push(thisExam.stream._id);
                $scope.streams.push(thisExam.stream);
            }
        });
        console.log($scope.streams);
        
        
        
        
        $scope.overviewIcons = [
            {
                icon:'images/icons/centre.png',
                text:'Centres',
                data: '1'
            },
            {
                icon:'images/icons/city.png',
                text:'Cities',
                data: '1'
            },
            {
                icon:'images/icons/students.png',
                text:'Students',
                data: '100'
            },
            {
                icon:'images/icons/faculty.png',
                text:'Faculty',
                data: '10'
            }
        ];
        
        $scope.showMap = false;
        $scope.flipMap = function(){
              $scope.showMap = !$scope.showMap;
        };
        
        
        
        $rootScope.pageTitle = $scope.provider.name + ": " + $scope.subcategory.displayname + " preparation in " + $scope.city;
        
        
    }]);    
             
        
    exambazaar.controller("partnerDashboardController", 
        [ '$scope', '$state','thisPartner', 'targetStudyProviderService', '$mdDialog','$timeout', function($scope, $state, thisPartner, targetStudyProviderService, $mdDialog, $timeout){
            $scope.partner = thisPartner.data;
            $scope.listing = $scope.partner.partner[0];
            $scope.editManagement = false;
            $scope.management = $scope.listing.management;
            $scope.primaryManagement = $scope.listing.primaryManagement;
            
            $scope.addPrimaryManagement = false;
            $scope.showOtherManagement = false;
            if(!$scope.primaryManagement || $scope.primaryManagement.mobile =='' || $scope.primaryManagement.name ==''){
                $scope.addPrimaryManagement = true;
                $scope.primaryManagement ={
                    name: '',
                    mobile: '',
                    role: '',
                    email: '',
                }
            }
            $scope.showOthers = function(){
                $scope.showOtherManagement = true;
            };
            $scope.unShowOthers = function(){
                $scope.showOtherManagement = false;
            };
            $scope.editAll = function(){
                $scope.editManagement = true;
                $scope.management.forEach( function(thisPerson, index){
                    thisPerson.editable = true;
                });
            }
            $scope.editPrimaryManagement = function(){
                $scope.addPrimaryManagement = true;
                $scope.showOthers();
                $scope.editAll();
            };
            if(!$scope.management){
                $scope.management = [];
            }
            var newManagement = {
                name: '',
                mobile: '',
                role: '',
                email: '',
                editable: true
            };
            $scope.addNewManagement = function(){
                $scope.management.push(newManagement);
            };
            $scope.removeManagement = function(thisManagement, index){
                
                if(!thisManagement._id){
                    $scope.management.splice(index, 1);
                }else{
                    var managementIds = $scope.management.map(function(a) {return a._id;});
                    var mIndex = managementIds.indexOf(thisManagement._id);
                    if(mIndex != -1){
                        var newManagementForm ={
                            management: thisManagement,
                            providerId: $scope.listing._id
                        };
                         targetStudyProviderService.removeManagement(newManagementForm).success(function (data, status, headers) {
                            $scope.showSavedDialog();
                            $state.reload();
                            console.log("Done");
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                        
                    }else{
                        $scope.management.splice(index, 1);
                    }
                }
            };
            
            
            $scope.savePrimaryManagement = function(){
                var thisManagement = $scope.primaryManagement;
                var newMobile = thisManagement.mobile;
                var newName = thisManagement.name;
                var managementMobiles = $scope.management.map(function(a) {return a.mobile;});
                if(newMobile !='' && newName != ''){
                    var mIndex = managementMobiles.indexOf(newMobile);
                    
                    if(mIndex == -1){
                        var newManagementForm ={
                            management: thisManagement,
                            providerId: $scope.listing._id
                        };
                         targetStudyProviderService.addPrimaryManagement(newManagementForm).success(function (data, status, headers) {
                            $scope.showSavedDialog();
                            $state.reload();
                            console.log("Done");
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                    }else{
                        $scope.existingManagement = $scope.management[mIndex];
                        $scope.showMobileExistDialog();
                        //alert('Cant add two management people with same mobile');
                    }
                }else{
                    $scope.showErrorDialog();
                }
                
            };
            
            $scope.editManagementFunc = function(thisManagement){
                thisManagement.editable = true;
            };
            
            
            $scope.saveManagement = function(thisManagement){
                var newMobile = thisManagement.mobile;
                var newName = thisManagement.name;
                var managementMobiles = $scope.management.map(function(a) {
                    if(a.editable){
                        return null;
                    }else{
                        return a.mobile;
                    }
                    
                });
                if(newMobile !='' && newName != ''){
                    var mIndex = managementMobiles.indexOf(newMobile);
                    
                    if(mIndex == -1){
                        var newManagementForm ={
                            management: thisManagement,
                            providerId: $scope.listing._id
                        };
                         targetStudyProviderService.addManagement(newManagementForm).success(function (data, status, headers) {
                            $scope.showSavedDialog();
                            $state.reload();
                            console.log("Done");
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                    }else{
                        $scope.existingManagement = $scope.management[mIndex];
                        $scope.showMobileExistDialog();
                        //alert('Cant add two management people with same mobile');
                    }
                }else{
                    $scope.showErrorDialog();
                }
                
            };
            
            
            $scope.dontsaveChanges= function(){
                $state.reload();
            };
            $scope.showSavedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#savedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            
            
            
            
            
            $scope.showMobileExistDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#mobileExistDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },5000)
            };
            $scope.showErrorDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#errorDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },5000)
            };
            $scope.edit = function(){
                $state.go('claim', {coachingId: $scope.listing._id});
            };
           
            
    }]);    
    function compareDates(dateTimeA, dateTimeB) {
        //returns 1 if dateTimeA > dateTimeB
        dateTimeA = new Date(dateTimeA);
        var momentA = moment(dateTimeA,"DD/MM/YYYY");
        var momentB = moment(dateTimeB,"DD/MM/YYYY");
        if (momentA > momentB) return 1;
        else if (momentA < momentB) return -1;
        else return 0;
    };
    exambazaar.controller("masterDashboardController", 
        [ '$scope', 'usersCount', 'verifiedUsersCount', 'studentCount', 'coachingCount', 'internList', 'tofillciList', 'tofillciService', 'viewService', '$state', 'masterViewSummary','coachingSavedCount', 'filledCount', 'reviewsCount', 'couponsCount', 'issuedcouponsCount' , '$mdDialog', 'toverifyciService', 'toverifyciList', 'verifiedCount', '$rootScope', 'targetStudyProviderService', '$timeout', 'addContactInfoService', 'addContactInfoList', 'rateInstituteService', 'rateInstituteList', 'couponService', function($scope, usersCount, verifiedUsersCount, studentCount, coachingCount, internList, tofillciList, tofillciService,viewService, $state, masterViewSummary, coachingSavedCount , filledCount, reviewsCount, couponsCount, issuedcouponsCount,  $mdDialog, toverifyciService, toverifyciList, verifiedCount, $rootScope, targetStudyProviderService, $timeout, addContactInfoService, addContactInfoList, rateInstituteService, rateInstituteList, couponService){
            
            $scope.today = moment();
            var startOfWeek = moment().startOf('week').subtract(3, "days");
            var endOfWeek = moment().endOf('week').add(1, 'w');

            $scope.days = [];
            var day = startOfWeek;

            while (day <= endOfWeek) {
                $scope.days.push(day.toDate());
                day = day.clone().add(1, 'd');
            }
            
            $scope.daysTask = function(task, day){
                var comp = $scope.compareDates(task._deadline, day);
                console.log(task._deadline + ' ' + day + ' ' + comp);
                if(comp == 0){
                    return true;
                }else{
                    return false;
                }
            };
            $scope.compareDates = function(dateTimeA, dateTimeB) {
                dateTimeA = new Date(dateTimeA);
                var momentA = moment(dateTimeA,"DD/MM/YYYY");
                var momentB = moment(dateTimeB,"DD/MM/YYYY");
                if (momentA > momentB) return 1;
                else if (momentA < momentB) return -1;
                else return 0;
            };
            
            $scope.usersCount = usersCount.data;
            $scope.studentCount = studentCount.data;
            $scope.coachingCount = coachingCount.data;
            $scope.coachingSavedCount = coachingSavedCount.data;
            $scope.internList = internList.data;
            $scope.activeInternList = [];
            //console.log($scope.internList);
            $scope.internList.forEach( function(thisIntern, index){
                if(thisIntern.active){
                    $scope.activeInternList.push(thisIntern);    
                }
            });
            
            $scope.couponDatabaseEdit = function(){
                console.log('Database edit starting');
                couponService.databaseServices().success(function (data, status, headers) {
                    alert('All Done');
                })
                .error(function (data, status, header, config) {
                    console.log(status + " " + data);
                });
                
            };
            
            $scope.showSavedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#savedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            $scope.showFillDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#fillDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                
            };
            $scope.showInternAssignedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#internAssignedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                
            };
            
            $scope.changeUser = function(){
                toverifyciService.changeUser().success(function (data, status, headers) {
                    $scope.showSavedDialog();
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log(status + " " + data);
                });
            };
            
            $scope.changeUserContactInfo = function(){
                addContactInfoService.changeUser().success(function (data, status, headers) {
                    $scope.showSavedDialog();
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log(status + " " + data);
                });
            };
            $scope.filledCount = filledCount.data;
            $scope.reviewsCount = reviewsCount.data;
            $scope.couponsCount = couponsCount.data;
            $scope.issuedcouponsCount = issuedcouponsCount.data;
            
            $scope.tofillciList = tofillciList.data;
            
            var tofillGroupNames = $scope.tofillciList.map(function(a) {return a.institute.groupName;});
            $scope.toverifyciList = toverifyciList.data;
            $scope.addContactInfoList = addContactInfoList.data;
            $scope.rateInstituteList = rateInstituteList.data;
            
            var rateGroupNames = $scope.rateInstituteList.map(function(a) {return a.institute.groupName;});
            
            //console.log($scope.addContactInfoList);
            
            $scope.verifiedCount = verifiedCount.data;
            $scope.masterViewSummary = masterViewSummary.data;
            
            $scope.internDueList = [];
            $scope.yesterdayTasks = [];
            $scope.fillsDue = 0;
            $scope.fillsAssigned = 0;
            var internIds = $scope.internList.map(function(a) {return a._id;});
            $scope.internList.forEach( function(thisIntern, index){
                var internDue = {
                    intern: thisIntern,
                    done: 0,
                    due: 0,
                    assigned: 0,
                    taskList: [],
                };
                $scope.internDueList.push(internDue);
            });
            
            var yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            yesterday.setHours(0,0,0,0);
            $scope.yesterday = yesterday;
            
            var rightNow = new Date();
            
            $scope.tofillciList.forEach( function(thisTask, index){
               
                console.log(JSON.stringify(thisTask));
                var iIndex = internIds.indexOf(thisTask.user._id);
                
                if($scope.compareDates(thisTask._deadline, $scope.days[0]) == 1){
                    console.log($scope.internDueList[iIndex]);
                    $scope.internDueList[iIndex].taskList.push(thisTask);
                }
                
                //console.log(thisTask);
                if(thisTask.active){
                    $scope.fillsAssigned += 1;
                    var internIndex = internIds.indexOf(thisTask.user._id);
                    console.log(thisTask);
                    console.log(internIndex);
                    $scope.internDueList[internIndex].assigned += 1;
                    
                    //console.log(thisTask._deadline + ' ' + rightNow + ' ' + compare(rightNow, new Date(thisTask._deadline)));
                    if(compare(rightNow, new Date(thisTask._deadline)) == 1){
                        $scope.internDueList[internIndex].due += 1;
                        
                        
                        $scope.fillsDue += 1;
                    }
                }else{
                    var thisEmail = thisTask.institute.email;
                    if(!thisEmail || thisEmail.length == 0){
                        thisTask.noEmail = true;
                    }else{
                        thisTask.noEmail = false;
                    }
                    //console.log(thisTask._id);
                    var internIndex = internIds.indexOf(thisTask.user._id);
                    $scope.internDueList[internIndex].done += 1;
                    if(compare(new Date(thisTask._finished), yesterday) == 1){
                        $scope.yesterdayTasks.push(thisTask);
                    }
                    
                }
                
            });
            //console.log($scope.internDueList);
            $scope.verifiedUsersCount = verifiedUsersCount.data;
            $scope.ciDeadline = new Date();
            $scope.ciDeadline.setDate( $scope.ciDeadline.getDate() + 1);
            $scope.assignCIFill = function(){
                var intern = $scope.ciIntern;
                var coaching = $scope.instituteInput;
                var ciDeadline = $scope.ciDeadline;
                ciDeadline.setHours(23,59,59);
                var res = coaching.split("/");
                var coaching = res[res.length-1];
                if(coaching.length < 15 || !ciDeadline){
                    alert('Check Coaching Id or URL and deadline date');
                }else{
                    
                    var tofillciForm = {
                        institute: coaching,
                        user: intern,
                        _deadline: ciDeadline,
                    };
                    console.log(JSON.stringify(tofillciForm));
                    tofillciService.savetofillci(tofillciForm).success(function (data, status, headers) {
                        $scope.showSavedDialog();
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log(status + " " + data);
                    });
                }
            };
            
            
            $scope.getInternAssigned = function(due){
                var internId = due.intern._id;
                var internIndex = internIds.indexOf(internId);
                
                $scope.activeIntern = $scope.internDueList[internIndex];
                
                

                
                $scope.showInternAssignedDialog();
                
            };
            
            $scope.getSummary = function(tofillci){
                var instituteId = tofillci.institute._id;
                
                targetStudyProviderService.getProviderFillSummary(instituteId).success(function (data, status, headers) {
                    $scope.fillProvider = data;
                    $scope.fillUser = tofillci.user;
                    $scope.showFillDialog();
                    console.log(JSON.stringify(data));
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            
            
            $scope.rankedCities = ["Jaipur", "Delhi", "Mumbai", "New Delhi", "Gurgaon", "Kota"];
            
            $scope.ciVerifyDeadline = new Date();
            $scope.ciVerifyDeadline.setDate( $scope.ciVerifyDeadline.getDate() + 1);
            
            
            $scope.instituteVerifyCount = 1;
            $scope.ciVerifyIntern = $scope.internList[$scope.internList.length-1];
            $scope.verifyCity = 'Jaipur';
            $scope.assignCIVerify = function(){
                var intern = $scope.ciVerifyIntern;
                var instituteVerifyCount = $scope.instituteVerifyCount;
                var ciVerifyDeadline = $scope.ciVerifyDeadline;
                var verifyCity = $scope.verifyCity;
                ciVerifyDeadline.setHours(23,59,59);
                //var res = coaching.split("/");
                //var coaching = res[res.length-1];
                if(instituteVerifyCount == '' || !ciVerifyDeadline){
                    alert('Check Count or URL and deadline date');
                }else{
                    
                    var toverifyciForm = {
                        verifyCity: verifyCity,
                        instituteVerifyCount: instituteVerifyCount,
                        user: intern,
                        _deadline: ciVerifyDeadline,
                    };
                   console.log(toverifyciForm); toverifyciService.savetoverifyci(toverifyciForm).success(function (data, status, headers) {
                        console.log('Done');
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log(status + " " + data);
                    });
                }
            };
            
            $scope.addContactInfoDeadline = new Date();
            $scope.addContactInfoDeadline.setDate( $scope.addContactInfoDeadline.getDate() + 1);
            $scope.assignAddContactInfo = function(){
                var intern = $scope.addContactInfoIntern;
                var addContactInfoCount = $scope.addContactInfoCount;
                var addContactInfoDeadline = $scope.addContactInfoDeadline;
                var addContactInfoCity = $scope.addContactInfoCity;
                addContactInfoDeadline.setHours(23,59,59);
                //var res = coaching.split("/");
                //var coaching = res[res.length-1];
                if(addContactInfoCount == '' || !addContactInfoDeadline){
                    alert('Check Count or URL and deadline date');
                }else{
                    var addContactInfoForm = {
                        addContactInfoCity: addContactInfoCity,
                        addContactInfoCount: addContactInfoCount,
                        user: intern,
                        _deadline: addContactInfoDeadline,
                    };
                   console.log(addContactInfoForm); addContactInfoService.saveaddContactInfo(addContactInfoForm).success(function (data, status, headers) {
                        console.log('Done');
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log(status + " " + data);
                    });
                }
            };
            
            
            
            $scope.showRemoveConfirm = function(tofillci, ev) {
                //console.log(JSON.stringify(tofillci.user));
                var confirm = $mdDialog.confirm()
                    .title('Would you like to remove ' + tofillci.institute.name + ' for ' +  tofillci.user.basic.name + '?')
                    .textContent('Assigned on: ' + moment(tofillci._created).format('DD-MMM HH:mm') + ', Deadline: ' + moment(tofillci._deadline).format('DD-MMM HH:mm') + '!')
                    .ariaLabel('Lucky day')
                    .targetEvent(ev)
                    .clickOutsideToClose(true)
                    .ok('Confirm')
                    .cancel('Cancel');
                    $mdDialog.show(confirm).then(function() {
                      $scope.removeAssigned(tofillci);
                    }, function() {
                      //nothing
                    });

            };
            
            
            $scope.showRateRemoveConfirm = function(rateInstitute, ev) {
                //console.log(JSON.stringify(rateInstitute.user));
                var confirm = $mdDialog.confirm()
                    .title('Would you like to remove ' + rateInstitute.institute.name + ' for ' +  rateInstitute.user.basic.name + '?')
                    .textContent('Assigned on: ' + moment(rateInstitute._created).format('DD-MMM HH:mm') + ', Deadline: ' + moment(rateInstitute._deadline).format('DD-MMM HH:mm') + '!')
                    .ariaLabel('Lucky day')
                    .targetEvent(ev)
                    .clickOutsideToClose(true)
                    .ok('Confirm')
                    .cancel('Cancel');
                    $mdDialog.show(confirm).then(function() {
                      $scope.removeRateAssigned(rateInstitute);
                    }, function() {
                      //nothing
                    });

            };
            
            
            $scope.removeAssigned = function(tofillci){
                console.log(tofillci);
                tofillciService.removeAssigned(tofillci._id);
                $state.reload();
            };
            
            $scope.removeRateAssigned = function(rateInstitute){
                console.log(rateInstitute);
                rateInstituteService.removeAssigned(rateInstitute._id);
                $state.reload();
            };
            
            $rootScope.pageTitle = 'Master Dashboard';
            $scope.fetching = false;
            $scope.$watch('instituteInput', function (newValue, oldValue, scope) {
            if(newValue != null && newValue != ''){
                //console.log(newValue);
                //DEF
                var newValueArr = newValue.split("/");
                newValue = newValueArr[newValueArr.length-1];
                //$scope.email.instituteId = newValue;
                //console.log(newValue);
                if(newValue.length > 5){
                    $scope.fetching = true;
                    $scope.assignError = false;
                    console.log(newValue);
                    targetStudyProviderService.getGroupName(newValue).success(function (data, status, headers) {
                        console.log(data);
                        if(data){
                            $scope.assignGroup = data;
                            if(tofillGroupNames.indexOf(data) == -1){
                                $scope.prevFilledLength = 0;
                            }else{
                                $scope.prevFilledLength = 1;
                            }
                        }else{
                            $scope.assignError = true;
                        }
                        
                        $scope.fetching = false;
                    }).error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    
                    //tofillGroupNames 
                    /*tofillciService.prevFilled(newValue).success(function (prevfilleddata, status, headers) {
                        $scope.prevFilledLength = prevfilleddata;
                        
                        $scope.fetching = false;
                    })
                    .error(function (data, status, header, config) {
                        console.log(status + " " + data);
                    });*/
                    
                    
                    
                    
                }

            }

            }, true);
            
            
            
            
            $scope.rateInstitutefetching = false;
            $scope.$watch('rateInstitute', function (newValue, oldValue, scope) {
            if(newValue != null && newValue != ''){
                //console.log(newValue);
                //DEF
                var newValueArr = newValue.split("/");
                newValue = newValueArr[newValueArr.length-1];
                //$scope.email.instituteId = newValue;
                //console.log(newValue);
                if(newValue.length > 5){
                    $scope.fetching = true;
                    $scope.assignError = false;
                    console.log(newValue);
                    targetStudyProviderService.getGroupName(newValue).success(function (data, status, headers) {
                        console.log(data);
                        if(data){
                            $scope.assignGroup = data;
                            if(rateGroupNames.indexOf(data) == -1){
                                $scope.prevRateLength = 0;
                            }else{
                                $scope.prevRateLength = 1;
                            }
                        }else{
                            $scope.assignError = true;
                        }
                        
                        $scope.fetching = false;
                    }).error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    
                    //tofillGroupNames 
                    /*tofillciService.prevFilled(newValue).success(function (prevfilleddata, status, headers) {
                        $scope.prevFilledLength = prevfilleddata;
                        
                        $scope.fetching = false;
                    })
                    .error(function (data, status, header, config) {
                        console.log(status + " " + data);
                    });*/
                    
                    
                    
                    
                }

            }

            }, true);
            
            $scope.ciRateDeadline = new Date();
            $scope.ciRateDeadline.setDate( $scope.ciRateDeadline.getDate() + 1);
            $scope.assignCIRate = function(){
                var intern = $scope.ciRateIntern;
                var coaching = $scope.rateInstitute;
                var ciRateDeadline = $scope.ciRateDeadline;
                ciRateDeadline.setHours(23,59,59);
                var res = coaching.split("/");
                var coaching = res[res.length-1];
                if(coaching.length < 15 || !ciRateDeadline){
                    alert('Check Coaching Id or URL and deadline date');
                }else{
                    
                    var rateInstituteForm = {
                        institute: coaching,
                        user: intern,
                        _deadline: ciRateDeadline,
                    };
                    console.log(JSON.stringify(rateInstituteForm));
                    rateInstituteService.saverateInstitute(rateInstituteForm).success(function (data, status, headers) {
                        $scope.showSavedDialog();
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log(status + " " + data);
                    });
                }
            };
            
            
            
    }]);
    
    /*    
    exambazaar.controller("masterToFillController", 
        [ '$scope', 'internList', 'tofillciList', 'tofillciService', '$state', 'filledCount', '$mdDialog', function($scope, internList, tofillciList, tofillciService, $state , filledCount, $mdDialog){
            
            $scope.internList = internList.data;
            $scope.activeInternList = [];
            //console.log($scope.internList);
            $scope.internList.forEach( function(thisIntern, index){
                if(thisIntern.active){
                    $scope.activeInternList.push(thisIntern);    
                }
            });
            
            $scope.filledCount = filledCount.data;
            $scope.tofillciList = tofillciList.data;
            
            $scope.internDueList = [];
            $scope.yesterdayTasks = [];
            $scope.fillsDue = 0;
            $scope.fillsAssigned = 0;
            var internIds = $scope.internList.map(function(a) {return a._id;});
            $scope.internList.forEach( function(thisIntern, index){
                var internDue = {
                    intern: thisIntern,
                    done: 0,
                    due: 0,
                    assigned: 0
                };
                $scope.internDueList.push(internDue);
            });
            
            var yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            yesterday.setHours(0,0,0,0);
            $scope.yesterday = yesterday;
            
            var rightNow = new Date();
            
            $scope.tofillciList.forEach( function(thisTask, index){
               
                
                //console.log(JSON.stringify(thisTask.institute));
                if(thisTask.active){
                    $scope.fillsAssigned += 1;
                    var internIndex = internIds.indexOf(thisTask.user._id);
                    //console.log(internIndex);
                    $scope.internDueList[internIndex].assigned += 1;
                    
                    //console.log(thisTask._deadline + ' ' + rightNow + ' ' + compare(rightNow, new Date(thisTask._deadline)));
                    if(compare(rightNow, new Date(thisTask._deadline)) == 1){
                        $scope.internDueList[internIndex].due += 1;
                        $scope.fillsDue += 1;
                    }
                }else{
                    var thisEmail = thisTask.institute.email;
                    if(!thisEmail || thisEmail.length == 0){
                        thisTask.noEmail = true;
                    }else{
                        thisTask.noEmail = false;
                    }
                    var internIndex = internIds.indexOf(thisTask.user._id);
                    $scope.internDueList[internIndex].done += 1;
                    if(compare(new Date(thisTask._finished), yesterday) == 1){
                        $scope.yesterdayTasks.push(thisTask);
                    }
                    
                }
            });
            $scope.ciDeadline = new Date();
            $scope.ciDeadline.setDate( $scope.ciDeadline.getDate() + 1);
            $scope.assignCIFill = function(){
                var intern = $scope.ciIntern;
                var coaching = $scope.instituteInput;
                var ciDeadline = $scope.ciDeadline;
                ciDeadline.setHours(23,59,59);
                var res = coaching.split("/");
                var coaching = res[res.length-1];
                if(coaching.length < 15 || !ciDeadline){
                    alert('Check Coaching Id or URL and deadline date');
                }else{
                    
                    var tofillciForm = {
                        institute: coaching,
                        user: intern,
                        _deadline: ciDeadline,
                    };
                    console.log(JSON.stringify(tofillciForm));
                    tofillciService.savetofillci(tofillciForm).success(function (data, status, headers) {
                        alert('Done');
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log(status + " " + data);
                    });
                }
            };
            
            $scope.showRemoveConfirm = function(tofillci, ev) {
                console.log(JSON.stringify(tofillci.institute));
                console.log(JSON.stringify(tofillci.user));
                
                var confirm = $mdDialog.confirm()
                    .title('Would you like to remove ' + tofillci.institute.name + ' for ' +  tofillci.user.name + '?')
                    .textContent('Assigned on: ' + moment(tofillci._created).format('DD-MMM HH:mm') + ', Deadline: ' + moment(tofillci._deadline).format('DD-MMM HH:mm') + '!')
                    .ariaLabel('Lucky day')
                    .targetEvent(ev)
                    .clickOutsideToClose(true)
                    .ok('Confirm')
                    .cancel('Cancel');
                    $mdDialog.show(confirm).then(function() {
                      $scope.removeAssigned(tofillci);
                    }, function() {
                      //nothing
                    });
            };
            
            
            $scope.removeAssigned = function(tofillci){
                console.log(tofillci);
                tofillciService.removeAssigned(tofillci._id);
                $state.reload();
            };
            
    }]);    */
        
    exambazaar.controller("seocontroller", ['$rootScope', function($rootScope){
        $rootScope.pageTitle = "Exambazaar: Exclusive Deals and Videos for test preparation";
    }]);
    
    
    exambazaar.controller("loginController", 
        [ '$scope','$rootScope','$state','$cookies','$http','UserService', '$mdDialog', function($scope,$rootScope,$state,$cookies,$http,UserService,$mdDialog){
        $mdDialog.hide();
        $scope.login = {
            mobile: '',
            password: ''
        };
        if(typeof($cookies.getObject('sessionuser'))!= 'undefined'){
            $scope.sessionuser = $cookies.getObject('sessionuser');
        }
         
        if($scope.sessionuser != null){
           if($scope.sessionuser.studentId != null){
               StudentService.getStudentNotification($scope.sessionuser.studentId).success(function (data, status, headers) {
                    
               $scope.$evalAsync(
                    function( $scope ) {
                        $scope.notification = data;
                    }
                ); 
                   
                })
                .error(function (data, status, header, config) {
                    console.log(status + " " + data);
                });
            }    
        } 
            
        $scope.login = function(){
            $http.post('/login', {
              mobile: $scope.login.mobile,
              password: $scope.login.password,
            })
            .success(function(user){
                
                
                var loginForm = {
                    userId: user._id
                };
                if($cookies.getObject('ip')){
                    var ip = $cookies.getObject('ip');
                    loginForm.ip = ip;
                }
                console.log(JSON.stringify(loginForm));
                UserService.markLogin(loginForm).success(function (data, status, headers) {
                    console.log('Login marked');
                })
                .error(function (data, status, header, config) {
                    console.log(status + " " + data);    
                });
                UserService.getUser(user._id).success(function (data, status, headers) {
                    var fulluser = data;
                    var sessionuser;
                    if(user.verified===true){
                        console.log('User type is: ' + user.userType);
                        
                        sessionuser = {
                            userId: fulluser._id,
                            masterId: fulluser._id,
                            facebookId: fulluser.facebookId,
                            userType: fulluser.userType,
                            basic: fulluser.basic,
                            image: fulluser.image,
                            mobile: fulluser.mobile,
                            email: fulluser.email,
                            
                        };
                        
                            
                        
                        $cookies.putObject('sessionuser', sessionuser);
                        if($state.current.name == 'landing' || $state.current.name == 'login'){
                            if(sessionuser.userType =='Master'){
                                $state.go('master-dashboard', {masterId: sessionuser.masterId});
                                
                                
                            }
                            if(sessionuser.userType =='Intern - Business Development'){ $state.go('assigned', {userId: sessionuser.userId});
                            }
                            if(sessionuser.userType =='Student'){
                                $state.reload();
                            }
                            
                        }else{
                            $state.reload();
                        }
                        
                        
                    }else{
                        
                        $state.go('verify', {userId: user._id});
                    }
                    
                })
                .error(function (data, status, header, config) {
                console.log('Error');
                })
            
            })
            .error(function (data, status, header, config){
              
              $scope.login.password="";
              $scope.message = 'Incorrect Mobile or Password';
                
            });
        };//login ends
        /*$scope.logout = function(){
            $cookies.remove('sessionuser');
            $http.post('/logout');
            $state.reload();
            //$state.go("main", {}, {reload: true});
        };*/
            
    }]);
    
    exambazaar.controller("footerController", 
        [ '$scope', '$rootScope', 'ExamService', function($scope, $rootScope, ExamService){
        $scope.maintenance = false;    
        if(!$rootScope.streamExams || $rootScope.streamExams.length == 0){
            ExamService.getExamsBasic().success(function (data, status, headers) {
                var doNotShow = ['Other', 'Insurance', 'School'];
                var streamNames = [];
                var streamExams = [];
                var allExams = data;
                allExams.forEach(function(thisExam, eIndex){
                    var thisStream = thisExam.stream.displayname;
                    var dIndex = doNotShow.indexOf(thisStream);
                    if(thisExam.active && dIndex == -1){
                        var sIndex = streamNames.indexOf(thisStream);
                        if(sIndex == -1){
                            streamNames.push(thisStream);
                            var streamExamObj = {
                                stream: thisStream,
                                active: thisExam.stream.active,
                                rank: thisExam.stream.rank,
                                exams: []
                            };
                            streamExamObj.exams.push(thisExam);
                            streamExams.push(streamExamObj);
                        }else{
                            streamExams[sIndex].exams.push(thisExam);
                        }
                    }            
                });
                $rootScope.streamExams = streamExams;
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });   
        }
            
    }]);     
    exambazaar.controller("headerController", 
        [ '$scope','$rootScope','$state', '$stateParams','$cookies','$http','UserService', 'OTPService','NotificationService','ipService','blogpostService','$geolocation', '$facebook', '$mdDialog', 'EmailService', 'ExamService', 'SidebarJS','$timeout', '$window', function($scope,$rootScope,$state, $stateParams,$cookies,$http,UserService, OTPService, NotificationService, ipService, blogpostService, $geolocation, $facebook, $mdDialog, EmailService, ExamService, SidebarJS,$timeout, $window){
            
            $scope.maintenance = false;
            
            
            $rootScope.pageType = "website";
            $rootScope.pageSeeAlso = null;
            $rootScope.searchMode = false;
            $rootScope.searchPlaceholder = "Search";
            $rootScope.stateName = $state.current.name;
            
            
            
            $rootScope.loginState = $rootScope.stateName;
            $rootScope.defaultCoachingLogo = "https://exambazaar.s3.amazonaws.com/fb2b671170976dfdbb2992a1aeaf0c87.png";
            
            
            $rootScope.permittedToAdd = [
                '59085f0fc7289d0011d6ea8c',
                '59a7eb973d71f10170dbb468',
                '5a1831f0bd2adb260055e352',
                '5a20ab026740556f2a36c7c0',
                '5a239c17783f96589525bfc2',
                '5a29000d2742b6164f1a7024',
                '5a2bf98207932b2309259431',
                '5a20e929799c4c2e6d4e120a',
            ];
            
            $rootScope.permittedToDisable = [
                '5a1831f0bd2adb260055e352',
                
            ];
            
            if(!$rootScope.headerBlogs){
                blogpostService.headerBlogs().success(function (data, status, headers) {
                    $rootScope.headerBlogs = data;
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }
            if(!$rootScope.streamranks || !$rootScope.streamexams){
                ExamService.streamexam().success(function (data, status, headers) {
                    if(data){
                        
                        $rootScope.streamranks = data.streamranks;
                        
                        $rootScope.streamexams = data.streamexams;
                        
                    }
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }
            
            //"findCoaching", "showCoaching", "showGroup"
            var headerGreenStates = [];
            
            var headerTransparentStates = ["landing", "main", "category", "city"];
            $scope.headerLogoCSS = function(){
                var stateName = $state.current.name;
                var headerLogoCSS = "headerLogo";
                var sIndex = -1;
                
                if(stateName =="showblog"){
                    $rootScope.pageType = "article";
                }
                
                sIndex = headerGreenStates.indexOf(stateName);
                if(sIndex != -1){
                    headerLogoCSS = "headerLogoGreen";
                }
                
                sIndex = headerTransparentStates.indexOf(stateName);
                if(sIndex != -1){
                    headerLogoCSS = "headerLogoTransparent";
                }
                return headerLogoCSS;
            };
            
            $scope.headerBackgroundCSS = function(){
                var stateName = $state.current.name;
                var headerBackgroundCSS = "headerWhite";
                var sIndex = -1;
                
                sIndex = headerGreenStates.indexOf(stateName);
                if(sIndex != -1){
                    headerBackgroundCSS = "headerGreen";
                }
                
                sIndex = headerTransparentStates.indexOf(stateName);
                if(sIndex != -1){
                    headerBackgroundCSS = "headerTransparent";
                }
                return headerBackgroundCSS;
            };
            
            $scope.headerButtonCSS = function(){
                var stateName = $state.current.name;
                var headerButtonCSS = "md-green2 tolowercase";
                var sIndex = -1;
                
                sIndex = headerGreenStates.indexOf(stateName);
                if(sIndex != -1){
                    headerButtonCSS = "md-black tolowercase";
                }
                
                sIndex = headerTransparentStates.indexOf(stateName);
                if(sIndex != -1){
                    headerButtonCSS = "md-green2 tolowercase";
                }
                return headerButtonCSS;
            };
            
            $scope.headerShowOptions = function(){
                var stateName = $state.current.name;
                var showVal = true;
                var sIndex = -1;
                
                sIndex = headerTransparentStates.indexOf(stateName);
                if(sIndex != -1){
                    showVal = false;
                }
                return showVal;
            };
            $rootScope.showMobileSearch = false;
            $scope.flipMobileSearch = function(){
                $rootScope.showMobileSearch = !$rootScope.showMobileSearch;
            };
            
            $scope.sendWelcomeEmail = function(){
                if(!$scope.user){
                    $scope.user = $cookies.getObject('sessionuser');
                }
                console.log($scope.user);
                if($scope.user && $scope.user.email){
                    $scope.email = {
                        to: $scope.user.email,
                        templateName: 'Verification Email',
                        username: $scope.user.basic.name,
                        userid: $scope.user._id
                    };
                    EmailService.verifyEmail($scope.email).success(function (data, status, headers) {
                        var response = data;
                        console.log(JSON.stringify(response));

                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });  

                }else{
                    console.log('Either no user or no email for the user');
                }
            }; 
        
            
            
        
        if($rootScope.stateName == 'showGroup'){
            $rootScope.coachingGroupName = $stateParams.groupName;
            $rootScope.coachingGroupCity = $stateParams.cityName;
        }
        
        //console.log($rootScope.stateName );
        $scope.showLoginDialog = function(ev) {
            var forceLoginStates = ['showGroup', 'claim', 'rankerswall', 'k21', 'eligibility', 'questionpapers'];
            SidebarJS.close();
            if(forceLoginStates.indexOf($state.current.name) != -1){
                //console.log('I am here');
                $mdDialog.show({
                  contentElement: '#loginDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: false,
                  escapeToClose: false,
                  //hasBackdrop: true,
                  openFrom: {
                      top: -50,
                      width: 30,
                      height: 80
                    },
                 closeTo: {
                  left: 1500
                }
                });
            }else{
                $mdDialog.show({
                  contentElement: '#loginDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true,
                  escapeToClose: true,
                  //hasBackdrop: true,
                  openFrom: {
                      top: -50,
                      width: 30,
                      height: 80
                    },
                 closeTo: {
                  left: 1500
                }
                });
            }
            
        };
            
        $scope.showForcedLoginDialog = function(ev) {
            console.log('Forced Login');
            SidebarJS.close();
            $mdDialog.show({
              contentElement: '#loginDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: false,
              escapeToClose: false,
              //hasBackdrop: true,
              openFrom: {
                  top: -50,
                  width: 30,
                  height: 80
                },
             closeTo: {
              left: 1500
            }
            });
            
        };
        $scope.hideLoginDialog = function(ev){
            $mdDialog.hide();
        };
           
        
            
        $scope.signupMode = false;
        $scope.resetMode = false;
        $scope.signupToggle = function(){
            $scope.signupMode = !$scope.signupMode;
        };
        $scope.resetToggle = function(){
            $scope.resetMode = !$scope.resetMode;
        };
            
        if($cookies.getObject('ip')){
            //console.log("IP exists");
        }else{
            ipService.getip()
            .success(function (data, status, headers) {
                //console.log(data);
                var ip = {
                    city: data.city,
                    country: data.country_name,
                    region: data.region_name,
                    lat: data.latitude,
                    long: data.longitude,
                    zip: data.zip_code,
                    query: data.ip,
                };
                //console.log(ip);
                $cookies.putObject('ip', ip);
            })
            .error(function (data, status, header, config) {
                console.log();
            });
        }
            
        
        
        if($cookies.getObject('userlocation')){
            $scope.userlocation = $cookies.getObject('userlocation');
            
            if(!$scope.userPosition || $scope.userPosition.length < 4){
                //console.log('Empty object');
                $geolocation.getCurrentPosition({
                timeout: 60000
                 }).then(function(position) {
                    $cookies.putObject('userlocation', position);
                    $scope.userlocation = position;
                    if($scope.userlocation && $scope.userlocation.coords && $scope.userlocation.coords.latitude &&  $scope.userlocation.coords.longitude){
                        $scope.userlatlng = new google.maps.LatLng($scope.userlocation.coords.latitude, $scope.userlocation.coords.longitude);
                        
                        $scope.userPosition = $scope.userlocation.coords.latitude.toString() + "," + $scope.userlocation.coords.longitude.toString();
                        $cookies.putObject('userPosition', $scope.userPosition);
                        
                    }
                 });
            }
            
            
            if($scope.userlocation && $scope.userlocation.coords && $scope.userlocation.coords.latitude &&  $scope.userlocation.coords.longitude){
                $scope.userlatlng = new google.maps.LatLng($scope.userlocation.coords.latitude, $scope.userlocation.coords.longitude);
                
                
                $scope.userPosition = $scope.userlocation.coords.latitude.toString() + "," + $scope.userlocation.coords.longitude.toString();
            }
            
        }else{
            $geolocation.getCurrentPosition({
            timeout: 60000
             }).then(function(position) {
                $cookies.putObject('userlocation', position);
                $scope.userlocation = position;
                if($scope.userlocation && $scope.userlocation.coords && $scope.userlocation.coords.latitude &&  $scope.userlocation.coords.longitude){
                    $scope.userlatlng = new google.maps.LatLng($scope.userlocation.coords.latitude, $scope.userlocation.coords.longitude); 
                }
                
             });
        }
        
            
        $scope.showLoginForm = function(){
            $scope.showLoginDialog();
            
        };
        $scope.showForcedLoginForm = function(){
            $scope.showForcedLoginDialog();
            
        };    
        
            
        $rootScope.$on("CallShowLogin", function(){
           $scope.showLoginForm();
        });
        $rootScope.$on("ForcedLogin", function(){
           $scope.showForcedLoginForm();
        });

        $rootScope.$on("CallBlogLogin", function(){
           $scope.showLoginForm();
        });
            
        if($cookies.getObject('sessionuser')){
            $scope.sessionuser = $cookies.getObject('sessionuser');
        }else{
            $scope.sessionuser = {};
        }
            
        $scope.userlogin = {
            mobile: '',
            password: ''
        };
            
        $scope.login = function(){
            console.log('Login Initiated');
            
            
            $http.post('/login', {
              mobile: $scope.userlogin.mobile,
              password: $scope.userlogin.password,
            })
            .success(function(user){
                var loginForm = {
                    userId: user._id
                };
                if($cookies.getObject('ip')){
                    var ip = $cookies.getObject('ip');
                    loginForm.ip = ip;
                }
                
                UserService.markLogin(loginForm).success(function (data, status, headers) {
                    console.log('Login marked');
                })
                .error(function (data, status, header, config) {
                    console.log(status + " " + data);    
                });
                UserService.getUser(user._id).success(function (data, status, headers) {
                    $scope.hideLoginDialog();
                    var fulluser = data;
                    var sessionuser;
                    if(user.verified===true){
                        sessionuser = {
                            _id: fulluser._id,
                            userId: fulluser._id,
                            masterId: fulluser._id,
                            facebookId: fulluser.facebookId,
                            userType: fulluser.userType,
                            basic: fulluser.basic,
                            image: fulluser.image,
                            mobile: fulluser.mobile,
                            email: fulluser.email,
                        };
                        
                        if(user.userType == 'Partner'){
                            sessionuser.partner = user.partner;
                        }
                        $cookies.putObject('sessionuser', sessionuser);
                        $scope.sessionuser = sessionuser;
                        loginReroute();
                        
                    }else{
                        
                        $state.go('verify', {userId: user._id});
                    }
                    
                })
                .error(function (data, status, header, config) {
                console.log('Error');
                })
            
            })
            .error(function(){
                $scope.login.password="";
                $scope.loginErrorMessage = 'Incorrect mobile or password';

                //$state.go('login');
            });
        };//login ends
        $scope.logout = function(){
            //$http.post('/logout');
            
            
            if($scope.sessionuser && $scope.sessionuser.facebookId){
                console.log('Facebook Logout Initiated');
                $cookies.remove('sessionuser');
                $scope.sessionuser = {};
                $facebook.logout().then(function(response) {
                    console.log('Facebook Logout done');
                    $state.reload();
                });
            }else{
                console.log('Normal Logout Inititated');
                $cookies.remove('sessionuser');
                $scope.sessionuser = {};
                $http.post('/logout');
                $state.reload();
            }
        }; 
        

        $scope.fblogin = function() {
            
           
            $facebook.login().then(function(response) {
                $scope.fbLoginStatus = response;
                //console.log("Login Status is: " + JSON.stringify($scope.fbLoginStatus));
                refresh();
            });
            
        };
            
        function refresh() {
            $facebook.api("/me", {fields: 'id, name, age_range, link, gender, picture, email'}).then(
            function(response) {
                
                if($scope.sessionuser && $scope.sessionuser.userId){
                    //link the user's fb id to the current user
                    $scope.sessionuser.fbuser = {
                        name: response.name,
                        gender: response.gender,
                        image: response.picture.data.url,
                        email: response.email,
                        facebook: {
                            link: response.link,
                            id: response.id,
                        }
                    };

                    if(!$scope.sessionuser.facebookId){
                    //console.log("Calls being made to add user");
                    $scope.sessionuser.fbuser.facebook.accessToken = $scope.fbLoginStatus.authResponse.accessToken;
                    UserService.fbSave($scope.sessionuser).success(function (data, status, headers) {
                        $mdDialog.hide();
                        var fulluser = data;
                        console.log(fulluser);
                        var sessionuser = {
                            _id: fulluser._id,
                            userId: fulluser._id,
                            facebookId: fulluser.facebookId,
                            userType: fulluser.userType,
                            basic: fulluser.basic,
                            image: fulluser.image,
                            mobile: fulluser.mobile,
                            email: fulluser.email,

                        };
                        //console.log('I am here');
                        $cookies.putObject('sessionuser', sessionuser);
                        $scope.sessionuser = sessionuser;
                        
                        loginReroute();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    }

                }else{
                    $scope.sessionuser = {};
                    $scope.sessionuser.fbuser = {
                        name: response.name,
                        gender: response.gender,
                        image: response.picture.data.url,
                        email: response.email,
                        facebook: {
                            link: response.link,
                            id: response.id,
                        }
                    };
                    if(!$scope.sessionuser.facebookId){
                    //add a new user with facebook id
                    //console.log("Calls being made to add user");
                    $scope.sessionuser.fbuser.facebook.accessToken = $scope.fbLoginStatus.authResponse.accessToken;
                    UserService.fbSave($scope.sessionuser).success(function (data, status, headers) {
                        $mdDialog.hide();
                        
                        var fulluser = data;
                        var sessionuser = {
                            _id: fulluser._id,
                            userId: fulluser._id,
                            facebookId: fulluser.facebookId,
                            userType: fulluser.userType,
                            basic: fulluser.basic,
                            image: fulluser.image,
                            mobile: fulluser.mobile,
                            email: fulluser.email,

                        };
                        $cookies.putObject('sessionuser', sessionuser);
                        $scope.sessionuser = sessionuser;
                        
                        loginReroute();
                        
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    }
                }

                },
                function(err) {
                    $scope.welcomeMsg = "Please log in";
                    $scope.isLoggedIn = false;
            });
            $facebook.api("/me/permissions").then(
                function(response) {
                    //console.log(response);
                    $scope.permissions = response;
                },
                function(err) {
                $scope.welcomeMsg = "Permissions Error";
            });
                
        };
            
        function loginReroute(){
            $mdDialog.hide();
            
            $rootScope.$emit("userset", {});
            console.log('Rerouting to state');
            if($state.current.name == 'landing'){
                if($scope.sessionuser.userType =='Master'){

                    //$state.go('master-dashboard', {masterId: $scope.sessionuser.userId});
                    $state.go('charting');
                }
                if($scope.sessionuser.userType =='Intern - Business Development'){
                     $state.go('assigned', {userId: $scope.sessionuser.userId});
                }
                if($scope.sessionuser.userType =='Student'){
                    //console.log('student logged in');
                    //$state.reload();
                }
                if($scope.sessionuser.userType =='Partner'){
                    $state.go('partner-dashboard', {userId: $scope.sessionuser.userId});
                }
            }else{
                if($state.current.name == 'exam'){
                    $state.reload();
                }
                if($state.current.name == 'showblog'){
                    $state.reload();
                }
                if($state.current.name == 'profile'){
                    $state.reload();
                }
                if($state.current.name == 'assessment'){
                    $state.reload();
                }
                if($state.current.name == 'claim'){
                    $state.reload();
                }
                if($state.current.name == 'questionpapers'){
                    $state.reload();
                }
                //$state.reload();
            }
        };
            
        $scope.signup = {
            name: '',
            email: '',
            mobile: '',
            password: '',
        }; 
        $scope.checkSignupForm = function(){
            var disabled = false;
            
            if($scope.signup.name.length <3){
                disabled = true;
            }
            if(!$scope.signup.password || $scope.signup.password.length < 6){
                disabled = true;
            }
            if(!$scope.OTPVerified){
                disabled = true;
            }
            return disabled;
        };
        $scope.checkResetForm = function(){
            var disabled = false;
            if($scope.reset.mobile){
                $scope.reset.mobile = $scope.reset.mobile.toString();
            }
            if(!$scope.reset.mobile || $scope.reset.mobile.length != 10){
                disabled = true;
            }
            if(!$scope.reset.password || $scope.reset.password.length < 6){
                disabled = true;
            }
            if(!$scope.ResetOTPVerified){
                disabled = true;
            }
            return disabled;
        };
        
        $scope.showVerifyOTP = false;
        $scope.showResetVerifyOTP = false;
        $scope.OTPsent = false;
        $scope.ResetOTPsent = false;
        
         
        
        $scope.$watch('signup.mobile', function (newValue, oldValue, scope) {
            if(newValue)
            newValue = newValue.toString();
            if(newValue && newValue.length == 10){
                $scope.showVerifyOTP = true;
                //Change this back
                //$scope.showVerifyOTP = false;
                //$scope.OTPVerified = true;
                //$scope.userExistMessage = null;
            }

        }, true);
        $scope.reset = {
            mobile: '',
            otp: '',
            password: '',
        }
        $scope.$watch('reset.mobile', function (newValue, oldValue, scope) {
            if(newValue)
            newValue = newValue.toString();
            if(newValue && newValue.length == 10){
                $scope.showResetVerifyOTP = true;
                $scope.userExistMessage = null;
            }else{
                $scope.showResetVerifyOTP = false;
                $scope.userExistMessage = null;
            }

        }, true);      
            
        $scope.$watch('reset.otp', function (newValue, oldValue, scope) {
            if(newValue)
                newValue = newValue.toString();
            if(newValue && newValue.length == 4){
                console.log(newValue);
                if($scope.setResetOTP == newValue){
                    $scope.ResetOTPVerified = true;
                    $scope.ResetOTPmessage = null;
                }else{
                    $scope.ResetOTPmessage = 'Incorrect OTP';
                }
                
            }

        }, true);    
            
        $scope.$watch('signup.otp', function (newValue, oldValue, scope) {
            if(newValue)
                newValue = newValue.toString();
            if(newValue && newValue.length == 4){
                if($scope.setOTP == newValue){
                    $scope.OTPVerified = true;
                    $scope.OTPmessage = null;
                }else{
                    $scope.OTPmessage = 'Incorrect OTP';
                }
                
            }

        }, true);
        
            
        $scope.verifyPhone = function(){
            $scope.generateUserOTP();
        };
        $scope.resetPhone = function(){
            $scope.generateUserResetOTP();
        };    
            
        $scope.verifyOTP = function(){
            if($scope.newUser.OTP == $scope.setOTP){
                $scope.step2 = false;
                $scope.step3 = true;
            }else{
                $scope.OTPmessage = 'Incorrect OTP';
            }
        };
        $scope.signupUser = function(){
            $scope.signup.userType = 'Student';
            $scope.signup.verified = true;
            var saveUser = UserService.saveUser($scope.signup).success(function (data, status, headers) {
                var fulluser = data;
                
                var sessionuser = {
                    _id: fulluser._id,
                    userId: fulluser._id,
                    masterId: fulluser._id,
                    facebookId: fulluser.facebookId,
                    userType: fulluser.userType,
                    basic: fulluser.basic,
                    image: fulluser.image,
                    mobile: fulluser.mobile,
                    email: fulluser.email,
                    
                };
                $cookies.putObject('sessionuser', sessionuser);
                $scope.sessionuser = sessionuser;
                $mdDialog.hide();
                $state.reload();
                
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
            
        $scope.generateUserResetOTP = function(){
            console.log('Sending Reset Message');
            UserService.userexists($scope.reset.mobile).success(function (data, status, headers) {
                var userExists = data;
                if(userExists){
                     var thisOTP = {
                        mobile:$scope.reset.mobile,
                        otp: generateOtp(),
                        reason : 'Reset'
                    };
                    OTPService.generateOTP(thisOTP).success(function (data, status, headers) {
                        $scope.ResetOTPsent = true;
                        $scope.setResetOTP = data.otp;
                        console.log("OTP sent to mobile " + thisOTP.mobile);
                    })
                    .error(function (data, status, header, config) {

                    });
                }else{
                    $scope.userResetExistMessage = "User with mobile " + $scope.reset.mobile + ' does not exist!';   
                    
                }
                //$state.go('main');

            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
            
        };
            
        $scope.generateUserOTP = function(){
            UserService.userexists($scope.signup.mobile).success(function (data, status, headers) {
                var userExists = data;
                //console.log(userExists);
                if(userExists){
                    $scope.userExistMessage = "User with mobile " + $scope.signup.mobile + ' already exists!';    
                }else{
                    var thisOTP = {
                        mobile:$scope.signup.mobile,
                        otp: generateOtp(),
                        reason : 'Signup'
                    };
                    OTPService.generateOTP(thisOTP).success(function (data, status, headers) {
                        $scope.OTPsent = true;
                        $scope.setOTP = data.otp;
                        console.log("OTP sent to mobile " + thisOTP.mobile);
                    })
                    .error(function (data, status, header, config) {

                    });
                }
                //$state.go('main');

            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
            
        };
            
            
        $scope.resetPassword = function(){
            console.log($scope.reset);
           var userPassword = {
               mobile: $scope.reset.mobile,
               newPassword: $scope.reset.password,
           };
            UserService.updatePassword(userPassword).success(function (data, status, headers) {
                //console.log('User verified & password updated! Please login again.');
                $scope.userlogin.mobile = $scope.reset.mobile;
                $scope.userlogin.password = $scope.reset.password;
                //console.log($scope.userlogin);
                $scope.login();
                //$scope.logout();
                //$state.go('main');
            })
            .error(function (data, status, header, config) {
                $scope.ServerResponse =  htmlDecode("Data: " + data +
                    "\n\n\n\nstatus: " + status +
                    "\n\n\n\nheaders: " + header +
                    "\n\n\n\nconfig: " + config);
            });
            
        }    
        /*$rootScope.fblikeDialog = null;
        $rootScope.fbpopupMode = false;
        $rootScope.showfblikeDialog = function(ev) {
            $rootScope.fbpopupMode = true;
            $rootScope.fblikeDialog = $mdDialog.show({
              contentElement: '#fblikeDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: false,
              escapeToClose: false,
              //hasBackdrop: true,
              
            });

        };
        $timeout(function() {
          if($rootScope.fblikeDialog && !$rootScope.fblikeDialog.$$state.status) { 
           console.log("Dialog is still active");
          }else{
              console.log("Dialog is not open");
              $rootScope.fblikeDialog = null;
              $rootScope.fbpopupMode = false;
          }
        }, 1000);*/
        
        
            
    }]); 
    
      
    
    exambazaar.controller("verifyController", 
    [ '$scope','thisuser','OTPService','UserService','$rootScope','$state','$cookies', function($scope,thisuser,OTPService,UserService,$rootScope,$state,$cookies){
        $scope.user = thisuser.data;
        $scope.sessionuser = $cookies.getObject('sessionuser');
        
        $scope.enterOTP=false;
        $scope.setOTP;
        $scope.next=false;
        $scope.privacyPolicy=false;
        $scope.OTPgenerated=false;
        $scope.acceptPrivacyPolicy=false;
        
        
        var thisOTP = {
            _user:$scope.user._id,
            firstName:$scope.user.firstName,
            mobile:$scope.user.mobile,
            otp: generateOtp(),
            reason : 'Verification'
        };
        
        $scope.generateUserOTP = function(){
            OTPService.generateOTP(thisOTP).success(function (data, status, headers) {
            $scope.acknowledgement = data;
            $scope.enterOTP = true;
            $scope.setOTP = data.otp;
            $rootScope.message="OTP sent to mobile " + thisOTP.mobile;
            })
            .error(function (data, status, header, config) {
                $scope.ServerResponse =  htmlDecode("Data: " + data +
                    "\n\n\n\nstatus: " + status +
                    "\n\n\n\nheaders: " + header +
                    "\n\n\n\nconfig: " + config);
            });
            $scope.OTPgenerated=true;
        };
        
        $scope.checkOTP = function(){
            if($scope.inputOTP ==$scope.setOTP){
                $scope.privacyPolicy=true;
                $scope.acceptPrivacyPolicy=true;
            }else{
                $scope.privacyPolicy=false;
                $scope.acceptPrivacyPolicy=true;
            }
        };
        $scope.setNewPassword = function(){
           var userPassword = {
               userId: $scope.user._id,
               newPassword: $scope.password
           };
            UserService.updatePassword(userPassword).success(function (data, status, headers) {
                $rootScope.message = 'User verified & password updated! Please login again.';
                $scope.logout();
                //$state.go('main');
            })
            .error(function (data, status, header, config) {
                $scope.ServerResponse =  htmlDecode("Data: " + data +
                    "\n\n\n\nstatus: " + status +
                    "\n\n\n\nheaders: " + header +
                    "\n\n\n\nconfig: " + config);
            });
            
        }
        /*$scope.logout = function(){
            $scope.user = {};
            $cookies.remove('sessionuser');
            $state.reload();
            
        };*/
    }]);
    
    
    
     
     exambazaar.controller("providersWithAreasController", 
    [ '$scope', 'targetStudyProviderService','targetStudyProvidersList','$state','$stateParams', '$cookies', function($scope, targetStudyProviderService,targetStudyProvidersList,$state,$stateParams, $cookies){
        
        $scope.providersList = targetStudyProvidersList.data;
        
        $scope.startsWithProviders = function(){
           
           if($scope.startsWith != ''){
               targetStudyProviderService.changeProvidersStartingWith($scope.startsWith).success(function (data, status, headers) {
                    console.log("Done");
                   $scope.clear();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
           }
            
        };
        $scope.setStartsWith = function(name){
            var splitPoint = name.indexOf('-');
            var newName = name.substring(0,splitPoint).trim();
            $scope.startsWith = newName;
            $scope.startsWithProviders();
        };
        $scope.clear = function(){
            $scope.startsWith = '';
        };
    }]); 
        
    exambazaar.controller("groupController", 
    [ '$scope', 'targetStudyProviderService','$timeout','$state','$stateParams', '$cookies','$mdDialog','$window', function($scope, targetStudyProviderService,$timeout,$state,$stateParams, $cookies,$mdDialog,$window){
        //$scope.providersList = targetStudyProvidersList.data;
        $scope.findPartners = function (query){
            targetStudyProviderService.groupProviders(query).success(function (data, status, headers) {
                $scope.providersList = data;
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
            
            
        };
        
        if($cookies.getObject('sessionuser')){
            
            $scope.user = $cookies.getObject('sessionuser');
            if($scope.user.userType=='Master'){
                $scope.showLevel = 10;
            }
            if($scope.user.userType=='Intern - Business Development'){
                $scope.showLevel = 1; 
                
            }
            
        }
        $scope.saveChanges = function(providerId){
            var saveProvider = {
                targetStudyProvider: providerId
            };
            targetStudyProviderService.saveProvider(saveProvider).success(function (data, status, headers) {
                $scope.cancel();
                
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        
        $scope.searchText = '';
        $scope.filterText = '';
        $scope.setFilter = function(text){
            if(text && text !=''){
                $scope.searchText = text;
                $scope.filterText = text;
            }else{
                $scope.filterText = $scope.searchText;
            }
            
            
        };
        $scope.clearFilter = function(){
            $scope.searchText = '';
            $scope.filterText = '';
        };
        
    }]); 
    
    exambazaar.controller("getTargetStudyCoachingController", 
    [ '$scope', 'targetStudyProviderService', 'targetStudyProvidersList','targetStudyCities', '$timeout','$state','$stateParams', '$cookies','$mdDialog','locationsList','$window', 'institutesSavedList', 'institutesFilledList', 'emailList', 'FileSaver', '$rootScope', function($scope, targetStudyProviderService,targetStudyProvidersList,targetStudyCities,$timeout,$state,$stateParams, $cookies,$mdDialog, locationsList,$window, institutesSavedList, institutesFilledList, emailList, FileSaver, $rootScope){
        $scope.city = $stateParams.city;
        $rootScope.pageTitle = $scope.city + ' City Exambazaar Database';
        $scope.providersList = targetStudyProvidersList.data;
        $scope.emailsList = emailList.data;
        var providersListIds = $scope.providersList.map(function(a) {return a._id;});
        var institutesSaved = institutesSavedList.data;
        var institutesFilled = institutesFilledList.data;
        //console.log(institutesFilled);
        
        
        $scope.filledCounter = 0;
        $scope.verifiedCounter = 0;
        $scope.doesnotexistCounter = 0;
        $scope.noresponseCounter = 0;
        $scope.noMapCounter = 0;
        $scope.noEmailCounter = 0;
        
        $scope.emailSentCount = 0;
        $scope.emailsList.forEach(function(thisEmail, index){
            var pIndex = providersListIds.indexOf(thisEmail.institute);
            if(pIndex != -1){
                $scope.providersList[pIndex].emailSent = true;
                $scope.emailSentCount += 1;
            }
        });
        
        $scope.showDisableConfirm = function(provider, ev) {
        
            var confirm = $mdDialog.confirm()
                .title('Would you like to diable ' + provider.name + '?')
                .textContent('Address: ' + provider.address + ', ' + provider.city + '!')
                .ariaLabel('Lucky day')
                .targetEvent(ev)
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                  $scope.disableProvider(provider);
                }, function() {
                  //nothing
                });
            
        };
        
        $scope.showSavedDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#savedDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        $scope.providersList.forEach(function(thisProvider, index){
            if(!thisProvider.email || thisProvider.email.length ==0){
                thisProvider.noEmail = true;
                //$scope.noEmailCounter += 1;
            }else{
                thisProvider.noEmail = false;
            }
            
            
            if(!thisProvider.latlng){
                $scope.noMapCounter += 1;
            }
            if(institutesSaved.indexOf(thisProvider._id) != -1){
                thisProvider.cisaved = true;
            }else{
                thisProvider.cisaved = false;
            }
            
            //console.log(thisProvider.groupName);
            //console.log(institutesFilled.indexOf(thisProvider.groupName));
            if(institutesFilled.indexOf(thisProvider.groupName) != -1){
                thisProvider.cifilled = true;
                //$scope.filledCounter += 1;
            }else{
                thisProvider.cifilled = false;
            }
        });
        
        $scope.providersList.forEach(function(thisProvider, index){
            if(thisProvider.cifilled){
                $scope.filledCounter += 1;
               /* $scope.providersList.forEach(function(otherProvider, otherIndex){
                    if(otherProvider.name == thisProvider.name){
                        otherProvider.cifilled = true;
                        $scope.filledCounter += 1;
                    }
                });*/
            }
            if(!thisProvider.noEmail){
                $scope.providersList.forEach(function(otherProvider, otherIndex){
                    if(otherProvider.name == thisProvider.name){
                        otherProvider.noEmail = false;
                        //$scope.noEmailCounter -= 1;
                    }
                });
            }
            if(thisProvider.ebVerifyState && thisProvider.ebVerifyState !='' ){
                $scope.verifiedCounter += 1;
                if(thisProvider.ebVerifyState == 'Does not Exist'){
                    $scope.doesnotexistCounter += 1;
                }
                if(thisProvider.ebVerifyState == 'No Response'){
                    $scope.noresponseCounter += 1;
                }
            }
        });
        
        $scope.providersList.forEach(function(thisProvider, index){
            if(thisProvider.noEmail){
                $scope.noEmailCounter += 1;
            }
        });
        
        $scope.cityStates = targetStudyCities.data.map(function(a) {return a._id;});
        
        var repStates = $scope.cityStates.map(function(a) {return a.state;});
        $scope.states = [];
        repStates.forEach(function(thisState, index){
            if($scope.states.indexOf(thisState) == -1){
                $scope.states.push(thisState);
            }
        });
        
        
        
        
        
        if($cookies.getObject('location')){
            $scope.location = $cookies.getObject('location');
        }
        
        $scope.showLevel = 0;
        var permittedCities = [
            "Jaipur",
            "Kota",
            "Barmer",
            "Silvassa",
            "Chittorgarh",
            "Bahraich",
            "Chennai",
            "Coimbatore",
            "Salem",
            "Tirunelveli",
            "Tiruppur",
            "Tiruchirappalli",
            "Vellore",
            "Hosur",
            "Madurai",
            "Erode",
            "Tuticorin",
            "Dindigul",
            "Thanjavur",
            "Nagarcoil",
            "Kanchipuram",
            "Tiruvavur",
            "Virudhunagar",
            "Karur",
            "Paramakudi",
            "Cuddalore",
            "Villupuram",
            "Kancheepuram",
            "Karaikudi",
            "Tiruvanmalai",
            "Chittoor",
            "Tezpur",
            "Bhagalpur",
            "Gaya",
            "Bettiah",
            "Raipur",
            "Durg-bhilai",
            "Mehasana ",
            "Gurgaon",
            "Yamunanagar",
            "Faridabad",
            "Panipat",
            "Kangra",
            "Solan",
            "Deoghar",
            "Jamshedpur",
            "Dhanbad",
            "Mangalore",
            "Bellairy",
            "Bijapur",
            "Kozikode",
            "Kannur",
            "Kollam",
            "Ujjain",
            "Ratlam",
            "Mandsaur",
            "Jabalpur",
            "Bhind",
            "Guna",
            "Neemuch",
            "Nagpur",
            "Aurangabad",
            "Navi Mumbai",
            "Nashik",
            "Kozhikode", 
            "Ujjain",
            "Rourkela",
            "Bangalore",
            "Hyderabdad",
            "Mumbai",
            "Kolkata",
        ];
        
        if($cookies.getObject('sessionuser')){
            
            $scope.user = $cookies.getObject('sessionuser');
            if($scope.user.userType=='Master'){
                $scope.showLevel = 10;
            }
            if($scope.user.userType=='Intern - Business Development'){
                
                if(permittedCities.indexOf($scope.city) != -1){
                    $scope.showLevel = 1;
                }else{
                    $scope.showLevel = 0; 
                }
                
            }
            
        }
        
        $scope.disableProvider = function(provider){
            if(provider._id){
                var instituteIds = [provider._id];
                var disableForm = {
                    instituteIds: instituteIds,
                    user: $scope.user.userId
                };
                targetStudyProviderService.bulkDisableProviders(disableForm).success(function (data, status, headers) {
                    $scope.showSavedDialog();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            }
        };
        $scope.addEmail = function(provider){
            $window.open(provider.targetStudyWebsite, '_newhtml');
            //$window.open('https://targetstudy.com/tools/ge.php', '_newhtml2');
        };
        $scope.oneOff = function(){
            targetStudyProviderService.oneOff().success(function (data, status, headers) {
                $scope.showSavedDialog();
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.locations = locationsList.data;
        $scope.currProvider = {};
        $scope.showLocationDialog = function(ev,provider) {
            $scope.currProvider = provider;
            $mdDialog.show({
              contentElement: '#myDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.cancel = function() {
          $mdDialog.cancel();
        };
        $scope.saveLocation = function(thisLocation){
            
            $scope.currProvider.location = thisLocation._id;
            var saveProvider = {
                targetStudyProvider:$scope.currProvider
            };
            targetStudyProviderService.saveProvider(saveProvider).success(function (data, status, headers) {
                $scope.cancel();
                
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
            
        };
         
        
        
        
        $scope.uprank = function(provider){
            targetStudyProviderService.uprank(provider._id).success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.downrank = function(provider){
            targetStudyProviderService.downrank(provider._id).success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        
        $scope.searchText = '';
        $scope.filterText = '';
        $scope.setFilter = function(text){
            if(text && text !=''){
                $scope.searchText = text;
                $scope.filterText = text;
            }else{
                $scope.filterText = $scope.searchText;
            }
            
            
        };
        $scope.clearFilter = function(){
            $scope.searchText = '';
            $scope.filterText = '';
        };
        //var tempFilterText = '',
        //    filterTextTimeout;
        
        /*$scope.$watch('searchText', function (newValue, oldValue, scope) {
            if (filterTextTimeout) $timeout.cancel(filterTextTimeout);
            
            tempFilterText = newValue;
            filterTextTimeout = $timeout(function() {
                $scope.filterText = tempFilterText;
            }, 250); // delay 250 ms
        });*/
        
        
        
        
        
        $scope.removeDuplicates = function(){
            targetStudyProviderService.removeDuplicates($scope.city).success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.rank0 = function(){
            targetStudyProviderService.rank0().success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        
        $scope.getWebsites = function(){
            //alert('Starting');
            targetStudyProviderService.getWebsites().success(function (data, status, headers) {
                console.log("Done");
                var allWebsites = data;
                var separator = "\n";
                var websiteText = "";
                allWebsites.forEach(function(thisWebsites, index){
                    if(thisWebsites != ''){
                        console.log(thisWebsites);
                        websiteText += thisWebsites + separator;
                    }
                    
                    
                });
                
                var data = new Blob([websiteText], { type: "application/xhtml+xml;ISO-8859-1" });
                    FileSaver.saveAs(data, 'allwebsites.txt');
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
        };
        
        $scope.cityStateService = function(){
            //alert('Starting');
            targetStudyProviderService.citySummaryService().success(function (data, status, headers) {
                
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        /*$scope.cacsService = function(){
             targetStudyProviderService.cacsService().success(function (data, status, headers) {
                
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };*/
        
        $scope.citySummary = null;
        $scope.citySummaryService = function(){
            //alert('Starting');
            targetStudyProviderService.citySummaryService().success(function (data, status, headers) {
                $scope.citySummary = data;
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.cityStateService2 = function(){
            //alert('Starting');
            targetStudyProviderService.cityStateService2().success(function (data, status, headers) {
                console.log(data);
                //$scope.allCities = data;
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.getCityCount = function(){
            targetStudyProviderService.getCityCount().success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        
        $scope.logoService = function(){
            targetStudyProviderService.logoService().success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.databaseService = function(){
            targetStudyProviderService.databaseService().success(function (data, status, headers) {
                $scope.distinctStates = data;
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.UniqueLogoService = function(){
            
            $scope.showlogos = true;
            targetStudyProviderService.UniqueLogoService().success(function (data, status, headers) {
                $scope.uniquelogos = data;
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        
        $scope.allDistinct = function(){
            $scope.allDistinctBool = false;
            targetStudyProviderService.allDistinct().success(function (data, status, headers) {
                alert('Done');
                //$scope.allProviderNames = data;
                //$scope.allDistinctBool = true;
                //console.log(JSON.stringify(data));
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.allCourses = false;
        $scope.getAllCourses = function(){
            targetStudyProviderService.getAllCourses().success(function (data, status, headers) {
                console.log("Done");
                $scope.allCourses = true;
                $scope.courses = data;
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        
        $scope.cleanTargetstudyurls = function(){
            targetStudyProviderService.cleanTargetstudyurls().success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
    }]); 
    
    exambazaar.filter('bytes', function() {
        return function(bytes, precision) {
            if (isNaN(parseFloat(bytes)) || !isFinite(bytes)) return '-';
            if (typeof precision === 'undefined') precision = 1;
            var units = ['bytes', 'kB', 'MB', 'GB', 'TB', 'PB'],
                number = Math.floor(Math.log(bytes) / Math.log(1024));
            return (bytes / Math.pow(1024, Math.floor(number))).toFixed(precision) +  ' ' + units[number];
        }
    });
    exambazaar.controller("editTargetStudyCoachingController", 
    [ '$scope', 'targetStudyProviderService','LocationService','thisTargetStudyProvider','$state','$stateParams', '$cookies','ImageService','Upload','imageMediaTagList', function($scope, targetStudyProviderService,LocationService,thisTargetStudyProvider,$state,$stateParams, $cookies,ImageService,Upload,imageMediaTagList){
        $scope.provider = thisTargetStudyProvider.data;
        $scope.imageTags = imageMediaTagList.data.mediaTypeTags;
        $scope.imageTypes = imageMediaTagList.data.distinctTypes;
        
        
        $scope.locations = [];
        $scope.showButton = true;
        $scope.getLocations = function(){
            var city =  $scope.provider.city;
            LocationService.getCityLocations(city).success(function (data, status, headers) {
                $scope.showButton = false;
                $scope.locations = data;
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.suggestedLeft = [
            'contact',
            'info',
            'support',
            'admin',
        ];
        
        $scope.suggestedEmails = [];
        if($scope.provider){
            $scope.suggestedLeft.push($scope.provider.city.toLowerCase());
            $scope.suggestedLeft.push($scope.provider.state.toLowerCase());
            
            
            var url = $scope.provider.website[0] || [];
            if(url && url.length > 0){
            url = url.replace('www.','');
            url = url.replace('http://','');
            url = url.replace('https://','');
            var rightChar = url.substring(url.length-1, url.length);
            }
            
            
            var pivot1 = url.indexOf('/');
            if(pivot1 != -1)
                url = url.substring(0, pivot1);
            $scope.suggestedLeft.forEach(function(thisLeft, index){
                var newEmail = thisLeft + '@' + url;
                $scope.suggestedEmails.push(newEmail);
            });
            var pName = $scope.provider.name;
            pName = pName.replace(/ /g,'').toLowerCase();

            $scope.suggestedEmails.push(pName + '@gmail.com');
            $scope.suggestedEmails.push(pName + '@yahoo.com');
        }
        
        $scope.uploadPhotos = function () {
            var photos = $scope.photos;
            var nFiles = photos.length;
            $scope.showAddPhotosForm = false;
            var providerId = $scope.provider._id;
            var counter = 0;
            if (photos && photos.length) {
            photos.forEach(function(thisFile, index){
                
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            };
            //console.log(JSON.stringify(fileInfo));
            ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                thisFile.link = $(resp.data).find('Location').text();
                thisFile.newPhoto = {
                    image: thisFile.link
                };
                var newPhotoForm ={
                    photo: thisFile.newPhoto,
                    providerId: providerId
                }; targetStudyProviderService.addPhoto(newPhotoForm).success(function (data, status, headers) {
                    counter = counter + 1;
                    if(counter == nFiles){
                        $scope.showAddPhotosForm = true;
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                    //console.log('progress: ' + thisFile.uploadProgress + '% ' + thisFile.name);
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
         };
        
        
        $scope.uploadFaculties = function () {
            var faculties = $scope.faculties;
            var nFiles = faculties.length;
            $scope.showAddFacultiesForm = false;
            var providerId = $scope.provider._id;
            var counter = 0;
            if (faculties && faculties.length) {
            faculties.forEach(function(thisFile, index){
                
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            };
            console.log(JSON.stringify(fileInfo));
            ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                thisFile.link = $(resp.data).find('Location').text();
                thisFile.newFaculty = {
                    name: '',
                    image: thisFile.link,
                    subject: '',
                    yearsExperience: '',
                    qualification: '',
                    description: ''
                };
                var newFacultyForm ={
                    faculty: thisFile.newFaculty,
                    providerId: providerId
                }; targetStudyProviderService.addFaculty(newFacultyForm).success(function (data, status, headers) {
                    counter = counter + 1;
                    //console.log('Counter is: ' + counter);
                    //console.log("Faculty added to database " + thisFile.newFaculty.image);
                    if(counter == nFiles){
                        $scope.showAddFacultiesForm = true;
                        $scope.preUploadFacultyLength = $scope.provider.faculty.length;
                        var refreshedProvider = targetStudyProviderService.getProvider(providerId).success(function (refreshedProvider, status, headers) {
                            $scope.provider = refreshedProvider;
                            $scope.editPhotos();
                        }).error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                        
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                    //console.log('progress: ' + thisFile.uploadProgress + '% ' + thisFile.name);
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
         };
        $scope.setEmail = function(suggestedEmail){
            if($scope.provider.email){
                $scope.provider.email += ', ' +suggestedEmail;
            }else{
                $scope.provider.email = suggestedEmail;
            }
            
        };
        
        $scope.setLocation = function(location){
            $scope.provider.location = location._id;
        };
        $scope.uprank = function(provider){
            targetStudyProviderService.uprank(provider._id).success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        
        $scope.data = '';
        $scope.add = function(){
            var f = document.getElementById('file').faculties[0],
            r = new FileReader();
            r.onloadend = function(e){
                $scope.Imagedata = e.target.result;
                
                //$scope.Imagedata = 'data:image/png;base64,'+$scope.Imagedata;
                $scope.newImage = {
                    data: $scope.Imagedata,
                    contentType: 'image/png'
                };
                console.log(JSON.stringify($scope.newImage));
                ImageService.saveImage($scope.newImage).success(function (data, status, headers) {
                   console.log('Done'); 
                })
                .error(function (data, status, header, config) {
                    console.log(data);
                });
                
            }
            r.readAsBinaryString(f);
        };
        
        $scope.downrank = function(provider){
            targetStudyProviderService.downrank(provider._id).success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.saveCoaching = function(){
            
           var provider = {
               targetStudyProvider: $scope.provider
           }; targetStudyProviderService.saveProvider(provider).success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        
    }]); 
            
        
    exambazaar.controller("mastergetCoachingController", 
    [ '$scope', 'ProviderService','providersList','$timeout','$state','$stateParams', function($scope, ProviderService,providersList,$timeout,$state,$stateParams){
        //$scope.master = thismaster.data;
        $scope.cities = ['Agra','Ahmedabad','Akola','Aligarh','Allahabad','Amravati','Amritsar','Aurangabad','Bareilly','Belgaum','Bengaluru','Bhavnagar','Bhilai','Bhopal','Bhubaneswar','Bikaner','Bokaro','Chandigarh','Chennai','Cochin','Coimbatore','Cuttack','Dehradun','Delhi','Dhanbad','Durgapur','Gorakhpur','Guwahati','Gwalior','Hyderabad','Indore','Jaipur','Jalandhar','Jalgaon','Jammu','Jamnagar','Jamshedpur','Jhansi','Kanpur','Kolhapur','Kolkata','Kota','Kozhikode','Lucknow','Ludhiana','Madurai','Meerut','Moradabad','Mumbai','Mysore','Nagpur','Nanded','Nashik','Nellore','Patiala','Patna','Pune','Raipur','Rajkot','Ranchi','Salem','Solapur','Surat','Tirupur','Trichy','Trivandrum','Udaipur','Ujjain','Vadodara','Varanasi','Vijayawada','Visakhapatnam'];
        $scope.city = $stateParams.city;
        $scope.providersList = providersList.data;
        $scope.urls = [];
        $scope.filterText = '';
        $scope.setFilter = function(text){
            $scope.searchText = text;
        };
        $scope.clearFilter = function(text){
            $scope.searchText = '';
        };
        var tempFilterText = '',
            filterTextTimeout;
        $scope.$watch('searchText', function (val) {
            if (filterTextTimeout) $timeout.cancel(filterTextTimeout);

            tempFilterText = val;
            filterTextTimeout = $timeout(function() {
                $scope.filterText = tempFilterText;
            }, 250); // delay 250 ms
        });
        
        $scope.removeDuplicates = function(){
            ProviderService.removeDuplicates($scope.city).success(function (data, status, headers) {
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        
        
        
        
    }]); 
        
    
    
    exambazaar.controller("addSendGridController", 
        [ '$scope',  'sendGridCredentialList','SendGridService','$http','$state', function($scope, sendGridCredentialList, SendGridService,$http,$state){
        $scope.sendGridCredentials = sendGridCredentialList.data;
        
        $scope.sendGridCredential = {
            apiKey:'',
            active: true
        };
        $scope.removeEmailTemplate = function(template){
           /* 
            $scope.sendGridCredential.emailTemplate.forEach(function(thisTemplate, templateIndex){
                if(thisTemplate.name == template.name && ){
                    
                }
                
            });*/
        };
        $scope.addEmailTemplate = function(){
            var newTemplate = {
                name: '',
                templateKey:''
            };
            $scope.sendGridCredential.emailTemplate.push(newTemplate);
        };
        $scope.addSendGridCredential = function () {
            var saveSendGridCredential = SendGridService.saveSendGridCredential($scope.sendGridCredential).success(function (data, status, headers) {
               
                alert("SendGrid Credential saved: " + $scope.sendGridCredential.apiKey);
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
            
        
        $scope.setSendGridCredential = function(sendGridCredential){
            $scope.sendGridCredential = sendGridCredential;
        };
    }]);
        
    exambazaar.controller("autocompleteController2", 
        [ '$scope', '$http','$state','$rootScope', 'targetStudyProviderService', function($scope, $http, $state, $rootScope, targetStudyProviderService){
        
        this.selectedItemChange = selectedItemChange;
        function selectedItemChange(item) {
            console.log('Item changed to ' + JSON.stringify(item));
            //$state.go('claim', {coachingId: item._id});
            $rootScope.reviewInstitute = item;
        };
        this.querySearch = function(query){
            if(query.length > 2){
                var cityQueryForm = {
                    query: query,
                    city: $rootScope.city
                };
                
                return targetStudyProviderService.searchCityProviders(cityQueryForm).then(function(response){
                    //console.log(response.data);
                    return response.data;
                });
            }
            
        };
            //$rootScope.pageTitle ='Sandbox';
    }]);
         
      
        
    exambazaar.controller("offerController", 
        [ '$scope', '$http','$state','$rootScope', 'targetStudyProviderService', '$mdDialog', '$document', 'offerService', function($scope, $http, $state, $rootScope, targetStudyProviderService, $mdDialog, $document, offerService){
            $scope.offers = [];
            offerService.getActiveOffersBasic().success(function (data, status, headers) {
                $scope.offersList = data;
                //console.log($scope.offersList);
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
            
            $scope.$watch('offersList', function (newValue, oldValue, scope) {
                if(newValue != null && newValue != ''){
                    $scope.offers = newValue;
                    //console.log(newValue);
                }
            }, true);
            
        $scope.instituteHolder = "your Coaching Institute"; 
        $scope.goToReview = function(){
            var statesToShow = ["landing","main","category","city","findCoaching"];
            var sIndex = statesToShow.indexOf($state.current.name);
            
            if($state.current.name == 'showGroup'){
                $mdDialog.hide();
                var someElement = angular.element(document.getElementById('Reviews'));
                $document.scrollToElement(someElement, -200, 1000);
            }else if($state.current.name == 'review'){
                var someElement = angular.element(document.getElementById('Reviews'));
                $document.scrollToElement(someElement, 0, 1000);
            }else if(sIndex != -1){
                
                $state.go('review');
            }
            
            
        };
        
        $scope.showBottomOfferBar = function(){
            var showMe = false;
            var statesToShow = ["landing","main","category","city","findCoaching","why"];
            var sIndex = statesToShow.indexOf($state.current.name);
            
            if(sIndex != -1){
                showMe = true;
            }
            
            return showMe;
        };
        $rootScope.$on("ShowReviewDialog", function(){
            $scope.showUserReviewSearchDialog();
        });
        $rootScope.$on("ShowWhyReviewDialog", function(){
           $scope.showWhyReviewSearchDialog();
        });    
        $scope.showUserReviewSearchDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#userReviewSearchDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            }).finally(function() {
                //$scope.userReviewMode = true;
            });
        };
            
        $scope.showWhyReviewSearchDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#whyReviewDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            }).finally(function() {
                $scope.userReviewMode = true;
            });
        };
            
        $scope.showPartnerDialog = function(offer, ev) {
            $rootScope.partnerOffer = offer;
            
            
            $mdDialog.show({
              contentElement: '#partnerDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            }).finally(function() {
                
            });
        };
    }]);
        
    exambazaar.controller("offerController2", 
        [ '$scope', '$http','$state','$rootScope', 'targetStudyProviderService', '$mdDialog', '$document', 'offerService', function($scope, $http, $state, $rootScope, targetStudyProviderService, $mdDialog, $document, offerService){
            $scope.offers = [];
            offerService.getActiveOffersBasic().success(function (data, status, headers) {
                $scope.offersList = data;
                //console.log($scope.offersList);
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
            
            $scope.$watch('offersList', function (newValue, oldValue, scope) {
                if(newValue != null && newValue != ''){
                    $scope.offers = newValue;
                    //console.log(newValue);
                }
            }, true);
            
        $scope.instituteHolder = "your Coaching Institute"; 
        $scope.goToReview = function(){
            var statesToShow = ["landing","main","category","city","findCoaching"];
            var sIndex = statesToShow.indexOf($state.current.name);
            
            if($state.current.name == 'showGroup'){
                $mdDialog.hide();
                var someElement = angular.element(document.getElementById('Reviews'));
                $document.scrollToElement(someElement, -200, 1000);
            }else if($state.current.name == 'review'){
                var someElement = angular.element(document.getElementById('Reviews'));
                $document.scrollToElement(someElement, 0, 1000);
            }else if(sIndex != -1){
                
                $state.go('review');
            }
            
            
        };
        
        $scope.showBottomOfferBar = function(){
            var showMe = false;
            var statesToShow = ["landing","main","category","city","findCoaching","rankerswall","why"];
            var sIndex = statesToShow.indexOf($state.current.name);
            
            if(sIndex != -1){
                showMe = true;
            }
            
            return showMe;
        };
          
        $scope.showUserReviewSearchDialog = function(ev) {
            console.log('I am opened');
            $mdDialog.show({
              contentElement: '#userReviewSearchDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            }).finally(function() {
                //$scope.userReviewMode = true;
            });
        };
            
        $scope.showWhyReviewSearchDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#whyReviewDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            }).finally(function() {
                $scope.userReviewMode = true;
            });
        };
            
        $scope.showPartnerDialog = function(offer, ev) {
            $rootScope.partnerOffer = offer;
            
            
            $mdDialog.show({
              contentElement: '#partnerDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            }).finally(function() {
                
            });
        };
    }]);      
    exambazaar.controller("coachingGroupAutocompleteController", 
        [ '$scope', '$http','$state','$rootScope', 'targetStudyProviderService', function($scope, $http, $state, $rootScope, targetStudyProviderService){
            
        this.selectedItemChange = selectedItemChange;
        function selectedItemChange(item) {
            //console.log('Item changed to ' + JSON.stringify(item));
            $rootScope.coachingGroup = item;
            
            var items = $rootScope.coachingGroupItems;
            //console.log(items.length);
            var coachingGroupItems = [];
            items.forEach(function(thisItem, index){
                if(thisItem.groupName == item.groupName){
                    coachingGroupItems.push(thisItem);
                }else{
                    //console.log(thisItem);
                }
                
            });
            $rootScope.coachingGroupItems = coachingGroupItems;
            $rootScope.$emit("setSpreadSheetCoachings", {coachingGroupItems: coachingGroupItems});
            //console.log(coachingGroupItems.length);
        };
        this.querySearch = function(query){
            if(query.length > 2){
                $rootScope.coachingGroupItems = [];
                return targetStudyProviderService.searchCoachingGroupProviders(query).then(function(response){
                    //console.log(response.data);
                    
                    $rootScope.coachingGroupItems = response.data;
                    return response.data;
                });
            }
            
            /*return $http.get("https://api.github.com/search/users", {params: {q: query}})
            .then(function(response){
              return response.data.items;
            })*/
        };
            //$rootScope.pageTitle ='Sandbox';
    }]);    
    
    exambazaar.controller("blogCoachingGroupAutocompleteController", 
        [ '$scope', '$http','$state','$rootScope', 'targetStudyProviderService', function($scope, $http, $state, $rootScope, targetStudyProviderService){
            
        this.selectedItemChange = selectedItemChange;
        function selectedItemChange(item) {
            var groupName = item.name;
            $rootScope.$emit("setBlogCoachingGroup", {groupName: groupName});
            this.selectedItem = null;
            //console.log(groupName);
        };
        this.querySearch = function(query){
            if(query.length > 2){
                return targetStudyProviderService.searchBlogCoachingGroupProviders(query).then(function(response){
                    //console.log(response.data);
                    
                    $rootScope.coachingGroupItems = response.data;
                    return response.data;
                });
            }else{
                return null;
            }
            
        };
    }]);        
        
    exambazaar.controller("userAutocompleteController", 
        [ '$scope', '$http','$state','$rootScope', 'UserService', function($scope, $http, $state, $rootScope, UserService){
            
        this.selectedItemChange = selectedItemChange;
        function selectedItemChange(item) {
            //console.log('Item changed to ' + JSON.stringify(item));
            $rootScope.$emit("setBloggerUser", {user: item});
        };
        this.querySearch = function(query){
            if(query.length > 2){
                return UserService.searchUsers(query).then(function(response){
                    return response.data;
                });
            }
        };
    }]);    
        
    exambazaar.controller("autocompleteController", 
        [ '$scope', '$http','$state','$rootScope', 'targetStudyProviderService', function($scope, $http, $state, $rootScope, targetStudyProviderService){
            
            $scope.searchFocusIn = function(){
                console.log('Focus In');
                $rootScope.searchMode = true;
                $rootScope.searchPlaceholder = "Search Exambazaar for over 26,000 coaching classes for 50+ Exams in 90+ cities";
            };
            $scope.searchFocusOut = function(){
                console.log('Focus Out');
                $rootScope.searchMode = false;
                $rootScope.searchPlaceholder = "Search";
                $rootScope.showMobileSearch = !$rootScope.showMobileSearch;
            };
            $scope.goToCoaching = function(provider){
                var coachingForm = {
                    _id: provider._id 
            };
            targetStudyProviderService.showGroupHelperById(coachingForm).success(function (data, status, headers) {
                    var examStream = data;
                    $state.go('showGroup', {categoryName: examStream.stream, subCategoryName: examStream.exam, cityName: examStream.city, groupName: examStream.groupName});
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
        };    
            
        this.selectedItemChange = selectedItemChange;
        function selectedItemChange(item) {
            console.log('Item changed to ' + JSON.stringify(item));
            $scope.goToCoaching(item);
        };
        this.querySearch = function(query){
            if(query.length > 2){
                return targetStudyProviderService.searchProviders(query).then(function(response){
                    //console.log(response.data);
                    return response.data;
                });
            }
        };
    }]);
        
    exambazaar.controller("citySearchController", 
        [ '$scope', '$http','$state','$rootScope', 'targetStudyProviderService', '$cookies', function($scope, $http, $state, $rootScope, targetStudyProviderService, $cookies){
        
        
        if($cookies.getObject('userlocation')){
            $scope.userlocation = $cookies.getObject('userlocation');
        }
        if($cookies.getObject('ip')){
            $scope.userip = $cookies.getObject('ip');
        }
        
            
        $scope.reviewCity = "";
        this.selectedItemChange = selectedItemChange;
        function selectedItemChange(item) {
            $rootScope.newReviewCity = item;
            console.log($rootScope.newReviewCity);
            $rootScope.newReviewError = null;
        };
        this.querySearch = function(query){
            var searchQuery = query;
            if(query == ''){
                searchQuery = "exambazaar";
            }
            return targetStudyProviderService.providercities(searchQuery).then(function(response){
                
                //console.log(response.data);
                return response.data;
            });
        };
    }]);
    
    exambazaar.controller("coachingSearchController", 
        [ '$scope', '$http','$state','$rootScope', 'targetStudyProviderService', function($scope, $http, $state, $rootScope, targetStudyProviderService){
        
        
        this.selectedItemChange = selectedItemChange;
        function selectedItemChange(item) {
            console.log('Item changed to ' + JSON.stringify(item));
            $rootScope.newReviewCoaching = item;
        };
        this.querySearch = function(query){
            if(!$rootScope.newReviewCity){
                $rootScope.newReviewError = true;
            }else{
                $rootScope.newReviewError = null;
                if(query ==''){query = "exambazaar";}
                var cityQueryForm = {
                    query: query,
                    city: $rootScope.newReviewCity
                };
                //console.log($rootScope.newReviewCity);

                return targetStudyProviderService.searchCityReviewProviders(cityQueryForm).then(function(response){
                    //console.log(response.data);
                    return response.data;
                });
            }

        };
        
    }]);  
        
    exambazaar.controller("reviewRedirectController", 
        [ '$scope', '$http','$state','$rootScope', 'targetStudyProviderService', 'offerService', '$mdDialog', '$document', function($scope, $http, $state, $rootScope, targetStudyProviderService, offerService, $mdDialog, $document){
            $scope.redirectToReview = function(){
                if($rootScope.newReviewCity && $rootScope.newReviewCoaching){
                    //ABC
                    var cityCoachingForm = {
                        city: $rootScope.newReviewCity,
                        coachingName: $rootScope.newReviewCoaching.name,
                    };
                    console.log(cityCoachingForm);
                    targetStudyProviderService.showGroupHelper(cityCoachingForm).success(function (data, status, headers) {
                        var examStream = data;
                        console.log(examStream);
                        
                        $state.go('showGroup', {categoryName: examStream.stream, subCategoryName: examStream.exam, cityName: $rootScope.newReviewCity, groupName: $rootScope.newReviewCoaching.name,'#': 'Reviews'});
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                    
                    
                }
            };
            
            $scope.offers = [];
            offerService.getActiveOffersBasic().success(function (data, status, headers) {
                $scope.offersList = data;
                //console.log($scope.offersList);
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
            
            $scope.$watch('offersList', function (newValue, oldValue, scope) {
                if(newValue != null && newValue != ''){
                    $scope.offers = newValue;
                    //console.log(newValue);
                }
            }, true);
            
    }]);      
        
    exambazaar.controller("resultAutocompleteController", 
        [ '$scope', '$http','$state', 'targetStudyProviderService', function($scope, $http, $state, targetStudyProviderService){
            
        this.selectedItemChange = selectedItemChange;
        function selectedItemChange(item) {
            console.log('Item changed to ' + JSON.stringify(item));
            $state.go('claim', {coachingId: item._id});
            
        };
        this.querySearch = function(query){
            if(query.length > 2){
                return targetStudyProviderService.searchProviders(query).then(function(response){
                    //console.log(response.data);
                    return response.data;
                });
            }
        };
    }]);
        
    exambazaar.controller("sandbox2Controller", 
        [ '$scope', '$http','$state','$rootScope','NgMap','targetStudyProviderService','targetStudyProvidersList', '$stateParams', 'targetStudyCities', 'cityProviderCount', function($scope, $http, $state, $rootScope,NgMap, targetStudyProviderService, targetStudyProvidersList, $stateParams, targetStudyCities, cityProviderCount){
            $scope.providers = targetStudyProvidersList.data;
            //$scope.filterText = 'Career Launcher';
            $scope.city = $stateParams.cityName;
            $scope.cityProviderCount = cityProviderCount.data;
            $scope.masterId = $stateParams.masterId;
            $scope.cityStates = targetStudyCities.data.map(function(a) {return a._id;});
            var repStates = $scope.cityStates.map(function(a) {return a.state;});
            $scope.states = [];
            repStates.forEach(function(thisState, index){
                if($scope.states.indexOf(thisState) == -1){
                    $scope.states.push(thisState);
                }
            });
            $scope.providers.forEach(function(thisProvider, index){
                thisProvider.mapLatLng = [thisProvider.latlng.lat, thisProvider.latlng.lng]
            });
            $scope.showProvider = function(event, provider){
                $scope.activeProvider = provider;
                if(!provider.logo || provider.logo == ''){
                    $scope.activeProvider.logo = '';
                }
                
            };
            //$rootScope.pageTitle ='Sandbox 2';
    }]);
    
        
    exambazaar.controller("thankyouController", 
        [ '$scope', '$http','$state', '$rootScope', '$location', 'Socialshare', '$mdDialog', '$timeout', function($scope, $http, $state, $rootScope, $location, Socialshare, $mdDialog, $timeout){
            //var redirectUrl = "https://www.exambazaar.com/" + "/user/" + $scope.user._id + "/thankyou";
            var redirectUrl = "https://www.exambazaar.com";
            $scope.shareFacebook = function(){
                Socialshare.share({
                  'provider': 'facebook',
                  'attrs': {
                    'socialshareType': 'share',
                    'socialshareUrl': 'https://www.exambazaar.com',
                    'socialshareVia':"1236747093103286",  'socialshareRedirectUri': redirectUrl,
                  }
                });    
            };
            
            $scope.shareText = "Receive amazing discounts at Exambazaar by reviewing your coaching institute! Go ahead, review your coaching and get discount at ";
            
            $rootScope.pageTitle = 'Thank you for reviewing your coaching institute!';
            $rootScope.pageURL = 'https://www.exambazaar.com';
            $rootScope.pageImage = 'https://www.exambazaar.com/images/logo/cover.png';
    }]);
    
    
    exambazaar.controller("availOfferController", 
        [ '$scope', '$http','$state', '$rootScope','thisuser','targetStudyProviderService', 'UserService', 'couponService', '$location', 'thisReview', 'activeOfferInstitutes', 'activeCoupons', 'Socialshare', '$mdDialog', '$timeout', '$window', function($scope, $http, $state, $rootScope, thisuser, targetStudyProviderService, UserService, couponService, $location, thisReview, activeOfferInstitutes, activeCoupons, Socialshare, $mdDialog, $timeout, $window){
            $window.scrollTo(0, 0);
            $scope.user = thisuser.data;
            $scope.activeOfferInstitutes = activeOfferInstitutes.data;
            $scope.activeCoupons = activeCoupons.data;
            $scope.thisReview = thisReview.data;
            $scope.states = ["Browse","Refer","Coupon",];
            $scope.currState = "Browse";
            
            var deliveredCouponId = null;
            if($scope.thisReview.coupon){
                $scope.currState='Coupon';
                deliveredCouponId = $scope.thisReview.coupon;
            }
            
            $scope.$watch('currState', function (newValue, oldValue, scope) {
                if(deliveredCouponId){
                    couponService.getCoupon(deliveredCouponId).success(function (data, status, headers) {
                        $scope.deliveredCoupon = data;
                        console.log($scope.deliveredCoupon);
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                    
                }

            }, true);
            
            
            
            
            $scope.chooseCoupon = function(activeCoupon, activeOfferInstitute){
                $scope.selectedCoupon = activeCoupon;
                $scope.selectedOfferInstitute = activeOfferInstitute;
                $scope.currState = "Refer";
            };
            $scope.getBreadCrumbClass = function(state){
                var className = "";
                if(state == $scope.currState){
                    className = "active";
                }
                return className;
            };
            $scope.navigate = function(clickstate){
                var clickIndex = $scope.states.indexOf(clickstate);
                var currIndex = $scope.states.indexOf($scope.currState);
                
                if(clickIndex < currIndex && $scope.currState != 'Coupon'){
                    $scope.currState = clickstate;
                }
            };
            
            $scope.shareOnFacebook = true;
            $scope.shareText = "I have received an amazing discount at Exambazaar.com by reviewing " +  $scope.thisReview.institute.name + "! Go ahead, review your coaching and get your discount at www.exambazaar.com/review/";
            var redirectUrl = "https://www.exambazaar.com/thankyou";
           
            
            
            

            $scope.fail = function (err) {
                console.error('Error!', err);
            };
            
            var messageText = function(){
                var totalDiscount = '';
                if($scope.selectedCoupon.discountType == 'Percentage Discount'){
                    totalDiscount = $scope.selectedCoupon.percentageDiscount + "%";
                }
                if($scope.selectedCoupon.discountType == 'Flat Discount'){
                    totalDiscount = $scope.selectedCoupon.flatDiscount +"Rs.";
                }
                
                var smsMessage = $scope.user.basic.name + " received " + totalDiscount + " on prep material via www.exambazaar.com. Review your coaching institute and lock-in your 50% off now!";
                
                return smsMessage;
            };
            
            $scope.showCopiedDialog = function(text, ev) {
                $scope.copiedText = text;
                $mdDialog.show({
                  contentElement: '#copiedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },500)
            };
            $scope.refermobiles = [];
            var i =1;
            for (i=1;i<=5;i++) {
                
                var newMobile = {
                    mobile: '',
                    exists: null,
                    placeholder: "10 Digit Mobile " + i,
                };
                $scope.refermobiles.push(newMobile);
            };
            
            $scope.$watch('refermobiles', function (newValue, oldValue, scope) {
                newValue.forEach(function(thisMobile, mindex){
                    if(thisMobile.mobile && thisMobile.mobile != oldValue[mindex].mobile){
                         UserService.referexists(thisMobile.mobile).success(function (data, status, headers) {
                            thisMobile.exists = data;
                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                    }   
                });
            }, true);
            
            $scope.shareFacebook = function(){
                Socialshare.share({
                  'provider': 'facebook',
                  'attrs': {
                    'socialshareType': 'send',
                    'socialshareUrl': 'https://www.exambazaar.com',
                    'socialshareVia':"1236747093103286",  'socialshareRedirectUri': redirectUrl,
                  }
                });
                
                $scope.userSocial = true;
            };
            
            $scope.postFacebook = function(){
                Socialshare.share({
                  'provider': 'facebook',
                  'attrs': {
                    'socialshareType': 'feed',
                    'socialshareUrl': 'https://www.exambazaar.com',
                    'socialshareVia':"1236747093103286",  'socialshareRedirectUri': 'https://www.exambazaar.com',
                  }
                });    
            };
            $scope.inviteMobiles = function(){
                var invalid = false;
                $scope.referMobilesError = null;
               
                var sendmobiles = $scope.refermobiles.map(function(a) {return a.mobile;});
                
                $scope.refermobiles.forEach(function(thisMobile, mindex){
                    if(thisMobile.mobile){
                        thisMobile.mobile = thisMobile.mobile.toString();
                    }
                    if(thisMobile.mobile.length != 10 || thisMobile.exists){
                        console.log(thisMobile.mobile.length + thisMobile.mobile);
                        invalid = true;
                    }
                });
                
                if(invalid){
                    $scope.referMobilesError = "Please enter 5 valid mobile numbers";
                }else{
                    var smsMessage = messageText();
                    console.log(smsMessage.length);
                    console.log(smsMessage);
                    
                    
                    
                    var referralForm = {
                        user: $scope.user._id,
                        message: smsMessage,
                        mobiles: $scope.refermobiles,
                        
                    };
                    console.log(referralForm);
                    UserService.sendReferrals(referralForm).success(function (data, status, headers) {
                        console.log('Delivered');
                        $scope.userSocial = true;
                    }).error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    
                }
            };
            
            $scope.showSkipDialog = function(ev) {
                var totalDiscount = '';
                if($scope.selectedCoupon.discountType == 'Percentage Discount'){
                    totalDiscount = $scope.selectedCoupon.percentageSocialShareBenefit + "% !";
                }
                if($scope.selectedCoupon.discountType == 'Flat Discount'){
                    totalDiscount = $scope.selectedCoupon.flatSocialShareBenefit +" Rs !";
                }
                var confirm = $mdDialog.confirm()
                .title('Would you like to skip referring your friends to Exambazaar?')
                .textContent('You will not receive the additional Exambazaar discount of ' + totalDiscount)
                .ariaLabel('Lucky day')
                .targetEvent(ev)
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.issueCoupon(false);
                }, function() {
                  //nothing
                });
                    
            };
            
            $scope.$watch('userSocial', function (newValue, oldValue, scope) {
                if(newValue){
                    $scope.issueCoupon(true);
                }
            }, true);
            
            $scope.issueCoupon = function(social){
                
                var couponForm = {
                    name: $scope.selectedCoupon.name,
                    offer: $scope.selectedCoupon.offer,
                };
                couponService.getOneActiveCouponCode(couponForm).success(function (data, status, headers) {
                    if(data){
                        $scope.selectedCoupon = data;
                        $scope.selectedCoupon.user = $scope.user._id;
                        
                        $scope.selectedCoupon.delivered = {
                            social: social,
                            state: 'Delivered',
                        };
                        if(social){
                            $scope.selectedCoupon.delivered.usercode = $scope.selectedCoupon.socialShareCode;
                        }else{
                            $scope.selectedCoupon.delivered.usercode = $scope.selectedCoupon.code;
                            
                        }
                        var timeNow = moment();
                        $scope.selectedCoupon.delivered._deliverDate = timeNow;
                        if($scope.selectedCoupon.validityType == 'From date of issue by Exambazaar'){
                            var nDays = $scope.selectedCoupon.validtyDuration;
                            var ebExpiry = timeNow.add(nDays, "days");
                            $scope.selectedCoupon.delivered._expiryDate = ebExpiry;
                        }
                        
                        if($scope.selectedCoupon.validityType == 'Fixed Expiry Date'){
                            var fixedExpiryDate = $scope.selectedCoupon.fixedExpiryDate;
                            $scope.selectedCoupon.delivered._expiryDate = fixedExpiryDate;
                        }
                        
                        var deliverForm = {
                            selectedCoupon: $scope.selectedCoupon,
                            review: $scope.thisReview._id,
                        };
                        
                        couponService.deliver(deliverForm).success(function (data, status, headers) {
                        console.log(data);
                        if(data){
                            $scope.selectedCoupon = data;
                            deliveredCouponId = $scope.selectedCoupon._id;
                            $scope.currState = "Coupon";
                            console.log($scope.selectedCoupon);
                            var voucherForm = {
                                user: $scope.user._id,    
                                coupon: $scope.selectedCoupon._id,    
                            };
                            UserService.deliverVoucher(voucherForm).success(function (data, status, headers) {
                                console.log('Delivered');
                                
                            }).error(function (data, status, header, config) {
                                console.log("Error ");
                            });
                            
                        }else{
                            console.log('Something went wrong');
                        }
                            
                            
                        
                        }).error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                        
                        
                        
                    }else{
                        console.log('Error: No more active coupon for this offer! Sorry');
                    }
                }).error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            
            $scope.deliverCoupon = function(){
                var voucherForm = {
                    user: $scope.user._id,    
                    coupon: $scope.deliveredCoupon._id,    
                };
                UserService.deliverVoucher(voucherForm).success(function (data, status, headers) {
                    console.log('Delivered');

                }).error(function (data, status, header, config) {
                    console.log("Error ");
                });    
            };
            
            /*var currURL = $location.absUrl();
            $rootScope.pageURL = currURL;*/
            $rootScope.pageTitle = 'Review your coaching institute to get rewarded!';
            $rootScope.pageImage = 'https://www.exambazaar.com/images/logo/cover.png';
    }]);
    
    
    
        
    exambazaar.controller("addedInstitutesController", 
        [ '$scope', '$http','$state','$rootScope','thisuser','targetStudyProviderService', 'addedInstitutes', 'ebteam', '$mdDialog', '$timeout', 'tofillciService', function($scope, $http, $state, $rootScope, thisuser, targetStudyProviderService, addedInstitutes, ebteam, $mdDialog, $timeout, tofillciService){
            $scope.user = thisuser.data;
            $rootScope.pageTitle ='Report - Added Institutes';
            
            var ebteam = ebteam.data;
            var ebteamIds = ebteam.map(function(a) {return a._id;});
            
            var listedUsers = [];
            
            if($scope.user && ($scope.user.userType == 'Master' || $scope.user.userType == 'Intern - Business Development')){
                $scope.authorized = true;
            }
            $scope.masterUser = null;
            if($scope.user.userType == 'Master'){
                $scope.masterUser = true;
            }
            $scope.allAddedInstitutes = addedInstitutes.data;
            
            $scope.$watch('allAddedInstitutes', function (newValue, oldValue, scope) {
                if(newValue != null && newValue.length > 0){
                    var instituteIds = newValue.map(function(a) {return a._id;});
                    //console.log(instituteIds);
                    tofillciService.findAssigned(instituteIds).success(function (data, status, headers) {
                        var response = data;
                        if(response && response.length > 0){
                            response.forEach(function(thisInstitute, index){
                                var iIndex = instituteIds.indexOf(thisInstitute);
                                if(iIndex != -1){
                                    $scope.allAddedInstitutes[iIndex].cifilled = true;
                                }
                            });
                        }
                        
                        $scope.addedInstitutes = $scope.allAddedInstitutes;
                        
                        
                        $scope.addedInstitutes.forEach(function(thisInstitute, index){
                            
                            var addedByUser = thisInstitute._createdBy;
                            if(listedUsers.indexOf(addedByUser) == -1){
                                listedUsers.push(addedByUser);
                            }
                            var uIndex = ebteamIds.indexOf(addedByUser);
                            if(uIndex != -1){
                                thisInstitute._createdBy = ebteam[uIndex];
                            }
                            
                        });
                        $scope.listedUsers = [];
                        listedUsers.forEach(function(thisUser, index){
                            var uIndex = ebteamIds.indexOf(thisUser);
                            $scope.listedUsers.push(ebteam[uIndex]);

                        });
                        
                        //Summary code starts here
                        var reportSummary = [];
                        var reportSummaryIds = []; 
                         $scope.addedInstitutes.forEach(function(thisInstitute, index){
                             var user = thisInstitute._createdBy;
                             var userName = null;
                             if(user.basic.name){
                                 userName = user.basic.name;
                             }
                            var thisDateString = moment(thisInstitute._created).format("DD-MMM-YYYY");
                            
                            var thisIndex = -1;
                            for(var i = 0; i < reportSummary.length; i++) {
                                if (reportSummary[i].userName == userName && reportSummary[i].dateString == thisDateString) {
                                    thisIndex = i;
                                }
                            }
                            if(thisIndex != -1){
                                reportSummary[thisIndex].count += 1;
                            }else{
                                var newSummary = {
                                    
                                    userName: userName,
                                    dateString: thisDateString,
                                    count: 1,
                                };
                                reportSummary.push(newSummary);
                            }
                             
                        });
                        var uniqueDateStrings = [];
                        var uniqueUserNames = [];
                        var finalSummary = {};
                        
                         reportSummary.forEach(function(thisElement, index){
                            if(uniqueDateStrings.indexOf(thisElement.dateString) == -1){
                               
                                uniqueDateStrings.push(thisElement.dateString);
                            }
                        });
                        reportSummary.forEach(function(thisElement, index){
                            if(uniqueUserNames.indexOf(thisElement.userName) == -1){
                                uniqueUserNames.push(thisElement.userName);
                            }
                        });
                         uniqueDateStrings.forEach(function(thisElement, index){
                            uniqueUserNames.forEach(function(thisSubElement, sindex){
                                finalSummary[thisElement] = {};
                                finalSummary[thisElement][thisSubElement] = 0;
                                
                            });
                        });
                        reportSummary.forEach(function(thisElement, index){
                            finalSummary[thisElement.dateString][thisElement.userName] = thisElement.count;
                        });
                        var summaryStrings = [];
                        for (var property in finalSummary) {
                            var newString = "";
                            newString += "Date: " +property + " | ";
                            for (var property2 in finalSummary[property]) {
                                newString += property2 +": " + finalSummary[property][property2] + " | ";
                            }
                            summaryStrings.push(newString);
                        }
                        $scope.summaryStrings = summaryStrings;
                        //Summary code ends here
                        
                        
                        

                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });  
                }
                
            }, true);
            
            
            $scope.showSummaryDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#summaryDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            
            $scope.websiteExists = function(institute){
                var exists = false;
                if(institute.website.length > 0){
                    exists = true;
                }
                return exists;
            };
            
            $scope.updateAddedInstitutes = function(user){
                
                if(user && user._id){
                    var userId = user._id;
                    $scope.addedInstitutes = [];
                    $scope.allAddedInstitutes.forEach(function(thisInstitute, index){
                        var addedByUser = thisInstitute._createdBy;
                        if(addedByUser._id == userId){
                            $scope.addedInstitutes.push(thisInstitute);
                        }
                    });
                }else{
                    $scope.addedInstitutes = $scope.allAddedInstitutes;
                }
            };
            $scope.showSavedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#savedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            
            $scope.titleCaseName = function(provider, index){
                targetStudyProviderService.titleCaseName(provider._id).success(function (data, status, headers) {
                    if(data){
                        provider = data;
                        console.log(provider.name);
                        /*$scope.showSavedDialog();
                        var addedByUser = provider._createdBy;
                        
                        var uIndex = ebteamIds.indexOf(addedByUser);
                        provider._createdBy = ebteam[uIndex];
                        
                        $scope.updateAddedInstitutes(null);*/
                    }else{
                        console.log('Something went wrong');   
                    }
                })
                .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
                });  
            };
            
            $scope.removeProviderConfirm = function(provider){
                var confirm = $mdDialog.confirm()
                .title('Would you like to remove coaching named ' + provider.name + ', located at ' +  provider.address + ', ' + provider.city + '?')
                .textContent('You will not be able to revert it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.removeProvider(provider);
                }, function() {
                  //nothing
                    $scope.showExamDialog();
                });     
            };
            $scope.removeProvider = function(provider){
                 targetStudyProviderService.removeProvider(provider._id).success(function (data, status, headers) {
                    if(data){
                        $scope.showSavedDialog();
                    }else{
                        console.log('Something went wrong');   
                    }
                })
                .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
                });  
            };
    }]);
        
    exambazaar.controller("analyticsController", 
        [ '$scope', '$http', '$state', '$rootScope', '$cookies', 'blogpostService', 'targetStudyProviderService', function($scope, $http, $state, $rootScope, $cookies, blogpostService, targetStudyProviderService){
            var allblogsbasic = null;
            var allblogsbasicIds = null;
            $scope.analyticsOptions = ["Blog Analytics", "P5 Analytics"];
            $scope.activeAnalytics = "Blog Analytics";
            $scope.setOption = function(analyticsOption){
                $scope.activeAnalytics = analyticsOption;
                $scope.blogAnalytics = null;
                $scope.p5Analytics = null;
                
                setPage();
            };
            
            
            $scope.goToCoaching = function(provider){
                var coachingForm = {
                    _id: provider._id 
                };
                targetStudyProviderService.showGroupHelperById(coachingForm).success(function (data, status, headers) {
                        var examStream = data;
                        
                        var url = $state.href('showGroup', {categoryName: examStream.stream, subCategoryName: examStream.exam, cityName: examStream.city, groupName: examStream.groupName});
                        window.open(url,'_blank');
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
            };
            
            $scope.authorized = false;
            var setPage = function(){
                if($scope.activeAnalytics == 'Blog Analytics'){
                    loadBlogs();
                }
                if($scope.activeAnalytics == 'P5 Analytics'){
                    loadP5Views();
                }    
                $rootScope.pageTitle = $scope.activeAnalytics;
            };
            $scope.start = moment().subtract(1, 'days');
            $scope.end = moment();
            $scope.limits = ["0", "1", "7", "14", "30", "180", "365"];
            $scope.nDays = 1;
            $scope.lastNDays = function(days){
                $scope.blogAnalytics = null;
                $scope.p5Analytics = null;
                
                $scope.nDays = days;
                $scope.end = moment();
                $scope.start = moment().subtract(days, 'days');
                setPage();
            };
            $scope.setCustomDates = function(){
                $scope.blogAnalytics = null;
                $scope.p5Analytics = null;
                
                $scope.nDays = $scope.end.diff($scope.start, 'days');
                
                setPage();
            };
            $scope.buttonClass = function(limit){
                if($scope.nDays == limit){
                    return "md-danger";
                }else{
                    return "md-next";
                }
            };
            
            var loadBlogs = function(){
                var analyticsForm = {
                    start: $scope.start,
                    end: $scope.end,
                };
                blogpostService.blogAnalytics(analyticsForm).success(function (data, status, headers) {
                    blogpostService.allblogsbasic().success(function (blogdata, status, headers) {
                        $scope.blogAnalytics = data;
                    
                        allblogsbasic = blogdata;
                        allblogsbasicIds = allblogsbasic.map(function(a) {return ("/blogpost/" + a.urlslug);});
                        initiateBlogs();
                    })
                    .error(function (data, status, header, config) {
                        console.log();
                    });
                })
                .error(function (data, status, header, config) {
                    console.log();
                });    
            };
            var initiateBlogs = function(){
                $scope.totalViews = 0;
                $scope.blogAnalytics.forEach(function(thisBlog, bindex){
                    $scope.totalViews += thisBlog.views;
                    var bIndex = allblogsbasicIds.indexOf(thisBlog.blogurl);
                    
                    if(bIndex != -1){
                        thisBlog.show = true;
                        thisBlog.active = allblogsbasic[bIndex].active;
                        thisBlog.title = allblogsbasic[bIndex].title;
                        thisBlog.urlslug = allblogsbasic[bIndex].urlslug;
                        thisBlog._id = allblogsbasic[bIndex]._id;
                        thisBlog._published = allblogsbasic[bIndex]._published;
                        thisBlog._published_ago = moment(allblogsbasic[bIndex]._published).fromNow();
                    }
                });
            };
            
            var loadP5Views = function(){
                var analyticsForm = {
                    start: $scope.start,
                    end: $scope.end,
                };
                targetStudyProviderService.p5Analytics(analyticsForm).success(function (data, status, headers) {
                    $scope.p5Analytics = data;
                })
                .error(function (data, status, header, config) {
                    console.log();
                });    
            };
            
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
                
                    
                
                if($scope.user.userType == 'Master'){
                    $scope.authorized = true;
                    setPage();
                    
                    
                }
                
            }else{
                console.log('Could not find user');
                $scope.authorized = false;
                $cookies.remove('sessionuser');
                $rootScope.$emit("ForcedLogin", {});
                
            };
            
            
            
            
            
            
    }]);
        
    exambazaar.controller("filledCollegesController", 
        [ '$scope', '$http','$state', '$rootScope','thisuser','tofillcollegeService', 'filledColleges', 'ebteam', '$mdDialog', function($scope, $http, $state, $rootScope, thisuser, tofillcollegeService, filledColleges, ebteam, $mdDialog){
            $scope.user = thisuser.data;
            $scope.filledcolleges = filledColleges.data;
            $scope.allFilledcolleges = filledColleges.data;
            if(!$scope.filledcolleges){
                $scope.filledcolleges = [];
            }
            //console.log($scope.filledcolleges);
            $scope.getRowClass = function(filledcollege){
                var classname = "";
                var nCount = 0;
                if(!filledcollege.active && filledcollege.college.studentbody){
                    for (var property in filledcollege.college.studentbody) {
                        nCount += filledcollege.college.studentbody[property].length;
                    }
                    if(nCount == 0){
                        classname = "error1";
                    }else{
                        classname = "correct";
                    }
                }else{
                    
                }
                
                
                
                return classname;
            };
            if($scope.user && ($scope.user.userType == 'Master' || $scope.user.userType == 'Intern - Business Development')){
                $scope.authorized = true;
                $rootScope.pageTitle = $scope.user.basic.name + " - Filled Colleges Report";
            }
            
            
            var ebteam = ebteam.data;
            var ebteamIds = ebteam.map(function(a) {return a._id;});
            
            var listedUsers = [];
            
            $scope.filledcolleges.forEach(function(thisFilledCollege, index){
                var addedByUser = thisFilledCollege.user;
                if(listedUsers.indexOf(addedByUser) == -1){
                    listedUsers.push(addedByUser);
                }
                var uIndex = ebteamIds.indexOf(addedByUser);
                thisFilledCollege.user = ebteam[uIndex];
                
            });
            $scope.listedUsers = [];
            listedUsers.forEach(function(thisUser, index){
                var uIndex = ebteamIds.indexOf(thisUser);
                $scope.listedUsers.push(ebteam[uIndex]);
                
            });
            
            $scope.subcategories = [
                {
                    name: 'placement',    
                    displayname: 'Placement Cell',    
                },
                {
                    name: 'training_internship',    
                    displayname: 'Training & Internship',    
                },
                {
                    name: 'academic_council',    
                    displayname: 'Academic Council',    
                },
                {
                    name: 'class_representative',    
                    displayname: 'Class Representative',    
                },
                {
                    name: 'student_council',    
                    displayname: 'Student Council',    
                },
                {
                    name: 'student_welfare',    
                    displayname: 'Student Welfare',    
                },
                {
                    name: 'alumni_association',    
                    displayname: 'Alumni Association',    
                },
                {
                    name: 'hostel_affairs',    
                    displayname: 'Hostel Affairs',    
                },
                {
                    name: 'cultural',    
                    displayname: 'Cultural',    
                },
                {
                    name: 'sports',    
                    displayname: 'Sports',    
                },
                {
                    name: 'others',    
                    displayname: 'Others',    
                },
                
                {
                    name: 'ebNote',    
                    displayname: 'EB Notes',    
                },
            ];
            
            $scope.updateFilledColleges = function(user){
                
                var userId = user._id;
                $scope.filledcolleges = [];
                $scope.allFilledcolleges.forEach(function(thisFilledCollege, index){
                    var thisUser = thisFilledCollege.user;
                    if(thisUser._id == userId){
                        $scope.filledcolleges.push(thisFilledCollege);
                    }
                });
            };
            
            $scope.showSummaryDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#summaryDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            
            $scope.generateInternSummary = function(){
                //Summary code starts here
                var reportSummary = [];
                var reportSummaryIds = []; 
                 $scope.allFilledcolleges.forEach(function(thisFilledCollege, index){
                     //console.log(thisFilledCollege);
                     var user = thisFilledCollege.user;
                     //console.log(user);
                     var userName = null;
                     if(user && user.basic.name){
                         userName = user.basic.name;
                     }
                    var thisDateString = moment(thisFilledCollege._created).format("DD-MMM-YYYY");

                    var thisIndex = -1;
                    for(var i = 0; i < reportSummary.length; i++) {
                        if (reportSummary[i].userName == userName && reportSummary[i].dateString == thisDateString) {
                            thisIndex = i;
                        }
                    }
                    var thisCount = 0;
                    if(thisFilledCollege.active == false){
                        thisCount = 1;
                    }
                    if(thisIndex != -1){
                        reportSummary[thisIndex].count += thisCount;
                    }else{
                        var newSummary = {

                            userName: userName,
                            dateString: thisDateString,
                            count: thisCount,
                        };
                        reportSummary.push(newSummary);
                    }

                });
                var uniqueDateStrings = [];
                var uniqueUserNames = [];
                var finalSummary = {};

                 reportSummary.forEach(function(thisElement, index){
                    if(uniqueDateStrings.indexOf(thisElement.dateString) == -1){

                        uniqueDateStrings.push(thisElement.dateString);
                    }
                });
                reportSummary.forEach(function(thisElement, index){
                    if(uniqueUserNames.indexOf(thisElement.userName) == -1){
                        uniqueUserNames.push(thisElement.userName);
                    }
                });
                 uniqueDateStrings.forEach(function(thisElement, index){
                    uniqueUserNames.forEach(function(thisSubElement, sindex){
                        finalSummary[thisElement] = {};
                        finalSummary[thisElement][thisSubElement] = 0;

                    });
                });
                reportSummary.forEach(function(thisElement, index){
                    finalSummary[thisElement.dateString][thisElement.userName] = thisElement.count;
                });
                var summaryStrings = [];
                for (var property in finalSummary) {
                    var newString = "";
                    newString += "Date: " +property + " | ";
                    for (var property2 in finalSummary[property]) {
                        newString += property2 +": " + finalSummary[property][property2] + " | ";
                    }
                    summaryStrings.push(newString);
                }
                $scope.summaryStrings = summaryStrings;
                console.log(summaryStrings);
                //Summary code ends here    
            };
            $scope.generateInternSummary();
    }]);
        
    exambazaar.controller("addedQuestionsController", 
        [ '$scope', '$http','$state','$rootScope', '$mdDialog','thisuser','targetStudyProviderService', 'addedQuestions', 'ebteam', 'examList', function($scope, $http, $state, $rootScope, $mdDialog, thisuser, targetStudyProviderService, addedQuestions, ebteam, examList){
            $scope.user = thisuser.data;
            var exams = examList.data;
            
            if($scope.user && ($scope.user.userType == 'Master' || $scope.user.userType == 'Intern - Business Development')){
                $scope.authorized = true;
            }
            $scope.allAddedQuestions = addedQuestions.data;
            $scope.addedQuestions = addedQuestions.data;
            var ebteam = ebteam.data;
            var ebteamIds = ebteam.map(function(a) {return a._id;});
            var examIds = exams.map(function(a) {return a._id;});
            
            var listedUsers = [];
            $scope.showSummaryDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#summaryDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            $scope.addedQuestions.forEach(function(thisQuestion, index){
                var addedByUser = thisQuestion._createdBy;
                if(listedUsers.indexOf(addedByUser) == -1){
                    listedUsers.push(addedByUser);
                }
                var uIndex = ebteamIds.indexOf(addedByUser);
                thisQuestion._createdBy = ebteam[uIndex];
                
                var eIndex = examIds.indexOf(thisQuestion.exam);
                if(eIndex != -1){
                    thisQuestion.exam = exams[eIndex];
                }
                thisQuestion.hasSolution = 'No';
                thisQuestion.questions.forEach(function(thisQuestionPart, index){
                    
                });
            });
            $scope.listedUsers = [];
            listedUsers.forEach(function(thisUser, index){
                var uIndex = ebteamIds.indexOf(thisUser);
                $scope.listedUsers.push(ebteam[uIndex]);
                
            });
            $scope.updateAddedQuestions = function(user){
                
                var userId = user._id;
                $scope.addedQuestions = [];
                $scope.allAddedQuestions.forEach(function(thisQuestion, index){
                    var addedByUser = thisQuestion._createdBy;
                    if(addedByUser._id == userId){
                        $scope.addedQuestions.push(thisQuestion);
                    }
                });
            };
            $scope.generateExamSummary = function(){
                $scope.examQCount = [];
                var examQuestionIds = $scope.addedQuestions.map(function(a) {return a.exam._id;});
                var examQuestionCounts = $scope.addedQuestions.map(function(a) {return a.questions;});
                $scope.totalQuestions = 0;
                var counts = {};
                for (var i = 0; i < examQuestionIds.length; i++) {
                    var thisLength = 0;
                    if(examQuestionCounts[i] && examQuestionCounts[i].length > 0){
                        thisLength = examQuestionCounts[i].length;
                    }
                    counts[examQuestionIds[i]] = thisLength + (counts[examQuestionIds[i]] || 0);
                    $scope.totalQuestions += thisLength;
                }
                for(var i in counts){
                    //console.log(i + " " + counts[i]);
                    var newExamCount = {
                        exam: null,
                        count: null
                    };
                    
                    var eIndex = examIds.indexOf(i);
                    if(eIndex != -1){
                        newExamCount.exam = exams[eIndex];
                        newExamCount.count = counts[i];
                    }
                    $scope.examQCount.push(newExamCount);
                }
                //console.log($scope.examQCount);
            };
            $scope.generateExamSummary();
            
            $scope.generateInternSummary = function(){
                //Summary code starts here
                var reportSummary = [];
                var reportSummaryIds = []; 
                 $scope.addedQuestions.forEach(function(thisQuestion, index){
                     var user = thisQuestion._createdBy;
                     console.log(user);
                     var userName = null;
                     if(user && user.basic.name){
                         userName = user.basic.name;
                     }
                    var thisDateString = moment(thisQuestion._created).format("DD-MMM-YYYY");

                    var thisIndex = -1;
                    for(var i = 0; i < reportSummary.length; i++) {
                        if (reportSummary[i].userName == userName && reportSummary[i].dateString == thisDateString) {
                            thisIndex = i;
                        }
                    }
                    if(thisIndex != -1){
                        reportSummary[thisIndex].count += thisQuestion.questions.length;
                    }else{
                        var newSummary = {

                            userName: userName,
                            dateString: thisDateString,
                            count: thisQuestion.questions.length,
                        };
                        reportSummary.push(newSummary);
                    }

                });
                var uniqueDateStrings = [];
                var uniqueUserNames = [];
                var finalSummary = {};

                 reportSummary.forEach(function(thisElement, index){
                    if(uniqueDateStrings.indexOf(thisElement.dateString) == -1){

                        uniqueDateStrings.push(thisElement.dateString);
                    }
                });
                reportSummary.forEach(function(thisElement, index){
                    if(uniqueUserNames.indexOf(thisElement.userName) == -1){
                        uniqueUserNames.push(thisElement.userName);
                    }
                });
                 uniqueDateStrings.forEach(function(thisElement, index){
                    uniqueUserNames.forEach(function(thisSubElement, sindex){
                        finalSummary[thisElement] = {};
                        finalSummary[thisElement][thisSubElement] = 0;

                    });
                });
                reportSummary.forEach(function(thisElement, index){
                    finalSummary[thisElement.dateString][thisElement.userName] = thisElement.count;
                });
                var summaryStrings = [];
                for (var property in finalSummary) {
                    var newString = "";
                    newString += "Date: " +property + " | ";
                    for (var property2 in finalSummary[property]) {
                        newString += property2 +": " + finalSummary[property][property2] + " | ";
                    }
                    summaryStrings.push(newString);
                }
                $scope.summaryStrings = summaryStrings;
                console.log(summaryStrings);
                //Summary code ends here    
            };
            $scope.generateInternSummary();
    }]);
        
    exambazaar.controller("cityGroupExamQueryController", 
        [ '$scope', '$http','$state','$rootScope', 'targetStudyProviderService', function($scope, $http, $state, $rootScope, targetStudyProviderService){
        
        this.selectedItemChange = selectedItemChange;
        function selectedItemChange(item) {
            console.log('Item changed to ' + JSON.stringify(item));
            //$state.go('claim', {coachingId: item._id});
            $rootScope.reviewInstitute = item;
        };
        this.querySearch = function(query){
            if(query.length > 2){
                var cityGroupExamQuery = {
                    query: query,
                    city: $rootScope.reviewCity,
                    exam: $rootScope.reviewExam,
                    stream: $rootScope.reviewStream,
                };
                
                return targetStudyProviderService.cityGroupExamQueryForm(cityGroupExamQuery).then(function(response){
                    //console.log(response.data);
                    return response.data;
                });
            }
            
            /*return $http.get("https://api.github.com/search/users", {params: {q: query}})
            .then(function(response){
              return response.data.items;
            })*/
        };
            //$rootScope.pageTitle ='Sandbox';
    }]);  
        
        
    exambazaar.controller("reviewController", 
        [ '$scope', '$http','$state','$rootScope','targetStudyProviderService', 'allcities', '$location', 'streamList', 'examList', '$mdDialog', function($scope, $http, $state, $rootScope, targetStudyProviderService, allcities, $location, streamList, examList, $mdDialog){
            $mdDialog.hide();
            $scope.streams = streamList.data;
            $scope.exams = examList.data;
            
            $scope.cities = allcities.data;
            $scope.rankedCities = [
            "Delhi","Mumbai","New Delhi","Ahmedabad","Chennai","Kolkata","Hyderabad","Pune","Bangalore","Chandigarh","Jaipur",
                "Agartala", 
                "Agra", 
                "Ajmer", 
                "Aligarh", 
                "Allahabad", 
                "Alwar", 
                "Ambala", 
                "Amritsar", 
                "Bareilly", 
                "Belgaum", 
                "Bhilwara", 
                "Bhopal", 
                /*"Bhubaneshwar", */
                "Bhubaneswar", 
                "Bikaner", 
                "Bilaspur", 
                "Coimbatore", 
                "Davanagere", 
                "Dehradun", 
                "Dhanbad", 
                "Dibrugarh", 
                "Faridabad", 
                "Ganganagar", 
                "Ghaziabad", 
                "Gorakhpur", 
                "Guntur", 
                "Gurgaon", 
                "Guwahati", 
                "Gwalior", 
                "Hosur", 
                "Hubli", 
                "Indore", 
                "Jabalpur", 
                "Jalandhar", 
                "Jammu", 
                "Jamshedpur", 
                "Jhansi", 
                "Jodhpur", 
                "Kannur", 
                "Kanpur", 
                "Kochi", 
                "Kolar", 
                "Kolhapur", 
                "Kota", 
                "Kozhikode", 
                "Kurukshetra", 
                "Lucknow", 
                "Ludhiana", 
                "Madurai", 
                "Malappuram", 
                "Mangalore", 
                "Mathura", 
                "Meerut", 
                "Mohali", 
                "Moradabad", 
                "Mysore", 
                "Nagpur", 
                "Nainital", 
                "Nashik", 
                "Noida", 
                "Panipat", 
                "Patiala", 
                "Patna", 
                "Pondicherry", 
                "Raipur", 
                "Rajkot", 
                "Ranchi", 
                "Rohtak", 
                "Roorkee", 
                "Saharanpur", 
                "Secunderabad", 
                "Shimla", 
                "Sikar", 
                "Solapur", 
                "Srinagar", 
                "Surat", 
                "Thrissur", 
                "Tiruvananthapuram", 
                "Trichy", 
                "Trissur", 
                "Trivandrum", 
                "Tumakuru", 
                "Udaipur", 
                "Ujjain", 
                "Vadodara", 
                "Varanasi", 
                "Vellore", 
                "Vijayawada",
                "Visakhapatnam", 
                
                "Warangal", 
            ];
            //$scope.rankedCities = ["Jaipur","Kota"];
            
            $scope.reviewPolicy = "I certify that this review is based on my own experience and is my genuine opinion of this coaching institute, and that I have no personal or business relationship with this establishment, and have not been offered any incentive or payment originating from the establishment to write this review. I understand that Exambazaar has a zero-tolerance policy on fake reviews.";
            
            $scope.cancelDialog = function(){
                $mdDialog.hide();
            };
            $scope.showOtherCityDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#cityDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            
            $scope.examStep = function(){
                $scope.selectStream = false;
                $scope.selectExam = true;
                $scope.selectCity = false;
                $scope.searchCoaching = false;
                $rootScope.reviewExam = null;
                $rootScope.reviewCity = null;
                $rootScope.reviewInstitute = null;
            };
            $scope.cityStep = function(){
                $scope.selectStream = false;
                $scope.selectExam = false;
                $scope.selectCity = true;
                $scope.searchCoaching = false;
                $rootScope.reviewCity = null;
                $rootScope.reviewInstitute = null;
            };
            $scope.selectStream = true;
            $scope.selectExam = false;
            $scope.selectCity = false;
            $scope.searchCoaching = false;
            $scope.updateStream = function(stream){
                $rootScope.reviewStream = stream;
                $scope.selectStream = false;
                $scope.selectExam = true;
                $scope.selectCity = false;
                $scope.searchCoaching = false;
            };
            $scope.updateExam = function(exam){
                $rootScope.reviewExam = exam;
                $scope.selectStream = false;
                $scope.selectExam = false;
                $scope.selectCity = true;
                $scope.searchCoaching = false;
            };
            $scope.updateCity = function(city){
                $mdDialog.hide();
                $rootScope.reviewCity = city;
                $scope.selectStream = false;
                $scope.selectExam = false;
                $scope.selectCity = false;
                $scope.searchCoaching = true;
            };
            $scope.clearAll = function(){
                $scope.selectStream = true;
                $scope.selectExam = false;
                $scope.selectCity = false;
                $scope.searchCoaching = false;
                $rootScope.reviewStream = null;
                $rootScope.reviewExam = null;
                $rootScope.reviewCity = null;
                $rootScope.reviewInstitute = null;
            };
            
            $scope.checkReviewButton = function(){
                var disabled = false;
                if(!$rootScope.reviewStream || !$rootScope.reviewExam || !$rootScope.reviewCity || !$rootScope.reviewInstitute){
                    disabled = true;
                }
                return disabled;
            };
            $scope.goToReview = function(){
                var stream = $rootScope.reviewStream;
                var exam = $rootScope.reviewExam;
                var city = $rootScope.reviewCity;
                var institute = $rootScope.reviewInstitute;
                
                $state.go('showGroup', {categoryName: stream.name, subCategoryName: exam.name, cityName: city, groupName: institute.groupName,'#': 'Reviews'});
            };
            $rootScope.pageTitle ='Write a Review | Exambazaar';
            
            var currURL = $location.absUrl();
            $rootScope.pageURL = currURL;
            $rootScope.pageImage = 'https://www.exambazaar.com/images/logo/cover.png';
    }]);
        
    /*exambazaar.controller("reviewCenterController", 
    [ '$scope', '$rootScope', 'thisProvider','$location', 'reviewService', '$cookies', '$mdDialog', '$timeout', function($scope,$rootScope, thisProvider, $location, reviewService, $cookies, $mdDialog, $timeout){
        $scope.provider = thisProvider.data;
        if($cookies.getObject( 'sessionuser')){
            $scope.user = $cookies.getObject( 'sessionuser');
        }
        
        
        $scope.reviewParams = [
            {name: "faculty", displayname:"Faculty and Teaching Experience", hoverVal: -1},
            {name: "competitive_environment", displayname:"Competitive Environment", hoverVal: -1},
            {name: "quality_of_material", displayname:"Quality of material", hoverVal: -1},
            {name: "infrastructure", displayname:"Infrastructure", hoverVal: -1},
        ];
        $scope.userReview = {
            institute: $scope.provider._id,
            text: ''
        };
        if($scope.user && $scope.user.userId){
            $scope.userReview.user = $scope.user.userId;
        }
        $scope.reviewParams.forEach(function(thisParam, index){
            $scope.userReview[thisParam.name] = null;
        });
        var noReview = false;
        $scope.$watch('[user.userId, provider._id]', function (newValue, oldValue, scope) {
            if(newValue[0] && newValue[1] && !noReview){
                var userInstituteForm = {
                    user: newValue[0],   
                    institute: newValue[1],   
                };
                reviewService.existingReview(userInstituteForm).success(function (data, status, headers) {
                    if(data){
                        $scope.userReview = data;
                        $scope.reviewParams.forEach(function(thisParam, index){
                            var pIndex = $scope.reviews.indexOf(parseInt($scope.userReview[thisParam.name]));
                            $scope.setReview(thisParam.name,parseInt($scope.userReview[thisParam.name]));
                        });
                    }else{
                        noReview = true;
                    }
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                }); 
            }
        }, true);
        $scope.reviews = [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0];
        $scope.reviewsClasses = ["review1","review2","review3","review4","review5","review6","review7","review8","review9"];
        $scope.minTextLength = 140;
        
        $scope.placeholder = "Tip: A great review covers information about Faculty, Peer Interaction, Quality of material and Infrastructure. Got recommendations for your favorite faculty and employees, or something everyone should know about " + $scope.provider.name +", " + $scope.provider.city + "? Include that too! And remember, your review needs to be atleast " + $scope.minTextLength + " characters long :)";
        
        var paramNames = $scope.reviewParams.map(function(a) {return a.name;});
        
        $scope.getBackgroundColour = function(reviewParam,  paramIndex){
            var pIndex = paramNames.indexOf(reviewParam.name);
            var className = "noreview";
            
            var propName = $scope.reviewParams[pIndex].name;
            var review = $scope.userReview[propName];
            
            if(review){
                var rIndex = $scope.reviews.indexOf(review);
                //console.log(rIndex);
                if(paramIndex <= rIndex){
                    var rIndex2 = rIndex + 1;
                    className = "review" + rIndex2;    
                }
                
            }
            
            if($scope.reviewParams[pIndex].hoverVal >= 0){
                className = "noreview";
            };
            
            if($scope.reviewParams[pIndex].hoverVal >= paramIndex){
                
                var paramIndex2 = paramIndex + 1;
                className = "review" + paramIndex2;
            }
            
            
            return className;
        };
        
        $scope.logMouseEvent = function(reviewParam,  paramIndex) {
            switch (event.type) {
              case "mouseenter":
                    console.log("Hey Mouse Entered");
                    break;
              case "mouseover":{
                    var pIndex = paramNames.indexOf(reviewParam.name);
                    $scope.reviewParams[pIndex].hoverVal = paramIndex;
                    break;
              }
              case "mouseout":{
                    var pIndex = paramNames.indexOf(reviewParam.name);
                    $scope.reviewParams[pIndex].hoverVal = -1;
                    break;
              }
                    
              case "mouseleave":
                console.log("Mouse Gone");
                break;

              default:
                console.log(event.type);
                break;
            };
        };
        
        $scope.showSavedReviewDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#savedReviewDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        
        $scope.submitReview = function(){
            if($scope.userReview.user){
                reviewService.savereview($scope.userReview).success(function (data, status, headers) {
                    $scope.showSavedReviewDialog();
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                console.log('No user set');
            }
        };
        $scope.checkReview = function(reviewParam, rateVal) {   
            if($scope.userReview[reviewParam.name] >=rateVal){return true;}else{return false;}
        }
        
        $scope.setReview = function(param, value){
            $scope.userReview[param] = value;
            //console.log($scope.userReview);
        };
        $scope.invalidSubmit = function(){
            var invalid = false;
            
            $scope.reviewParams.forEach(function(thisParam, index){
                if(!$scope.userReview[thisParam.name]){
                    invalid = true;
                }
            });
            $scope.userReview.text = $scope.userReview.text.trim();
            $scope.userReview.text = $scope.userReview.text.replace(/\s+/g, " ");
            
            
            
            var textLength = $scope.userReview.text.length;
            //console.log(textLength);
            if(textLength < $scope.minTextLength){
                invalid = true;
            }
            
            return invalid;
        };
        
        $rootScope.pageTitle = "Review " + $scope.provider.name + " " + $scope.provider.city;
        
        var currURL = $location.absUrl();
        $rootScope.pageURL = currURL;
        $rootScope.pageImage = 'https://www.exambazaar.com/images/logo/cover.png';
        
    }]);    */
    
    exambazaar.controller("editCollegeController", 
        [ '$scope', '$http','$state','$rootScope', 'collegeService', '$cookies', 'thisCollege', 'Notification', 'tofillcollegeService', '$mdDialog', 'screenSize', function($scope, $http, $state, $rootScope, collegeService, $cookies, thisCollege, Notification, tofillcollegeService, $mdDialog, screenSize){
            
            if (screenSize.is('xs, sm')){
                $scope.disabled = true;
            }else{
                $scope.disabled = false;
            }

            
            $scope.college = thisCollege.data;
            $scope.college.website = $scope.college.Institute["Correspondence Details"]["Website"];
            
            if($scope.college.website2){
                $scope.college.website = $scope.college.website2;
            }
            if($scope.college.website.indexOf('http')){
                $scope.college.website = "http://" + $scope.college.website;
            }
            $scope.disabled = null;
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
                
                if($scope.user.userType == 'Master' || $scope.user.userType == 'Intern - Business Development'){
                    $scope.disabled = false;
                    var toFillCollegesForm = {
                        user: $scope.user._id,
                        collegeId: $scope.college._id,
                    };
                    
                    tofillcollegeService.tofilluser(toFillCollegesForm).success(function (filldata, status, headers) {
                        $scope.tofilluser = filldata;
                        console.log($scope.tofilluser);
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                    
                }
                
            }else{
                $scope.disabled = true;
            }
            
            $scope.subcategories = [
                {
                    name: 'placement',    
                    displayname: 'Placement Cell',    
                },
                {
                    name: 'training_internship',    
                    displayname: 'Training & Internship',    
                },
                {
                    name: 'academic_council',    
                    displayname: 'Academic Council',    
                },
                {
                    name: 'class_representative',    
                    displayname: 'Class Representative',    
                },
                {
                    name: 'student_council',    
                    displayname: 'Student Council',    
                },
                {
                    name: 'student_welfare',    
                    displayname: 'Student Welfare',    
                },
                {
                    name: 'alumni_association',    
                    displayname: 'Alumni Association',    
                },
                {
                    name: 'hostel_affairs',    
                    displayname: 'Hostel Affairs',    
                },
                {
                    name: 'cultural',    
                    displayname: 'Cultural',    
                },
                {
                    name: 'sports',    
                    displayname: 'Sports',    
                },
                {
                    name: 'others',    
                    displayname: 'Others',    
                },
                {
                    name: 'ebNote',    
                    displayname: 'EB Notes',    
                },
                
            ];
            $scope.activeSubcategory = null;
            $scope.activeSubcategoryObj = null;
            $scope.setActiveSubcategory = function(subcategory){
                $scope.activeSubcategory = subcategory;
                
                if($scope.college.studentbody[subcategory.name]){
                    $scope.activeSubcategoryObj = $scope.college.studentbody[subcategory.name];
                }else{
                    $scope.activeSubcategoryObj = [];
                }
            };
            
            $scope.addwebsite2 = function(ev){
                $mdDialog.show({
                  contentElement: '#website2Dialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });    
            };
            $scope.closeDialog = function(ev){
                $mdDialog.hide();   
            };
            
            $scope.setActiveSubcategory($scope.subcategories[0]);
            
            $scope.addContact = function(activeSubcategory){
                var newContact = {
                    title: '',
                    name: '',
                    email: [],
                    mobile: [],
                    landline: [],
                };
                if(activeSubcategory.name == 'ebNote'){
                    newContact = {
                        note: '',
                        user: $scope.user._id,
                    };
                }
                $scope.activeSubcategoryObj.push(newContact);
                $scope.college.studentbody[$scope.activeSubcategory.name] = $scope.activeSubcategoryObj;
            };
            $scope.flipwebsitenotworking = function(){
                if(!$scope.college.websitenotworking){
                    $scope.college.websitenotworking = true;
                }else{
                    $scope.college.websitenotworking = false;
                }
            };
            $scope.deleteContact = function(contact, index){
                if($scope.activeSubcategoryObj && $scope.activeSubcategoryObj.length > index){
                    $scope.activeSubcategoryObj.splice(index, 1);
                }
            };
            $scope.addEmail = function(contact){
                if(!contact.email){
                    contact.email = [];
                }
                contact.email.push('');
            };
            $scope.deleteEmail = function(contact, index){
                if(!contact.email){
                    contact.email = [];
                }
                if(contact.email.length > index){
                    contact.email.splice(index, 1);
                }
            };
            $scope.addMobile = function(contact){
                if(!contact.mobile){
                    contact.mobile = [];
                }
                contact.mobile.push('');
            };
            $scope.deleteMobile = function(contact, index){
                if(!contact.mobile){
                    contact.mobile = [];
                }
                if(contact.mobile.length > index){
                    contact.mobile.splice(index, 1);
                }
            };
            $scope.addLandline = function(contact){
                if(!contact.landline){
                    contact.landline = [];
                }
                contact.landline.push('');
            };
            $scope.deleteLandline = function(contact, index){
                if(!contact.landline){
                    contact.landline = [];
                }
                if(contact.landline.length > index){
                    contact.landline.splice(index, 1);
                }
            };
            
            $scope.saveCollege = function(){
                collegeService.saveCollege($scope.college).success(function (data, status, headers) {
                    Notification.primary({message: "Great, changes saved!",  positionY: 'top', positionX: 'right', delay: 1000});
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                });
            };
            
            $scope.markDoneConfirm = function(){
                var confirm = $mdDialog.confirm()
                    .title('Would you like to mark ' + $scope.college.inst_name + ' as done?')
                    .textContent('This will be saved in your report')
                    .ariaLabel('Lucky day')
                    .targetEvent()
                    .clickOutsideToClose(true)
                    .ok('Confirm')
                    .cancel('Cancel');
                    $mdDialog.show(confirm).then(function() {
                        $scope.markDone();
                    }, function() {
                          //nothing
                            
                    });    
            };
            
            $scope.markDone = function(){
                var toFillCollegesForm = {
                    user: $scope.user._id,
                    college: $scope.college._id,
                };

                tofillcollegeService.markDone(toFillCollegesForm).success(function (taskdata, status, headers) {
                    
                    if(taskdata){
                        Notification.primary({message: "Great, task marked as done!",  positionY: 'top', positionX: 'right', delay: 1000});
                        $scope.tofilluser = taskdata;
                    }else{
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    }
                    
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                });
            };
            
            $scope.markNotDoneConfirm = function(){
                var confirm = $mdDialog.confirm()
                    .title('Would you like to mark ' + $scope.college.inst_name + ' as NOT done?')
                    .textContent('This will be saved in your report')
                    .ariaLabel('Lucky day')
                    .targetEvent()
                    .clickOutsideToClose(true)
                    .ok('Confirm')
                    .cancel('Cancel');
                    $mdDialog.show(confirm).then(function() {
                        $scope.markNotDone();
                    }, function() {
                          //nothing
                            
                    });    
            };
            $scope.markNotDone = function(){
                var toFillCollegesForm = {
                    user: $scope.user._id,
                    college: $scope.college._id,
                };

                tofillcollegeService.markNotDone(toFillCollegesForm).success(function (taskdata, status, headers) {
                    
                    if(taskdata){
                        Notification.primary({message: "Great, task marked as not done!",  positionY: 'top', positionX: 'right', delay: 1000}); $scope.tofilluser = taskdata;
                    }else{
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    }
                    
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                });
            };
    }]);      
    exambazaar.controller("collegesController", 
        [ '$scope', '$http','$state','$rootScope', 'collegeService', '$cookies', 'internList', 'AllIds', 'Notification', 'tofillcollegeService', function($scope, $http, $state, $rootScope, collegeService, $cookies, internList, AllIds, Notification, tofillcollegeService){
            $scope.disabled = null;
            $scope.interns = internList.data;
            $scope.AllIds = AllIds.data;
            $scope.assigned = false;
            $scope.deadline = moment();
            $scope.assignedTo = null;
            $scope.canAssign = false;
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
                
                if($scope.user.userType == 'Master' || $scope.user.userType == 'Intern - Business Development'){
                    $scope.disabled = false;
                }
                
                if($scope.user.userType == 'Master' || $scope.user._id == '58c8e895bbaebf3560545f19' || $scope.user._id == '5a1831f0bd2adb260055e352'){
                    $scope.canAssign = true;
                };
                
                
            }else{
                $scope.disabled = true;
            }
            
            $scope.newlimit = null;
            $scope.limits = [1, 10, 20, 50];
            $scope.collegesForm = {
                limit: 20,
                skip: 0
            };
            $scope.buttonClass = function(collegesLength){
                if($scope.collegesForm.limit == collegesLength){
                    return 'md-danger';
                }else{
                    return 'md-next';
                }
            };
            
            var loadColleges = function(){
                if(!$scope.assigned){
                    collegeService.getUnassignedColleges($scope.collegesForm).success(function (data, status, headers) {
                    
                        $scope.colleges = data;

                        $scope.colleges.forEach(function(thisCollege, index){
                            thisCollege.district = thisCollege.Institute["Correspondence Details"]["District"];
                            thisCollege.state = thisCollege.Institute["Correspondence Details"]["State"];
                            thisCollege.website = thisCollege.Institute["Correspondence Details"]["Website"];
                            if(thisCollege.website.indexOf('http') == -1){
                                thisCollege.website = "http://" + thisCollege.website;
                            }
                        });
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                }else{
                    collegeService.getAssignedColleges($scope.collegesForm).success(function (data, status, headers) {
                    
                        $scope.colleges = data;

                        $scope.colleges.forEach(function(thisCollege, index){
                            thisCollege.district = thisCollege.Institute["Correspondence Details"]["District"];
                            thisCollege.state = thisCollege.Institute["Correspondence Details"]["State"];
                            thisCollege.website = thisCollege.Institute["Correspondence Details"]["Website"];
                            if(thisCollege.website.indexOf('http') == -1){
                                thisCollege.website = "http://" + thisCollege.website;
                            }
                        });
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                }
            };
            loadColleges();
            $scope.nColleges = function(collegesLength){
                $scope.collegesForm.limit = collegesLength;
                loadColleges();
            };
            
            $scope.flipAssigned = function(){
                $scope.assigned = !$scope.assigned;
                $scope.collegesForm = {
                    limit: 50,
                    skip: 0
                };
                loadColleges();
            };
            $scope.nextPage = function(){
                $scope.colleges = null;
                $scope.collegesForm.skip = $scope.collegesForm.skip + $scope.collegesForm.limit;
                loadColleges();
            };
            $scope.prevPage = function(){
                if($scope.collegesForm.skip >= $scope.collegesForm.limit){
                    $scope.colleges = null;
                    $scope.collegesForm.skip = $scope.collegesForm.skip - $scope.collegesForm.limit;
                    loadColleges();
                }
                
            };
            $scope.updateAssignedTo = function(intern){
                console.log(intern);
                $scope.assignedTo = intern;
            };
            
            $scope.assignAll = function(){
                console.log();
                if(!$scope.assignedTo){
                    Notification.warning({message: "Select an Intern to assign to!",  positionY: 'top', positionX: 'right', delay: 1000});
                }else if(!$scope.deadline){
                    Notification.warning({message: "Select an deadline!",  positionY: 'top', positionX: 'right', delay: 1000});
                }else{
                    var assignedIds = [];
                    $scope.colleges.forEach(function(thisCollege, index){
                        var aIndex = $scope.AllIds.indexOf(thisCollege._id);
                        if(aIndex == -1){
                            assignedIds.push(thisCollege._id);
                        }
                    });
                    
                    if(assignedIds.length == 0){
                        Notification.warning({message: 'No assignable colleges!',  positionY: 'top', positionX: 'right', delay: 1000});
                    }else{
                        var toFillCollegesForm = {
                            user: $scope.assignedTo._id,
                            collegeIds: assignedIds,
                            _deadline: $scope.deadline
                        };

                        tofillcollegeService.save(toFillCollegesForm).success(function (data, status, headers) {
                            Notification.success({message: data + " colleges assigned to: " + $scope.assignedTo.basic.name,  positionY: 'top', positionX: 'right', delay: 1000});
                        })
                        .error(function (data, status, header, config) {
                            Notification.warning({message: 'Something went wrong!',  positionY: 'top', positionX: 'right', delay: 1000});
                        });
                    }
                    
                    
                }
                
                
            };
            
    }]);    
    exambazaar.controller("coachingGroupController", 
        [ '$scope', '$http','$state','$rootScope','targetStudyProviderService', '$mdDialog', '$timeout','thisuser', 'examList', 'streamList', function($scope, $http, $state, $rootScope, targetStudyProviderService, $mdDialog, $timeout,thisuser, examList, streamList){
            
            $scope.user = thisuser.data;
            $scope.allExams = examList.data;
            $scope.allStreams = streamList.data;
            $scope.spreadsheetMode = false;
            
            
            if($scope.user.userType =='Master'){
                $scope.spreadsheetMode = true;
            }
            if($scope.user._id =='5a1831f0bd2adb260055e352'){
                $scope.spreadsheetMode = true;
            }
            
            $rootScope.pageTitle ='Coaching Group Editing';
            
            
            $scope.showRenameCoachingDialog = function(ev) {
                $scope.newName = $scope.spreadSheetCoachings[1].name;
                $scope.newGroupName = $scope.spreadSheetCoachings[1].groupName;
                $mdDialog.show({
                  contentElement: '#renameCoachingDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            $scope.showRenameGroupDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#renameGroupDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            $scope.showExamDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#examDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            $scope.showRemoveExamDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#removeExamDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            $scope.showCommonExamDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#commonExamDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            $scope.showLogoDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#logoDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            $scope.showEmailDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#emailDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            
            $scope.showWebsiteDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#websiteDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            $scope.closeDialog = function(){
                $mdDialog.hide();
            };
            $scope.showSpreadsheetDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#spreadsheetDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            
            $scope.addExamsArray = [];
            $scope.removeExamsArray = [];
            $scope.addExam = function(thisArray, thisExam){
                var thisExamId = thisExam._id;
                var eIndex = thisArray.indexOf(thisExamId);
                if(eIndex == -1){
                    thisArray.push(thisExamId);
                }else{
                    //do nothing
                }
            };
            $scope.removeExam = function(thisArray, thisExam){
                var thisExamId = thisExam._id;
                var eIndex = thisArray.indexOf(thisExamId);
                if(eIndex == -1){
                    //do nothing
                }else{
                    thisArray.splice(eIndex,1);
                }
            };
            
            $scope.renameCoachingConfirm = function(){
                var instituteLength = $scope.spreadSheetCoachings.length;
                
                console.log($scope.newName);
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    instituteLength = allInstitutes.length - 1;
                }
                
                var groupName = '';
                if($scope.spreadSheetCoachings.length > 1){
                    groupName = $scope.spreadSheetCoachings[1].name;
                }
                var confirm = $mdDialog.confirm()
                .title('Would you like to rename these ' + instituteLength + ' coaching centers of ' +  groupName + '?')
                .textContent('You will not be able to revert it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.renameAllCoaching();
                }, function() {
                  //nothing
                    $scope.showExamDialog();
                }); 
            };
            
            $scope.renameGroupNameConfirm = function(){
                var instituteLength = $scope.spreadSheetCoachings.length;
                
                console.log($scope.newGroupName);
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    instituteLength = allInstitutes.length - 1;
                }
                
                var groupName = '';
                if($scope.spreadSheetCoachings.length > 1){
                    groupName = $scope.spreadSheetCoachings[1].groupName;
                }
                var confirm = $mdDialog.confirm()
                .title('Would you like to rename Group Name of these ' + instituteLength + ' coaching centers of ' +  groupName + '?')
                .textContent('You will not be able to revert it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.renameAllGroupName();
                }, function() {
                  //nothing
                    $scope.showExamDialog();
                }); 
            };
            $scope.renameAllCoaching = function(){
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    allInstitutes.splice(0,1);
                }
                
                var instituteArray =  allInstitutes.map(function(a) {return a._id;});
                var groupNameForm = {
                    instituteArray: instituteArray,
                    name: $scope.newName
                };
                
                targetStudyProviderService.renameAllCoaching(groupNameForm).success(function (data, status, headers) {
                    console.log('Done');
                    $scope.showSavedDialog();
                    //$scope.showSavedDialog();
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });       
            };
            
            $scope.renameAllGroupName = function(){
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    allInstitutes.splice(0,1);
                }
                
                var instituteArray =  allInstitutes.map(function(a) {return a._id;});
                var groupNameForm = {
                    instituteArray: instituteArray,
                    groupName: $scope.newGroupName
                };
                
                targetStudyProviderService.renameAllGroupName(groupNameForm).success(function (data, status, headers) {
                    console.log('Done');
                    $scope.showSavedDialog();
                    //$scope.showSavedDialog();
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });       
            };
            
            $scope.addExamConfirm = function(){
                var instituteLength = $scope.spreadSheetCoachings.length;
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    instituteLength = allInstitutes.length - 1;
                }
                
                var groupName = '';
                if($scope.spreadSheetCoachings.length > 1){
                    groupName = $scope.spreadSheetCoachings[1].name;
                }
                var confirm = $mdDialog.confirm()
                .title('Would you add these ' + $scope.addExamsArray.length + ' exams to these ' + instituteLength + ' coaching centers of ' +  groupName + '?')
                .textContent('You will not be able to revert it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.addExamsToAll();
                }, function() {
                  //nothing
                    $scope.showExamDialog();
                }); 
            };
            
            $scope.setLogoConfirm = function(){
                var instituteLength = $scope.spreadSheetCoachings.length;
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    instituteLength = allInstitutes.length - 1;
                }
                
                var groupName = '';
                if($scope.spreadSheetCoachings.length > 1){
                    groupName = $scope.spreadSheetCoachings[1].name;
                }
                var confirm = $mdDialog.confirm()
                .title('Would you like to set logo for these ' + instituteLength + ' coaching centers of ' +  groupName + '?')
                .textContent('You will not be able to revert it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.setLogoForAll();
                }, function() {
                  //nothing
                    $scope.showLogoDialog();
                }); 
            };
            
            $scope.setEmailConfirm = function(){
                var instituteLength = $scope.spreadSheetCoachings.length;
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    instituteLength = allInstitutes.length - 1;
                }
                
                var groupName = '';
                if($scope.spreadSheetCoachings.length > 1){
                    groupName = $scope.spreadSheetCoachings[1].name;
                }
                var confirm = $mdDialog.confirm()
                .title('Would you like to add email for these ' + instituteLength + ' coaching centers of ' +  groupName + '?')
                .textContent('You will not be able to revert it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.setEmailForAll();
                }, function() {
                  //nothing
                    $scope.showLogoDialog();
                }); 
            };
            $scope.setWebsiteConfirm = function(){
                var instituteLength = $scope.spreadSheetCoachings.length;
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    instituteLength = allInstitutes.length - 1;
                }
                
                var groupName = '';
                if($scope.spreadSheetCoachings.length > 1){
                    groupName = $scope.spreadSheetCoachings[1].name;
                }
                var confirm = $mdDialog.confirm()
                .title('Would you like to add website for these ' + instituteLength + ' coaching centers of ' +  groupName + '?')
                .textContent('You will not be able to revert it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.setWebsiteForAll();
                }, function() {
                  //nothing
                    $scope.showLogoDialog();
                }); 
            };
            
            $scope.addExamsToAll = function(){
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    allInstitutes.splice(0,1);
                }
                
                var instituteArray =  allInstitutes.map(function(a) {return a._id;});
                var groupExamForm = {
                    instituteArray: instituteArray,
                    examArray: $scope.addExamsArray
                };
                
                targetStudyProviderService.addExamsToAll(groupExamForm).success(function (data, status, headers) {
                    console.log('Done');
                    $scope.showSavedDialog();
                    //$scope.showSavedDialog();
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });       
            };
            
            $scope.setLogoForAll = function(){
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    allInstitutes.splice(0,1);
                }
                
                var instituteArray =  allInstitutes.map(function(a) {return a._id;});
                var groupLogoForm = {
                    instituteArray: instituteArray,
                    logo: $scope.newLogo
                };
                
                targetStudyProviderService.setLogoForAll(groupLogoForm).success(function (data, status, headers) {
                    console.log('Done');
                    $scope.showSavedDialog();
                    //$scope.showSavedDialog();
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });       
            };
            $scope.newEmail = '';
            $scope.setEmailForAll = function(){
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    allInstitutes.splice(0,1);
                }
                var emailArray = $scope.newEmail.toLowerCase().split(',');
                
                emailArray.forEach(function(thisEmail, index){
                    thisEmail = thisEmail.trim();
                });
                
                if(emailArray.length > 0){
                    var instituteArray =  allInstitutes.map(function(a) {return a._id;});
                    var groupEmailForm = {
                        instituteArray: instituteArray,
                        emailArray: emailArray
                    };

                    targetStudyProviderService.setEmailForAll(groupEmailForm).success(function (data, status, headers) {
                        $scope.showSavedDialog();

                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });  
                   
                }
                     
            };
            
            $scope.newWebsite = '';
            $scope.setWebsiteForAll = function(){
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    allInstitutes.splice(0,1);
                }
                var websiteArray = $scope.newWebsite.toLowerCase().split(',');
                
                websiteArray.forEach(function(thisWebsite, index){
                    thisWebsite = thisWebsite.trim();
                });
                
                if(websiteArray.length > 0){
                    var instituteArray =  allInstitutes.map(function(a) {return a._id;});
                    var groupWebsiteForm = {
                        instituteArray: instituteArray,
                        websiteArray: websiteArray
                    };

                    targetStudyProviderService.setWebsiteForAll(groupWebsiteForm).success(function (data, status, headers) {
                        $scope.showSavedDialog();

                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });  
                   
                }
                     
            };
            
            $scope.removeExamConfirm = function(){
                var instituteLength = $scope.spreadSheetCoachings.length;
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    instituteLength = allInstitutes.length - 1;
                }
                
                var groupName = '';
                if($scope.spreadSheetCoachings.length > 1){
                    groupName = $scope.spreadSheetCoachings[1].name;
                }
                var confirm = $mdDialog.confirm()
                .title('Would you remove these ' + $scope.removeExamsArray.length + ' exams from these ' + instituteLength + ' coaching centers of ' +  groupName + '?')
                .textContent('You will not be able to revert it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.removeExamsFromAll();
                }, function() {
                  //nothing
                    $scope.showRemoveExamDialog();
                }); 
            };
            $scope.removeExamsFromAll = function(){
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    allInstitutes.splice(0,1);
                }
                
                var instituteArray =  allInstitutes.map(function(a) {return a._id;});
                var groupExamForm = {
                    instituteArray: instituteArray,
                    examArray: $scope.removeExamsArray
                };
                
                targetStudyProviderService.removeExamsFromAll(groupExamForm).success(function (data, status, headers) {
                    console.log('Done');
                    $scope.showSavedDialog();
                    //$scope.showSavedDialog();
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });       
            };
            
            $scope.commonExamsInAll = function(){
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    allInstitutes.splice(0,1);
                }
                var allExamIds =  $scope.allExams.map(function(a) {return a._id;});
                
                var instituteArray =  allInstitutes.map(function(a) {return a._id;});
                var groupExamForm = {
                    instituteArray: instituteArray,
                    examArray: allExamIds,
                };
                
                targetStudyProviderService.commonExamsInAll(groupExamForm).success(function (data, status, headers) {
                    var commonExams = data;
                    $scope.commonExamIds = data;
                    var allExamIds =  $scope.allExams.map(function(a) {return a._id;});
                    $scope.commonExams = [];
                    commonExams.forEach(function(thisExam, index){
                        var eIndex = allExamIds.indexOf(thisExam);
                        $scope.commonExams.push($scope.allExams[eIndex]);
                    });
                    $scope.showCommonExamDialog();
                    console.log($scope.commonExams);
                    //$scope.showSavedDialog();
                    //$scope.showSavedDialog();
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });       
            };
            
            $scope.disableConfirm = function(){
                var instituteLength = $scope.spreadSheetCoachings.length;
                
                console.log($scope.newName);
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    instituteLength = allInstitutes.length - 1;
                }
                
                var groupName = '';
                if($scope.spreadSheetCoachings.length > 1){
                    groupName = $scope.spreadSheetCoachings[1].name;
                }
                var confirm = $mdDialog.confirm()
                .title('Would you like to disable these ' + instituteLength + ' coaching centers of ' +  groupName + '?')
                .textContent('You will not be able to revert it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.disableAll();
                }, function() {
                  //nothing
                    $scope.showExamDialog();
                }); 
            };
            
            $scope.disableAll = function(){
                
                var allInstitutes = $scope.spreadSheetCoachings;
                if(allInstitutes[0]._id == 'EB Id'){
                    allInstitutes.splice(0,1);
                }
                
                var disableForm = {
                    user: $scope.user._id,
                    instituteIds: allInstitutes
                };
                console.log('Disabling: ' + allInstitutes.length);
                targetStudyProviderService.bulkDisableProviders(disableForm).success(function (data, status, headers) {
                    console.log('Done');
                    $scope.showSavedDialog();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });   
            };
            
            $rootScope.$on("setSpreadSheetCoachings", function(event, data){
                $scope.spreadSheetCoachings = [];
                var searchedCoachingGroup = data.coachingGroupItems;
                var newCenter = {
                    sno: 'S. No',
                    _id: 'EB Id',
                    name: 'Name',
                    groupName: 'Group Name',
                    address: 'Address',
                    city: 'City',
                    state: 'State',
                    pincode: 'Pincode',
                    logo: 'Logo',
                    email: 'Email',
                    phone: 'Phone',
                    mobile: 'Mobile',
                    website: 'Website',
                };
                $scope.spreadSheetCoachings.push(newCenter);
                searchedCoachingGroup.forEach(function(thisCoaching, cindex){
                    if(thisCoaching.email && thisCoaching.email.length > 0){
                        var emailString = '';
                        thisCoaching.email.forEach(function(thisEmail, eindex){
                            emailString += thisEmail;
                            if(eindex != thisCoaching.email.length-1){
                                emailString +=", ";
                            }
                        });
                    }
                    if(thisCoaching.phone && thisCoaching.phone.length > 0){
                        var phoneString = '';
                        thisCoaching.phone.forEach(function(thisEmail, eindex){
                            phoneString += thisEmail;
                            if(eindex != thisCoaching.phone.length-1){
                                phoneString +=", ";
                            }
                        });
                    }
                    if(thisCoaching.mobile && thisCoaching.mobile.length > 0){
                        var mobileString = '';
                        thisCoaching.mobile.forEach(function(thisEmail, eindex){
                            mobileString += thisEmail;
                            if(eindex != thisCoaching.mobile.length-1){
                                mobileString +=", ";
                            }
                        });
                    }
                    if(thisCoaching.website && thisCoaching.website.length > 0){
                        var websiteString = '';
                        thisCoaching.website.forEach(function(thisEmail, eindex){
                            websiteString += thisEmail;
                            if(eindex != thisCoaching.website.length-1){
                                websiteString +=", ";
                            }
                        });
                    }
                    var newCenter = {
                        sno: cindex + 1,
                        _id: thisCoaching._id,
                        name: thisCoaching.name,
                        groupName: thisCoaching.groupName,
                        address: thisCoaching.address,
                        city: thisCoaching.city,
                        state: thisCoaching.state,
                        pincode: thisCoaching.pincode,
                        logo: thisCoaching.logo,
                        email: emailString,
                        phone: phoneString,
                        mobile: mobileString,
                        website: websiteString,
                    };
                   
                    
                    $scope.spreadSheetCoachings.push(newCenter);

                });
            });
            
            $scope.showSavedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#savedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            
    }]);
        
    exambazaar.controller("suggestCoachingController", 
        [ '$scope', '$http','$state','$rootScope','suggestCoachingService','suggestedList', '$mdDialog', '$timeout', 'thisuser', function($scope, $http, $state, $rootScope, suggestCoachingService, suggestedList, $mdDialog, $timeout, thisuser){
            
            $scope.showSuggestions = true;
            $scope.flipMode = function(){
                $scope.showSuggestions = !$scope.showSuggestions;
            };
            $scope.suggestions = suggestedList.data;
            $scope.user = thisuser.data;
            $scope.suggestion ={
                coachingName: '',
                website: '',
                nCenters: '',
                newCoachingGroup: true,
                
            };
            
            
            
            $scope.saveSuggestion = function(){
                var suggestCoachingForm = {
                    user: $scope.user._id,
                    coachingName: $scope.suggestion.coachingName,
                    website: $scope.suggestion.website,
                    nCenters: $scope.suggestion.nCenters,
                };
                
                suggestCoachingService.savesuggestCoaching(suggestCoachingForm).success(function (data, status, headers) {
                    console.log('Done');
                    $scope.showSavedDialog();
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });       
                
            };
            
            $scope.showSavedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#savedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            $rootScope.pageTitle ='Search & Review Coaching Classes';
            
    }]); 
    
    
    
    exambazaar.factory('CoachingStream', function(targetStudyProviderService) {
      var CoachingStream = function(streamInfo) {
        this.items = [];
        this.busy = false;
        this.finished = false;
        this.skip = 0;
        this.categoryName = streamInfo.categoryName;  
        this.subCategoryName = streamInfo.subCategoryName;  
        this.cityName = streamInfo.cityName;
        this.groupName = null;
      };

      CoachingStream.prototype.nextPage = function() {
        //console.log(this.finished);
        if (this.busy) return;
        if (this.finished) return;
        this.busy = true;
        var streamInfo = {
            skip: this.skip,
            categoryName: this.categoryName,
            subCategoryName: this.subCategoryName,
            cityName: this.cityName,
            groupName: this.groupName,
        };
        targetStudyProviderService.CoachingStream(streamInfo).success(function (data, status, headers) {
            var items = data;
            if(items.length == 0){
                this.finished = true;
            }
            this.items = this.items.concat(items);
            this.skip += items.length;
            this.busy = false;
        }.bind(this))
        .error(function (data, status, header, config) {
            console.log("Error ");
        });  
      };

      return CoachingStream;
    });    
        
    
    exambazaar.factory('SuggestedBlogStream', function(blogpostService) {
      var SuggestedBlogStream = function(streamInfo) {
        this.items = [];
        this.busy = false;
        this.finished = false;
        this.skip = 0;
        this.streamName = streamInfo.categoryName;
        this.examName = streamInfo.subCategoryName;
      };

      SuggestedBlogStream.prototype.nextPage = function() {
        if (this.busy) return;
        if (this.finished) return;
        this.busy = true;
        var streamInfo = {
            skip: this.skip,
            streamName: this.streamName,
            examName: this.examName,
        };
        blogpostService.suggestedblogstream(streamInfo).success(function (data, status, headers) {
            var items = data;
            if(!items || (items && items.length == 0)){
                this.finished = true;
            }
            //console.log(items);
            this.items = this.items.concat(items);
            this.skip += items.length;
            this.busy = false;
        }.bind(this))
        .error(function (data, status, header, config) {
            console.log("Error ");
        });  
      };

      return SuggestedBlogStream;
    });
    
    /*exambazaar.factory('EdBitesStream', function(blogpostService) {
      var EdBitesStream = function() {
        this.items = [];
        this.busy = false;
        this.skip = 0;
      };

      EdBitesStream.prototype.nextPage = function() {
        if (this.busy) return;
        this.busy = true;
        var streamInfo = {
            skip: this.skip
        };
        blogpostService.EdBitesstream(streamInfo).success(function (data, status, headers) {
            var items = data;
            this.items = this.items.concat(items);
            this.skip += items.length;
            this.busy = false;
        }.bind(this))
        .error(function (data, status, header, config) {
            console.log("Error ");
        });  
      };

      return EdBitesStream;
    });
        */    
    exambazaar.factory('EdBitesStream', function(blogpostService) {
      var EdBitesStream = function(streamInfo) {
        this.items = [];
        this.busy = false;
        this.skip = 0;
        this.streamId = streamInfo.streamId;
      };

      EdBitesStream.prototype.nextPage = function() {
        if (this.busy) return;
        this.busy = true;
        var streamInfo = {
            skip: this.skip,
            streamId: this.streamId,
        };
        blogpostService.EdBitesstream(streamInfo).success(function (data, status, headers) {
            var items = data;
            this.items = this.items.concat(items);
            this.skip += items.length;
            this.busy = false;
        }.bind(this))
        .error(function (data, status, header, config) {
            console.log("Error ");
        });  
      };

      return EdBitesStream;
    });
    
    exambazaar.factory('StreamBlogStream', function(blogpostService) {
      var StreamBlogStream = function(streamInfo) {
        this.items = [];
        this.busy = false;
        this.finished = false;
        this.skip = 0;
        //this.streamName = streamInfo.streamName;
        this.streamId = streamInfo.streamId;
      };

      StreamBlogStream.prototype.nextPage = function() {
        if (this.busy) return;
        if (this.finished) return;
        this.busy = true;
        var streamInfo = {
            skip: this.skip,
            //streamName: this.streamName,
            streamId: this.streamId,
        };
        blogpostService.streamblogstream(streamInfo).success(function (data, status, headers) {
            var items = data;
            if(!items || (items && items.length == 0)){
                this.finished = true;
            }
            //console.log(items);
            this.items = this.items.concat(items);
            this.skip += items.length;
            this.busy = false;
        }.bind(this))
        .error(function (data, status, header, config) {
            console.log("Error ");
        });  
      };

      return StreamBlogStream;
    });
    exambazaar.factory('BlogStream', function(blogpostService) {
      var BlogStream = function(streamInfo) {
        this.items = [];
        this.busy = false;
        this.finished = false;
        this.skip = 0;
        this.limit = streamInfo.limit;
        this.streamId = streamInfo.streamId;
        this.included = streamInfo.included;
        this.excluded = streamInfo.excluded;
      };

      BlogStream.prototype.nextPage = function() {
        if (this.busy) return;
        if (this.finished) return;
        this.busy = true;
        var streamInfo = {
            skip: this.skip,
            limit: this.limit,
            streamId: this.streamId,
            included: this.included,
            excluded: this.excluded,
        };
        blogpostService.blogstream(streamInfo).success(function (data, status, headers) {
            var items = data;
            if(!items || (items && items.length == 0)){
                this.finished = true;
            }
            //console.log(items);
            this.items = this.items.concat(items);
            this.skip += items.length;
            this.busy = false;
        }.bind(this))
        .error(function (data, status, header, config) {
            console.log("Error ");
        });  
      };

      return BlogStream;
    });    
    exambazaar.factory('InfographicStream', function(blogpostService) {
      var InfographicStream = function(streamInfo) {
        this.items = [];
        this.busy = false;
        this.finished = false;
        this.skip = 0;
        this.limit = streamInfo.limit;
        this.streamId = streamInfo.streamId;
        this.included = streamInfo.included;
        this.excluded = streamInfo.excluded;
      };

      InfographicStream.prototype.nextPage = function() {
        if (this.busy) return;
        if (this.finished) return;
        this.busy = true;
        var streamInfo = {
            skip: this.skip,
            limit: this.limit,
            streamId: this.streamId,
            included: this.included,
            excluded: this.excluded,
        };
        blogpostService.infographicstream(streamInfo).success(function (data, status, headers) {
            var items = data;
            if(!items || (items && items.length == 0)){
                this.finished = true;
            }
            //console.log(items);
            this.items = this.items.concat(items);
            this.skip += items.length;
            this.busy = false;
        }.bind(this))
        .error(function (data, status, header, config) {
            console.log("Error ");
        });  
      };

      return InfographicStream;
    });     
        
    exambazaar.controller("socialLoginController", 
        [ '$scope', '$http','$state','$rootScope', '$facebook', '$location', '$cookies', 'UserService', 'BlogStream', function($scope, $http, $state, $rootScope, $facebook, $location, $cookies, UserService, BlogStream){
            $scope.reddit = new BlogStream();
            
            
            $rootScope.pageTitle ='Social Login Controller';
            
            $scope.fbLoginStatus = {};
            $scope.user = $cookies.getObject( 'sessionuser');
            $scope.loggedIn = false;
            
            $facebook.getLoginStatus().then(function(response) {
                $scope.fbLoginStatus = response;
            });
            if($scope.user && $scope.user.userId){
                $scope.loggedIn = true; 
                refresh();
            }else{
                $scope.loggedIn = false;
            }
            
            $scope.fblogin = function() {
                //console.log('Loggin into fb');
                $facebook.login().then(function(response) {
                    $scope.fbLoginStatus = response;
                    refresh();
                });   
            };
            var currURL = $location.absUrl();
            currURL = currURL.replace("localhost:8000", "exambazaar.com");
            currURL = "www.exambazaar.com/review";
            //console.log(currURL);
            $scope.fbshare = function() {
                $facebook.ui(
                     {
                      method: 'share',
                      href: currURL,
                      redirect_uri: 'https://www.exambazaar.com/', 
                      hashtag: '#exambazaar',
                      quote: 'Exambazaar: Find best coaching classes in your city for more than 50 exams',
                      display: 'iframe',
                      mobile_iframe: true
                    }, function(response){
                        console.log("Response is: " + response);
                        if(response){
                            alert('Done');
                        }else{
                            alert('Error');
                        }
                    });
            };
            $scope.fbshare2 = function() {
                $http.get('https://www.facebook.com/dialog/share?app_id=1236747093103286&display=popup&href=http%3A%2F%2Fwww.exambazaar.com/review%2F&redirect_uri=http%3A%2F%2Fwww.exambazaar.com/reviewed')
                .success(function(data) {
                    console.log(data)
                })
                .error(function(data) {
                    alert(data);
                    console.log('Error: ' + data);
                });
            };
            $scope.fbfeed = function() {
                $facebook.ui(
                     {
                      method: 'feed',
                      link: 'https://www.exambazaar.com',
                      //redirect_uri: 'https://www.exambazaar.com', 
                      source: 'https://www.exambazaar.com/images/logo/cover.png',
                      //display: 'iframe',
                      //mobile_iframe: true
                    }, function(response){
                        alert(response);
                        console.log("Response is: ");
                        console.log(response);
                        if(response){
                            alert('Done');
                        }else{
                            alert('Error');
                        }
                    });
            };
            $scope.fbInvite = function(){
                
                
                $facebook.ui({
                    method: 'send',
                    name: 'Review your coaching institute at Exambazaar.com',
                    description: 'Be heard and help others by reviewing your coaching institute! As a goodie, unlock discounts from Exambazaar.com',
                    display: 'popup',
                    link: currURL
                },function(response) {
                    if (response) {
                        alert('Successfully Invited');
                    } else {
                        alert('Failed To Invite');
                    }
                });
            };
            
            function refresh() {
                $facebook.api("/me", {fields: 'id, name, age_range, link, gender, picture, email'}).then(
                    function(response) {
                        //console.log($scope.user);
                        
                        if($scope.user && $scope.user.userId){
                            //link the user's fb id to the current user
                            $scope.user.fbuser = {
                                name: response.name,
                                gender: response.gender,
                                image: response.picture.data.url,
                                email: response.email,
                                facebook: {
                                    link: response.link,
                                    id: response.id,
                                }
                            };
                            
                            
                        }else{
                            $scope.user = {};
                            $scope.user.fbuser = {
                                name: response.name,
                                gender: response.gender,
                                image: response.picture.data.url,
                                email: response.email,
                                facebook: {
                                    link: response.link,
                                    id: response.id,
                                }
                            };
                            //add a new user with facebook id
                        }
                        
                    },
                    function(err) {
                        $scope.welcomeMsg = "Please log in";
                        $scope.isLoggedIn = false;
                });
                $facebook.api("/me/permissions").then(
                    function(response) {
                        //console.log(response);
                        $scope.permissions = response;
                    },
                    function(err) {
                    $scope.welcomeMsg = "Permissions Error";
                });
                
            };

            //console.log($scope.user);
            
            $scope.$watch('[fbLoginStatus.status, user.fbuser.facebook.id]', function (newValue, oldValue, scope) {
                //console.log(newValue);
            if(newValue[0] == 'connected' && newValue[1]){
                $scope.fbUser = true;
                $scope.user.fbuser.facebook.accessToken = $scope.fbLoginStatus.authResponse.accessToken;
                if(!$scope.user.facebookId){
                    UserService.fbSave($scope.user).success(function (data, status, headers) {
                        
                        var fulluser = data;
                        console.log(fulluser);
                        var sessionuser = {
                            userId: fulluser._id,
                            facebookId: fulluser.facebookId,
                            userType: fulluser.userType,
                            basic: fulluser.basic,
                            image: fulluser.image,
                            mobile: fulluser.mobile,
                            email: fulluser.email,

                        };
                        $cookies.putObject('sessionuser', sessionuser);
                        $scope.user = sessionuser;
                        
                        console.log(sessionuser.userType);
                        
                        if(sessionuser.userType =='Master'){  
                            $state.go('master-dashboard', {masterId: sessionuser.userId});
                        }
                        if(sessionuser.userType =='Intern - Business Development'){
                             $state.go('assigned', {userId: sessionuser.userId});
                        }
                        if(sessionuser.userType =='Student'){
                            $state.reload();
                        }
                        if(sessionuser.userType =='Partner'){
                            $state.go('partner-dashboard', {userId: sessionuser.userId});
                        }
                        
                        
                        //$state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                }
                
                
                
                
            }

            }, true);
            
            
            
            
    }]);
    
        
     
        
    exambazaar.controller("contactsController", 
        [ '$scope', '$http','$state','$rootScope', '$facebook', '$location', '$cookies', 'targetStudyProviderService', 'contactsSummary', function($scope, $http, $state, $rootScope, $facebook, $location, $cookies, targetStudyProviderService, contactsSummary){
            $scope.contacts = contactsSummary.data;
            console.log($scope.contacts);
            $scope.sanitizeMobiles = function(){
                targetStudyProviderService.sanitizeMobiles().success(function (data, status, headers) {
                    console.log('Mobiles sanitized');
                    console.log(data);
                    
                })
                .error(function (data, status, header, config) {
                    console.log();
                });    
            };
            
    }]);
      
    exambazaar.controller("aroundmeController", 
        [ '$scope', '$http','$state','$rootScope', '$location', '$cookies', 'UserService', 'targetStudyProviderService', 'NgMap', '$mdDialog', '$timeout', 'examList', 'streamList', '$geolocation', 'Notification', 'viewService','MasterService', function($scope, $http, $state, $rootScope, $location, $cookies, UserService, targetStudyProviderService, NgMap, $mdDialog, $timeout, examList, streamList, $geolocation, Notification, viewService, MasterService){
            $scope.allExams = examList.data;
            $scope.allStreams = streamList.data;
            
            $scope.masterUser = false;
            
            $rootScope.pageTitle ='Find Coaching Classes around you!';
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
                if($scope.user.userType == 'Master'){
                    $scope.masterUser = true;
                }
            }else{
                $scope.user = null;
            }
            
            $scope.toPdf = function(){
                var doc = new jsPDF({
                  orientation: 'landscape',
                  
                });

                doc.text('Hello world!', 35, 25);
                doc.text('Hello world2!', 35, 25);
                doc.save('two-by-four.pdf');
            };
            var viewForm = {
                state: $state.current.name,
                claim: false,
                url: $location.url()
            };
            if($scope.user && $scope.user.userId){
                viewForm.user = $scope.user.userId;
            }
            //console.log(JSON.stringify(viewForm));
            if($cookies.getObject('ip')){
                var ip = $cookies.getObject('ip');
                viewForm.ip = ip;
            }
            viewService.saveview(viewForm).success(function (data, status, headers) {
                //console.log('View Marked');
            })
            .error(function (data, status, header, config) {
                console.log();
            });
            
            $scope.setLocofAll = function(){
                targetStudyProviderService.setLocOfAll().success(function (data, status, headers) {
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });   
            };
            
            $scope.googlePlaces = function(){
                MasterService.googlePlaces().success(function (data, status, headers) {
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });   
            };
            
            $scope.bulkSaveLatLng = function(){
                MasterService.bulkSaveLatLng().success(function (data, status, headers) {
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });   
            };
            $scope.latLngSummary = function(){
                MasterService.latLngSummary().success(function (data, status, headers) {
                    console.log(data);
                    $scope.coachings = data;
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });   
            };
            
            NgMap.getMap().then(function(map) {
                //console.log('map', map);
                $scope.map = map;
            });
            $scope.goToCoaching = function(provider){
                var coachingForm = {
                    _id: provider._id 
                };
                targetStudyProviderService.showGroupHelperById(coachingForm).success(function (data, status, headers) {
                        var examStream = data;
                        if($scope.searchExams.length > 0){
                            var firstExamId = $scope.searchExams[0].toString();
                            var allExamIds = $scope.allExams.map(function(a) {return a._id.toString();});
                            var fIndex = allExamIds.indexOf(firstExamId);
                            if(fIndex != -1){
                                var firstExam = $scope.allExams[fIndex];
                                if(firstExam && firstExam.name){
                                    examStream.exam = firstExam.name;
                                }
                                if(firstExam && firstExam.stream && firstExam.stream.name){
                                    examStream.stream = firstExam.stream.name;
                                }
                            }   
                        }
                        var url = $state.href('showGroup', {categoryName: examStream.stream, subCategoryName: examStream.exam, cityName: examStream.city, groupName: examStream.groupName});
                        window.open(url, '_top');//,'_blank'
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
            };
            function reverseGeocodeUser(lat, lng){
                var geocoder = new google.maps.Geocoder();
                var latlng = new google.maps.LatLng(lat, lng);
                geocoder.geocode({ 'latLng': latlng }, function (results, status){
                    if (status == google.maps.GeocoderStatus.OK) {
                    if (results[1]) {
                        var gResults = results[1].address_components;
                        var userAddress = {
                            sublocality_level_2: null,    
                            sublocality: null,    
                            city: null,    
                            state: null,    
                            country: null,    
                        };
                        
                        //console.log(gResults);    
                        gResults.forEach(function(thisComp, cindex){
                        var cTypes = thisComp.types;
                         
                        if(cTypes.indexOf("sublocality_level_2") != -1){
                            userAddress.sublocality_level_2 = thisComp.long_name;
                        } 
                        if(cTypes.indexOf("sublocality_level_1") != -1){
                            userAddress.sublocality = thisComp.long_name;
                        }    
                        if(cTypes.indexOf("administrative_area_level_2") != -1){
                            userAddress.city = thisComp.long_name;
                        }
                        if(cTypes.indexOf("administrative_area_level_1") != -1){
                            userAddress.state = thisComp.long_name;
                        }
                        if(cTypes.indexOf("country") != -1){
                            userAddress.country = thisComp.long_name;
                        }
                        });
                           
                        //console.log(userAddress);
                        if(userAddress.sublocality && userAddress.city){
                           Notification.success("Great, we have located you at " + userAddress.sublocality + ", " + userAddress.city);
                           
                        }
                        
                            
                        //console.log(results[1].formatted_address);
                        } else {
                            console.log('Location not found');
                        }
                    } else {
                        console.log('Geocoder failed due to: ' + status);
                    }
                });
            };
            function latlngfromIP(){
                if($cookies.getObject('ip')){
                    var thisIP = $cookies.getObject('ip');
                    console.log("Using IP to geolocate user");
                    console.log(thisIP);
                    $scope.currLocation = [thisIP.lat, thisIP.long];
                    Notification.warning("Exambazaar couldn't locate you with accuracy");
                }    
            };
            
            $scope.$watch('currLocation', function (newValue, oldValue, scope) {
                if(newValue != null && newValue != ''){
                    reverseGeocodeUser(newValue[0], newValue[1]);
                }
            }, true);
            if (navigator.geolocation) {
              var timeoutVal = 10 * 1000 * 1000;
              navigator.geolocation.getCurrentPosition(
                displayPosition, 
                displayError,
                { enableHighAccuracy: true, timeout: timeoutVal, maximumAge: 0 }
              );
            }
            else {
              alert("Geolocation is not supported by your browser");
                //use ip info
            }

            function displayPosition(position) {
                $scope.currLocation = [position.coords.latitude, position.coords.longitude];
                //$scope.currLocation = [13.029595, 77.569381];
                //$scope.currLocation = [18.935322, 72.825932];
                //$scope.currLocation = [31.633979, 74.872264];
                //$scope.currLocation = [28.515623, 77.250452];
                //$scope.currLocation = [28.576849, 77.161944];
                //$scope.currLocation = [19.056719, 72.828877];
                //$scope.currLocation = [28.917227, 77.064013];
                //$scope.currLocation = [28.486915, 77.507298];
                //$scope.currLocation = [12.823035, 80.043792];
                //$scope.currLocation = [28.688274, 77.205712];
                //$scope.currLocation = [26.277995, 73.011094];
                //$scope.currLocation = [17.413502, 78.528736];
                //$scope.currLocation = [24.434886, 77.161200];
                //$scope.currLocation = [17.318687, 78.543050];
                //$scope.currLocation = [13.046689, 80.253591];
            }
            function displayError(error) {
              var errors = { 
                1: 'Permission denied',
                2: 'Position unavailable',
                3: 'Request timeout'
              };
              console.log("Error: " + errors[error.code]);
                //use ip info
                latlngfromIP();
            }
            
            $scope.showProvider = function(event, provider){
                $scope.activeProvider = provider;
                if(!provider.logo || provider.logo == ''){
                    $scope.activeProvider.logo = '';
                }
                $scope.map.showInfoWindow('foo-iw', $scope.activeProvider._id);
            };
            
            $scope.hideDetail = function() {
                $scope.map.hideInfoWindow('foo-iw');
            };
            $scope.onDragEnd = function (marker, $event) {
                var lat = marker.latLng.lat();
                var lng = marker.latLng.lng();
                $scope.currLocation = [lat, lng];
                //console.log($scope.currLocation);
                /*var geocoder = new $event.google.maps.Geocoder();
                geocoder.geocode({
                    'latLng': new $event.google.maps.LatLng(lat, lng)
                }, function (results, status) {
                    if (status === google.maps.GeocoderStatus.OK) {
                        if (results[0]) {
                            // @url: https://developers.google.com/maps/documentation/javascript/geocoding#ReverseGeocoding
                            // We return the second result, which is less specific than the first
                            //  (in this case, a neighborhood name)
                            var formatted_address = results[0].formatted_address;
                            $timeout(function () {
                                $scope.address = formatted_address;
                            }, 300);
                        } else {
                            alert('No results found');
                        }
                    } else {
                        alert('Geocoder failed due to: ' + status);
                    }
                });*/
            };
            $scope.getCurrentlocation = function(e) {
                $scope.currLocation = [e.latLng.lat(), e.latLng.lng()];
                
                
            };
            $scope.setSearchDistance = function(distance){
                $scope.searchDistance = distance;
            };
            $scope.searchDistance = 5;
            $scope.searchDistances = [1, 5, 10, 20, 50];
            $scope.searchExams = [];
            $scope.aroundme = function(){
                $mdDialog.hide();
                Notification.clearAll();
                //console.log($scope.searchExams);
                
                var queryForm = {
                    latlng: {
                        lat: $scope.currLocation[0],
                        lng: $scope.currLocation[1],
                    },
                    distanceinKm: $scope.searchDistance,
                    examArray: $scope.searchExams,
                };
                
                
                targetStudyProviderService.aroundme(queryForm).success(function (data, status, headers) {
                    $scope.providers = data;
                    
                    if($scope.providers.length > 0){
                        $scope.providers.forEach(function(thisProvider, index){
                            thisProvider.mapLatLng = [thisProvider.loc.coordinates[1], thisProvider.loc.coordinates[0]]
                        });
                        var latLngs = $scope.providers.map(function(a) {return a.mapLatLng;});
                        zoomToIncludeMarkers(latLngs);
                        Notification.success({message: "We found " + $scope.providers.length + " coaching classes within " + $scope.searchDistance + " kms of your location!", delay: 20000});
                        
                    }else{
                        Notification.error({message: 'Sorry we found no coaching classes around you!', delay: 20000});
                    }
                    
                    
                    //Notification.error({message: 'Error notification 1s', delay: 1000});
                    //console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            };
            
            $scope.showExamDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#examDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            
            $scope.closeDialog = function(){
                $mdDialog.hide();
            };
            
            $scope.addExam = function(thisExam){
                if(!$scope.searchExams){
                    $scope.searchExams = [];
                }
                var eIndex = $scope.searchExams.indexOf(thisExam._id);
                if(eIndex == -1){
                    $scope.searchExams.push(thisExam._id);
                }else{
                    //exam already exists
                }
            };
            
            $scope.removeExam = function(thisExam){
                if(!$scope.searchExams){
                    //do nothing
                }else{
                    var eIndex = $scope.searchExams.indexOf(thisExam._id);
                    if(eIndex == -1){
                        //do nothing
                    }else{
                         $scope.searchExams.splice(eIndex, 1);
                    }
                }
            };
            
            function zoomToIncludeMarkers(markers) {
                markers.push($scope.currLocation);
                var bounds = new google.maps.LatLngBounds();
                markers.forEach(function(thisMarker, mindex){
                    var latlng = new google.maps.LatLng(thisMarker[0], thisMarker[1]);
                    bounds.extend(latlng);
                    
                });
                
                
                NgMap.getMap().then(function(map) {
                    //vm.map = map;
                    map.setCenter(bounds.getCenter());
                    map.fitBounds(bounds);
                    //map.setZoom(4);
                });
            };
         
            
            $scope.$on('$locationChangeStart', function( event ) {
                var answer = confirm("Are you sure you want to leave this page?")
                if (!answer) {
                    event.preventDefault();
                }
            });
            
    }]); 
    
    exambazaar.controller("chartingController", 
        [ '$scope', '$http','$state','$rootScope', '$facebook', '$location', '$cookies', 'UserService', 'viewSummary', 'viewHourlyHeatmap', 'userSummary', 'userHourlyHeatmap', 'providerSummary', 'reviewSummary', 'blogDailySummary', function($scope, $http, $state, $rootScope, $facebook, $location, $cookies, UserService, viewSummary, viewHourlyHeatmap, userSummary, userHourlyHeatmap, providerSummary, reviewSummary, blogDailySummary){
            
            $rootScope.pageTitle ='Charting Sandbox';
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
            }else{
                $scope.user = null;
            }
            $scope.charts = [];
            
            var summaryData = viewSummary.data;
            $scope.viewSummary = [];
            summaryData.forEach(function(thisDay, vindex){
                var newDayData = {
                    date: new Date(thisDay._id.year, thisDay._id.month-1, thisDay._id.day),
                    views: thisDay.count,
                };
                $scope.viewSummary.push(newDayData);
            });
            $scope.viewSummary.sort(function(a,b){
              return new Date(a.date) - new Date(b.date);
            });
            var views = $scope.viewSummary.map(function(a) {return a.views;});
            $scope.viewoptions = {
                scales: {
                  yAxes: [
                    {
                      id: 'y-axis-1',
                      type: 'linear',
                      display: true,
                      position: 'right'
                    },
                  ]
                },
                title: {
                    display: true,
                    text: 'EB Views per day'
                }
            };
            var newChart = {
                labels: $scope.viewSummary.map(function(a) {return moment(a.date).format('DD MMM YY');}),
                series: ['Views'],
                data: [views],
                datasetOverride: [{ yAxisID: 'y-axis-1' }],
                options: $scope.viewoptions
            };
            $scope.charts.push(newChart);
            
            
            
            
            
            var summaryData = userSummary.data;
            $scope.userSummary = [];
            summaryData.forEach(function(thisDay, vindex){
                var newDayData = {
                    date: new Date(thisDay._id.year, thisDay._id.month-1, thisDay._id.day),
                    users: thisDay.count,
                };
                $scope.userSummary.push(newDayData);
            });
            $scope.userSummary.sort(function(a,b){
              return new Date(a.date) - new Date(b.date);
            });
            var users = $scope.userSummary.map(function(a) {return a.users;});
            $scope.useroptions = {
                scales: {
                  yAxes: [
                    {
                      id: 'y-axis-1',
                      type: 'linear',
                      display: true,
                      position: 'right'
                    },
                  ]
                },
                title: {
                    display: true,
                    text: 'EB Users per day'
                }
            };
            newChart = {
                labels: $scope.userSummary.map(function(a) {return moment(a.date).format('DD MMM YY');}),
                series: ['Users'],
                data: [users],
                datasetOverride: [{ yAxisID: 'y-axis-1' }],
                options: $scope.useroptions
            };
            $scope.charts.push(newChart);
            
            
            
            var summaryData = providerSummary.data;
            $scope.providerSummary = [];
            summaryData.forEach(function(thisDay, vindex){
                var newDayData = {
                    date: new Date(thisDay._id.year, thisDay._id.month-1, thisDay._id.day),
                    providers: thisDay.count,
                };
                if(thisDay._id.month>2  || thisDay._id.year>2017){
                    $scope.providerSummary.push(newDayData);
                }
                
            });
            $scope.providerSummary.sort(function(a,b){
              return new Date(a.date) - new Date(b.date);
            });
            var providers = $scope.providerSummary.map(function(a) {return a.providers;});
            $scope.provideroptions = {
                scales: {
                  yAxes: [
                    {
                      id: 'y-axis-1',
                      type: 'linear',
                      display: true,
                      position: 'right'
                    },
                  ]
                },
                title: {
                    display: true,
                    text: 'EB Providers added per day'
                }
            };
            newChart = {
                labels: $scope.providerSummary.map(function(a) {return moment(a.date).format('DD MMM YY');}),
                series: ['Providers'],
                data: [providers],
                datasetOverride: [{ yAxisID: 'y-axis-1' }],
                options: $scope.provideroptions
            };
            $scope.charts.push(newChart);
            
            
            var summaryData = reviewSummary.data;
            $scope.reviewSummary = [];
            summaryData.forEach(function(thisDay, vindex){
                var newDayData = {
                    date: new Date(thisDay._id.year, thisDay._id.month-1, thisDay._id.day),
                    reviews: thisDay.count,
                };
                if(thisDay._id.month>2 || thisDay._id.year>2017){
                    $scope.reviewSummary.push(newDayData);
                }
                
            });
            $scope.reviewSummary.sort(function(a,b){
              return new Date(a.date) - new Date(b.date);
            });
            var reviews = $scope.reviewSummary.map(function(a) {return a.reviews;});
            $scope.reviewoptions = {
                scales: {
                  yAxes: [
                    {
                      id: 'y-axis-1',
                      type: 'linear',
                      display: true,
                      position: 'right'
                    },
                  ]
                },
                title: {
                    display: true,
                    text: 'EB Reviews added per day'
                }
            };
            newChart = {
                labels: $scope.reviewSummary.map(function(a) {return moment(a.date).format('DD MMM YY');}),
                series: ['Review'],
                data: [reviews],
                datasetOverride: [{ yAxisID: 'y-axis-1' }],
                options: $scope.reviewoptions
            };
            $scope.charts.push(newChart);
            
            
            
            
            var summaryData = viewHourlyHeatmap.data;
            $scope.viewHourlyHeatmapSummary = [];
            summaryData.forEach(function(thisHour, vindex){
                var newHourData = {
                    hour: (thisHour._id.hour + 5) % 24,
                    views: thisHour.count,
                };
                $scope.viewHourlyHeatmapSummary.push(newHourData);
            });
            $scope.viewHourlyHeatmapSummary.sort(function(a,b){
              return new Date(a.hour) - new Date(b.hour);
            });
            var views = $scope.viewHourlyHeatmapSummary.map(function(a) {return a.views;});
            $scope.viewoptions = {
                scales: {
                  yAxes: [
                    {
                      id: 'y-axis-1',
                      type: 'linear',
                      display: true,
                      position: 'right'
                    },
                  ]
                },
                title: {
                    display: true,
                    text: 'EB Views based on time of day'
                }
            };
            newChart = {
                labels: $scope.viewHourlyHeatmapSummary.map(function(a) {return a.hour;}),
                series: ['Views'],
                data: [views],
                datasetOverride: [{ yAxisID: 'y-axis-1' }],
                options: $scope.viewoptions
            };
            $scope.charts.push(newChart);
            
            
            var summaryData = userHourlyHeatmap.data;
            $scope.userHourlyHeatmapSummary = [];
            summaryData.forEach(function(thisHour, vindex){
                var newHourData = {
                    hour: (thisHour._id.hour + 5) % 24,
                    users: thisHour.count,
                };
                $scope.userHourlyHeatmapSummary.push(newHourData);
            });
            $scope.userHourlyHeatmapSummary.sort(function(a,b){
              return new Date(a.hour) - new Date(b.hour);
            });
            var users = $scope.userHourlyHeatmapSummary.map(function(a) {return a.users;});
            $scope.useroptions = {
                scales: {
                  yAxes: [
                    {
                      id: 'y-axis-1',
                      type: 'linear',
                      display: true,
                      position: 'right'
                    },
                  ]
                },
                title: {
                    display: true,
                    text: 'New Users added based on time of day'
                }
            };
            newChart = {
                labels: $scope.userHourlyHeatmapSummary.map(function(a) {return a.hour;}),
                series: ['Users'],
                data: [users],
                datasetOverride: [{ yAxisID: 'y-axis-1' }],
                options: $scope.useroptions
            };
            $scope.charts.push(newChart);
            
            
            var blogSummaryData = blogDailySummary.data;
            $scope.blogSummaryData = [];
            blogSummaryData.forEach(function(thisDay, vindex){
                var newDayData = {
                    date: new Date(thisDay._id.year, thisDay._id.month-1, thisDay._id.day),
                    views: thisDay.count,
                };
                $scope.blogSummaryData.push(newDayData);
            });
            $scope.blogSummaryData.sort(function(a,b){
              return new Date(a.date) - new Date(b.date);
            });
            var views = $scope.blogSummaryData.map(function(a) {return a.views;});
            $scope.viewoptions = {
                scales: {
                  yAxes: [
                    {
                      id: 'y-axis-1',
                      type: 'linear',
                      display: true,
                      position: 'right'
                    },
                  ]
                },
                title: {
                    display: true,
                    text: 'Blog Views per day'
                }
            };
            var newChart = {
                labels: $scope.blogSummaryData.map(function(a) {return moment(a.date).format('DD MMM YY');}),
                series: ['Views'],
                data: [views],
                datasetOverride: [{ yAxisID: 'y-axis-1' }],
                options: $scope.viewoptions
            };
            $scope.charts.push(newChart);
            
    }]);     
    function getRandomInt(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
    }
    exambazaar.controller("blogController", 
        [ '$scope', '$http','$state','$rootScope', '$facebook', '$location', '$cookies','$mdDialog', '$document', 'pageTimer', 'blogpostService', 'Socialshare', 'viewService', 'upvoteService', 'allBlogsUpvotesCount', 'BlogStream', 'InfographicStream', 'EdBitesStream', 'streamList', function($scope, $http, $state, $rootScope, $facebook, $location, $cookies, $mdDialog, $document, pageTimer, blogpostService, Socialshare, viewService, upvoteService, allBlogsUpvotesCount, BlogStream, InfographicStream, EdBitesStream, streamList){
            //$scope.allBlogs = allBlogs.data;
            var allStreams = streamList.data;
            $scope.allStreams = [];
            var excludedStreams = ['other', 'insurance'];
            allStreams.forEach(function(thisStream, index){
                if(excludedStreams.indexOf(thisStream.name) == -1){
                    $scope.allStreams.push(thisStream);
                }
            });
            
            $scope.goToBlog = function(blog){
                var url = $state.href('showblog', {blogpostSlug: blog.urlslug});
                window.open(url,'_blank');  
            };
            $scope.goToBlogInfographic = function(blog){
                var url = $state.href('showblog', {blogpostSlug: blog.urlslug,'#': 'Infographic'});
                window.open(url,'_blank');  
            };
            
            
            $scope.filterStream = null;
            var streamInfo = {
                //streamName: 'Engineering',
                streamId: null//'58ac21ec144a140ee0fe62f1',
            };
            
            var InspirationStreamInfo = {
                streamId: null,
                excluded: ['Top 10 Online', 'Best Books', 'Exam Page', 'Best Schools', 'Degrees', 'Expert Reviews', 'EdBites', 'Build Resume', 'Job', 'Career', 'Exam Preparation' ],
                limit: 3,
            };
            var ExamPreparationStreamInfo = {
                streamId: null,
                included: ['Top 10 Online', 'Best Books', 'Exam Page', 'Exam Preparation' ],
                limit: 3,
            };
            var InformationStreamInfo = {
                streamId: null,
                included: ['Best Schools', 'Degrees'],
                limit: 3,
            };
            var BestCoachingStreamInfo = {
                streamId: null,
                included: ['Expert Reviews'],
                limit: 3,
            };
            var ResumeStreamInfo = {
                streamId: null,
                included: ['Build Resume', 'Job', 'Career'],
                limit: 3,
            };
            var EdbitesStreamInfo = {
                streamId: null,
                included: ['EdBites'],
                limit: 3,
            };
            var InforgraphicStreamInfo = {
                streamId: null,
                excluded: [],
                limit: 3,
            };
            
            
            var refreshAll = function(){
                $scope.InspirationBlogs = new BlogStream(InspirationStreamInfo);
                $scope.ExamPreparationBlogs = new BlogStream(ExamPreparationStreamInfo);
                $scope.InformationBlogs = new BlogStream(InformationStreamInfo);
                $scope.BestCoachingBlogs = new BlogStream(BestCoachingStreamInfo);
                $scope.ResumeBlogs = new BlogStream(ResumeStreamInfo);
                
                $scope.allEdbites = new BlogStream(EdbitesStreamInfo);
                $scope.allInfographics = new InfographicStream(InforgraphicStreamInfo);

                $scope.InspirationBlogs.nextPage();
                $scope.ExamPreparationBlogs.nextPage();
                $scope.InformationBlogs.nextPage();
                $scope.BestCoachingBlogs.nextPage();
                $scope.ResumeBlogs.nextPage();
                $scope.allEdbites.nextPage();
                $scope.allInfographics.nextPage();
                
                //console.log($scope.allInfographics);
            };
            refreshAll();
            $scope.setStream = function(stream){
                $scope.blogStream = stream;
                
                EdbitesStreamInfo.streamId = stream._id;
                InspirationStreamInfo.streamId = stream._id;
                ExamPreparationStreamInfo.streamId = stream._id;
                InformationStreamInfo.streamId = stream._id;
                BestCoachingStreamInfo.streamId = stream._id;
                InforgraphicStreamInfo.streamId = stream._id;
                //ResumeStreamInfo.streamId = stream._id;
                
                refreshAll();
            };
            $scope.clearStream = function(){
                $scope.blogStream = null;
                InspirationStreamInfo.streamId = null;
                ExamPreparationStreamInfo.streamId = null;
                InformationStreamInfo.streamId = null;
                BestCoachingStreamInfo.streamId = null;
                //ResumeStreamInfo.streamId = null;
                EdbitesStreamInfo.streamId = null;
                InforgraphicStreamInfo.streamId = null;
                
                refreshAll();
            };
            
            $scope.loadNextEdBitesBlogs = function(){
                $scope.allEdbites.nextPage();
            };
            $scope.loadNextInfographics = function(){
                $scope.allInfographics.nextPage();
            };
            $scope.loadNextInspirationBlogs = function(){
                $scope.InspirationBlogs.nextPage();
            };
            $scope.loadNextExamPreparationBlogs = function(){
                $scope.ExamPreparationBlogs.nextPage();
            };
            $scope.loadNextInformationBlogs = function(){
                $scope.InformationBlogs.nextPage();
            };
            $scope.loadNextBestCoachingBlogs = function(){
                $scope.BestCoachingBlogs.nextPage();
            };
            $scope.loadNextResumeBlogs = function(){
                $scope.ResumeBlogs.nextPage();
            };
            
            $scope.buttonCSS = function(stream){
                if(InspirationStreamInfo.streamId && stream._id == InspirationStreamInfo.streamId){
                    return('md-danger');
                }else{
                    return('md-next');
                }
            };
            
            
            
            var allBlogsUpvotesCount = allBlogsUpvotesCount.data;
            var blogUpvotesId = allBlogsUpvotesCount.map(function(a) {return a.blogpost;});
            
            $scope.$watch('InspirationBlogs.items', function (newValue, oldValue, scope) {
                if(newValue != null && newValue.length > 0){
                     $scope.InspirationBlogs.items.forEach(function(thisBlog, index){
                        var bIndex = blogUpvotesId.indexOf(thisBlog._id);
                        //console.log(bIndex);

                        if(!thisBlog.upvotes){
                            if(bIndex == -1){
                                thisBlog.upvotes = 0;
                            }else{
                                thisBlog.upvotes = allBlogsUpvotesCount[bIndex].upvotes;
                            }
                        }

                    });
                    
                }

            }, true);
            $scope.$watch('ExamPreparationBlogs.items', function (newValue, oldValue, scope) {
                if(newValue != null && newValue.length > 0){
                     $scope.ExamPreparationBlogs.items.forEach(function(thisBlog, index){
                        var bIndex = blogUpvotesId.indexOf(thisBlog._id);
                        //console.log(bIndex);

                        if(!thisBlog.upvotes){
                            if(bIndex == -1){
                                thisBlog.upvotes = 0;
                            }else{
                                thisBlog.upvotes = allBlogsUpvotesCount[bIndex].upvotes;
                            }
                        }

                    });
                    
                }

            }, true);
            $scope.$watch('InformationBlogs.items', function (newValue, oldValue, scope) {
                if(newValue != null && newValue.length > 0){
                     $scope.InformationBlogs.items.forEach(function(thisBlog, index){
                        var bIndex = blogUpvotesId.indexOf(thisBlog._id);
                        //console.log(bIndex);

                        if(!thisBlog.upvotes){
                            if(bIndex == -1){
                                thisBlog.upvotes = 0;
                            }else{
                                thisBlog.upvotes = allBlogsUpvotesCount[bIndex].upvotes;
                            }
                        }

                    });
                    
                }

            }, true);
            $scope.$watch('BestCoachingBlogs.items', function (newValue, oldValue, scope) {
                if(newValue != null && newValue.length > 0){
                     $scope.BestCoachingBlogs.items.forEach(function(thisBlog, index){
                        var bIndex = blogUpvotesId.indexOf(thisBlog._id);
                        //console.log(bIndex);

                        if(!thisBlog.upvotes){
                            if(bIndex == -1){
                                thisBlog.upvotes = 0;
                            }else{
                                thisBlog.upvotes = allBlogsUpvotesCount[bIndex].upvotes;
                            }
                        }

                    });
                    
                }

            }, true);
            
            $scope.$watch('ResumeBlogs.items', function (newValue, oldValue, scope) {
                if(newValue != null && newValue.length > 0){
                     $scope.ResumeBlogs.items.forEach(function(thisBlog, index){
                        var bIndex = blogUpvotesId.indexOf(thisBlog._id);
                        //console.log(bIndex);

                        if(!thisBlog.upvotes){
                            if(bIndex == -1){
                                thisBlog.upvotes = 0;
                            }else{
                                thisBlog.upvotes = allBlogsUpvotesCount[bIndex].upvotes;
                            }
                        }

                    });
                    
                }

            }, true);
            
            $scope.addedUpvoteIds = [];
            $scope.userUpvotes = [];
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
                upvoteService.blogpostUserUpvotes($scope.user._id).success(function (data, status, headers) {
                    $scope.userUpvotes = data;
                })
                .error(function (data, status, header, config) {
                    console.log();
                });
                
            }else{
                
            }
            
            $scope.upvoteExists = function(blogpost){
                var uIndex = $scope.userUpvotes.indexOf(blogpost._id);
                if(uIndex == -1){
                    return false;
                }else{
                    return true;
                }
            };
            
            $scope.saveupvote = function(blogpost){
                var upvoteForm = {
                    blogpost: blogpost._id,
                };
                if($scope.user && $scope.user._id){
                    upvoteForm.user = $scope.user._id;
                }
                upvoteService.saveupvote(upvoteForm).success(function (savedata, status, headers) {    
                    upvoteService.blogpostUpvoteCount(blogpost.urlslug).success(function (data, status, headers) {
                         $scope.userUpvotes.push(blogpost._id);
                         blogpost.upvotes = data;

                    })
                    .error(function (data, status, header, config) {
                        console.log();
                    });
                })
                .error(function (data, status, header, config) {
                    console.log();
                });
            };
            
            $scope.removeupvote = function(blogpost){
                if($scope.user && $scope.user._id){
                    var removeupvoteForm = {
                        blogpost: blogpost._id,
                        user: $scope.user._id,
                    };
                     upvoteService.removeupvote(removeupvoteForm).success(function (data, status, headers) {
                        upvoteService.blogpostUpvoteCount(blogpost.urlslug).success(function (sdata, status, headers) {    
                         upvoteService.blogpostUserUpvotes($scope.user._id).success(function (data, status, headers) {
                                $scope.userUpvotes = data;
                                blogpost.upvotes = sdata;
                            })
                            .error(function (data, status, header, config) {
                                console.log();
                            });

                        })
                        .error(function (data, status, header, config) {
                            console.log();
                        });
                    })
                    .error(function (data, status, header, config) {
                        console.log();
                    });   
                }
            };
            
            //var defaultBlogCovers = ["images/blog/blogcover2.jpg"];
            var defaultBlogCovers = ["images/blog/eb-blog-cover-1.jpg"];
            //var defaultBlogCovers = ["images/blog/cover20dec.jpg"];
            //var defaultBlogCovers = ["images/blog/cover2.jpg"];
            //"images/blog/blog-cover-7.jpg","images/blog/background.jpg"
            var rIndex = getRandomInt(0, defaultBlogCovers.length);
            var defaultBlogCover = defaultBlogCovers[rIndex];
            $scope.thisBlogCover = defaultBlogCover;
            
            $scope.shareText = "Hi! Read the exam preparation blog at Exambazaar! ";
            $scope.shareText2 = $scope.shareText;
            $scope.currURL = $location.absUrl();
            $scope.prefix = "https://exambazaar.com/blogpost/";
            $scope.shareURL = function(blogpost){
                return ($scope.prefix + blogpost.urlslug);
            };
            $scope.shareBlogText = function(blogpost){
                return ('"' + blogpost.title + '"' + " | Read all about exam preparation ");
            };
            $scope.postFacebook = function(blogpost){
                Socialshare.share({
                  'provider': 'facebook',
                  'attrs': {
                    'socialshareType': 'feed',
                    'socialshareUrl': $scope.shareURL(blogpost),
                    'socialshareVia':"1236747093103286",  'socialshareRedirectUri': 'https://www.exambazaar.com',
                  }
                });    
            };
            $scope.shareFacebook = function(){
                Socialshare.share({
                  'provider': 'facebook',
                  'attrs': {
                    'socialshareType': 'send',
                    'socialshareUrl': $scope.currURL,
                    'socialshareVia':"1236747093103286",  'socialshareRedirectUri': 'https://www.exambazaar.com',
                  }
                });
            };
           
            
            $rootScope.pageTitle = "Blog | Exambazaar resources for all exams in India";
            $rootScope.pageImage = $scope.thisBlogCover;
            
            $scope.goToBlog = function(blog){
                var url = $state.href('showblog', {blogpostSlug: blog.urlslug});
                window.open(url,'_blank');  
            };
            
            var viewForm = {
                state: $state.current.name,
                claim: false,
                url: $location.url()
            };
            if($scope.user && $scope.user.userId){
                viewForm.user = $scope.user.userId
            }
            //console.log(JSON.stringify(viewForm));
            if($cookies.getObject('ip')){
                var ip = $cookies.getObject('ip');
                viewForm.ip = ip;
            }
            viewService.saveview(viewForm).success(function (data, status, headers) {
                //console.log('View Marked');
            })
            .error(function (data, status, header, config) {
                console.log();
            });
            
            /*$document.on('mouseleave', leaveFromTop);
            function leaveFromTop(e){
                if( e.clientY < 0 && !$rootScope.fblikeDialog && $scope.t.counts > 10){
                    //console.log($rootScope.fblikeDialog);
                    $rootScope.showfblikeDialog();
                }
                //console.log($scope.t.counts);
            };
            $scope.t = pageTimer(1000);*/
            
            
    }]);   
    
    exambazaar.controller("activeUsersController", 
        [ '$scope', 'thisuser','activeUsers', 'UserService', 'Notification', function($scope, thisuser, activeUsers, UserService, Notification){
            $scope.user = thisuser.data;
            $scope.activeUsers = activeUsers.data;
            
            console.log($scope.activeUsers);
            if($scope.user && $scope.user.userType=='Master'){
                $scope.masterUser = true;
            }
            $scope.nDays = 7;
            $scope.daysArray = [1, 2, 3, 4, 5, 6, 7, 30, 60, 90];
            
            $scope.setNDays = function(day){
                $scope.nDays = day;
                $scope.updateActiveUsers();
            };
            $scope.updateActiveUsers = function(){
                UserService.activeUsers($scope.nDays).success(function (data, status, headers) {
                    $scope.activeUsers = data;
                    Notification.success("Great, we have found the active users of the last " + $scope.nDays + ' days!');
                })
                .error(function (data, status, header, config) {
                    console.log();
                });
            };
    }]);
    
    exambazaar.controller("allTestsController", 
        [ '$scope','examList','testList', 'testService', 's3UtilsService', 'testswithQuestions', 'questionService', 'Notification', '$cookies', 'FileSaver', 'Blob', function($scope, examList, testList, testService, s3UtilsService, testswithQuestions, questionService, Notification, $cookies, FileSaver, Blob){
            $scope.fullScope = false;
            if($cookies.getObject('sessionuser')){
                var sessionuser = $cookies.getObject( 'sessionuser');
                
                if(sessionuser.userType =='Master'){
                    $scope.fullScope = true;
                    $scope.user = sessionuser;
                }
                if(sessionuser._id =='5a1831f0bd2adb260055e352'){
                    $scope.fullScope = true;
                }
            }else{
                
            }
            $scope.markMCQs = function(){
                questionService.markMCQs().success(function (data, status, headers) {
                    Notification.primary({message: "All questions marked to MCQs successfully!",  positionY: 'top', positionX: 'right', delay: 3000});
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 3000});
                });
            };
            $scope.allTests = testList.data;
            var testswithQuestions = testswithQuestions.data;
            var testswithQuestionIds = testswithQuestions.map(function(a) {return a._id.toString();});
            var allExams = examList.data;
            
            var examIds = allExams.map(function(a) {return a._id;});
            
            allExams.forEach(function(thisExam, index){
                if(!thisExam.tests){
                    thisExam.tests = [];
                }
                thisExam.nTyped = 0;
                thisExam.nActive = 0;
            });
            $scope.allTests.forEach(function(thisTest, index){
                var eIndex = examIds.indexOf(thisTest.exam);
                var qIndex = testswithQuestionIds.indexOf(thisTest._id.toString());
                
                
                if(eIndex != -1){
                    if(!allExams[eIndex].tests){
                        allExams[eIndex].tests = [];
                    }
                    allExams[eIndex].tests.push(thisTest);
                    if(thisTest.simulationactive){
                        allExams[eIndex].nActive += 1;
                    }
                    
                }
                if(qIndex != -1){
                    thisTest.nTyped = testswithQuestions[qIndex].count;
                    if(eIndex != -1){
                        //console.log(thisTest);
                        if(thisTest.simulate.ready){
                            if(!allExams[eIndex].nReady){
                                allExams[eIndex].nReady = 0;
                            }
                            allExams[eIndex].nReady += 1;
                        }
                        allExams[eIndex].nTyped += testswithQuestions[qIndex].count;
                    }
                    
                }else{
                    thisTest.nTyped = 0;
                }
            });
            
            $scope.allExams = allExams;
            
            
            
            $scope.markSimulate = function(){
                var testIds = [];
                testService.markSimulate(testIds).success(function (data, status, headers) {
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                }); 
            };
            
            $scope.readTest = function(test){
                var question = test.url.question;
                var answer = test.url.question;
                testService.readTest(test._id).success(function (data, status, headers) {
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });    
            };
            
            $scope.markWatermarked = function(){
                testService.markWatermarked().success(function (data, status, headers) {
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                }); 
            };
            
            $scope.download = function(test){
                if(!test.exam._id){
                    var eIndex = examIds.indexOf(test.exam);
                    if(eIndex != -1){
                        var examStream = {
                            exam:{
                                name: allExams[eIndex].name,
                                displayname: allExams[eIndex].displayname,
                            },
                            stream:{
                                name: allExams[eIndex].stream.name,
                                displayname: allExams[eIndex].stream.displayname,
                            },
                            test:{
                                name: test.name,
                                description: test.description,
                            }
                        };
                        test.examStream = examStream;
                    }
                    
                    
                }
                var fileInfo = {
                    test: test,
                };
                /*console.log(test.exam);
                
                if(test.url.answer){
                    fileInfo.answer = test.url.answer;
                }
                console.log(fileInfo);*/
                s3UtilsService.download(fileInfo).success(function (data, status, headers) {
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });    
            };
            
            $scope.generatePDF = function(test){
                var testForm = {
                    _id: test._id    
                };
                testService.testpdf(testForm).success(function (data, status, headers) {
                    var fileName = test.name + ' by Exambazaar' + '.pdf';
                    var pdf = new Blob([data], {type : 'application/pdf'});
                    FileSaver.saveAs(pdf, fileName);
                    //console.log(data);
                    //return(data);
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                }); 
            };
            
            $scope.upload = function(test){
                var fileInfo = {};
                s3UtilsService.upload(fileInfo).success(function (data, status, headers) {
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });    
            };
    }]);    
        
    exambazaar.controller("eqadController", 
        [ '$scope', '$rootScope', '$state', '$stateParams', '$cookies', '$mdDialog', '$timeout', 'questionService', 'UserService', 'thisexam', 'Notification', function($scope, $rootScope, $state, $stateParams, $cookies, $mdDialog, $timeout, questionService, UserService, thisexam, Notification){
            if($cookies.getObject('sessionuser')){
                var sessionuser = $cookies.getObject( 'sessionuser');
                $scope.exam = thisexam.data;
                $rootScope.pageTitle = $scope.exam.seoname + " Exam Question A Day";
                $scope.thiseqadDate = moment($stateParams.eqadDate);
                $scope.thiseqadDateFormat = moment($stateParams.eqadDate).format("DD-MMM-YY");
                $scope.eqadDates = [];
                
                $scope.newEQADDate = $scope.thiseqadDate;
                
                
                /*$scope.$watch('newEQADDate', function (newValue, oldValue, scope) {
                    console.log(newValue);
                    if(newValue){
                        var thisDate = moment($scope.newEQADDate).format("DD-MMM-YY");
                        console.log(thisDate);
                    }

                }, true);*/
                
                $scope.setEQADDate = function(newEQADDate){
                    if(newEQADDate){
                        var thisDate = moment(newEQADDate).format("DD-MMM-YY");
                    }
                };
                $scope.goToEQADDate = function(newEQADDate){
                    if(newEQADDate){
                        var thisDate = moment(newEQADDate).format("DD-MMM-YY");
                        //console.log(thisDate);
                        $state.go('eqad', { 'examName':$scope.exam.name, 'eqadDate':thisDate });
                    }
                };
                $scope.eqadDates.push($scope.thiseqadDate.format("DD-MMM-YY"));
                for (var i = 0; i < 3; i++) { 
                    $scope.eqadDates.push($scope.thiseqadDate.subtract(1, 'days').format("DD-MMM-YY"));
                }
                
                
                
                UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                    $scope.user = data;
                    //Notification.primary({message: "Welcome " + $scope.user.basic.name + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                $scope.showLoginForm();
            }
            var optionsPrefix = [
                'A) ',
                'B) ',
                'C) ',
                'D) ',
                'E) ',
                'F) ',
                'G) ',
                'H) ',
            ];
            
            var sanitizeQuestion = function(question){
                if(question && question.context){
                    question.context = question.context.replace(/\n/ig, '<br/>');
                }
                if(question && question.questions){
                    question.questions.forEach(function(thisQuestion, index){
                        thisQuestion.question = thisQuestion.question.replace(/\n/ig, '<br/>');
                        
                        thisQuestion.options.forEach(function(thisOption, oindex){
                            thisOption.option = thisOption.option.replace(/\n/ig, '<br/>');
                            //thisOption.option = optionsPrefix[oindex] + thisOption.option;
                        });
                    });
                    
                }
                return question;
            };
            $scope.getQuestion = function(questionId){
                questionService.getQuestion(questionId).success(function (data, status, headers) {
                    if(data){
                        
                        $scope.question = data;
                        $scope.question = sanitizeQuestion($scope.question);
                        console.log($scope.question);
                        Notification.primary({message: "Question loaded successfully!",  positionY: 'top', positionX: 'right', delay: 1000});
                    }else{
                        Notification.warning({message: "Question not loaded!",  positionY: 'top', positionX: 'right', delay: 1000});
                    }
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });    
            };
            
            var randomQuestion = function(){
                if($scope.exam && $scope.exam._id){
                    questionService.randomQuestion($scope.exam._id).success(function (data, status, headers) {
                        console.log(data);
                        //return(data);
                        var questionId = data;
                        $scope.getQuestion(questionId);
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                }
                
            };
            
            
            randomQuestion();
            
            
    }]);
    
    
    exambazaar.controller("careertestController", 
    [ '$scope', '$state', '$stateParams', 'screenSize', function($scope, $state, $stateParams, screenSize ){
        
            
            if (screenSize.is('xs, sm')){
                $scope.disabled = true;
            }else{
                $scope.disabled = false;
                var domainName = '';
                if($stateParams.domainName){
                    domainName = $stateParams.domainName.toLowerCase();
                }
                if(domainName == 'aptitude'){
                    $state.go('assessment', {testId: '5a17f5f617cb4c07c5dd7f5b'});
                }else if(domainName == 'coding'){
                    $state.go('assessment', {testId: '5a2e5d007a7d9659d7c4537d'});
                }else if(domainName == 'quant'){
                    $state.go('assessment', {testId: '5a2e5924ea139b56bbff0694'});
                }else{
                    $scope.errorText = "Something's not right in the url! Please write to us at team@exambazaar.com for any queries!";
                }
                
            }

            
    }]); 
    exambazaar.controller("reportassessmentController", 
    [ '$scope', '$rootScope', '$state', '$stateParams', '$cookies', '$mdDialog', '$timeout', 'questionService', 'questionresponseService', 'qmarkforreviewService', 'qviewService', 'assessmentService', 'UserService', 'thistest', 'thisanswerkey', 'thisTestQuestions', 'Notification', '$window', 'screenSize', function($scope, $rootScope, $state, $stateParams, $cookies, $mdDialog, $timeout, questionService, questionresponseService, qmarkforreviewService, qviewService, assessmentService, UserService, thistest, thisanswerkey, thisTestQuestions, Notification, $window, screenSize ){
            
            $scope.openAddQuestion = function(){
                var url = $state.href('addQuestion', {testId: $scope.test._id});
                window.open(url, '_blank');    
            };
            $scope.col1Width = '25';
            $scope.pageWidth = '100';
            $scope.question = null;
            $scope.subquestion = null;
            
            $scope.disabled = false;
            $scope.testStarted = false;
            $scope.testOver = false;
            if (screenSize.is('xs, sm')){
                $scope.disabled = true;
            }else{
                $scope.disabled = false;
            }

            var sanitizeQuestion = function(question){
                if(question && question.context){
                    question.context = question.context.replace(/\n/ig, '<br/>');
                }
                if(question._startnumber){
                    question._startnumber = Number(question._startnumber);
                }
                if(question._endnumber){
                    question._endnumber = Number(question._endnumber);
                }
                if(question && question.questions){
                    question.questions.forEach(function(thisQuestion, index){
                        
                        if(!thisQuestion.marking){
                            thisQuestion.marking = {
                                correct: 3,
                                incorrect: -1
                            };
                        }
                        
                        var sIndex = $scope.answerkeysubquestionIds.indexOf(thisQuestion._id.toString());
                        if(sIndex != -1){
                            thisQuestion.answer = $scope.answerkey[sIndex];
                        }else{
                            console.log('Did not find answer: ' + thisQuestion._id + " | " + question._id);
                        }
                        
                        thisQuestion.question = thisQuestion.question.replace(/\n/ig, '<br/>');
                        
                        
                        thisQuestion.options.forEach(function(thisOption, oindex){
                            thisOption.option = thisOption.option.replace(/\n/ig, '<br/>');
                            //thisOption.option = optionsPrefix[oindex] + thisOption.option;
                        });
                    });

                }
                return question;
            };
            $scope.fullScreenMode = false;
            
            $scope.examQuestions = [];
            $scope.answered = 0;
            $scope.seen = 0;
        
            var getUserQMarkForReview = function(){
            if($scope.user._id){
                qmarkforreviewService.getUserQMarkforReviews($scope.user._id).success(function (data, status, headers) {

                $scope.userQMarkForReview = data;
                var userQMarkForReviewSubQuestionIds = $scope.userQMarkForReview.map(function(a) {return a.subquestion.toString();});
                
                if($scope.userQMarkForReview){
                    $scope.marked = 0;
                    $scope.testQuestions.forEach(function(thisQuestion, index){

                        var markforreview = false;
                        
                        thisQuestion.questions.forEach(function(thisSubQuestion, sindex){
                            var submarkforreview = false;
                            var thisSubQuestionId = thisSubQuestion._id.toString();
                            
                            var qIndex = userQMarkForReviewSubQuestionIds.indexOf(thisSubQuestionId);

                            if(qIndex != -1){
                                
                                submarkforreview = true;
                                markforreview = true;
                                
                                $scope.marked += 1;

                            }else{
                                
                            }
                            thisSubQuestion.markforreview = submarkforreview;
                        });
                        thisQuestion.markforreview = markforreview;
                    });

                    
                }
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
            }

            };
            var getUserQView = function(){
            if($scope.user._id){
                qviewService.getUserQViews($scope.user._id).success(function (data, status, headers) {

                $scope.userQView = data;
                var userQViewSubQuestionIds = $scope.userQView.map(function(a) {return a.subquestion.toString();});
                if($scope.userQView){
                    $scope.seen = 0;
                    $scope.testQuestions.forEach(function(thisQuestion, index){
                        //userQViewQuestionIds 
                        thisQuestion.questions.forEach(function(thisSubQuestion, sindex){
                            var thisSeen = false;
                            var sindex = userQViewSubQuestionIds.indexOf(thisSubQuestion._id);
                            if(sindex != -1){
                                thisSubQuestion.seen = true;
                                $scope.seen += 1;
                            }
                            
                        });
                        
                        
                        
                    });

                    
                }
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
            }

            };
            var getUserAnswers = function(){
                if($scope.user._id){
                    var correct = $scope.userAssessment.evaluation.marked.correct;
                    var correctSubQuestionIds = [];
                    if(correct.length > 0){
                        correctSubQuestionIds = correct.map(function(a) {return a.subquestion.toString();});
                    }
                    var incorrect = $scope.userAssessment.evaluation.marked.incorrect;
                    var incorrectSubQuestionIds = [];
                    if(incorrect.length > 0){
                        incorrectSubQuestionIds = incorrect.map(function(a) {return a.subquestion.toString();});
                    }
                   
                    
                    $scope.testQuestions.forEach(function(thisQuestion, index){
                        
                        thisQuestion.questions.forEach(function(thisSubQuestion, sindex){
                            var qno = thisQuestion._startnumber + sindex;
                            var cIndex = correctSubQuestionIds.indexOf(thisSubQuestion._id.toString());
                            var icIndex = incorrectSubQuestionIds.indexOf(thisSubQuestion._id.toString());
                            
                            if(cIndex != -1){
                                thisSubQuestion.userevaluation = {
                                    correct: true,    
                                    incorrect: false,    
                                    notattempted: false,    
                                };
                            }else if(icIndex != -1){
                                thisSubQuestion.userevaluation = {
                                    correct: false,    
                                    incorrect: true,    
                                    notattempted: false,    
                                };
                            }else if(cIndex == -1 && icIndex == -1){
                                thisSubQuestion.userevaluation = {
                                    correct: false,    
                                    incorrect: false,    
                                    notattempted: true,    
                                };
                            }
                            
                        });
                    });
                    
                    
                }
            };
        
            var getUserResponses = function(){
                if($scope.user._id){
                questionresponseService.getUserQuestionResponses($scope.user._id).success(function (data, status, headers) {

                $scope.userResponses = data;
                var userResponseSubQuestionIds = $scope.userResponses.map(function(a) {return a.subquestion.toString();});
                
                if($scope.userResponses){
                    $scope.answered = 0;
                    $scope.totalQuestions = 0;
                    
                    var userQViewSubQuestionIds = [];
                    if($scope.userQView){
                        var userQViewSubQuestionIds = $scope.userQView.map(function(a) {return a.subquestion.toString();});
                    }
                    $scope.testQuestions.forEach(function(thisQuestion, index){

                        var anyAnswer = false;
                        
                        $scope.totalQuestions += thisQuestion.questions.length;
                        
                        
                        
                        thisQuestion.questions.forEach(function(thisSubQuestion, sindex){
                            var subanyAnswer = false;
                            var thisSubQuestionId = thisSubQuestion._id.toString();
                            
                            var qIndex = userResponseSubQuestionIds.indexOf(thisSubQuestionId);

                            if(qIndex != -1){
                                var thisQuestionResponse = $scope.userResponses[qIndex];
                                anyAnswer = true;
                                subanyAnswer = true;
                               
                                if(thisQuestionResponse.option){
                                    $scope.testQuestions[index].questions[sindex].userAnswer = thisQuestionResponse.option.toString();
                                }
                                if(thisQuestionResponse.numericalAnswer){
                                    $scope.testQuestions[index].questions[sindex].userNumericalAnswer = Number(thisQuestionResponse.numericalAnswer);
                                }
                                
                                
                                
                                $scope.answered += 1;

                            }else{
                                $scope.testQuestions[index].questions[sindex].userAnswer = null;
                                $scope.testQuestions[index].questions[sindex].userNumericalAnswer = null;
                            }

                            thisSubQuestion.anyAnswer = subanyAnswer;
                        });
                        thisQuestion.anyAnswer = anyAnswer;

                        thisQuestion = sanitizeQuestion(thisQuestion);
                    });

                    
                }
                    /*if($scope.userResponses){
                    $scope.answered = 0;
                    $scope.testQuestions.forEach(function(thisQuestion, index){
                        var thisQuestionId = thisQuestion._id;
                        var qIndex = userResponseSubQuestionIds.indexOf(thisQuestionId);

                        if(qIndex != -1){
                            var thisQuestionResponse = $scope.userResponses[qIndex];
                            thisQuestion.userAnswer = thisQuestionResponse.option.toString();
                            $scope.answered += 1;

                        }else{
                            thisQuestion.userAnswer = null;
                        }

                        thisQuestion.questions.forEach(function(thisSubQuestion, index){
                            var thisSubQuestionId = thisSubQuestion._id.toString();

                        });

                        thisQuestion = sanitizeQuestion(thisQuestion);
                    });
                }*/



                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
                }

            };
            
            
            $scope.setQuestion = function(question, index){
                $scope.question = question;
                $scope.setSubQuestion($scope.question, index);
            };
            $scope.setSubQuestion = function(question, index){
                if(question && question.questions && question.questions.length > index){
                    if($scope.question._id != question._id){
                        $scope.question = question;
                    }
                    if($scope.subquestion){
                        if($scope.subquestion._id != question.questions[index]._id){
                            $scope.subquestion = question.questions[index];
                        }
                    }else{
                        $scope.subquestion = question.questions[index];
                    }
                }
                
            };
        
            $scope.setNextQuestion = function(question, subquestion){
                var questionId = question._id;
                var subquestionId = subquestion._id;
                var questionSubQuestionIds = question.questions.map(function(a) {return a._id.toString();});
                var nSubQuestions = question.questions.length;
                var sIndex = questionSubQuestionIds.indexOf(subquestionId);
                if(sIndex < nSubQuestions - 1){
                    $scope.subquestion = question.questions[sIndex + 1];
                   
                }else if (sIndex == nSubQuestions - 1 ){
                    var testQuestionIds = $scope.testQuestions.map(function(a) {return a._id;});
                    var nQuestions = $scope.testQuestions.length;

                    var tIndex = testQuestionIds.indexOf(questionId);

                    if(tIndex != -1 && tIndex != nQuestions- 1){
                       
                        $scope.question = $scope.testQuestions[tIndex + 1];
                        $scope.setSubQuestion($scope.question, 0);
                    }else if (tIndex == nQuestions- 1){
                        $scope.submitAssessment();
                    }
                    
                }
                
            };
            $scope.setPreviousQuestion = function(question, subquestion){
                var questionId = question._id;
                var subquestionId = subquestion._id;
                var questionSubQuestionIds = question.questions.map(function(a) {return a._id.toString();});
                var nSubQuestions = question.questions.length;
                var sIndex = questionSubQuestionIds.indexOf(subquestionId);
                if(sIndex > 0){
                    $scope.subquestion = question.questions[sIndex - 1];
                   
                }else if (sIndex == 0){
                    var testQuestionIds = $scope.testQuestions.map(function(a) {return a._id;});
                    var nQuestions = $scope.testQuestions.length;

                    var tIndex = testQuestionIds.indexOf(questionId);

                    if(tIndex != -1 && tIndex != 0){
                       
                        $scope.question = $scope.testQuestions[tIndex - 1];
                        $scope.setSubQuestion($scope.question, $scope.question.questions.length - 1);
                    }else if (tIndex == 0){
                        
                    }
                    
                }
            };
            $scope.user = null;
            if($cookies.getObject('sessionuser')){
                var sessionuser = $cookies.getObject( 'sessionuser');
                
                $scope.test = thistest.data;
                $scope.answerkey = thisanswerkey.data;
                $scope.answerkeysubquestionIds = $scope.answerkey.map(function(a) {return a.subquestion;});
                if($scope.test.instructions && $scope.test.instructions.length > 0){
                    $scope.instructions = $scope.test.instructions;    
                }
                
                $scope.testQuestions = thisTestQuestions.data;
                $scope.testQuestions.sort(function(a,b) {return (Number(a._startnumber) > Number(b._startnumber)) ? 1 : ((Number(b._startnumber) > Number(a._startnumber)) ? -1 : 0);} ); 
                
                $rootScope.pageTitle = "Exambazaar Test";
                var nQuestions = $scope.testQuestions.length;
                $scope.questionList = [];
                 $scope.testQuestions.forEach(function(thisQuestion, index){
                    thisQuestion = sanitizeQuestion(thisQuestion);
                    thisQuestion.questions.forEach(function(thisSubQuestion, sindex){
                        var newQuestionInList = {
                            question: thisQuestion,
                            subquestion: thisSubQuestion,
                            no: thisQuestion._startnumber + sindex,
                            sno: sindex,
                        };
                        $scope.questionList.push(newQuestionInList);
                    });
                     
                });
                $scope.getQClass = function(subquestion){
                    
                    var classname = '';
                    if(subquestion.userevaluation.correct){
                        classname = 'correctTag';
                    }
                    if(subquestion.userevaluation.incorrect){
                        classname = 'incorrectTag';
                    }
                    return(classname);
                };
                $scope.fullScope = false;
                UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                    $scope.user = data;
                    

                    Notification.primary({message: "Welcome " + $scope.user.basic.name + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                    var assessmentForm = {
                        user: $scope.user._id,
                        test: $stateParams.testId,
                    };
                    assessmentService.getAssessment(assessmentForm).success(function (adata, status, headers) {
                        $scope.userAssessment = adata;
                        $scope.testOver = false;
                        $scope.testStarted = false;


                        if($scope.userAssessment && $scope.userAssessment.submitted){
                            $scope.testOver = true;
                           
                            $scope.testStarted = true;
                            

                        }else{
                            $scope.testOver = false;
                            
                            $scope.endTime = moment($scope.userAssessment._end);
                            var timeNow = moment();
                            if($scope.endTime - timeNow < 0 &&  !$scope.userAssessment.submitted){
                                
                                console.log('Need to submit the test');

                            }
                        }
                        if($scope.testOver){
                            getUserAnswers();
                            getUserResponses();
                            getUserQMarkForReview();
                            getUserQView();
                            $scope.setQuestion($scope.testQuestions[0], 0);
                        }
                        
                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                        console.log('Error ' + data + ' ' + status);
                    });



                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "User not logged in!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                //$scope.user = null;
                //$rootScope.$emit("CallBlogLogin", {});
                
                console.log('No User');
            }
            var optionsPrefix = [
                'A) ',
                'B) ',
                'C) ',
                'D) ',
                'E) ',
                'F) ',
                'G) ',
                'H) ',
            ];


            $scope.submitAssessmentHelper = function(){
                var assessmentForm = {
                    user: $scope.user._id,
                    test: $stateParams.testId,
                };
                assessmentService.submitAssessment(assessmentForm).success(function (adata, status, headers) {
                    Notification.success({message: "Thank you, all done!",  positionY: 'top', positionX: 'right', delay: 1000});
                    $scope.userAssessment = adata;
                    $scope.testOver = false;
                    $scope.testStarted = false;
                    $scope.userevaluate();

                    if($scope.userAssessment){
                        $scope.testStarted = true;
                        $scope.endTime = moment($scope.userAssessment._end);
                        var timeNow = moment();
                        if($scope.endTime - timeNow < 0 || $scope.userAssessment.submitted){
                            $scope.testOver = true;
                            console.log('Test is over or submitted');

                        }else{
                            $scope.testOver = false;

                        }

                    }else{
                        $scope.testStarted = false;
                    }
                    getUserResponses();
                    getUserQMarkForReview();
                    getUserQView();

                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });

            };
            $scope.submitAssessment = function(){
                console.log($scope.isFullScreen);
                var confirm = $mdDialog.confirm()
                .title('Would you like to submit your test?')
                .textContent('You will not be able to access it again!' )
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {

                    $scope.submitAssessmentHelper();


                }, function() {
                  //nothing
                }); 




            }

            $scope.userevaluate = function(){
                var assessmentForm = {
                    user: $scope.user._id,
                    test: $stateParams.testId,
                };

                assessmentService.userevaluate(assessmentForm).success(function (edata, status, headers) {
                    console.log(edata);

                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
            }


            $scope.$watch('subquestion', function (newValue, oldValue, scope) {
                if(newValue != null){
                    $scope.activeQuestionNo = null;
                    var questionId = $scope.question._id;
                    var testQuestionIds = $scope.testQuestions.map(function(a) {return a._id;});

                    var tIndex = testQuestionIds.indexOf(questionId);
                    var thisQuestion = $scope.testQuestions[tIndex];
                    var questionSubQuestionIds = thisQuestion.questions.map(function(a) {return a._id.toString();});
                    var sIndex = questionSubQuestionIds.indexOf($scope.subquestion._id);
                    
                    if(sIndex != -1){
                        $scope.activeQuestionNo = thisQuestion._startnumber + sIndex;
                    }
                    
                    

                }
            }, true);
            //qmarkforreviewService abcd
            $scope.markQuestionForReview = function(question, subquestion){
                var qmarkforreviewForm = {
                    user: $scope.user._id,
                    question: question._id,
                    subquestion: subquestion._id,
                };

                qmarkforreviewService.saveQMarkforReview(qmarkforreviewForm).success(function (data, status, headers) {
                    question.markforreview = true;
                    //Notification.primary({message: "Your question has been marked for review!",  positionY: 'top', positionX: 'left', delay: 2000});
                    //getUserResponses();
                    getUserQMarkForReview();
                    //getUserQView();
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                    console.log('Error ' + data + ' ' + status);
                });
            };
            
            $scope.clearQuestionMarkForReview = function(subquestion){
                
                var userQMarkForReviewSubQuestionIds = $scope.userQMarkForReview.map(function(a) {return a.subquestion.toString();});

                var subquestionId = subquestion._id;
                var uIndex = userQMarkForReviewSubQuestionIds.indexOf(subquestionId);
                if(uIndex != -1){
                    var thisUserQMarkForReview = $scope.userQMarkForReview[uIndex];
                    qmarkforreviewService.removeQMarkforReview(thisUserQMarkForReview._id).success(function (data, status, headers) {
                        //Notification.success({message: "Your question has been unmarked from review!",  positionY: 'top', positionX: 'left', delay: 2000});
                        getUserQMarkForReview();

                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                        console.log('Error ' + data + ' ' + status);
                    });

                }
            };
        
            $scope.clearAnswer = function(subquestion){
                if(subquestion.type =='numerical'){
                    subquestion.userNumericalAnswer = null;
                }
                var userResponseSubQuestionIds = $scope.userResponses.map(function(a) {return a.subquestion.toString();});

                var subquestionId = subquestion._id;
                var uIndex = userResponseSubQuestionIds.indexOf(subquestionId);
                if(uIndex != -1){
                    var thisUserResponse = $scope.userResponses[uIndex];
                    questionresponseService.removeQuestionResponse(thisUserResponse._id).success(function (data, status, headers) {
                        //console.log('All done');
                        getUserResponses();

                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                        console.log('Error ' + data + ' ' + status);
                    });

                }
            };
            


            

            $scope.showInstructionDialog = function(ev) {

                $mdDialog.show({
                  contentElement: '#instructionDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: false,
                  escapeToClose: false,
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            $scope.closeInstructionDialog = function(ev) {

                $mdDialog.hide();
            };
        
            $scope.removeAssessmentDialog = function(){
                var confirm = $mdDialog.confirm()
                .title('Would you like to reset the test?')
                .textContent('You will lose your progress!' )
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.removeAssessment();
                }, function() {
                  //nothing
                });   
            };
        
            $scope.removeAssessment = function(){
                var thisAssessment = {
                    userId: $scope.user._id,
                    testId: $scope.test._id,
                };
                assessmentService.removeAssessment(thisAssessment).success(function (data, status, headers) {
                    Notification.success({message: "Assessment has been reset",  positionY: 'top', positionX: 'left', delay: 10000});
                    $state.reload();

                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                    console.log('Error ' + data + ' ' + status);
                });
                
            };
            $scope.startAssessment = function(assessmentInfo) {
                
                $scope.startErrors = [];
                var valid = true;
                if(!assessmentInfo.mobile){
                    assessmentInfo.mobile = '';
                }
                if(assessmentInfo && assessmentInfo.mobile){
                    assessmentInfo.mobile = assessmentInfo.mobile.toString();
                }

                if(!assessmentInfo.agree){
                    valid = false;
                    console.log('1');
                    $scope.startErrors.push('Please agree to terms and conditions.');
                }
                if(assessmentInfo.name.length < 2){
                    valid = false;
                    console.log('2');
                    $scope.startErrors.push('Please enter name');
                }
                console.log(assessmentInfo.mobile);
                if(assessmentInfo.mobile.length < 9){
                    valid = false;
                    console.log('4');
                    $scope.startErrors.push('Please enter a valid mobile number');
                }
                if(assessmentInfo.email.length < 2){
                    valid = false;
                    console.log('3');
                    $scope.startErrors.push('Please enter email');
                }
                
                /*if(!assessmentInfo.degree){
                    valid = false;
                    console.log('5');
                    $scope.startErrors.push('Please select degree');
                }
                if(assessmentInfo.degree == "Others" && assessmentInfo.otherdegree.length < 2){
                    valid = false;
                    console.log('6');
                    $scope.startErrors.push('Please enter Other degree name');
                }
                if(!assessmentInfo.stream){
                    valid = false;
                    console.log('7');
                    $scope.startErrors.push('Please select stream');
                }
                if(assessmentInfo.stream == "Others" && assessmentInfo.otherstream.length < 2){
                    valid = false;
                    console.log('8');
                    $scope.startErrors.push('Please select Other stream name');
                }
                if(assessmentInfo.mobile.length != 10){
                    valid = false;
                    console.log('9');
                    $scope.startErrors.push('Please enter mobile');
                }*/

                if(valid){
                    var timewithbreak = Number($scope.test.duration);
                    var testSections = $scope.test.simulate.sections;
                    if(testSections){
                    testSections.forEach(function(thisSection, index){
                        if(thisSection.timedSeparately){
                            timewithbreak += Number(thisSection.break);
                        }
                    });
                    }
                    
                    var assessmentForm = {
                        user: $scope.user._id,
                        test: $stateParams.testId,
                        info: assessmentInfo,
                        //time: 60,
                        time: $scope.test.duration,
                        timewithbreak: timewithbreak,
                    };
                    assessmentService.saveAssessment(assessmentForm).success(function (adata, status, headers) {
                        $scope.userAssessment = adata;
                        if($scope.userAssessment){
                            $scope.testStarted = true;
                            $scope.endTime = moment($scope.userAssessment._end);
                            var timeNow = moment();
                            if($scope.endTime - timeNow < 0 || $scope.userAssessment.submitted){
                                $scope.testOver = true;
                                console.log('Test is over or submitted');

                            }else{
                                $scope.testOver = false;

                            }

                        }else{
                            $scope.testStarted = false;
                        }
                        getUserResponses();
                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                        console.log('Error ' + data + ' ' + status);
                    });


                }else{
                    Notification.primary({message: "Please fill the form correctly and agree to terms to proceed ahead!",  positionY: 'top', positionX: 'right', delay: 5000});
                }



            };

            window.setInterval(function(){
                //console.log('Here');
                if($scope.userAssessment){
                    var timeNow = moment();
                    if($scope.endTime - timeNow < 0 && !$scope.userAssessment.submitted){
                        console.log('Test is over');
                        $scope.testOver = true;
                        $scope.submitAssessmentHelper();
                    }
                }

            }, 1000);

            /*var vis = (function(){
                var stateKey, eventKey, keys = {
                    hidden: "visibilitychange",
                    webkitHidden: "webkitvisibilitychange",
                    mozHidden: "mozvisibilitychange",
                    msHidden: "msvisibilitychange"
                };
                for (stateKey in keys) {
                    if (stateKey in document) {
                        eventKey = keys[stateKey];
                        break;
                    }
                }
                return function(c) {
                    if (c) document.addEventListener(eventKey, c);
                    return !document[stateKey];
                }
            })();
            var visible = vis();
            vis(function(){
              document.title = vis() ? 'Visible' : 'Not visible';
            });*/

    }]); 
    exambazaar.controller("assessmentController", 
    [ '$scope', '$rootScope', '$state', '$stateParams', '$cookies', '$mdDialog', '$timeout', 'questionService', 'questionresponseService', 'qmarkforreviewService', 'qviewService', 'assessmentService', 'UserService', 'thistest', 'thisTestQuestions', 'Notification', '$window', 'screenSize', 'viewService', function($scope, $rootScope, $state, $stateParams, $cookies, $mdDialog, $timeout, questionService, questionresponseService, qmarkforreviewService, qviewService, assessmentService, UserService, thistest, thisTestQuestions, Notification, $window, screenSize, viewService ){
            
            $scope.openAddQuestion = function(){
                var url = $state.href('addQuestion', {testId: $scope.test._id});
                window.open(url, '_blank');    
            };
            $scope.col1Width = '25';
            $scope.pageWidth = '100';
            $scope.question = null;
            $scope.subquestion = null;
            $scope.assessmentInfo = {
                name: '',
                mobile: '',
                email: '',
                address: '',
                degree: '',
                otherdegree: '',
                stream: '',
                otherstream: '',
                agree: false,
            };
            $scope.disabled = false;
            $scope.testStarted = false;
            $scope.testOver = false;
            if (screenSize.is('xs, sm')){
                $scope.disabled = true;
            }else{
                $scope.disabled = false;
            }

            var markView = function(question, subquestion){
                var userQViewSubQuestionIds = [];
                if($scope.userQView){
                    var userQViewSubQuestionIds = $scope.userQView.map(function(a) {return a.subquestion.toString();});
                }
                var sindex = userQViewSubQuestionIds.indexOf(subquestion._id);
                if(sindex == -1){

                    var qviewForm = {
                        user: $scope.user._id,
                        question: question._id,
                        subquestion: subquestion._id,
                    };

                    qviewService.saveQView(qviewForm).success(function (data, status, headers) {
                        question.seen = true;
                        subquestion.seen = true;
                        //Notification.primary({message: "Your question view has been marked!",  positionY: 'top', positionX: 'left', delay: 2000});
                        //getUserResponses();
                        getUserQView();
                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                        console.log('Error ' + data + ' ' + status);
                    });
                        
                        
                        
                        
                    }else{
                        //do nothing
                    }
                    
            };
            $scope.seeAssessmentResult = function(){
                var url = $state.href('reportassessment', {testId: $scope.test._id});
                window.open(url,'_blank');
            };

            var sanitizeQuestion = function(question){
                if(question && question.context){
                    question.context = question.context.replace(/\n/ig, '<br/>');
                }
                if(question._startnumber){
                    question._startnumber = Number(question._startnumber);
                }
                if(question._endnumber){
                    question._endnumber = Number(question._endnumber);
                }
                if(question && question.questions){
                    question.questions.forEach(function(thisQuestion, index){
                        
                        if(!thisQuestion.marking){
                            thisQuestion.marking = {
                                correct: 3,
                                incorrect: -1
                            };
                        }
                        
                        thisQuestion.question = thisQuestion.question.replace(/\n/ig, '<br/>');

                        thisQuestion.options.forEach(function(thisOption, oindex){
                            thisOption.option = thisOption.option.replace(/\n/ig, '<br/>');
                            //thisOption.option = optionsPrefix[oindex] + thisOption.option;
                        });
                    });

                }
                return question;
            };
            $scope.fullScreenMode = false;
            
            $scope.examQuestions = [];
            $scope.answered = 0;
            $scope.seen = 0;
        
            var getUserQMarkForReview = function(){
            if($scope.user._id){
                qmarkforreviewService.getUserQMarkforReviews($scope.user._id).success(function (data, status, headers) {

                $scope.userQMarkForReview = data;
                var userQMarkForReviewSubQuestionIds = $scope.userQMarkForReview.map(function(a) {return a.subquestion.toString();});
                
                if($scope.userQMarkForReview){
                    $scope.marked = 0;
                    $scope.testQuestions.forEach(function(thisQuestion, index){

                        var markforreview = false;
                        
                        thisQuestion.questions.forEach(function(thisSubQuestion, sindex){
                            var submarkforreview = false;
                            var thisSubQuestionId = thisSubQuestion._id.toString();
                            
                            var qIndex = userQMarkForReviewSubQuestionIds.indexOf(thisSubQuestionId);

                            if(qIndex != -1){
                                
                                submarkforreview = true;
                                markforreview = true;
                                
                                $scope.marked += 1;

                            }else{
                                
                            }
                            thisSubQuestion.markforreview = submarkforreview;
                        });
                        thisQuestion.markforreview = markforreview;
                    });

                    
                }
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
            }

            };
            var getUserQView = function(){
            if($scope.user._id){
                qviewService.getUserQViews($scope.user._id).success(function (data, status, headers) {

                $scope.userQView = data;
                var userQViewSubQuestionIds = $scope.userQView.map(function(a) {return a.subquestion.toString();});
                if($scope.userQView){
                    $scope.seen = 0;
                    $scope.testQuestions.forEach(function(thisQuestion, index){
                        //userQViewQuestionIds 
                        thisQuestion.questions.forEach(function(thisSubQuestion, sindex){
                            var thisSeen = false;
                            var sindex = userQViewSubQuestionIds.indexOf(thisSubQuestion._id);
                            if(sindex != -1){
                                thisSubQuestion.seen = true;
                                $scope.seen += 1;
                            }
                            
                        });
                        
                        
                        
                    });

                    
                }
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
            }

            };
            var getUserResponses = function(){
                if($scope.user._id){
                questionresponseService.getUserQuestionResponses($scope.user._id).success(function (data, status, headers) {

                $scope.userResponses = data;
                var userResponseSubQuestionIds = $scope.userResponses.map(function(a) {return a.subquestion.toString();});
                
                if($scope.userResponses){
                    $scope.answered = 0;
                    $scope.totalQuestions = 0;
                    
                    var userQViewSubQuestionIds = [];
                    if($scope.userQView){
                        var userQViewSubQuestionIds = $scope.userQView.map(function(a) {return a.subquestion.toString();});
                    }
                    $scope.testQuestions.forEach(function(thisQuestion, index){

                        var anyAnswer = false;
                        
                        $scope.totalQuestions += thisQuestion.questions.length;
                        
                        
                        
                        thisQuestion.questions.forEach(function(thisSubQuestion, sindex){
                            var subanyAnswer = false;
                            var thisSubQuestionId = thisSubQuestion._id.toString();
                            
                            var qIndex = userResponseSubQuestionIds.indexOf(thisSubQuestionId);

                            if(qIndex != -1){
                                var thisQuestionResponse = $scope.userResponses[qIndex];
                                anyAnswer = true;
                                subanyAnswer = true;
                               
                                if(thisQuestionResponse.option){
                                    $scope.testQuestions[index].questions[sindex].userAnswer = thisQuestionResponse.option.toString();
                                }
                                if(thisQuestionResponse.numericalAnswer){
                                    $scope.testQuestions[index].questions[sindex].userNumericalAnswer = Number(thisQuestionResponse.numericalAnswer);
                                }
                                
                                
                                
                                $scope.answered += 1;

                            }else{
                                $scope.testQuestions[index].questions[sindex].userAnswer = null;
                                $scope.testQuestions[index].questions[sindex].userNumericalAnswer = null;
                            }

                            thisSubQuestion.anyAnswer = subanyAnswer;
                        });
                        thisQuestion.anyAnswer = anyAnswer;

                        thisQuestion = sanitizeQuestion(thisQuestion);
                    });

                    
                }
                    /*if($scope.userResponses){
                    $scope.answered = 0;
                    $scope.testQuestions.forEach(function(thisQuestion, index){
                        var thisQuestionId = thisQuestion._id;
                        var qIndex = userResponseSubQuestionIds.indexOf(thisQuestionId);

                        if(qIndex != -1){
                            var thisQuestionResponse = $scope.userResponses[qIndex];
                            thisQuestion.userAnswer = thisQuestionResponse.option.toString();
                            $scope.answered += 1;

                        }else{
                            thisQuestion.userAnswer = null;
                        }

                        thisQuestion.questions.forEach(function(thisSubQuestion, index){
                            var thisSubQuestionId = thisSubQuestion._id.toString();

                        });

                        thisQuestion = sanitizeQuestion(thisQuestion);
                    });
                }*/



                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
                }

            };
            
            $scope.degrees = ["B.Tech", "MCA", "MBA", "Others"];
            $scope.streams = ["CS", "IT", "EC", "Others"];

            $scope.instructions = [
                "Welcome to Exambazaar!",
                "Exambazaar is India's largest education discovery platform which provides comprehensive information for test preparation for entrance exams, colleges, courses, universities and career options in India. You can find information about more than 100 exams and how to prepare for them. Students can also find exclusive videos and photographs of thousands of coaching institutes in every nook and corner of India. We currently cover 93 cities across India with over 26,000 education providers",

            ];
            $scope.markAnswer = function(question, subquestion, option){
                var questionresponseForm = {
                    user: $scope.user._id,
                    question: question._id,
                    subquestion: subquestion._id,
                    option: option._id,
                };

                questionresponseService.saveQuestionResponse(questionresponseForm).success(function (data, status, headers) {
                    question.anyAnswer = true;
                    Notification.primary({message: "Your answer has been marked!",  positionY: 'top', positionX: 'left', delay: 2000});
                    getUserResponses();
                    getUserQMarkForReview();
                    getUserQView();
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                    console.log('Error ' + data + ' ' + status);
                });
            };
            $scope.markNumericalAnswer = function(question, subquestion){
                if(subquestion.type == 'numerical'){
                    //console.log(subquestion.userNumericalAnswer);
                    if(subquestion.userNumericalAnswer){
                        var questionresponseForm = {
                            user: $scope.user._id,
                            question: question._id,
                            subquestion: subquestion._id,
                            numericalAnswer: subquestion.userNumericalAnswer,
                        };

                        questionresponseService.saveQuestionResponse(questionresponseForm).success(function (data, status, headers) {
                            question.anyAnswer = true;
                            subquestion.anyAnswer = true;
                            Notification.primary({message: "Your answer has been marked!",  positionY: 'top', positionX: 'left', delay: 2000});
                            getUserResponses();
                            getUserQMarkForReview();
                            getUserQView();
                        })
                        .error(function (data, status, header, config) {
                            Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                            console.log('Error ' + data + ' ' + status);
                        });

                    }

                } 
               
            };
            $scope.setQuestion = function(question, index){
                
                if($scope.question){
                    $scope.markNumericalAnswer($scope.question, $scope.subquestion);
                }
                
                $scope.question = question;
                $scope.setSubQuestion($scope.question, index);
                //$scope.subquestion = question.questions[0];
                markView($scope.question, $scope.subquestion);
            };
            $scope.setSubQuestion = function(question, index){
                if(question && question.questions && question.questions.length > index){
                    if($scope.question._id != question._id){
                        $scope.question = question;
                    }
                    if($scope.subquestion){
                        if($scope.subquestion._id != question.questions[index]._id){
                            $scope.subquestion = question.questions[index];
                        }
                    }else{
                        $scope.subquestion = question.questions[index];
                    }
                }
                
            };
        
            $scope.setNextQuestion = function(question, subquestion){
                var questionId = question._id;
                var subquestionId = subquestion._id;
                var questionSubQuestionIds = question.questions.map(function(a) {return a._id.toString();});
                var nSubQuestions = question.questions.length;
                var sIndex = questionSubQuestionIds.indexOf(subquestionId);
                if(sIndex < nSubQuestions - 1){
                    $scope.subquestion = question.questions[sIndex + 1];
                    markView($scope.question, $scope.subquestion);
                    $scope.markNumericalAnswer($scope.question, $scope.subquestion);
                }else if (sIndex == nSubQuestions - 1 ){
                    var testQuestionIds = $scope.testQuestions.map(function(a) {return a._id;});
                    var nQuestions = $scope.testQuestions.length;

                    var tIndex = testQuestionIds.indexOf(questionId);

                    if(tIndex != -1 && tIndex != nQuestions- 1){
                        $scope.markNumericalAnswer($scope.question, $scope.subquestion);
                        $scope.question = $scope.testQuestions[tIndex + 1];
                        $scope.setSubQuestion($scope.question, 0);
                        markView($scope.question, $scope.subquestion);
                    }else if (tIndex == nQuestions- 1){
                        $scope.submitAssessment();
                    }
                    
                }
                
            };
            $scope.setPreviousQuestion = function(question){
                var questionId = question._id;
                var testQuestionIds = $scope.testQuestions.map(function(a) {return a._id;});
                var nQuestions = $scope.testQuestions.length;

                var tIndex = testQuestionIds.indexOf(questionId);
                console.log(tIndex);

                if(tIndex != -1 && tIndex != 0){
                    $scope.question = $scope.testQuestions[tIndex-1];
                    markView($scope.question, $scope.subquestion);
                }
                $scope.markNumericalAnswer($scope.question, $scope.subquestion);
            };
            $scope.user = {};
            if($cookies.getObject('sessionuser')){
                var sessionuser = $cookies.getObject( 'sessionuser');
                $scope.test = thistest.data;
                if($scope.test.instructions && $scope.test.instructions.length > 0){
                    $scope.instructions = $scope.test.instructions;    
                }
                
                $scope.testQuestions = thisTestQuestions.data;
                $scope.testQuestions.sort(function(a,b) {return (Number(a._startnumber) > Number(b._startnumber)) ? 1 : ((Number(b._startnumber) > Number(a._startnumber)) ? -1 : 0);} ); 
                
                $rootScope.pageTitle = "Exambazaar Test";
                var nQuestions = $scope.testQuestions.length;
                $scope.questionList = [];
                 $scope.testQuestions.forEach(function(thisQuestion, index){
                    thisQuestion = sanitizeQuestion(thisQuestion);
                    thisQuestion.questions.forEach(function(thisSubQuestion, sindex){
                        var newQuestionInList = {
                            question: thisQuestion,
                            subquestion: thisSubQuestion,
                            no: thisQuestion._startnumber + sindex,
                            sno: sindex,
                        };
                        $scope.questionList.push(newQuestionInList);
                    });
                     
                });
                
                
                $scope.fullScope = false;
                UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                    $scope.user = data;
                    if($scope.user.userType == 'Master' || $scope.user._id == '5a1831f0bd2adb260055e352'){
                        $scope.fullScope = true;
                    }
                    var viewForm = {
                        state: $state.current.name,
                        claim: false
                    };
                    if($scope.user && $scope.user.userId){
                        viewForm.user = $scope.user.userId
                    }
                    //console.log(JSON.stringify(viewForm));
                    if($cookies.getObject('ip')){
                        var ip = $cookies.getObject('ip');
                        viewForm.ip = ip;
                    }
                    viewService.saveview(viewForm).success(function (data, status, headers) {
                        //console.log('View Marked');
                    })
                    .error(function (data, status, header, config) {
                        console.log();
                    });
                    
                    $scope.assessmentInfo = {
                        name: $scope.user.basic.name,
                        mobile: $scope.user.mobile,
                        email: $scope.user.email,
                        address: '',
                        degree: '',
                        otherdegree: '',
                        stream: '',
                        otherstream: '',
                        agree: false,
                    };

                    Notification.primary({message: "Welcome " + $scope.user.basic.name + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                    var assessmentForm = {
                        user: $scope.user._id,
                        test: $stateParams.testId,
                    };
                    assessmentService.getAssessment(assessmentForm).success(function (adata, status, headers) {
                        $scope.userAssessment = adata;
                        $scope.testOver = false;
                        $scope.testStarted = false;


                        if($scope.userAssessment){
                            $scope.testStarted = true;
                            $scope.endTime = moment($scope.userAssessment._end);
                            var timeNow = moment();
                            if($scope.endTime - timeNow < 0 || $scope.userAssessment.submitted){
                                $scope.testOver = true;
                                console.log('Test is over or submitted');

                            }else{
                                $scope.testOver = false;

                            }

                        }else{
                            $scope.testStarted = false;
                        }
                        getUserResponses();
                        getUserQMarkForReview();
                        getUserQView();
                        $scope.setQuestion($scope.testQuestions[0], 0);
                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                        console.log('Error ' + data + ' ' + status);
                    });



                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "User not logged in!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                //$scope.user = null;
                //$rootScope.$emit("CallBlogLogin", {});
                
                console.log('No User');
                var viewForm = {
                    state: $state.current.name,
                    claim: false
                };
                if($scope.user && $scope.user.userId){
                    viewForm.user = $scope.user.userId
                }
                //console.log(JSON.stringify(viewForm));
                if($cookies.getObject('ip')){
                    var ip = $cookies.getObject('ip');
                    viewForm.ip = ip;
                }
                viewService.saveview(viewForm).success(function (data, status, headers) {
                    //console.log('View Marked');
                })
                .error(function (data, status, header, config) {
                    console.log();
                });
            }
            var optionsPrefix = [
                'A) ',
                'B) ',
                'C) ',
                'D) ',
                'E) ',
                'F) ',
                'G) ',
                'H) ',
            ];


            $scope.submitAssessmentHelper = function(){
                var assessmentForm = {
                    user: $scope.user._id,
                    test: $stateParams.testId,
                };
                assessmentService.submitAssessment(assessmentForm).success(function (adata, status, headers) {
                    Notification.success({message: "Thank you, all done!",  positionY: 'top', positionX: 'right', delay: 1000});
                    $scope.userAssessment = adata;
                    $scope.testOver = false;
                    $scope.testStarted = false;
                    $scope.userevaluate();

                    if($scope.userAssessment){
                        $scope.testStarted = true;
                        $scope.endTime = moment($scope.userAssessment._end);
                        var timeNow = moment();
                        if($scope.endTime - timeNow < 0 || $scope.userAssessment.submitted){
                            $scope.testOver = true;
                            console.log('Test is over or submitted');

                        }else{
                            $scope.testOver = false;

                        }

                    }else{
                        $scope.testStarted = false;
                    }
                    getUserResponses();
                    getUserQMarkForReview();
                    getUserQView();

                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });

            };
            $scope.submitAssessment = function(){
                console.log($scope.isFullScreen);
                var confirm = $mdDialog.confirm()
                .title('Would you like to submit your test?')
                .textContent('You will not be able to access it again!' )
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {

                    $scope.submitAssessmentHelper();


                }, function() {
                  //nothing
                }); 




            }

            $scope.userevaluate = function(){
                var assessmentForm = {
                    user: $scope.user._id,
                    test: $stateParams.testId,
                };

                assessmentService.userevaluate(assessmentForm).success(function (edata, status, headers) {
                    console.log(edata);

                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
            }


            $scope.$watch('subquestion', function (newValue, oldValue, scope) {
                if(newValue != null){
                    $scope.activeQuestionNo = null;
                    var questionId = $scope.question._id;
                    var testQuestionIds = $scope.testQuestions.map(function(a) {return a._id;});

                    var tIndex = testQuestionIds.indexOf(questionId);
                    var thisQuestion = $scope.testQuestions[tIndex];
                    var questionSubQuestionIds = thisQuestion.questions.map(function(a) {return a._id.toString();});
                    var sIndex = questionSubQuestionIds.indexOf($scope.subquestion._id);
                    
                    if(sIndex != -1){
                        $scope.activeQuestionNo = thisQuestion._startnumber + sIndex;
                    }
                    
                    

                }
            }, true);
            //qmarkforreviewService abcd
            $scope.markQuestionForReview = function(question, subquestion){
                var qmarkforreviewForm = {
                    user: $scope.user._id,
                    question: question._id,
                    subquestion: subquestion._id,
                };

                qmarkforreviewService.saveQMarkforReview(qmarkforreviewForm).success(function (data, status, headers) {
                    question.markforreview = true;
                    //Notification.primary({message: "Your question has been marked for review!",  positionY: 'top', positionX: 'left', delay: 2000});
                    //getUserResponses();
                    getUserQMarkForReview();
                    //getUserQView();
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                    console.log('Error ' + data + ' ' + status);
                });
            };
            
            $scope.clearQuestionMarkForReview = function(subquestion){
                
                var userQMarkForReviewSubQuestionIds = $scope.userQMarkForReview.map(function(a) {return a.subquestion.toString();});

                var subquestionId = subquestion._id;
                var uIndex = userQMarkForReviewSubQuestionIds.indexOf(subquestionId);
                if(uIndex != -1){
                    var thisUserQMarkForReview = $scope.userQMarkForReview[uIndex];
                    qmarkforreviewService.removeQMarkforReview(thisUserQMarkForReview._id).success(function (data, status, headers) {
                        //Notification.success({message: "Your question has been unmarked from review!",  positionY: 'top', positionX: 'left', delay: 2000});
                        getUserQMarkForReview();

                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                        console.log('Error ' + data + ' ' + status);
                    });

                }
            };
        
            $scope.clearAnswer = function(subquestion){
                if(subquestion.type =='numerical'){
                    subquestion.userNumericalAnswer = null;
                }
                var userResponseSubQuestionIds = $scope.userResponses.map(function(a) {return a.subquestion.toString();});

                var subquestionId = subquestion._id;
                var uIndex = userResponseSubQuestionIds.indexOf(subquestionId);
                if(uIndex != -1){
                    var thisUserResponse = $scope.userResponses[uIndex];
                    questionresponseService.removeQuestionResponse(thisUserResponse._id).success(function (data, status, headers) {
                        //console.log('All done');
                        getUserResponses();

                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                        console.log('Error ' + data + ' ' + status);
                    });

                }
            };
            


            

            $scope.showInstructionDialog = function(ev) {

                $mdDialog.show({
                  contentElement: '#instructionDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: false,
                  escapeToClose: false,
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            $scope.closeInstructionDialog = function(ev) {

                $mdDialog.hide();
            };
        
            $scope.removeAssessmentDialog = function(){
                var confirm = $mdDialog.confirm()
                .title('Would you like to reset the test?')
                .textContent('You will lose your progress!' )
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.removeAssessment();
                }, function() {
                  //nothing
                });   
            };
        
            $scope.removeAssessment = function(){
                var thisAssessment = {
                    userId: $scope.user._id,
                    testId: $scope.test._id,
                };
                assessmentService.removeAssessment(thisAssessment).success(function (data, status, headers) {
                    Notification.success({message: "Assessment has been reset",  positionY: 'top', positionX: 'left', delay: 10000});
                    $state.reload();

                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'left', delay: 10000});
                    console.log('Error ' + data + ' ' + status);
                });
                
            };
            $scope.startAssessment = function(assessmentInfo) {
                
                $scope.startErrors = [];
                var valid = true;
                if(!assessmentInfo.mobile){
                    assessmentInfo.mobile = '';
                }
                if(assessmentInfo && assessmentInfo.mobile){
                    assessmentInfo.mobile = assessmentInfo.mobile.toString();
                }

                if(!assessmentInfo.agree){
                    valid = false;
                    console.log('1');
                    $scope.startErrors.push('Please agree to terms and conditions.');
                }
                if(assessmentInfo.name.length < 2){
                    valid = false;
                    console.log('2');
                    $scope.startErrors.push('Please enter name');
                }
                console.log(assessmentInfo.mobile);
                if(assessmentInfo.mobile.length < 9){
                    valid = false;
                    console.log('4');
                    $scope.startErrors.push('Please enter a valid mobile number');
                }
                if(assessmentInfo.email.length < 2){
                    valid = false;
                    console.log('3');
                    $scope.startErrors.push('Please enter email');
                }
                
                /*if(!assessmentInfo.degree){
                    valid = false;
                    console.log('5');
                    $scope.startErrors.push('Please select degree');
                }
                if(assessmentInfo.degree == "Others" && assessmentInfo.otherdegree.length < 2){
                    valid = false;
                    console.log('6');
                    $scope.startErrors.push('Please enter Other degree name');
                }
                if(!assessmentInfo.stream){
                    valid = false;
                    console.log('7');
                    $scope.startErrors.push('Please select stream');
                }
                if(assessmentInfo.stream == "Others" && assessmentInfo.otherstream.length < 2){
                    valid = false;
                    console.log('8');
                    $scope.startErrors.push('Please select Other stream name');
                }
                if(assessmentInfo.mobile.length != 10){
                    valid = false;
                    console.log('9');
                    $scope.startErrors.push('Please enter mobile');
                }*/

                if(valid){
                    var timewithbreak = Number($scope.test.duration);
                    var testSections = $scope.test.simulate.sections;
                    if(testSections){
                    testSections.forEach(function(thisSection, index){
                        if(thisSection.timedSeparately){
                            timewithbreak += Number(thisSection.break);
                        }
                    });
                    }
                    
                    var assessmentForm = {
                        user: $scope.user._id,
                        test: $stateParams.testId,
                        info: assessmentInfo,
                        //time: 60,
                        time: $scope.test.duration,
                        timewithbreak: timewithbreak,
                    };
                    assessmentService.saveAssessment(assessmentForm).success(function (adata, status, headers) {
                        $scope.userAssessment = adata;
                        if($scope.userAssessment){
                            $scope.testStarted = true;
                            $scope.endTime = moment($scope.userAssessment._end);
                            var timeNow = moment();
                            if($scope.endTime - timeNow < 0 || $scope.userAssessment.submitted){
                                $scope.testOver = true;
                                console.log('Test is over or submitted');

                            }else{
                                $scope.testOver = false;

                            }

                        }else{
                            $scope.testStarted = false;
                        }
                        getUserResponses();
                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                        console.log('Error ' + data + ' ' + status);
                    });


                }else{
                    Notification.primary({message: "Please fill the form correctly and agree to terms to proceed ahead!",  positionY: 'top', positionX: 'right', delay: 5000});
                }



            };

            window.setInterval(function(){
                //console.log('Here');
                if($scope.userAssessment){
                    var timeNow = moment();
                    if($scope.endTime - timeNow < 0 && !$scope.userAssessment.submitted){
                        console.log('Test is over');
                        $scope.testOver = true;
                        $scope.submitAssessmentHelper();
                    }
                }

            }, 1000);

            /*var vis = (function(){
                var stateKey, eventKey, keys = {
                    hidden: "visibilitychange",
                    webkitHidden: "webkitvisibilitychange",
                    mozHidden: "mozvisibilitychange",
                    msHidden: "msvisibilitychange"
                };
                for (stateKey in keys) {
                    if (stateKey in document) {
                        eventKey = keys[stateKey];
                        break;
                    }
                }
                return function(c) {
                    if (c) document.addEventListener(eventKey, c);
                    return !document[stateKey];
                }
            })();
            var visible = vis();
            vis(function(){
              document.title = vis() ? 'Visible' : 'Not visible';
            });*/

    }]); 
    exambazaar.controller("scheduleQADController", 
        [ '$scope', '$rootScope', 'thisuser', 'allPages', 'socialMediaCredentialService', '$mdDialog', '$timeout', 'examList', 'streamList', 'questionService', function($scope, $rootScope, thisuser, allPages, socialMediaCredentialService, $mdDialog, $timeout, examList, streamList, questionService){
            $scope.user = thisuser.data;
            $scope.allExams = examList.data;
            
            var examIds = $scope.allExams.map(function(a) {return a._id;});
            $scope.allStreams = streamList.data;
            
            if($scope.user._id =='59a7eb973d71f10170dbb468' || $scope.user.userType == 'Master'){
                $scope.masterUser = true;
            }
            
            $rootScope.pageTitle = "Schedule QAD";
            
            $scope.examBadgeClass = function(thisExam){
                var badgeClass = "examTagHolder";
                if($scope.markingPage){
                    var pageExamIds = $scope.markingPage.exams.map(function(a) {return a._id;});
                    if(pageExamIds.indexOf(thisExam._id) != -1){
                        badgeClass = "existingExamTagHolder";
                    }
                }
                return badgeClass;
            };
            $scope.allPages = allPages.data;
            
            $scope.allPages.forEach(function(thisPage, index){
                thisPage.facebook.link = "https://www.facebook.com/" + thisPage.facebook.id;
                
                thisPage.exams.forEach(function(thisExam, eindex){
                    var examIndex = examIds.indexOf(thisExam);
                    if(examIndex != -1){
                        $scope.allPages[index].exams[eindex] = $scope.allExams[examIndex];
                    }
                });
            });
            
            $scope.showSavedDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#savedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            $scope.showPostedDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#postedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            $scope.markingPage = null;
            $scope.showExamDialog = function(page, ev) {
                $scope.markingPage = page;
                console.log($scope.markingPage.exams);
                $mdDialog.show({
                  contentElement: '#examDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            $scope.markExamsDone = function(){
                $mdDialog.hide();    
            };
            
            $scope.addRemovePageExam = function(thisExam){
                if(!$scope.markingPage.exams){
                    $scope.markingPage.exams = [];
                }
                var examIds = $scope.markingPage.exams.map(function(a) {return a._id;});
                var eIndex = examIds.indexOf(thisExam._id);
                console.log(eIndex);
                if(eIndex == -1){
                    $scope.markingPage.exams.push(thisExam._id);
                }else{
                    //exam already exists
                    $scope.markingPage.exams.splice(eIndex, 1);
                }
            };
            
            
            
            
            
            $scope.savePage = function(page){
                if(!page.hashtags){
                    page.hashtags = [];
                }
                page.hashtags.forEach(function(thisHashTag, index){
                    if(thisHashTag == ''){
                        page.hashtags.splice(index, 1);
                    }else{
                        if(thisHashTag.indexOf('#') != 0){
                            page.hashtags[index] = "#" + thisHashTag;
                        }
                    }
                });
                socialMediaCredentialService.saveSocialMediaCredential(page).success(function (data, status, headers) {
                    socialMediaCredentialService.getSocialMediaCredentials().success(function (data, status, headers) {
                        $scope.allPages = data;
                        $scope.allPages.forEach(function(thisPage, index){
                            thisPage.facebook.link = "https://www.facebook.com/" + thisPage.facebook.id;

                            thisPage.exams.forEach(function(thisExam, eindex){
                                var examIndex = examIds.indexOf(thisExam);
                                if(examIndex != -1){
                                    $scope.allPages[index].exams[eindex] = $scope.allExams[examIndex];
                                }
                            });
                        });
                        $scope.showSavedDialog();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });    
            };
            
            $scope.syncFB = function(){
            FB.login(function(response){

            FB.api('/me/accounts', function(response){
            var fbpages = response.data;
            var nPages = fbpages.length;
            var counter = 0;

            fbpages.forEach(function(thisPage, index){
                var p_id = thisPage.id;
                var string_id = '/' + p_id + '/feed';
                var p_accessToken = thisPage.access_token;
                var p_name = thisPage.name;
                var existingPagesFBIds = $scope.allPages.map(function(a) {return a.facebook.id;});
                var eIndex = existingPagesFBIds.indexOf(p_id);
                
                FB.api(string_id, function(response) {
                    thisPage.data = response.data;
                    var newSocialMediaCredential = {
                        platform: 'Facebook',
                        facebook: thisPage,
                        exams: []
                    }; 
                    if(eIndex != -1){
                        
                        var currExams = $scope.allPages[eIndex].exams;
                        if(currExams.length > 0){
                            currExams = currExams.map(function(a) {return a._id;});
                        }
                        newSocialMediaCredential.exams = currExams;
                        
                    }
                    
                    socialMediaCredentialService.saveSocialMediaCredential(newSocialMediaCredential).success(function (data, status, headers) {
                        //console.log(data);
                        counter += 1;
                        if(counter == nPages){
                        socialMediaCredentialService.getSocialMediaCredentials().success(function (data, status, headers) {
                            $scope.allPages = data;
                            $scope.allPages.forEach(function(thisPage, index){
                                thisPage.facebook.link = "https://www.facebook.com/" + thisPage.facebook.id;

                                thisPage.exams.forEach(function(thisExam, eindex){
                                    var examIndex = examIds.indexOf(thisExam);
                                    if(examIndex != -1){
                                        $scope.allPages[index].exams[eindex] = $scope.allExams[examIndex];
                                    }
                                });
                            });
                            
                            
                            $scope.showSavedDialog();
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });

                        }
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                });
            });
            });

            },{scope:'manage_pages,publish_pages'});
            };
            
            $scope.postToFB = function(){
                FB.login(function(response){
                
                FB.api('/me/accounts', function(response){

                var fbpages = response.data;
                fbpages.forEach(function(thisPage, index){
                    
                    var p_id = thisPage.id;
                    var string_id = '/' + p_id + '/feed';
                    var photos_id = '/' + p_id + '/photos';
                    var p_accessToken = thisPage.access_token;
                    var p_name = thisPage.name; 
                    //console.log('The pagename is: '+ p_name + 'Page access token is: ' + p_accessToken);
                    
                    FB.api(string_id, function(response) {
                        //console.log(response);
                        thisPage.data = response.data;
                        console.log(thisPage);
                        var newSocialMediaCredential = {
                            platform: 'Facebook',
                            facebook: thisPage,
                            exams: []
                        };
                        
                        socialMediaCredentialService.saveSocialMediaCredential(newSocialMediaCredential).success(function (data, status, headers) {
                            console.log(data);
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                        
                    });
                    
                    
                    var questionString1 = "Exambazaar Question a Day of " + moment().format("DD MMM YY") + " is: \r\n\r\n";

                    var questionString1 = "Exambazaar Question a Day of " + moment().format("DD MMM YY") + " is: \r\n\r\n";
                    var questionString2 = "Q. A water cooler of storage capacity 120 litres can cool water at a constant rate of P watts. In a closed circulation system (as shown schematically in the figure), the water from the cooler is used to cool an external device that generates constantly 3 kW of heat (thermal load). The temperature of water fed into the device cannot exceed 30 degree celcius and the entire stored 120 litres of water in initially cooled to 10 degree celcius. The entire system is thermally insulated. The minimum value of P (in watts) for which the devicde can be operated for 3 hours is: (specific heat of water is 4.2 kJ per kg per K and the density of water is 1000 kg per meter^3) Î¸  \r\n\r\n";
                    var optionString = [];
                    optionString.push("A. 1600\r\n");
                    optionString.push("B. 2067\r\n");
                    optionString.push("C. 2533\r\n");
                    optionString.push("D. 3933\r\n");


                    var postString = questionString1 + questionString2;

                    optionString.forEach(function(thisOption, index){
                        postString += thisOption;
                    });

                    postString += "\r\n\r\nFor detailed answers and explanations, logon to www.exambazaar.com";
                    postString += "\r\n\r\n\#eqad #exambazaar";

                    var myDate="31-08-2017";
                    myDate=myDate.split("-");
                    var newDate=myDate[1]+"/"+myDate[0]+"/"+myDate[2];
                    var backdate = new Date(newDate).getTime();
                    //console.log(backdate);

                    var scheduledTime = moment().add(10, "minutes").unix();
                    //console.log(scheduledTime);
                    //The specified scheduled publish time is invalid

                    /*FB.api(
                        photos_id,
                        "POST",
                        {
                            "url": "https://exambazaar.s3.amazonaws.com/1ef829c877a8f44c6d755fd7e335ecc2.PNG",
                            access_token : p_accessToken,
                            caption: postString,
                            //no_story:1,
                            //backdated_time : backdate,
                            //published : false,
                            //scheduled_publish_time : scheduledTime,
                            //object_attachment

                        },
                        function (response) {
                          if (response && !response.error) {
                              console.log('Photo Posted');
                              console.log(response);
                              var photoId = response.id;
                              var photoPostId = response.post_id;
                          }else{
                              console.log(response);
                          }
                    });*/
                    /*FB.api(
                        string_id,
                        "POST",
                        {
                            "message": postString,
                            access_token : p_accessToken,
                            //backdated_time : backdate,
                            //published : false,
                            //scheduled_publish_time : scheduledTime,
                            object_attachment:photoId,

                        },
                        function (response) {
                          if (response && !response.error) {
                              console.log('Question Posted');
                              console.log(response);
                          }else{
                              console.log(response);
                          }
                    });*/

                });
                });
                
                },{scope:'manage_pages,publish_pages'});
                
                //publish_actions,
            };
            $scope.addHashtag = function(page){
                if(!page.hashtags){
                    page.hashtags = [];
                }
                page.hashtags.push('');
            };
            $scope.questionToPost = function(page){
                var examArray = page.exams.map(function(a) {return a._id;});
                //console.log(examArray);
                questionService.questionToPost(examArray).success(function (data, status, headers) {
                    var question = data;
                    
                    if(question){
                        $scope.postToFBPage(page, question);
                        
                    }else{
                        alert('Found no question');
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });  
            };
            $scope.buildPostSchedule = function(page){
                var examArray = page.exams.map(function(a) {return a._id;});
                var buildParams = {
                    examArray: examArray,
                    nQuestions: 10,
                };
                //console.log(examArray);
                questionService.buildPostSchedule(examArray).success(function (data, status, headers) {
                    var question = data;
                    
                    if(question){
                        console.log(question);
                        //$scope.postToFBPage(page, question);
                        
                    }else{
                        alert('Found no question');
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });  
            };
            //main posting function
            $scope.postToFBPage = function(page, question){
                console.log('FB Post Initiating');
            var thisPage = page.facebook;
            FB.login(function(response){
                FB.api('/me/accounts', function(response){
                    
                    var nQuestions = question.questions.length;
                    var nImages = 0;
                    if(question.images){
                        nImages = question.images.length;
                    }
                    console.log(question);
                    console.log(nQuestions);
                    console.log(nImages);
                    
                    var p_id = thisPage.id;
                    var string_id = '/' + p_id + '/feed';
                    var photos_id = '/' + p_id + '/photos';
                    var p_accessToken = thisPage.access_token;
                    var p_name = thisPage.name; 
                    //console.log('The pagename is: '+ p_name + 'Page access token is: ' + p_accessToken);
                    var miniseparator = "\r\n";
                    var separator = "\r\n\r\n";
                    var preQText = "EQAD of " + moment().format("DD MMM") + " as appeared in " + question.test.name + " is:" + separator;
                    
                    var totalQtexts = [];
                    if(question.context && question.context.length > 10){
                        totalQtexts.push(question.context + separator);
                    }
                    question.questions.forEach(function(thisQuestion, index){
                        //var thisQuestion = question.questions[0];
                        var qno = index + 1;
                        var Qtext = "Q" + qno + ". " + thisQuestion.question + separator;
                        var optionPrefixes = ["A. ", "B. ", "C. ", "D. ", "E. ", "F. ", "G. "];
                        var optionString = [];
                        var options = thisQuestion.options;
                        var Otext = "";
                        options.forEach(function(thisOption, index){
                            var nextOption = optionPrefixes[index] + thisOption.option + miniseparator;
                            Otext += nextOption;
                        });
                        Otext = Otext + separator;
                        var totalQtext = Qtext + Otext;
                        totalQtexts.push(totalQtext);
                    });
                    
                    var allQText = '';
                    totalQtexts.forEach(function(thisQuestionPart, index){
                        allQText += thisQuestionPart;
                    });
                    
                    var postOText = "For detailed answers and explanations, logon to www.exambazaar.com" + separator;
                    var thisPageHashTags = page.hashtags;
                    if(!thisPageHashTags){
                        thisPageHashTags = [];
                    }
                    var hashTagsList = ['#eqad', '#exambazaar'];
                    thisPageHashTags = thisPageHashTags.concat(hashTagsList);
                    var hashTags = "";
                    thisPageHashTags.forEach(function(thisHashTag, index){
                        hashTags = hashTags + thisHashTag;
                        if(index != thisPageHashTags.length - 1){
                            hashTags = hashTags + " ";
                        }
                        
                        
                    });
                    console.log(hashTags);

                    var postString = preQText + allQText + postOText + hashTags;
                    
                    var myDate="10-09-2017";
                    myDate=myDate.split("-");
                    var newDate=myDate[1]+"/"+myDate[0]+"/"+myDate[2];
                    var backdate = new Date(newDate).getTime();
                    //console.log(backdate);

                    var scheduledTime = moment().add(60, "minutes").unix();
                    //schedule time should be from 10 minutes to 6 months from now
                    
                    if(nImages == 0){
                        FB.api(
                            string_id,
                            "POST",
                            {
                                "message": postString,
                                access_token : p_accessToken,
                                //backdated_time : backdate,
                                published : false,
                                scheduled_publish_time : scheduledTime,

                            },
                            function (response) {
                              if (response && !response.error) {
                                  $scope.showPostedDialog();
                                  console.log('Question Posted');
                                  console.log(response);
                              }else{
                                  console.log(response);
                              }
                        });
                    }else{
                        FB.api(
                        photos_id,
                        "POST",
                        {
                            "url": question.images[0],
                            access_token : p_accessToken,
                            caption: postString,
                            //no_story:1,
                            //backdated_time : backdate,
                            published : false,
                            scheduled_publish_time : scheduledTime,
                            //object_attachment

                        },
                        function (response) {
                          if (response && !response.error) {
                              $scope.showPostedDialog();
                              console.log('Photo Posted');
                              console.log(response);
                              var photoId = response.id;
                              var photoPostId = response.post_id;
                          }else{
                              console.log(response);
                          }
                    });
                    }
                    
                    
                    
                    //console.log(scheduledTime);
                    //The specified scheduled publish time is invalid
                    /*FB.api(
                        photos_id,
                        "POST",
                        {
                            "url": "https://exambazaar.s3.amazonaws.com/1ef829c877a8f44c6d755fd7e335ecc2.PNG",
                            access_token : p_accessToken,
                            caption: postString,
                            //no_story:1,
                            //backdated_time : backdate,
                            //published : false,
                            //scheduled_publish_time : scheduledTime,
                            //object_attachment

                        },
                        function (response) {
                          if (response && !response.error) {
                              console.log('Photo Posted');
                              console.log(response);
                              var photoId = response.id;
                              var photoPostId = response.post_id;
                          }else{
                              console.log(response);
                          }
                    });*/
                    /*FB.api(
                        string_id,
                        "POST",
                        {
                            "message": postString,
                            access_token : p_accessToken,
                            //backdated_time : backdate,
                            //published : false,
                            //scheduled_publish_time : scheduledTime,
                            object_attachment:photoId,

                        },
                        function (response) {
                          if (response && !response.error) {
                              console.log('Question Posted');
                              console.log(response);
                          }else{
                              console.log(response);
                          }
                    });*/
                
                    
                });
            },{scope:'manage_pages,publish_pages'});
                
                //publish_actions,
            };
    }]);    
        
        
    exambazaar.controller("postBlogController", 
        [ '$scope', '$http','$state', '$stateParams','$rootScope', '$cookies', 'UserService', 'Upload', 'ImageService','$mdDialog', '$timeout', 'blogpostService', 'upvoteService', 'allBlogsUpvotesCount', 'allBloggers', 's3UtilsService', 'Notification', function($scope, $http, $state, $stateParams, $rootScope, $cookies, UserService, Upload, ImageService, $mdDialog, $timeout, blogpostService, upvoteService, allBlogsUpvotesCount, allBloggers, s3UtilsService, Notification){
            var allBlogsUpvotesCount = allBlogsUpvotesCount.data;
            $scope.allBloggers = allBloggers.data;
            
            $scope.oneOff = function(){
                blogpostService.oneOff().success(function (blogData, status, headers) {
                    console.log(blogData);

                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });    
            };
            
            var processBlogs = function(){
                var blogUpvotesId = allBlogsUpvotesCount.map(function(a) {return a.blogpost;});
                    $scope.userBlogs.forEach(function(thisBlog, index){
                        var bIndex = blogUpvotesId.indexOf(thisBlog._id);
                        thisBlog.fullurl = "https://www.exambazaar.com/blogpost/" + thisBlog.urlslug;

                        if(bIndex == -1){
                            thisBlog.upvotes = 0;
                        }else{
                            thisBlog.upvotes = allBlogsUpvotesCount[bIndex].upvotes;
                        }

                    });    
            };
            if(!$scope.user){
                if($cookies.getObject('sessionuser')){
                    $scope.user = $cookies.getObject('sessionuser');
                    
                    
                    UserService.getBlogger($scope.user._id).success(function (data, status, headers) {
                        
                        if(data.blogger && data.blogger.active){
                            $scope.blogGallery = data.blogger.gallery;
                            
                            blogpostService.getUserBlogposts($scope.user._id).success(function (blogData, status, headers) {
                                $scope.userBlogs = blogData;
                                processBlogs();



                            })
                            .error(function (data, status, header, config) {
                                console.log("Error ");
                            });
                            
                        }else{
                            $scope.bloggingNotActive = true;
                            Notification.warning("Blogging has not been activated for you yet!");
                        }
                        
                        
                        
                        
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });

                }else{
                    $scope.user = null;
                }
            }
            if($scope.user.userType == 'Master'){
                $scope.masterUser = true;
            }
            
            $scope.downloadCoverPhotos = function(){
                s3UtilsService.downloadFromURLS().success(function (data, status, headers) {
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });     
            };
            
            $scope.credentialsMode = false;
            $scope.setCredentials = function(){
                $scope.credentialsMode = true;
            };
            $scope.saveBlogger = function(){
                $scope.credentialsMode = false;
                UserService.updateUser($scope.user).success(function (data, status, headers) {
                    $scope.showSavedDialog();
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });    
            };
            $scope.uploadBloggerPic = function (newPic) {
            //var pic = $scope.newPic;
            var pic = [newPic];
            var nFiles = pic.length;
            
            var counter = 0;
            console.log(JSON.stringify($scope.user));
            var userId = $scope.user._id;
            if (pic && pic.length) {
            
            pic.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var picLink = $(resp.data).find('Location').text();
                
                var newPicForm ={
                    image: picLink,
                    userId: userId
                };
                
                UserService.addPic(newPicForm).success(function (data, status, headers) {
                    counter = counter + 1;
                    if(counter == nFiles){
                    
                        
                    if($cookies.getObject('sessionuser')){
                        var sessionuser = $cookies.getObject( 'sessionuser');
                        sessionuser.image = picLink;
                        $cookies.putObject('sessionuser', sessionuser);
                    }

                    $state.reload();
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
         };
            
            $scope.blogRowClass = function(thisblog){
                var className = "inactiveBlog";
                if(thisblog.active){
                    className = "activeBlog";
                }
                return className;
            };
            
            $scope.markFlipboardPublish = function(thisblog){
                $mdDialog.hide();
                var timeNow = moment();
                if(!thisblog.flipboard){
                    thisblog.flipboard = {};
                }
                thisblog.flipboard = {
                    published: true,
                    _date: timeNow,
                };
                $scope.updateConfirm(thisblog);
            };
            
            
            
            $rootScope.pageTitle ='Write Blog Post at Exambazaar';
            $scope.refreshVoteCount = function(){
                upvoteService.allBlogsUpvotesCount().success(function (data, status, headers) {
                    var allBlogsUpvotesCount = data;
                    var blogUpvotesId = allBlogsUpvotesCount.map(function(a) {return a.blogpost;});
                    $scope.userBlogs.forEach(function(thisBlog, index){
                        var bIndex = blogUpvotesId.indexOf(thisBlog._id);

                        if(bIndex == -1){
                            thisBlog.upvotes = 0;
                        }else{
                            thisBlog.upvotes = allBlogsUpvotesCount[bIndex].upvotes;
                        }
                    });
                })
                .error(function (data, status, header, config) {
                    console.log();
                });    
            };
            
            $scope.setBlog = function(thisblog){
                $scope.blogpost = thisblog;
            };
            
            
            $scope.mediumBindOptions = {
                buttonLabels: 'fontawesome',
                toolbar: {
                    buttons: ['bold', 'italic', 'underline', 'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull', 'indent', 'outdent', 'anchor', 'h1','h2', 'h3', 'image', 'removeFormat', 'table', 'orderedlist', 'unorderedlist']
                },
                extensions: {
                    table: new MediumEditorTable()
                },
                anchor: {
                    placeholderText: 'Type a link',
                    customClassOption: 'btn',
                    customClassOptionText: 'Create Button'
                },
                keyboardCommands: {
                    /* This example includes the default options for keyboardCommands,
                       if nothing is passed this is what it used */
                    commands: [
                        {
                            command: 'bold',
                            key: 'B',
                            meta: true,
                            shift: false,
                            alt: false
                        },
                        {
                            command: 'italic',
                            key: 'I',
                            meta: true,
                            shift: false,
                            alt: false
                        },
                        {
                            command: 'underline',
                            key: 'U',
                            meta: true,
                            shift: false,
                            alt: false
                        }
                    ],
                }
            };
            $scope.titleBindOptions = {
                toolbar: {
                    buttons: ['bold', 'italic', 'underline', 'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull', 'anchor', 'h1','h2', 'h3','removeFormat']
                },
                disableReturn: true,
                disableExtraSpaces: true,
              
            };
            
            $scope.blogpost = {
                title: '',
                content: ''
            };
            
            $scope.newBlogPost = function(){
                var blogpost = {
                    title: $scope.user.basic.name + ' - new blogpost. Click and Edit! ' + moment().format("DD MMM YY HH:mm"),
                    content: 'You should write your blog here'
                };
                
                var blogpostForm = {
                    user: $scope.user._id,
                    savedBy: $scope.user._id,
                    autosave: false,
                    title: blogpost.title,
                    content: blogpost.content,
                    active: false,
                    urlslug: slugify(blogpost.title)
                };
                for (var property in blogpost) {
                    blogpostForm[property] = blogpost[property];
                }
                blogpostService.saveblogpost(blogpostForm).success(function (data, status, headers) {
                    var blogpostId = data._id;
                    blogpostService.getUserBlogposts($scope.user._id).success(function (data, status, headers) {
                        $scope.userBlogs = data;
                        $scope.refreshVoteCount();
                        //var url = $state.href('editblog', {blogpostId: blogpostId});
                        //window.open(url,'_blank');
                        $state.go('editblog', {blogpostId: blogpostId});
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            
            $scope.cloneConfirm = function(thisblog){
                
                var confirm = $mdDialog.confirm()
                .title('Would you like to create a clone of post titled "' + thisblog.title + '"?')
                .textContent('It was originally authored by ' + thisblog.user.basic.name +"!" )
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.cloneBlogPost(thisblog);
                }, function() {
                  //nothing
                }); 
            };
            
            $scope.cloneBlogPost = function(toCloneBlog){
                var newtitle = toCloneBlog.title + ' - Clone ' + moment().format("DD MMM YY HH:mm");
                var cloneForm = {
                    from: toCloneBlog._id,
                    userId: $scope.user._id,
                    title: newtitle,
                    urlslug: slugify(newtitle)
                };
                blogpostService.cloneblogpost(cloneForm).success(function (data, status, headers) {
                    $scope.userBlogs.push(data);
                    processBlogs();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                
                /*var blogpost = {
                    title: toCloneBlog.title + ' - Clone ' + moment().format("DD MMM YY HH:mm"),
                    content: toCloneBlog.content,
                    savedBy: $scope.user._id,
                    autosave: false
                };
                
                var blogpostForm = {
                    user: $scope.user._id,
                    title: blogpost.title,
                    content: blogpost.content,
                    active: false,
                    urlslug: slugify(blogpost.title)
                };
                for (var property in blogpost) {
                    blogpostForm[property] = blogpost[property];
                }
                
                blogpostService.saveblogpost(blogpostForm).success(function (data, status, headers) {
                    var blogpostId = data._id;
                    blogpostService.getUserBlogposts($scope.user._id).success(function (data, status, headers) {
                        $scope.userBlogs = data;
                        $scope.refreshVoteCount();
                        var url = $state.href('editblog', {blogpostId: blogpostId});
                        window.open(url,'_blank');
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });*/
            };
            
            $scope.removeConfirm = function(thisblog){
                
                var confirm = $mdDialog.confirm()
                .title('Would you like to delete post titled "' + thisblog.title + '"?')
                .textContent('It was authored by ' + thisblog.user.basic.name +"!" )
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.removeBlogPost(thisblog);
                }, function() {
                  //nothing
                }); 
            };
            
            $scope.updateConfirm = function(thisblog){
                if(!thisblog.user || !thisblog.user.basic){
                    thisblog.user = {
                        basic: {
                            name: 'User'
                        }
                    }
                }
                var confirm = $mdDialog.confirm()
                .title('Would you like to update changes to post titled "' + thisblog.title + '"?')
                .textContent('It was authored by ' + thisblog.user.basic.name +"!" )
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.updateBlogPost(thisblog);
                }, function() {
                  //nothing
                }); 
            };
            
            $scope.updateBlogPost = function(thisblog){
                
                 thisblog.savedBy = $scope.user._id;
                 thisblog.autosave = false;
                blogpostService.saveblogpost(thisblog).success(function (data, status, headers) {
                    $scope.showSavedDialog();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });    
            };
            $scope.flipEdbites = function(thisblog){
                if(thisblog.blogSeries == 'EdBites'){
                    $scope.unmarkEdbites(thisblog);
                }else{
                    $scope.markEdbites(thisblog);
                }
            };
            $scope.markEdbites = function(thisblog){
                 blogpostService.markEdbites(thisblog._id).success(function (data, status, headers) {
                    
                     $scope.showSavedDialog();
                     $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });    
            };
            $scope.unmarkEdbites = function(thisblog){
                 blogpostService.unmarkEdbites(thisblog._id).success(function (data, status, headers) {
                    
                     $scope.showSavedDialog();
                     $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });    
            };
            
            $scope.removeBlogPost = function(toRemoveBlog){
                 blogpostService.removeblogpost(toRemoveBlog._id).success(function (data, status, headers) {
                    blogpostService.getUserBlogposts($stateParams.userId).success(function (data, status, headers) {
                        $scope.userBlogs = data;
                        $scope.refreshVoteCount();
                        $scope.showSavedDialog();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            
            $scope.allRandomUpvotes = function(){
                var nBlogs = $scope.userBlogs;
                var counter = 0;
                var totalVotes = 0;
                
                $scope.userBlogs.forEach(function(thisBlog, index){
                    var randomUpvoteForm = {
                        blogpost: thisBlog._id,
                    };
                    upvoteService.randomUpvotes(randomUpvoteForm).success(function (data, status, headers) {
                        totalVotes += data;
                        counter += 1;
                        if(counter == nBlogs){
                            Notification.primary("All blogs upvoted by: " + totalVotes);
                        }

                    })
                    .error(function (data, status, header, config) {
                        console.log();
                    });
                    
                });
                
                
                
            };
            
            $scope.randomUpvotes = function(blogpost){
                var randomUpvoteForm = {
                    blogpost: blogpost._id,
                };
                upvoteService.randomUpvotes(randomUpvoteForm).success(function (data, status, headers) {
                    console.log(data);
                    Notification.primary("This blog upvoted by: " + data);
                    
                })
                .error(function (data, status, header, config) {
                    console.log();
                });
            };
            $scope.sanitizeblogposts = function(){
                blogpostService.sanitizeblogposts().success(function (data, status, headers) {
                    if(data){
                        $scope.showSavedDialog();
                        $state.reload();
                    }else{
                        
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                
            };
            $scope.markAllEdbites = function(){
                blogpostService.markAllEdbites().success(function (data, status, headers) {
                    if(data){
                        $scope.showSavedDialog();
                        $state.reload();
                    }else{
                        
                    }
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                
            };
            $scope.markAllExpertReviews = function(){
                blogpostService.markAllExpertReviews().success(function (data, status, headers) {
                    if(data){
                        $scope.showSavedDialog();
                        $state.reload();
                    }else{
                        
                    }
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                
            };
            $scope.markAllExamPatterns = function(){
                blogpostService.markAllExamPatterns().success(function (data, status, headers) {
                    if(data){
                        $scope.showSavedDialog();
                        $state.reload();
                    }else{
                        
                    }
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                
            };
            
            $scope.removePic = function(image){
                
                var confirm = $mdDialog.confirm()
                .title('Would you like to delete this image?')
                .textContent('You will not be able to restore it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    var newPicForm ={
                        image: image,
                        userId: $scope.user._id
                    }; UserService.removeBlogGalleryPic(newPicForm).success(function (data, status, headers) {
                        UserService.getBlogger($scope.user._id).success(function (data, status, headers) {
                            var userGallery = data.blogger.gallery;
                            //console.log(userGallery);
                            $scope.blogGallery = userGallery;
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                }, function() {
                  //nothing
                }); 
            };
            $scope.uploadPic = function (newPic) {
                //var pic = $scope.newPic;
                var pic = [newPic];
                var nFiles = pic.length;

                var counter = 0;
                //console.log(JSON.stringify($scope.user));
                var userId = $scope.user._id;
                if (pic && pic.length) {

                pic.forEach(function(thisFile, index){
                var fileInfo = {
                    filename: thisFile.name,
                    contentType: thisFile.type
                }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                var s3Request = {};
                var allParams = data.params;
                for (var key in allParams) {
                  if (allParams.hasOwnProperty(key)) {
                    s3Request[key] = allParams[key];
                  }
                }

                s3Request.file = thisFile;
                Upload.upload({
                    url: data.endpoint_url,
                    data: s3Request
                }).then(function (resp) {
                    console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                    var picLink = $(resp.data).find('Location').text();
                    console.log(picLink);
                    

                    var newPicForm ={
                        image: picLink,
                        userId: userId
                    }; UserService.addBlogGalleryPic(newPicForm).success(function (data, status, headers) {
                        UserService.getBlogger($scope.user._id).success(function (data, status, headers) {
                            var userGallery = data.blogger.gallery;
                            //console.log(userGallery);
                            $scope.blogGallery = userGallery;
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                        //$state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    }, function (resp) {
                        console.log('Error status: ' + resp.status);
                    }, function (evt) {

                    });

                })
                .error(function (data, status, header, config) {
                    console.log("Error");
                });   

                });
                }
             };
            
             $scope.showCopiedDialog = function(text, ev) {
                $scope.copiedText = text;
                $mdDialog.show({
                  contentElement: '#copiedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },500)
            };
            $scope.showFlipboardDialog = function(thisblog, ev) {
                $scope.flipboardBlog = thisblog;
                $mdDialog.show({
                  contentElement: '#flipboardDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            $scope.seeDescription = function(){
                
                /*var remove = "<div class=";
                var rIndex = $scope.blogpost.content.indexOf(remove);
                $scope.blogpost.content = $scope.blogpost.content.substring(0, rIndex);*/
                console.log(JSON.stringify($scope.blogpost.content));
                $scope.markdownText = toMarkdown($scope.blogpost.content);
                console.log(JSON.stringify($scope.markdownText));
                
                var converter = new Showdown.converter();
                $scope.htmlText = converter.makeHtml($scope.markdownText);
                
            };
            
            $scope.saveBlogPost = function(blogpost){
                var blogpostForm = {
                    user: $scope.user._id,
                    title: blogpost.title,
                    content: blogpost.content,
                };
                if(blogpost._id){
                    blogpostForm._id = blogpost._id;
                }
                blogpostService.saveblogpost(blogpostForm).success(function (data, status, headers) {
                    $scope.showSavedDialog();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            $scope.previewBlogPost = function(blogpost){
                var blogpostSlug = blogpost.urlslug;
                //console.log(blogpostSlug);

                var url = $state.href('showblog', {blogpostSlug: blogpostSlug});
                window.open(url,'_blank');
            };
            $scope.editBlogPost = function(blogpost){
                var blogpostId = blogpost._id;
                var url = $state.href('editblog', {blogpostId: blogpostId});
                window.open(url,'_blank');
            };
            $scope.showSavedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#savedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            $scope.showRemovedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#removeDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            
            
            
            
            
    }]);       
    
    
    exambazaar.controller("coachingGroupSummaryController", 
        [ '$scope', '$http', '$rootScope','$state', '$mdDialog', 'MasterService','groupSummary', 'examList', 'streamList', function($scope, $http, $rootScope, $state, $mdDialog, MasterService, groupSummary, examList, streamList){
            
            $rootScope.pageTitle = 'EB Coaching Group Summary';
            $scope.allGroups = groupSummary.data;
            $scope.groupSummary = $scope.allGroups;
            $scope.examList = examList.data;
            $scope.allExams = $scope.examList;
            $scope.allStreams = streamList.data;
            var examIds = $scope.examList.map(function(a) {return a._id;});
            $scope.groupSummary.forEach(function(thisGroup, gindex){
                var thisExams = thisGroup.exams;
                var allExams = [];
                thisExams.forEach(function(thisExam, eindex){
                    var exIndex = examIds.indexOf(thisExam);
                    if(exIndex != -1){
                        //thisExam = $scope.examList[exIndex];
                        allExams.push($scope.examList[exIndex]);
                    }else{
                        console.log('something is wrong: ' + thisExam);
                    }
                });
                thisGroup.exams = allExams;
            });
            $scope.searchExams = [];
            
            $scope.addExam = function(exam){
                var examId = exam._id;
                var eIndex = $scope.searchExams.indexOf(examId);
                if(eIndex == -1){
                    $scope.searchExams.push(examId.toString());
                }
            };
            $scope.removeExam = function(exam){
                var examId = exam._id;
                var eIndex = $scope.searchExams.indexOf(examId);
                if(eIndex != -1){
                    $scope.searchExams.splice(eIndex, 1);
                }
            };
            $scope.filterCoachings = function(){
                console.log($scope.searchExams);
                $scope.groupSummary = [];
                
                $scope.allGroups.forEach(function(thisGroup, gindex){
                    var thisFilter = false;
                    var thisExams = thisGroup.exams;
                    thisExams = thisExams.map(function(a) {return a._id.toString();});
                    
                    $scope.searchExams.forEach(function(thisExam, eindex){
                        if(!thisFilter){
                            var exIndex = thisExams.indexOf(thisExam);
                            if(exIndex != -1){
                                thisFilter = true;
                            }
                        }
                        
                    });
                    if(thisFilter > 0){
                        $scope.groupSummary.push(thisGroup);
                        
                        console.log(thisGroup.name);
                    }
                });
                $mdDialog.hide();
            };
            $scope.showExamDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#examDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
    }]); 
    exambazaar.controller("extractEmailsController", 
        [ '$scope', '$http', '$rootScope','$state', '$mdDialog', 'MasterService', 'collegeService', function($scope, $http, $rootScope, $state, $mdDialog, MasterService, collegeService){
            
            $rootScope.pageTitle = 'Extract Emails';
            
            
            $scope.emails= [];
            $scope.extractEmails = function()
            {
                $scope.emails = $scope.text.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);
                console.log($scope.emails);
            };
            //$scope.text = 'sdabhikagathara@rediffmail.com, "assdsdf" <dsfassdfhsdfarkal@gmail.com>, "rodnsdfald ferdfnson" <rfernsdfson@gmal.com>, "Affdmdol Gondfgale" <gyfanamosl@gmail.com>, "truform techno" <pidfpinfg@truformdftechnoproducts.com>, "NiTsdfeSh ThIdfsKaRe" <nthfsskare@ysahoo.in>, "akasdfsh kasdfstla" <akashkatsdfsa@yahsdfsfoo.in>, "Bisdsdfamal Prakaasdsh" <bimsdaalprakash@live.com>,; "milisdfsfnd ansdfasdfnsftwar" <dfdmilifsd.ensfdfcogndfdfatia@gmail.com>';
            $scope.text = '';
            $scope.limit = 1000;
            $scope.skip = 0;
            $scope.extractEmailfromIds = function(){
                var params = {
                    limit: parseInt($scope.limit),   
                    skip: parseInt($scope.skip),   
                };
                
                MasterService.extractEmails(params).success(function (data, status, headers) {
                    console.log(data);
                    $scope.skip = parseInt($scope.skip) + parseInt($scope.limit);
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            };
            $scope.extractknowyourcollege = function(){
                var collegeIds = [
                    '1-10001284',
'1-10002971',
'1-10003861',
'1-10003974',
'1-10007463',
'1-10008111',
'1-10009621',
'1-10009924',
'1-10012771',
'1-10014231',
'1-10015407',
'1-10023722',
'1-10023904',
'1-10023931',
'1-1002563391',
'1-10027961',
'1-10031491',
'1-10033913',
'1-10034141',
'1-10035944',
'1-10037341',
'1-10038704',
'1-10041131',
'1-10041361',
'1-10041741',
'1-10043091',
'1-10043414',
'1-10043855',
'1-10046661',
'1-10047884',
'1-10057434',
'1-10058361',
'1-10061731',
'1-10061874',
'1-10063464',
'1-10064214',
'1-10064364',
'1-10065871',
'1-10066704',
'1-10067204',
'1-10074001',
'1-10074451',
'1-10082920',
'1-10083071',
'1-10083441',
'1-10086261',
'1-10088401',
'1-10092144',
'1-10092973',
'1-10093904',
'1-10094311',
'1-10094841',
'1-10094951',
'1-10096671',
'1-10097031',
'1-10099511',
'1-10100121',
'1-10106241',
'1-10107051',
'1-10108482',
'1-10122092',
'1-10124001',
'1-10124644',
'1-10125164',
'1-10132661',
'1-10133101',
'1-10137131',
'1-10141114',
'1-10144991',
'1-10152184',
'1-10152701',
'1-10152794',
'1-10155081',
'1-10155621',
'1-10158131',
'1-10164651',
'1-10164951',
'1-10174461',
'1-10176304',
'1-10176721',
'1-10177351',
'1-10178764',
'1-10184281',
'1-10185957',
'1-10189031',
'1-10190374',
'1-10191041',
'1-10208791',
'1-10213343',
'1-10214744',
'1-10215161',
'1-10217461',
'1-10217584',
'1-10222661',
'1-10223338',
'1-10223991',
'1-10229401',
'1-10229711',
'1-10233347',
'1-10233900',
'1-10238381',
'1-10248896',
'1-10255711',
'1-10259071',
'1-10261013',
'1-10264741',
'1-10271391',
'1-10276231',
'1-10276271',
'1-10276401',
'1-10277621',
'1-10279691',
'1-10281414',
'1-10282064',
'1-10291401',
'1-10292774',
'1-10293721',
'1-10294391',
'1-10295411',
'1-10295521',
'1-10297546',
'1-10297895',
'1-10305221',
'1-10305491',
'1-10306294',
'1-10306541',
'1-10306663',
'1-10308701',
'1-10310314',
'1-10311357',
'1-10311411',
'1-10311624',
'1-10318474',
'1-10319004',
'1-10330551',
'1-1033271921',
'1-10339771',
'1-10339953',
'1-10345511',
'1-10347270',
'1-1035145281',
'1-1035511421',
'1-10355141',
'1-10355851',
'1-10359491',
'1-10365041',
'1-10366504',
'1-1037108351',
'1-1037261391',
'1-10374444',
'1-10377141',
'1-10377495',
'1-1037776551',
'1-1037778081',
'1-10377811',
'1-10377881',
'1-10378961',
'1-10381411',
'1-10385851',
'1-10385884',
'1-10389501',
'1-1039532121',
'1-10398731',
'1-10400211',
'1-10401911',
'1-10402107',
'1-10406098',
'1-10406955',
'1-10413134',
'1-10417491',
'1-10421016',
'1-10423931',
'1-10425346',
'1-10429151',
'1-10433274',
'1-10435123',
'1-10435671',
'1-10437914',
'1-10444003',
'1-10445831',
'1-10446591',
'1-10447061',
'1-10448131',
'1-1045157161',
'1-10452961',
'1-10453831',
'1-1045774011',
'1-1045796631',
'1-10459491',
'1-10460724',
'1-10467791',
'1-10473051',
'1-10476194',
'1-10482254',
'1-10485891',
'1-10487371',
'1-10487461',
'1-10488201',
'1-10490265',
'1-1049358594',
'1-1049369841',
'1-10497141',
'1-10497903',
'1-10506381',
'1-10509289',
'1-10509624',
'1-10510041',
'1-10512404',
'1-1052010131',
'1-10521211',
'1-10525271',
'1-1053089281',
'1-10533431',
'1-10535291',
'1-10540411',
'1-10564221',
'1-10566087',
'1-10567201',
'1-10568531',
'1-10572063',
'1-10573051',
'1-10575091',
'1-10575231',
'1-10580691',
'1-10586051',
'1-10596731',
'1-10603013',
'1-10603861',
'1-10604314',
'1-10605091',
'1-10607954',
'1-10612311',
'1-10615381',
'1-10616271',
'1-10619031',
'1-10619874',
'1-10626904',
'1-10637961',
'1-10643461',
'1-10645161',
'1-10645651',
'1-10652331',
'1-10654831',
'1-10657304',
'1-10657821',
'1-10665381',
'1-10667944',
'1-10669191',
'1-10683951',
'1-10684930',
'1-10688251',
'1-10693853',
'1-10702401',
'1-10704678',
'1-10706530',
'1-10711331',
'1-10721663',
'1-10726211',
'1-10728705',
'1-10728988',
'1-10731053',
'1-10732431',
'1-10735731',
'1-10736057',
'1-10737121',
'1-10737174',
'1-10740424',
'1-10746341',
'1-10746884',
'1-10750627',
'1-10750751',
'1-10751031',
'1-10751201',
'1-10751831',
'1-10754974',
'1-10755724',
'1-10760565',
'1-10760791',
'1-10762621',
'1-10764461',
'1-10765421',
'1-10766444',
'1-10768621',
'1-10769834',
'1-10771321',
'1-10777084',
'1-10784274',
'1-10784317',
'1-10784774',
'1-10785021',
'1-10787922',
'1-10801171',
'1-10802821',
'1-10804531',
'1-10804971',
'1-10805621',
'1-10807611',
'1-10811151',
'1-10813514',
'1-10820815',
'1-10824423',
'1-10825981',
'1-10826069',
'1-10829284',
'1-10829988',
'1-10830181',
'1-10830963',
'1-10831271',
'1-10835551',
'1-10836733',
'1-10850261',
'1-10850721',
'1-10862231',
'1-10864261',
'1-10864621',
'1-10865553',
'1-10871665',
'1-10876351',
'1-10889270',
'1-10896871',
'1-10903001',
'1-10905891',
'1-10906901',
'1-10906981',
'1-10907041',
'1-10911973',
'1-10912721',
'1-10913057',
'1-1091407351',
'1-10914111',
'1-10916654',
'1-10920321',
'1-10939912',
'1-10951181',
'1-10952891',
'1-10954713',
'1-10955051',
'1-10956291',
'1-10958311',
'1-10961001',
'1-10964216',
'1-10970301',
'1-10989481',
'1-10993511',
'1-10997771',
'1-10998561',
'1-11001341',
'1-11002585',
'1-11003077',
'1-11017229',
'1-11020851',
'1-11021865',
'1-11027101',
'1-11032151',
'1-11037521',
'1-11038694',
'1-11040671',
'1-11054401',
'1-11068223',
'1-11068304',
'1-11074123',
'1-11077531',
'1-11081222',
'1-11102551',
'1-11102614',
'1-11104730',
'1-11115474',
'1-11120794',
'1-11128101',
'1-11133581',
'1-11135071',
'1-11136715',
'1-11138404',
'1-11140211',
'1-11152131',
'1-11152222',
'1-11164071',
'1-11171561',
'1-11187346',
'1-11194083',
'1-11204364',
'1-11204611',
'1-11211149',
'1-11223344',
'1-11237211',
'1-11237794',
'1-11238061',
'1-11264181',
'1-11265731',
'1-11269175',
'1-11273231',
'1-11276258',
'1-11278401',
'1-11279613',
'1-11282634',
'1-11292931',
'1-11299251',
'1-11306504',
'1-11307927',
'1-11321556',
'1-11327101',
'1-11327871',
'1-11338124',
'1-11339741',
'1-11344171',
'1-11345621',
'1-11346262',
'1-11346471',
'1-11346974',
'1-11354551',
'1-11354561',
'1-11358001',
'1-11359521',
'1-11359974',
'1-11360531',
'1-11365721',
'1-11391341',
'1-11405511',
'1-11432511',
'1-11448494',
'1-11451491',
'1-11477172',
'1-11477181',
'1-11478661',
'1-11481924',
'1-11486141',
'1-11492251',
'1-11510036',
'1-11516541',
'1-11516701',
'1-11517571',
'1-11521481',
'1-1154304341',
'1-11543951',
'1-11557861',
'1-11564604',
'1-11565519',
'1-11569944',
'1-11578165',
'1-11581657',
'1-11583021',
'1-11584331',
'1-11599471',
'1-11632701',
'1-11634234',
'1-11636111',
'1-11639121',
'1-11643478',
'1-11647102',
'1-11650111',
'1-11650616',
'1-11652107',
'1-11652185',
'1-11658101',
'1-11675141',
'1-11680601',
'1-11686214',
'1-11715987',
'1-11719075',
'1-11741041',
'1-11755921',
'1-11759291',
'1-11762850',
'1-11770524',
'1-11778261',
'1-11812251',
'1-11823591',
'1-11830441',
'1-11838601',
'1-11849261',
'1-11862950',
'1-11863731',
'1-11878126',
'1-11885876',
'1-11887784',
'1-11899124',
'1-11925484',
'1-11931373',
'1-11934400',
'1-11935694',
'1-11936551',
'1-11936911',
'1-11940601',
'1-11958015',
'1-11965891',
'1-11989651',
'1-11994551',
'1-12002071',
'1-12002901',
'1-12036461',
'1-12053991',
'1-12056621',
'1-12056881',
'1-12060061',
'1-12069191',
'1-12072791',
'1-12085611',
'1-12085801',
'1-12090891',
'1-1209121',
'1-12094754',
'1-12109971',
'1-12120544',
'1-12127561',
'1-12134923',
'1-12136136',
'1-12143731',
'1-12143791',
'1-12167101',
'1-12169113',
'1-12175401',
'1-12176161',
'1-12178111',
'1-12195531',
'1-12200121',
'1-12200161',
'1-12266207',
'1-1227101',
'1-12277633',
'1-12280101',
'1-1229101',
'1-1230746451',
'1-12313824',
'1-12314001',
'1-12318743',
'1-12332891',
'1-12340827',
'1-12344381',
'1-12346111',
'1-12356524',
'1-12360011',
'1-12360176',
'1-12360605',
'1-1237131',
'1-12371754',
'1-12373983',
'1-12374081',
'1-12380521',
'1-12383211',
'1-12384281',
'1-12393881',
'1-12396741',
'1-12404911',
'1-12407071',
'1-12407161',
'1-12420161',
'1-12421161',
'1-12477141',
'1-12514811',
'1-12521481',
'1-1252477951',
'1-12527441',
'1-12529801',
'1-12529971',
'1-12530161',
'1-12534421',
'1-12544431',
'1-12549734',
'1-12549811',
'1-12563697',
'1-12565831',
'1-12586204',
'1-12588797',
'1-12589174',
'1-12590881',
'1-12591731',
'1-12595454',
'1-12596211',
'1-12606241',
'1-12612941',
'1-12614931',
'1-12638551',
'1-12669431',
'1-12682946',
'1-12689081',
'1-12704269',
'1-12748731',
'1-12785291',
'1-12785341',
'1-12786234',
'1-12822363',
'1-12828421',
'1-12841261',
'1-12863243',
'1-12912151',
'1-12915271',
'1-12939741',
'1-12942597',
'1-12958225',
'1-12961701',
'1-12974226',
'1-12974731',
'1-12974863',
'1-12993504',
'1-12999241',
'1-13003614',
'1-13060751',
'1-13109204',
'1-13118164',
'1-13119431',
'1-13120911',
'1-13121734',
'1-1313769821',
'1-13158634',
'1-13159881',
'1-13173251',
'1-13177981',
'1-13181371',
'1-13184564',
'1-13186164',
'1-13192961',
'1-13202501',
'1-13238621',
'1-13240611',
'1-13245521',
'1-13246644',
'1-13246964',
'1-13247321',
'1-13247411',
'1-13248581',
'1-13249271',
'1-13278941',
'1-13285644',
'1-13288233',
'1-13310735',
'1-13315171',
'1-13323323',
'1-13324331',
'1-13327111',
'1-13328406',
'1-13342175',
'1-13346994',
'1-13347267',
'1-13352801',
'1-1335491',
'1-13364111',
'1-13370661',
'1-13371151',
'1-13392996',
'1-13393212',
'1-13407014',
'1-13419201',
'1-13439501',
'1-1344171',
'1-13444823',
'1-13444841',
'1-13448361',
'1-13448924',
'1-13456471',
'1-13456611',
'1-13459411',
'1-1345983571',
'1-13462784',
'1-13464971',
'1-13467551',
'1-13475301',
'1-13485391',
'1-13488681',
'1-1349328411',
'1-13493571',
'1-13495321',
'1-1349697224',
'1-13499321',
'1-13499771',
'1-1350097261',
'1-13503171',
'1-13511644',
'1-13514891',
'1-13522523',
'1-13533854',
'1-13536434',
'1-13538393',
'1-13540901',
'1-13541961',
'1-1357746137',
'1-1358082621',
'1-1358418621',
'1-13585843',
'1-13585987',
'1-1359580791',
'1-13598791',
'1-1361766091',
'1-1361790601',
'1-13632741',
'1-13635421',
'1-13636687',
'1-13650104',
'1-13654681',
'1-13659071',
'1-1366332831',
'1-13664711',
'1-13673044',
'1-13683922',
'1-13712921',
'1-13715891',
'1-1371793371',
'1-13732431',
'1-13734711',
'1-1374426715',
'1-1374497891',
'1-1377009331',
'1-13798941',
'1-13809617',
'1-13845051',
'1-1386070921',
'1-1386427851',
'1-1386480101',
'1-13883614',
'1-13887371',
'1-13889369',
'1-13892711',
'1-1390393261',
'1-1390404971',
'1-1391096971',
'1-13916021',
'1-13919931',
'1-13929861',
'1-13936731',
'1-13937727',
'1-13965411',
'1-13967731',
'1-14036241',
'1-1404766831',
'1-14068819',
'1-1412872211',
'1-1412925581',
'1-14144501',
'1-14145451',
'1-14145641',
'1-14150151',
'1-1415075774',
'1-14151804',
'1-14152622',
'1-14155411',
'1-14163741',
'1-14166661',
'1-14171561',
'1-14177311',
'1-14182101',
'1-14187211',
'1-14189514',
'1-14193691',
'1-1419517371',
'1-14207221',
'1-14214221',
'1-1423258331',
'1-14234843',
'1-1423562371',
'1-1423868961',
'1-14253613',
'1-14253853',
'1-14257321',
'1-14264421',
'1-14266274',
'1-14269401',
'1-1427432091',
'1-14290541',
'1-14294724',
'1-14302451',
'1-14311971',
'1-14312367',
'1-14318331',
'1-14327361',
'1-14329571',
'1-1433116641',
'1-14336361',
'1-14342823',
'1-14343071',
'1-14355955',
'1-14359478',
'1-14368851',
'1-1437395791',
'1-1437622971',
'1-14377191',
'1-14378501',
'1-14402661',
'1-14418245',
'1-14418701',
'1-14418731',
'1-14419987',
'1-1443729831',
'1-14438191',
'1-14439301',
'1-1445384161',
'1-1445565881',
'1-14461931',
'1-1447551291',
'1-1447826261',
'1-1448217351',
'1-1448230001',
'1-14482661',
'1-14483404',
'1-14490169',
'1-1449696124',
'1-14497487',
'1-14498491',
'1-1450050351',
'1-1450081741',
'1-14502953',
'1-14507841',
'1-14513151',
'1-1451375411',
'1-1451378891',
'1-1451815051',
'1-14520781',
'1-14525534',
'1-1452943251',
'1-1455267131',
'1-1455436001',
'1-1455442721',
'1-1457037931',
'1-1457119781',
'1-1457151624',
'1-14577031',
'1-1457799691',
'1-14581481',
'1-1458642824',
'1-14594878',
'1-14596864',
'1-1459753621',
'1-14597691',
'1-14598214',
'1-14601229',
'1-14610511',
'1-14610587',
'1-1461348261',
'1-1461438701',
'1-14615837',
'1-1461615081',
'1-14617111',
'1-14618981',
'1-14621747',
'1-14621931',
'1-14626132',
'1-14627816',
'1-14629401',
'1-14630341',
'1-14633841',
'1-14635781',
'1-14637064',
'1-14637301',
'1-1463875701',
'1-14640945',
'1-14641701',
'1-14644461',
'1-14648271',
'1-14651841',
'1-1465226521',
'1-1465664891',
'1-1465848681',
'1-14658841',
'1-14665501',
'1-14666921',
'1-14677794',
'1-14678821',
'1-14683203',
'1-14684551',
'1-1468829561',
'1-14691744',
'1-14694944',
'1-14697201',
'1-1469843681',
'1-1469854221',
'1-14699598',
'1-14701651',
'1-14702891',
'1-1471259901',
'1-14713524',
'1-1471615381',
'1-14720233',
'1-14724311',
'1-14726147',
'1-14728541',
'1-14729741',
'1-1473500971',
'1-1473953971',
'1-14752081',
'1-1475767801',
'1-1475895021',
'1-1476111671',
'1-14761469',
'1-14765426',
'1-14774551',
'1-14776451',
'1-14776534',
'1-14782151',
'1-1478519151',
'1-1478954311',
'1-1479054591',
'1-14797951',
'1-1480889841',
'1-1481358131',
'1-1481600021',
'1-14816021',
'1-14827881',
'1-1482808181',
'1-14835021',
'1-14835891',
'1-1484303611',
'1-14844341',
'1-1484495891',
'1-14850314',
'1-1485678181',
'1-1485694281',
'1-14859171',
'1-14863571',
'1-1486931211',
'1-14877641',
'1-1488044611',
'1-1488562551',
'1-14892721',
'1-14894593',
'1-1489643151',
'1-14897751',
'1-1489974291',
'1-1490035851',
'1-1490534571',
'1-14909641',
'1-1490972671',
'1-14914504',
'1-1491527901',
'1-1491551471',
'1-14916831',
'1-14931432',
'1-14932291',
'1-1494356351',
'1-14943881',
'1-14944751',
'1-14953351',
'1-14959364',
'1-14962834',
'1-14962904',
'1-1496623711',
'1-1496968641',
'1-1497017841',
'1-1497235264',
'1-14972823',
'1-14981451',
'1-1498261731',
'1-1498455391',
'1-1498909591',
'1-1499357811',
'1-1499476541',
'1-1499668401',
'1-1499711421',
'1-1500136501',
'1-1500345031',
'1-1500557231',
'1-1500593491',
'1-1500823201',
'1-15018311',
'1-1502020421',
'1-15028501',
'1-1502860331',
'1-15029771',
'1-1503749921',
'1-1504674361',
'1-1504712991',
'1-15047367',
'1-1504882511',
'1-15049654',
'1-1505586841',
'1-15056181',
'1-1505869571',
'1-1505902131',
'1-1505905911',
'1-1505920251',
'1-15063651',
'1-1506736841',
'1-15067981',
'1-15068215',
'1-15068805',
'1-1507402981',
'1-1507444831',
'1-1507445741',
'1-1507791051',
'1-1507864111',
'1-1508020141',
'1-1508213381',
'1-15086751',
'1-1508705311',
'1-1509181971',
'1-1509525111',
'1-1509873891',
'1-15100841',
'1-1510254684',
'1-15104851',
'1-15105294',
'1-1510604571',
'1-1510759331',
'1-1510868851',
'1-15112467',
'1-15116411',
'1-1511762071',
'1-1511969101',
'1-15125684',
'1-1512770921',
'1-15130501',
'1-1513138521',
'1-15135074',
'1-15135131',
'1-1513618957',
'1-1513701431',
'1-15139201',
'1-15140441',
'1-15141651',
'1-15143531',
'1-15144271',
'1-15145021',
'1-15151529',
'1-15151891',
'1-15161971',
'1-1516349281',
'1-1517817431',
'1-1518001051',
'1-15197151',
'1-1519894261',
'1-15216741',
'1-1522183741',
'1-15232571',
'1-15233054',
'1-1524013701',
'1-1524174547',
'1-1524320201',
'1-1524553524',
'1-15250304',
'1-15254047',
'1-15260084',
'1-1526331541',
'1-15272471',
'1-15274663',
'1-15279821',
'1-15280521',
'1-1528156611',
'1-1528580191',
'1-1528642701',
'1-15288791',
'1-1529259281',
'1-1529568061',
'1-1530689271',
'1-15322531',
'1-1532423211',
'1-15328981',
'1-15335344',
'1-1536103181',
'1-15363534',
'1-1537520451',
'1-1537599761',
'1-1538283341',
'1-1538431511',
'1-1538446771',
'1-1538603311',
'1-15393131',
'1-15395954',
'1-1540101501',
'1-1540123764',
'1-1541844151',
'1-1542464911',
'1-1542771',
'1-15432521',
'1-1543501471',
'1-15447541',
'1-1544998591',
'1-1545691',
'1-1547761',
'1-15482853',
'1-1548741',
'1-1548838071',
'1-1549555521',
'1-1549625394',
'1-1549983557',
'1-1550031721',
'1-1550242781',
'1-15511421',
'1-15514615',
'1-15514691',
'1-1552021',
'1-15520641',
'1-1552084781',
'1-1552165281',
'1-1552167861',
'1-1552859701',
'1-1553320761',
'1-1553433091',
'1-1553561021',
'1-1553613581',
'1-1553813651',
'1-15539545',
'1-1554963711',
'1-1555166801',
'1-1555272361',
'1-1555320081',
'1-15553783',
'1-15554015',
'1-1555647901',
'1-1556294291',
'1-1556632501',
'1-1556763671',
'1-15570431',
'1-15572441',
'1-15573321',
'1-1557930161',
'1-1558651',
'1-15594261',
'1-15596151',
'1-1559901921',
'1-1559911',
'1-1560595351',
'1-1560964531',
'1-15611551',
'1-1561390821',
'1-1561593671',
'1-1561615141',
'1-15629231',
'1-1563312101',
'1-1563367701',
'1-15638101',
'1-15650003',
'1-15654011',
'1-15685551',
'1-15722591',
'1-15727284',
'1-15730244',
'1-1573026321',
'1-1573036931',
'1-15740366',
'1-1574475961',
'1-1574537901',
'1-1574674941',
'1-15748414',
'1-1576220901',
'1-1576339441',
'1-15776171',
'1-1578156211',
'1-15782701',
'1-1578967421',
'1-1579527681',
'1-15800151',
'1-15804431',
'1-15807391',
'1-15813371',
'1-1581447551',
'1-15816744',
'1-1582815151',
'1-1582903401',
'1-1584222811',
'1-15843806',
'1-15868911',
'1-15892424',
'1-15892694',
'1-15892871',
'1-1590439441',
'1-1590578881',
'1-15906961',
'1-15912061',
'1-15916211',
'1-15920071',
'1-15929831',
'1-15932481',
'1-15937511',
'1-15938264',
'1-15940854',
'1-1594991101',
'1-1596880521',
'1-1597246681',
'1-15972471',
'1-1599017631',
'1-1599195881',
'1-16006381',
'1-16023751',
'1-1602794150',
'1-1603766537',
'1-16038681',
'1-16049655',
'1-1605311911',
'1-1605393621',
'1-1605574701',
'1-1605736261',
'1-16065021',
'1-1606601981',
'1-1607768251',
'1-16102413',
'1-1611428311',
'1-1612213401',
'1-1614533711',
'1-1614611581',
'1-1614638421',
'1-1614644911',
'1-1614715451',
'1-1614769721',
'1-16148771',
'1-1614964791',
'1-1614968231',
'1-1614969081',
'1-1614969551',
'1-1614981631',
'1-1615031191',
'1-16154671',
'1-16155411',
'1-1615810791',
'1-16163611',
'1-16164623',
'1-16176971',
'1-16177771',
'1-16212721',
'1-16229131',
'1-16255851',
'1-16274307',
'1-16277883',
'1-16284341',
'1-16290011',
'1-16290594',
'1-16298721',
'1-1630281',
'1-1630347',
'1-1630407',
'1-1630541',
'1-16315001',
'1-16332061',
'1-16381801',
'1-16393231',
'1-16396451',
'1-16423771',
'1-16428201',
'1-16429411',
'1-16433411',
'1-16461651',
'1-16471761',
'1-16481761',
'1-16487004',
'1-16497744',
'1-16497941',
'1-16507111',
'1-16515264',
'1-16544034',
'1-16549401',
'1-16555513',
'1-16570211',
'1-16582091',
'1-16583694',
'1-16627851',
'1-16638665',
'1-16655331',
'1-16692924',
'1-16740411',
'1-16765001',
'1-1677171',
'1-16783591',
'1-16820951',
'1-16821231',
'1-16872534',
'1-16873381',
'1-16881901',
'1-16890036',
'1-16891151',
'1-16895401',
'1-16903964',
'1-16906883',
'1-16908541',
'1-16908673',
'1-1691341',
'1-16941464',
'1-16962391',
'1-16962461',
'1-16970811',
'1-16971371',
'1-16977553',
'1-16992591',
'1-16992934',
'1-16994991',
'1-17022641',
'1-17032284',
'1-17048921',
'1-17079521',
'1-1708512281',
'1-17089421',
'1-17097385',
'1-1710521',
'1-1710534',
'1-1710591',
'1-1710731',
'1-1711090',
'1-17119971',
'1-17122811',
'1-17123263',
'1-17125611',
'1-17136821',
'1-17137879',
'1-17142914',
'1-1719445',
'1-1719901',
'1-1720061',
'1-1721484',
'1-1721491',
'1-1721502',
'1-1722531',
'1-1722907',
'1-17234051',
'1-1723411',
'1-17237531',
'1-1724675',
'1-17247811',
'1-17257771',
'1-17258553',
'1-17260993',
'1-17264464',
'1-1726621',
'1-1728281',
'1-17284151',
'1-17285304',
'1-17293845',
'1-17314721',
'1-17330985',
'1-1734491',
'1-17345051',
'1-17346571',
'1-17351823',
'1-17355411',
'1-17358363',
'1-1739536',
'1-17398771',
'1-17403831',
'1-17404994',
'1-17447781',
'1-17469163',
'1-17477701',
'1-17481561',
'1-17483724',
'1-17498133',
'1-17526064',
'1-17526123',
'1-17530711',
'1-17531404',
'1-17537411',
'1-17541751',
'1-17548901',
'1-17555321',
'1-17559516',
'1-17563481',
'1-17570964',
'1-17597693',
'1-17602871',
'1-17635351',
'1-17667371',
'1-17679721',
'1-17682503',
'1-17700401',
'1-17707261',
'1-17722735',
'1-17724401',
'1-17729931',
'1-17735201',
'1-17735351',
'1-17747367',
'1-17754191',
'1-17760061',
'1-17764851',
'1-17770981',
'1-17784741',
'1-17787444',
'1-17794964',
'1-17796681',
'1-17816541',
'1-17821113',
'1-17832211',
'1-17855051',
'1-17867404',
'1-17875561',
'1-17876521',
'1-17876741',
'1-17894066',
'1-17914021',
'1-17914261',
'1-17937354',
'1-17957101',
'1-17962623',
'1-17979921',
'1-17988886',
'1-18085711',
'1-18132111',
'1-18149191',
'1-18149204',
'1-18152947',
'1-18154011',
'1-18207291',
'1-18207791',
'1-18240354',
'1-18243921',
'1-18266543',
'1-18272301',
'1-18284891',
'1-18287874',
'1-18329824',
'1-18354451',
'1-18440821',
'1-18455403',
'1-18501123',
'1-18501161',
'1-18506573',
'1-18537131',
'1-18539859',
'1-18592101',
'1-18625841',
'1-18633445',
'1-18644761',
'1-18650481',
'1-18681803',
'1-18724756',
'1-18796363',
'1-18803124',
'1-18819914',
'1-18839111',
'1-18844584',
'1-18867531',
'1-18873461',
'1-18894561',
'1-18902034',
'1-18902446',
'1-18909921',
'1-18910241',
'1-18911704',
'1-18919434',
'1-18924904',
'1-18925291',
'1-18988481',
'1-19023177',
'1-19030181',
'1-19052381',
'1-19058371',
'1-19060311',
'1-19074461',
'1-19074731',
'1-19099704',
'1-19217481',
'1-19240771',
'1-1924421',
'1-1924834',
'1-1925401',
'1-19298331',
'1-1930401',
'1-19317321',
'1-1932651',
'1-1932732',
'1-19409211',
'1-19430577',
'1-19521851',
'1-19558326',
'1-19559834',
'1-19574481',
'1-19576431',
'1-19588032',
'1-19590351',
'1-19610007',
'1-19616660',
'1-19617351',
'1-19636727',
'1-19640842',
'1-19662983',
'1-19720914',
'1-19730241',
'1-19734541',
'1-19781981',
'1-19782301',
'1-19787864',
'1-19813991',
'1-19861851',
'1-19867941',
'1-19870263',
'1-19889278',
'1-19904303',
'1-19917321',
'1-19920221',
'1-19923881',
'1-19926841',
'1-19933491',
'1-19964467',
'1-19964521',
'1-20001871',
'1-20002871',
'1-20016232',
'1-20038784',
'1-20043220',
'1-20044874',
'1-20046291',
'1-20066461',
'1-20068563',
'1-20090224',
'1-20105094',
'1-20121091',
'1-20124641',
'1-2012531',
'1-2012681',
'1-2013051',
'1-2013177',
'1-2013187',
'1-2013661',
'1-20157651',
'1-20172504',
'1-2018111',
'1-2018184',
'1-2019411',
'1-2019451',
'1-20200194',
'1-2020098',
'1-2020302',
'1-20219711',
'1-20221111',
'1-2022661',
'1-2023597',
'1-20236611',
'1-2023665',
'1-2024231',
'1-2024361',
'1-2024381',
'1-20267391',
'1-20277471',
'1-20278613',
'1-2028941',
'1-2028971',
'1-2029051',
'1-2029561',
'1-20300151',
'1-20343421',
'1-20350061',
'1-20363121',
'1-20363141',
'1-20363811',
'1-2036471',
'1-2036511',
'1-2036561',
'1-2036601',
'1-2037011',
'1-20371281',
'1-20373431',
'1-20376751',
'1-20392951',
'1-20399151',
'1-20402341',
'1-20406991',
'1-20410151',
'1-20411611',
'1-20414374',
'1-20423361',
'1-20428024',
'1-20428711',
'1-2046076351',
'1-2046344121',
'1-2046361601',
'1-2046377471',
'1-2047242121',
'1-2047299601',
'1-2047301191',
'1-2047379791',
'1-2047406451',
'1-2047593931',
'1-2048372131',
'1-2049636521',
'1-2050948641',
'1-2050985591',
'1-2051181481',
'1-2051471401',
'1-20530371',
'1-2053141661',
'1-2053471381',
'1-2053503821',
'1-2053811111',
'1-20541361',
'1-2054512131',
'1-20548741',
'1-2055043291',
'1-2055162081',
'1-2055481',
'1-2055561',
'1-2055801',
'1-2056084421',
'1-2056211',
'1-2056282',
'1-2056351',
'1-2056521',
'1-2056611791',
'1-2056734441',
'1-2056831',
'1-2056843331',
'1-2057505501',
'1-2057537054',
'1-2057811541',
'1-2057990614',
'1-20581981',
'1-2058402731',
'1-20586871',
'1-2059146721',
'1-2059377951',
'1-20594581',
'1-2059464194',
'1-2059984901',
'1-20600161',
'1-2060094261',
'1-2060148211',
'1-20601786',
'1-2060195521',
'1-20603451',
'1-2060360344',
'1-2060831',
'1-2061090701',
'1-2061151',
'1-2061175564',
'1-2061229791',
'1-2061292',
'1-2061315781',
'1-2061403651',
'1-20619871',
'1-2062492931',
'1-2062754581',
'1-2062801301',
'1-2062857',
'1-2063201',
'1-20635701',
'1-20635851',
'1-2063780141',
'1-2063923341',
'1-2064024291',
'1-2064373621',
'1-2064376171',
'1-2064423114',
'1-2064632551',
'1-2064658621',
'1-2064662531',
'1-2064666851',
'1-2065769851',
'1-20658387',
'1-2066317801',
'1-2066666481',
'1-2066730101',
'1-2066931',
'1-2067151',
'1-2067422224',
'1-2067578301',
'1-2067620861',
'1-2067689481',
'1-2067780361',
'1-2067945951',
'1-2068490281',
'1-2068619351',
'1-2068620641',
'1-2068719831',
'1-2068747811',
'1-2068837731',
'1-2069587',
'1-2069672981',
'1-2069791981',
'1-2069893621',
'1-2070257231',
'1-2070647321',
'1-2070781941',
'1-2070793231',
'1-2071025701',
'1-2071082684',
'1-20712421',
'1-2071320801',
'1-2071982851',
'1-2072131171',
'1-2072601',
'1-2073072751',
'1-2073181',
'1-2073486441',
'1-2074028681',
'1-2074187531',
'1-2075662091',
'1-20757871',
'1-2076095861',
'1-2076261',
'1-2077574861',
'1-2077598701',
'1-2077902601',
'1-2080393201',
'1-2080449921',
'1-2080793071',
'1-2081019451',
'1-2081614431',
'1-2081616171',
'1-2081817161',
'1-2082034331',
'1-2082172681',
'1-2082325841',
'1-2082667151',
'1-2082797321',
'1-2083014261',
'1-2083482521',
'1-2083687611',
'1-2083730701',
'1-2083942451',
'1-2084328241',
'1-2084731621',
'1-2084815251',
'1-2085134831',
'1-2085565677',
'1-2085701741',
'1-2086240431',
'1-2087247171',
'1-2087920291',
'1-20885021',
'1-2088584641',
'1-2088796921',
'1-2091014491',
'1-2091200011',
'1-2091237011',
'1-2092725651',
'1-2093840434',
'1-20946191',
'1-2095671861',
'1-2095780021',
'1-2096845441',
'1-2096989741',
'1-2097242801',
'1-2097309271',
'1-2098328781',
'1-2098529231',
'1-2099489001',
'1-2099741361',
'1-2100025201',
'1-2100812461',
'1-2100894291',
'1-2101062901',
'1-2101169291',
'1-2101200721',
'1-2102055171',
'1-2102064451',
'1-2102599541',
'1-2102786821',
'1-2103006811',
'1-2103448891',
'1-2103719071',
'1-21042524',
'1-21042938',
'1-2104485921',
'1-21044861',
'1-2105103581',
'1-2105105891',
'1-2105174101',
'1-21052415',
'1-21052791',
'1-2105553681',
'1-2105615031',
'1-2105664791',
'1-21056671',
'1-2105683921',
'1-2107047421',
'1-2107050944',
'1-2107350881',
'1-21078625',
'1-21085646',
'1-21112983',
'1-21116724',
'1-21127301',
'1-21129841',
'1-21139161',
'1-21164001',
'1-21174064',
'1-21210081',
'1-2122219994',
'1-21226151',
'1-2123071',
'1-21231951',
'1-2123888801',
'1-21239900',
'1-21260671',
'1-21287351',
'1-21288074',
'1-21296761',
'1-21298561',
'1-21309801',
'1-21313644',
'1-21321005',
'1-21321043',
'1-21334861',
'1-21346941',
'1-21349201',
'1-21350231',
'1-21359408',
'1-21378091',
'1-21381141',
'1-21387501',
'1-21387804',
'1-21391957',
'1-2142081',
'1-2142351',
'1-21443851',
'1-2145671',
'1-21458111',
'1-2146711',
'1-21473614',
'1-21474251',
'1-21485613',
'1-21485781',
'1-21495521',
'1-21513233',
'1-21555841',
'1-21556824',
'1-21569051',
'1-21575861',
'1-21580631',
'1-21614921',
'1-21620683',
'1-21625351',
'1-21632360',
'1-21634681',
'1-21637982',
'1-21641511',
'1-21643361',
'1-21649111',
'1-21656734',
'1-21657071',
'1-21660411',
'1-21699611',
'1-21719884',
'1-21723274',
'1-2172541',
'1-21726723',
'1-21728511',
'1-2173587',
'1-21774581',
'1-21788371',
'1-2179361',
'1-21805422',
'1-2181184721',
'1-2181202221',
'1-2181207301',
'1-2181229281',
'1-2181241',
'1-2181255281',
'1-2181288034',
'1-2181291',
'1-2181324871',
'1-2181381',
'1-2181509881',
'1-2181572531',
'1-2181664251',
'1-2181710931',
'1-2181844821',
'1-2181889901',
'1-2181933881',
'1-2181986031',
'1-2182458537',
'1-2182541791',
'1-2182588451',
'1-2182645451',
'1-2182768801',
'1-2183137181',
'1-2183170601',
'1-2183174231',
'1-2183306931',
'1-2183358531',
'1-2183471891',
'1-2183488261',
'1-2183608891',
'1-2183632981',
'1-2183682561',
'1-2183698291',
'1-2183858641',
'1-2184018161',
'1-21843671',
'1-2184583431',
'1-2184701401',
'1-2185327631',
'1-2185563441',
'1-2185671511',
'1-2185717431',
'1-2185790091',
'1-2185853371',
'1-2185947461',
'1-2186187721',
'1-2186354961',
'1-2186362591',
'1-2186413611',
'1-2186606031',
'1-2186688401',
'1-2187005501',
'1-2187393761',
'1-2187396811',
'1-2187497711',
'1-2187749411',
'1-2187948381',
'1-2188061',
'1-2188078501',
'1-2188249181',
'1-2188291791',
'1-2188769051',
'1-2188912481',
'1-21889521',
'1-2189001211',
'1-2189107701',
'1-2189140071',
'1-21892831',
'1-2189696411',
'1-2189847',
'1-2190142',
'1-2190350741',
'1-2190444941',
'1-2190452064',
'1-2190736321',
'1-2190744701',
'1-2190900851',
'1-21909393',
'1-21909541',
'1-2191238931',
'1-2191566831',
'1-2191633831',
'1-2191764221',
'1-2192151241',
'1-2192545341',
'1-2192708761',
'1-2192720491',
'1-21930161',
'1-2193028951',
'1-2193161',
'1-2193173031',
'1-2193177981',
'1-2193268321',
'1-2193443991',
'1-21936701',
'1-2193892291',
'1-2194159151',
'1-2194221261',
'1-2194659191',
'1-2194788061',
'1-2195358411',
'1-2195395701',
'1-2195402841',
'1-2195471601',
'1-2195791501',
'1-2196436461',
'1-21964501',
'1-2196689431',
'1-2196718161',
'1-2197135511',
'1-2197716871',
'1-2198092461',
'1-2198147061',
'1-2198566721',
'1-2199074381',
'1-2199988601',
'1-2199988631',
'1-2200065711',
'1-2200214201',
'1-2200341561',
'1-2201035161',
'1-2201117141',
'1-2201310801',
'1-2201339791',
'1-22015311',
'1-22025109',
'1-22043841',
'1-22108181',
'1-22145718',
'1-2214602',
'1-22154153',
'1-2216569401',
'1-22167934',
'1-22172981',
'1-22203871',
'1-22204701',
'1-22208661',
'1-22221182',
'1-22233334',
'1-22268581',
'1-22275071',
'1-22286661',
'1-22291621',
'1-22296081',
'1-22310751',
'1-22312561',
'1-22313065',
'1-22322721',
'1-22331997',
'1-22340051',
'1-22359484',
'1-22362711',
'1-22388211',
'1-22400151',
'1-22401801',
'1-22420221',
'1-22432791',
'1-22476511',
'1-22480715',
'1-22486871',
'1-22490813',
'1-22495966',
'1-22498561',
'1-22512121',
'1-2253899',
'1-22539953',
'1-22601221',
'1-22610037',
'1-22636351',
'1-22641464',
'1-22644781',
'1-22652114',
'1-22674881',
'1-22686012',
'1-22686521',
'1-22699251',
'1-22705881',
'1-22710593',
'1-22725297',
'1-22729991',
'1-22744031',
'1-22793581',
'1-22800795',
'1-22830883',
'1-22834965',
'1-22837831',
'1-22845901',
'1-22883161',
'1-22885034',
'1-22890411',
'1-22939033',
'1-22940401',
'1-22944372',
'1-22960161',
'1-22995711',
'1-23041601',
'1-23048731',
'1-23054751',
'1-23064741',
'1-23093151',
'1-23098831',
'1-23099961',
'1-23111191',
'1-23116871',
'1-23139281',
'1-23150811',
'1-23345061',
'1-23364361',
'1-23417661',
'1-23439963',
'1-23445331',
'1-23493760',
'1-23496101',
'1-23528205',
'1-23557212',
'1-23577171',
'1-23590971',
'1-23602414',
'1-23622271',
'1-23622351',
'1-23632427',
'1-23687721',
'1-23698811',
'1-23703261',
'1-23710051',
'1-23716013',
'1-23735644',
'1-23741731',
'1-23760281',
'1-23810146',
'1-23838031',
'1-23863307',
'1-2388434',
'1-2388564',
'1-2388932',
'1-2389603',
'1-2389691',
'1-2389881',
'1-2389972',
'1-2390451',
'1-23940691',
'1-23954841',
'1-2396524',
'1-2396653',
'1-24014961',
'1-2402534',
'1-2402716',
'1-2402723',
'1-2402821',
'1-2403491',
'1-2403671',
'1-2404581',
'1-2404711',
'1-2404851',
'1-24056021',
'1-2406223',
'1-2407474',
'1-2407525',
'1-2408454',
'1-2408841',
'1-2408981',
'1-2409491',
'1-24142851',
'1-24155491',
'1-24174271',
'1-24175111',
'1-24211221',
'1-24221311',
'1-24234541',
'1-24262101',
'1-24371465',
'1-24375324',
'1-24416934',
'1-24420701',
'1-24426121',
'1-24426516',
'1-24557981',
'1-2463927771',
'1-2464611111',
'1-2464811091',
'1-2464837444',
'1-2464910771',
'1-2466526481',
'1-2467359711',
'1-2467764621',
'1-2467780141',
'1-2467881941',
'1-2468605634',
'1-2469017431',
'1-2470127711',
'1-2470137661',
'1-2470150941',
'1-2470479921',
'1-2470954041',
'1-2471131211',
'1-2471196781',
'1-2471266031',
'1-2471433431',
'1-2471463941',
'1-2472826801',
'1-2474317051',
'1-2474330041',
'1-2474515251',
'1-2475456241',
'1-2475739611',
'1-2476071601',
'1-2476213031',
'1-2476437711',
'1-2477372441',
'1-2478023971',
'1-2478389201',
'1-2479273831',
'1-2479451651',
'1-2479490991',
'1-2479570601',
'1-2479581324',
'1-2479651211',
'1-2480100091',
'1-2480385701',
'1-2480831941',
'1-2480932581',
'1-2480988044',
'1-2481059741',
'1-2481460631',
'1-2481498001',
'1-2481648561',
'1-2481797441',
'1-2483031241',
'1-2483206221',
'1-24832501',
'1-2483331961',
'1-2484333611',
'1-2484367361',
'1-2484561971',
'1-2484687551',
'1-2485132121',
'1-2485567661',
'1-2486584731',
'1-24868041',
'1-2486967171',
'1-2487184881',
'1-2487354231',
'1-2487426341',
'1-2487674531',
'1-24877214',
'1-24878006',
'1-2487852681',
'1-2487854121',
'1-24879271',
'1-24885461',
'1-2488593381',
'1-2488685871',
'1-2489028601',
'1-2489272661',
'1-2489283121',
'1-2489434061',
'1-2490946211',
'1-2491056331',
'1-2491069651',
'1-2491077281',
'1-24911141',
'1-2491139531',
'1-2491191151',
'1-2491308981',
'1-2491537221',
'1-2491592761',
'1-2491968661',
'1-2492091',
'1-2492116821',
'1-2492131',
'1-2492288',
'1-2492353081',
'1-2492477331',
'1-2492491',
'1-2492635171',
'1-2492777331',
'1-2492832711',
'1-2493338491',
'1-2493368481',
'1-2493649991',
'1-2493739771',
'1-2493774811',
'1-2493847771',
'1-2494043441',
'1-2494340101',
'1-2494430421',
'1-2494491551',
'1-2494566071',
'1-2494721081',
'1-2494761',
'1-2494796871',
'1-2494827',
'1-2494904',
'1-2495469681',
'1-2495503371',
'1-2495611',
'1-2495669121',
'1-2495846061',
'1-2495980451',
'1-2496077681',
'1-24962214',
'1-2496405271',
'1-2496465741',
'1-2496711',
'1-2496727551',
'1-2496742151',
'1-2496804',
'1-2497194981',
'1-2497285',
'1-2497331',
'1-2497334191',
'1-2497334351',
'1-2497480471',
'1-2497592901',
'1-2497903431',
'1-2498032583',
'1-2498263991',
'1-2498562819',
'1-2498827120',
'1-2498860046',
'1-2499107924',
'1-2499174011',
'1-2499196901',
'1-2499361731',
'1-2499387281',
'1-2499577911',
'1-2499591631',
'1-2499864601',
'1-2501237481',
'1-2501241881',
'1-2501273261',
'1-2501353871',
'1-2501831501',
'1-2501861',
'1-2501960',
'1-2502588201',
'1-25028181',
'1-2502824991',
'1-2503123591',
'1-2503164471',
'1-2504638271',
'1-2504741',
'1-2504761',
'1-2504821',
'1-2504901',
'1-25063243',
'1-2506580461',
'1-2506616831',
'1-2506936',
'1-2506984',
'1-2507214871',
'1-2507271',
'1-2507491',
'1-2507657',
'1-2508211334',
'1-2508325151',
'1-2508773',
'1-2509027334',
'1-2509654',
'1-25097474',
'1-2510067141',
'1-2510129621',
'1-25109205',
'1-2511162',
'1-2511179721',
'1-2511369351',
'1-2511491',
'1-2511703381',
'1-2511748131',
'1-2511917',
'1-2511948751',
'1-2512098211',
'1-2512181',
'1-2512696',
'1-2513089831',
'1-2513513091',
'1-2513582301',
'1-2513934421',
'1-2513951',
'1-2513971',
'1-2514001',
'1-2514281',
'1-2515038221',
'1-2515117701',
'1-2515150161',
'1-2515228524',
'1-2515288271',
'1-2515575031',
'1-2516397461',
'1-2516530001',
'1-2518088841',
'1-25181337',
'1-2518265591',
'1-2518266641',
'1-25189044',
'1-2518913051',
'1-2519081341',
'1-2519321631',
'1-2519410071',
'1-2519447601',
'1-2520269301',
'1-2522098071',
'1-2522324001',
'1-2522399111',
'1-252374691',
'1-2524383051',
'1-2524947151',
'1-2525393031',
'1-2526287661',
'1-2527534761',
'1-2527841',
'1-2528171',
'1-2528181',
'1-25346951',
'1-25372671',
'1-25385201',
'1-25427104',
'1-254314764',
'1-25477061',
'1-25482721',
'1-25525451',
'1-2557985',
'1-2558181',
'1-2558221',
'1-25588651',
'1-25626101',
'1-25647931',
'1-25652301',
'1-25668131',
'1-2567118791',
'1-25687181',
'1-25701224',
'1-25728497',
'1-25738997',
'1-25745133',
'1-25747141',
'1-25754471',
'1-25756281',
'1-25801501',
'1-25811284',
'1-25814141',
'1-2581815',
'1-25831501',
'1-25854653',
'1-2590786',
'1-2593721',
'1-2596391',
'1-2596691',
'1-2596861',
'1-259700861',
'1-2597051',
'1-2599724',
'1-2599744',
'1-2600191',
'1-2600510',
'1-2600621',
'1-2600681',
'1-2603737',
'1-2603775',
'1-2605911',
'1-2606101',
'1-2606254',
'1-2606471',
'1-2608151',
'1-2608560',
'1-2608694',
'1-2609784',
'1-2609821',
'1-2610054',
'1-2610351',
'1-2610514',
'1-2614741',
'1-2615141',
'1-2615181',
'1-2615748',
'1-2615781',
'1-262244434',
'1-262262952',
'1-2622725',
'1-2622871',
'1-2623001',
'1-2624954',
'1-2625221',
'1-2625316',
'1-26270263',
'1-26276721',
'1-262936828',
'1-2629451',
'1-26332611',
'1-264114969',
'1-26429171',
'1-26466614',
'1-26469001',
'1-2647031',
'1-2647213',
'1-2649823',
'1-2650394',
'1-26516461',
'1-26555196',
'1-26572041',
'1-26607593',
'1-26677261',
'1-26677561',
'1-2686041',
'1-26917541',
'1-27113461',
'1-273386441',
'1-2735826',
'1-2736031',
'1-2737891',
'1-2739834',
'1-2739841',
'1-2740981',
'1-2741001',
'1-2742801',
'1-27440891',
'1-2744874',
'1-2745081',
'1-2754891',
'1-2755053',
'1-2757921',
'1-27682191',
'1-2780921',
'1-2780951',
'1-2781841',
'1-27823541',
'1-2782821',
'1-2782851',
'1-2782864',
'1-2786871',
'1-2787821',
'1-27916062',
'1-2799881',
'1-2799924',
'1-2817934',
'1-2819171',
'1-2819834',
'1-2819861',
'1-2819951',
'1-28199721',
'1-2820021',
'1-28207667',
'1-28226243',
'1-2824917',
'1-2825941',
'1-2828971',
'1-2829001',
'1-28321041',
'1-28324031',
'1-2833911',
'1-2833961',
'1-2835473161',
'1-2841821651',
'1-2841884571',
'1-2841935261',
'1-2841991181',
'1-2842045301',
'1-2842063491',
'1-2842106681',
'1-2842132261',
'1-2842672931',
'1-28428671',
'1-2842941931',
'1-2842959281',
'1-2843157821',
'1-2843462161',
'1-2843555031',
'1-2843576241',
'1-2843638141',
'1-2843668331',
'1-2843792671',
'1-2844497241',
'1-2844517761',
'1-2844522461',
'1-2844591941',
'1-28447791',
'1-2845229621',
'1-2845305801',
'1-2845390761',
'1-2845411441',
'1-2845427421',
'1-2845501211',
'1-2845518161',
'1-2846046191',
'1-2846059221',
'1-2846146731',
'1-2846161831',
'1-2846163491',
'1-2846165611',
'1-2846171381',
'1-2846173691',
'1-2846195971',
'1-2846263901',
'1-2846263951',
'1-2846327701',
'1-2846355041',
'1-2846412051',
'1-2846511721',
'1-28467561',
'1-2846941441',
'1-28475041',
'1-2847667231',
'1-2847849001',
'1-2847896041',
'1-2847931031',
'1-2847939841',
'1-2847968671',
'1-2848003131',
'1-2848010613',
'1-2848067241',
'1-2848078951',
'1-2848095451',
'1-2848107781',
'1-2848108831',
'1-2848153441',
'1-2848515301',
'1-2848956891',
'1-2849075161',
'1-2849217281',
'1-2849220101',
'1-2849240381',
'1-2849690071',
'1-2849701121',
'1-2850093541',
'1-2850485231',
'1-2850558801',
'1-2850886071',
'1-2850921891',
'1-2850939751',
'1-2851030361',
'1-2851332727',
'1-2851689791',
'1-2851903187',
'1-2851910931',
'1-2851910961',
'1-2851930421',
'1-2852110421',
'1-2852578821',
'1-2852831361',
'1-2852857111',
'1-2853115721',
'1-2853149201',
'1-2853233121',
'1-2853239131',
'1-2853619771',
'1-2853630161',
'1-2853713731',
'1-2854124181',
'1-2854684171',
'1-2854788441',
'1-2854929921',
'1-2855388831',
'1-2855559131',
'1-2855645161',
'1-2856118461',
'1-2856224141',
'1-2856346271',
'1-2856836681',
'1-2857018561',
'1-2857046271',
'1-2857057061',
'1-2857174951',
'1-2857214411',
'1-2857231461',
'1-2857413111',
'1-2858001251',
'1-2858009941',
'1-2858236601',
'1-2858317391',
'1-2858347581',
'1-2858778481',
'1-2858839394',
'1-2859350991',
'1-2859391891',
'1-2859638491',
'1-2859867201',
'1-2860280821',
'1-2860691731',
'1-2861233511',
'1-2861364801',
'1-2861912261',
'1-2862025551',
'1-2862307831',
'1-2862619631',
'1-2862734361',
'1-2862853561',
'1-2863269691',
'1-2863306591',
'1-2863444437',
'1-2863462851',
'1-2863503551',
'1-2863779331',
'1-2863798081',
'1-28638038',
'1-28640291',
'1-2864103791',
'1-2864534151',
'1-2864825241',
'1-2864843741',
'1-2864930031',
'1-2864942021',
'1-2865234661',
'1-2865270411',
'1-2865369351',
'1-2865465901',
'1-2865849381',
'1-2865908181',
'1-2866455011',
'1-2867375811',
'1-2867621131',
'1-2867621284',
'1-2867769951',
'1-2868365241',
'1-28685171',
'1-2869423461',
'1-2869437751',
'1-2869754251',
'1-2870012641',
'1-2870154161',
'1-2870237381',
'1-2870457021',
'1-2870732344',
'1-2870843591',
'1-2870850431',
'1-2870986361',
'1-2871036841',
'1-2871121711',
'1-2871133051',
'1-28713251',
'1-2871429431',
'1-2871779871',
'1-2871805591',
'1-2871846061',
'1-2871856381',
'1-2871904131',
'1-2871947981',
'1-2872176731',
'1-2872552251',
'1-2872554601',
'1-2872710151',
'1-2872744181',
'1-2873102851',
'1-2873205591',
'1-2873297751',
'1-2873298381',
'1-2873426841',
'1-2873498251',
'1-2873521571',
'1-2873848161',
'1-2874076481',
'1-2874076941',
'1-2874264611',
'1-2874575001',
'1-2874650311',
'1-2874705531',
'1-2874713141',
'1-2874816221',
'1-2874919101',
'1-2874919421',
'1-2874967711',
'1-2874973841',
'1-28750737',
'1-2875076131',
'1-2875099121',
'1-28751344',
'1-2875233061',
'1-2875271621',
'1-2875329191',
'1-2875474121',
'1-2875778901',
'1-2875892471',
'1-2876475364',
'1-2876867614',
'1-2877016161',
'1-2877056111',
'1-2877126031',
'1-2877397381',
'1-2877398341',
'1-28775271',
'1-2877567991',
'1-2877581491',
'1-2877815351',
'1-2877911171',
'1-2877956231',
'1-2877972351',
'1-2878153061',
'1-2878170781',
'1-2878183051',
'1-2878195831',
'1-2878234121',
'1-2878249561',
'1-2878601491',
'1-2878644377',
'1-2878770581',
'1-28788791',
'1-2878935254',
'1-2879525401',
'1-28795591',
'1-2879655341',
'1-2879677551',
'1-2879705251',
'1-2879706341',
'1-2879933221',
'1-2879941501',
'1-2879987444',
'1-2879995474',
'1-2879997531',
'1-2880028531',
'1-2880315521',
'1-2880720561',
'1-2880777101',
'1-2880994101',
'1-2881063341',
'1-2881079901',
'1-2881117591',
'1-2881176921',
'1-2881323321',
'1-2881352711',
'1-2881395971',
'1-2881506611',
'1-2882361701',
'1-2883245811',
'1-2883298784',
'1-2883352741',
'1-2883400811',
'1-2883472321',
'1-2883501031',
'1-2883509771',
'1-2883861221',
'1-2883885181',
'1-2884288221',
'1-2884407931',
'1-2884747191',
'1-2884799241',
'1-2884801281',
'1-2884946641',
'1-2885709411',
'1-2885883721',
'1-2885884171',
'1-2885938161',
'1-2885951651',
'1-2885960311',
'1-2886013361',
'1-2886014491',
'1-2886054381',
'1-2886208291',
'1-2887121711',
'1-2887219231',
'1-2887595001',
'1-2888028511',
'1-2888367201',
'1-2888623561',
'1-2888653311',
'1-2888693061',
'1-2888854',
'1-2889131411',
'1-2889771',
'1-2890153004',
'1-2891071961',
'1-2891090561',
'1-2891186341',
'1-2891634',
'1-2891714',
'1-2892813',
'1-2893010601',
'1-2893075341',
'1-2893141',
'1-2893251',
'1-2893356',
'1-2893381',
'1-2893411',
'1-2894011',
'1-2894158',
'1-2894231',
'1-2894781',
'1-2895931',
'1-28960681',
'1-2896174',
'1-2896354',
'1-2896411',
'1-2896661',
'1-2896931',
'1-2897091',
'1-2902541',
'1-2902623',
'1-2902674',
'1-2902741',
'1-29028101',
'1-2905851',
'1-2906311',
'1-29109213',
'1-29235692',
'1-2928921',
'1-2929021',
'1-2929791',
'1-2931121',
'1-2931693',
'1-2933011',
'1-2933231',
'1-2933261',
'1-2935114',
'1-2935171',
'1-2935391',
'1-2937461',
'1-29378481',
'1-2939861',
'1-2939881',
'1-2941897',
'1-2942084',
'1-2942301',
'1-2942331',
'1-2942871',
'1-2943641',
'1-2944881',
'1-2945121',
'1-2945211',
'1-29536181',
'1-29548781',
'1-29557821',
'1-29596603',
'1-29642981',
'1-2987831',
'1-29965821',
'1-2998891',
'1-30016691',
'1-30022324',
'1-3002821',
'1-30118924',
'1-30200314',
'1-30235674',
'1-30328351',
'1-30341354',
'1-3036031',
'1-3036221',
'1-30376293',
'1-3038007',
'1-3041281',
'1-30414464',
'1-3041821',
'1-3041944',
'1-3041984',
'1-3042114',
'1-3044091',
'1-3047921',
'1-3048184',
'1-3049261',
'1-30510114',
'1-30512093',
'1-30523574',
'1-30524014',
'1-30649163',
'1-30834321',
'1-30883381',
'1-3096804',
'1-3097303',
'1-3097521',
'1-3099321',
'1-3100910',
'1-3101501',
'1-3101711',
'1-31026567',
'1-3103001',
'1-3103151',
'1-3103341',
'1-3103701',
'1-3104081',
'1-31041611',
'1-3104511',
'1-3104691',
'1-3105801',
'1-3106414',
'1-31065551',
'1-3106791',
'1-3106811',
'1-3107061',
'1-3107191',
'1-31073941',
'1-3107881',
'1-3108533',
'1-3108741',
'1-3110945',
'1-3111461',
'1-31175264',
'1-3118891',
'1-3119311',
'1-3119681',
'1-31264821',
'1-3130821',
'1-3130921',
'1-3130963',
'1-3131574',
'1-3131691',
'1-3131921',
'1-3132391',
'1-31327876',
'1-31331537',
'1-3134514',
'1-3134941',
'1-3135491',
'1-3136251',
'1-3136641',
'1-3136691',
'1-3139201',
'1-3140542',
'1-3140596',
'1-3140633',
'1-3142246',
'1-3142811',
'1-3142834',
'1-3143011',
'1-3143591',
'1-3143681',
'1-31442321',
'1-31442561',
'1-31455521',
'1-31499891',
'1-31657221',
'1-31689601',
'1-31711221',
'1-31762024',
'1-31876571',
'1-3191481',
'1-31927121',
'1-3199093',
'1-32037656',
'1-3204361',
'1-3204491',
'1-3214121',
'1-3214133',
'1-32221983',
'1-32272801',
'1-32291594',
'1-32335211',
'1-32347208',
'1-3234811',
'1-3239294',
'1-3239371',
'1-32395303',
'1-3242944',
'1-32446794',
'1-3245204',
'1-32484821',
'1-32498041',
'1-32501011',
'1-32506803',
'1-32536881',
'1-32561481',
'1-32561901',
'1-32579754',
'1-3259951',
'1-3260041',
'1-3260061',
'1-3260168',
'1-3262051',
'1-32717711',
'1-32779251',
'1-3278823',
'1-3279121',
'1-32808334',
'1-3280921',
'1-3281431',
'1-3281811',
'1-3282145',
'1-3282934',
'1-3283091',
'1-3283904',
'1-3285111',
'1-3285267',
'1-3285877',
'1-3285881',
'1-3286931',
'1-3286971',
'1-3287291',
'1-3287311',
'1-32882581',
'1-32891881',
'1-3289821',
'1-3289861',
'1-3290049',
'1-3290304',
'1-3290934',
'1-3291051',
'1-3291561',
'1-32938411',
'1-32939071',
'1-32953973',
'1-32971964',
'1-33023293',
'1-33029843',
'1-33077607',
'1-33165451',
'1-33176073',
'1-33195851',
'1-33211311',
'1-3322801',
'1-3323061',
'1-3323691',
'1-33257691',
'1-33261664',
'1-33266953',
'1-3328804',
'1-3330811',
'1-33340881',
'1-33367191',
'1-33382434',
'1-33393284',
'1-3340841',
'1-3341283',
'1-3341573',
'1-3341681',
'1-3345809',
'1-33524871',
'1-3359847',
'1-3360134',
'1-3360543',
'1-3360631',
'1-33625673',
'1-33670055',
'1-3369933',
'1-33714121',
'1-33729371',
'1-33849801',
'1-33883791',
'1-3393271',
'1-3393781',
'1-3396081',
'1-3396281',
'1-3398321',
'1-3401731',
'1-3403081',
'1-3403771',
'1-34086291',
'1-34088681',
'1-3408921',
'1-3409476',
'1-3409671',
'1-3409771',
'1-3411121',
'1-34182281',
'1-3419111',
'1-3419951',
'1-34221165',
'1-3422974',
'1-3423091',
'1-34240141',
'1-3426958',
'1-34323441',
'1-34371391',
'1-34374804',
'1-34392081',
'1-34401344',
'1-34462041',
'1-3446974',
'1-3447077',
'1-34489691',
'1-3449021',
'1-3449911',
'1-3450001',
'1-3450974',
'1-3451381',
'1-3453101',
'1-3453121',
'1-3453133',
'1-3454261',
'1-3456381',
'1-3456561',
'1-3459924',
'1-3459931',
'1-3460153',
'1-34636554',
'1-34641201',
'1-34648683',
'1-34656414',
'1-34713511',
'1-34716474',
'1-34727050',
'1-34738501',
'1-34746097',
'1-3476931',
'1-3477251',
'1-3477994',
'1-3478061',
'1-3478431',
'1-34822401',
'1-3483211',
'1-3483261',
'1-3483501',
'1-34863771',
'1-34863821',
'1-34932761',
'1-34969671',
'1-349964881',
'1-35015311',
'1-35023771',
'1-35025311',
'1-35052964',
'1-35121833',
'1-3514117',
'1-35186271',
'1-35241531',
'1-35288461',
'1-3528961',
'1-35315663',
'1-35322741',
'1-35341955',
'1-35360061',
'1-35377021',
'1-35377431',
'1-3538990',
'1-3539093',
'1-3539231',
'1-35394164',
'1-3539644',
'1-35453534',
'1-3546901',
'1-3547201',
'1-3548321',
'1-3548701',
'1-3548907',
'1-3548911',
'1-35535461',
'1-3562061',
'1-35645144',
'1-3565247',
'1-35653231',
'1-3565901',
'1-3566561',
'1-3566651',
'1-35681791',
'1-35694637',
'1-3579484',
'1-3583251',
'1-3584027',
'1-3585751',
'1-3587151',
'1-3589034',
'1-3589341',
'1-3589621',
'1-3589631',
'1-3589664',
'1-3589711',
'1-3592461',
'1-3595201',
'1-3598171',
'1-3598221',
'1-36084613',
'1-36086671',
'1-36193291',
'1-36227871',
'1-36239793',
'1-3633035',
'1-3634031',
'1-3636001',
'1-3638011',
'1-3638131',
'1-3638154',
'1-3638161',
'1-3639013',
'1-3640051',
'1-3640153',
'1-3640401',
'1-3641071',
'1-3641693',
'1-3643021',
'1-3643041',
'1-3645041',
'1-36456711',
'1-36630761',
'1-3669414',
'1-36696942',
'1-3669721',
'1-3670931',
'1-3671978',
'1-3672174',
'1-3672941',
'1-3673131',
'1-3673201',
'1-3674181',
'1-3674191',
'1-3674343',
'1-3675114',
'1-3675161',
'1-3675361',
'1-3675803',
'1-3675821',
'1-3676078',
'1-3678161',
'1-3678201',
'1-3678211',
'1-3680181',
'1-3680281',
'1-36869047',
'1-3687281',
'1-3687373',
'1-3690321',
'1-3690901',
'1-3693194',
'1-3695144',
'1-3695591',
'1-36961681',
'1-3698321',
'1-37064261',
'1-37176461',
'1-37230541',
'1-37296024',
'1-37485014',
'1-37512081',
'1-3755274',
'1-3760792',
'1-3761141',
'1-3761464',
'1-3762161',
'1-3762338',
'1-3763241',
'1-3763431',
'1-3766399',
'1-3766781',
'1-3767327',
'1-37676163',
'1-37834731',
'1-3797271',
'1-3799173',
'1-3799401',
'1-3799438',
'1-3799478',
'1-3799751',
'1-3806221',
'1-3807111',
'1-3810104',
'1-3810251',
'1-38136961',
'1-38169544',
'1-3817141',
'1-3817154',
'1-3818113',
'1-38190893',
'1-38191033',
'1-38338853',
'1-38345741',
'1-3836111',
'1-3836161',
'1-38372931',
'1-38471831',
'1-3847411',
'1-3847534',
'1-3847801',
'1-3850141',
'1-3850571',
'1-3853050',
'1-3853061',
'1-3855291',
'1-3858465',
'1-3858524',
'1-3859081',
'1-3861574',
'1-3861731',
'1-3861751',
'1-3866524',
'1-3867401',
'1-3867785',
'1-3867961',
'1-3869061',
'1-3870631',
'1-3871211',
'1-3871626',
'1-3871966',
'1-3874176',
'1-3874391',
'1-3875791',
'1-3882211',
'1-3882391',
'1-3885143',
'1-3885153',
'1-3887144',
'1-3887416',
'1-3888366',
'1-3888371',
'1-3889321',
'1-3890141',
'1-3890191',
'1-3891111',
'1-3891204',
'1-3891235',
'1-3892556',
'1-38935861',
'1-39089593',
'1-3913254',
'1-3925141',
'1-3925751',
'1-3926101',
'1-3926870',
'1-39275251',
'1-3928411',
'1-3928641',
'1-3928664',
'1-39287261',
'1-3928991',
'1-3929123',
'1-3929261',
'1-3929271',
'1-3929501',
'1-3929791',
'1-3930101',
'1-3930191',
'1-3930283',
'1-3930783',
'1-39308991',
'1-3931161',
'1-3931981',
'1-3932164',
'1-3932201',
'1-3932331',
'1-3932467',
'1-3933154',
'1-3933345',
'1-3933661',
'1-3934011',
'1-3934931',
'1-3935283',
'1-3936021',
'1-39482811',
'1-39490287',
'1-3954311',
'1-3954924',
'1-3955211',
'1-3955612',
'1-3955821',
'1-3956281',
'1-3956598',
'1-3956901',
'1-3958501',
'1-3959581',
'1-396064271',
'1-39607283',
'1-3960853',
'1-3960951',
'1-39624141',
'1-3962501',
'1-3967731',
'1-3968343',
'1-396896621',
'1-396937201',
'1-396942661',
'1-396973721',
'1-3969771',
'1-39721737',
'1-3972354',
'1-3975664',
'1-3976425',
'1-3977001',
'1-3978961',
'1-3979366',
'1-3979901',
'1-398066391',
'1-3982193',
'1-3982211',
'1-398255563',
'1-3982786',
'1-398281221',
'1-3982824',
'1-3983371',
'1-398340581',
'1-3984404',
'1-39847241',
'1-398982311',
'1-3990308',
'1-399038971',
'1-399048571',
'1-3990745',
'1-399076211',
'1-399078211',
'1-399082231',
'1-3992214',
'1-3992484',
'1-3992601',
'1-400203651',
'1-4002206',
'1-400503141',
'1-400582941',
'1-400698821',
'1-40098463',
'1-4010334',
'1-4010725',
'1-4011411',
'1-4011594',
'1-4011650',
'1-40133681',
'1-401581011',
'1-401622983',
'1-401635061',
'1-401639081',
'1-401648801',
'1-401777433',
'1-4020271',
'1-40203481',
'1-40208031',
'1-4021561',
'1-4021993',
'1-4022409',
'1-4022461',
'1-4023089',
'1-4023681',
'1-4023705',
'1-4023854',
'1-4024292',
'1-4025471',
'1-402581451',
'1-4026486',
'1-4026521',
'1-4026537',
'1-4026664',
'1-40271851',
'1-4027581',
'1-4027961',
'1-402924711',
'1-402988081',
'1-403117291',
'1-403200961',
'1-403222671',
'1-403260341',
'1-403335391',
'1-40338531',
'1-40403351',
'1-404124841',
'1-404222571',
'1-404247151',
'1-40425501',
'1-404261661',
'1-404262021',
'1-404271913',
'1-404277901',
'1-404292091',
'1-404308681',
'1-404330091',
'1-404341501',
'1-404351401',
'1-404370901',
'1-404373951',
'1-404392831',
'1-404407811',
'1-404434391',
'1-40443451',
'1-404449271',
'1-404525741',
'1-404537421',
'1-404574931',
'1-404639443',
'1-40465351',
'1-404662901',
'1-4048493',
'1-4048961',
'1-4053011',
'1-405508261',
'1-405639211',
'1-405645191',
'1-405661531',
'1-405668361',
'1-4056851',
'1-405719351',
'1-405737511',
'1-405752831',
'1-405756881',
'1-405756891',
'1-405766781',
'1-40578521',
'1-40581471',
'1-4058171',
'1-405918065',
'1-405925043',
'1-405934101',
'1-40606901',
'1-4061101',
'1-406118101',
'1-40623461',
'1-40631831',
'1-4064151',
'1-4064279',
'1-4065001',
'1-4066143',
'1-40662581',
'1-4066421',
'1-4068259',
'1-4068274',
'1-406972591',
'1-407010941',
'1-407024373',
'1-407026971',
'1-407140283',
'1-407263811',
'1-407303563',
'1-407308481',
'1-407330281',
'1-407368881',
'1-407397531',
'1-407397711',
'1-407452351',
'1-4077114',
'1-4077296',
'1-4077897',
'1-40782250',
'1-40799171',
'1-4083788',
'1-4083884',
'1-4085154',
'1-4088244',
'1-4088523',
'1-4088531',
'1-408890131',
'1-408958931',
'1-4090214',
'1-4090371',
'1-4092411',
'1-4092776',
'1-409528191',
'1-409559303',
'1-409559591',
'1-409569241',
'1-409574951',
'1-409588801',
'1-409699763',
'1-409699831',
'1-409727411',
'1-409749101',
'1-409749621',
'1-409749991',
'1-409830631',
'1-40985394',
'1-409865251',
'1-409904461',
'1-409933451',
'1-409946923',
'1-409961641',
'1-4100221',
'1-410024651',
'1-410816771',
'1-410859461',
'1-410861491',
'1-410884681',
'1-410888971',
'1-410894971',
'1-410900233',
'1-410915017',
'1-410916521',
'1-410921021',
'1-410922381',
'1-410940821',
'1-410954021',
'1-4110211',
'1-41106811',
'1-411241581',
'1-411302291',
'1-411302361',
'1-411314411',
'1-411390181',
'1-41210021',
'1-41212001',
'1-412264351',
'1-412273151',
'1-412284203',
'1-412299001',
'1-412310651',
'1-412310931',
'1-412313481',
'1-412316841',
'1-412318341',
'1-412322421',
'1-412323311',
'1-412323371',
'1-412330821',
'1-412353291',
'1-412355991',
'1-412359851',
'1-412372261',
'1-412372841',
'1-412372851',
'1-412386381',
'1-412640361',
'1-412675211',
'1-412677211',
'1-412736121',
'1-412736271',
'1-412748343',
'1-412750281',
'1-412754363',
'1-412781281',
'1-412785161',
'1-413071371',
'1-413091151',
'1-413096282',
'1-413109001',
'1-413151231',
'1-413158501',
'1-413158591',
'1-413208103',
'1-413208321',
'1-413241061',
'1-413241491',
'1-413241561',
'1-413751241',
'1-413785501',
'1-413788101',
'1-413804033',
'1-413810131',
'1-413810171',
'1-413813301',
'1-413816321',
'1-413825331',
'1-413825351',
'1-413835731',
'1-413840661',
'1-413841731',
'1-413844632',
'1-413844974',
'1-413846681',
'1-413851051',
'1-413854521',
'1-413854711',
'1-413856711',
'1-413856901',
'1-413864571',
'1-413869831',
'1-414154333',
'1-414161261',
'1-414170221',
'1-414180401',
'1-414200305',
'1-414224371',
'1-414227051',
'1-414237011',
'1-414245441',
'1-414247161',
'1-414297071',
'1-414297172',
'1-414666982',
'1-414705381',
'1-414725591',
'1-414751311',
'1-414751622',
'1-414765001',
'1-414770421',
'1-4151744',
'1-4151871',
'1-4151991',
'1-4152591',
'1-415278771',
'1-4152791',
'1-415281253',
'1-4152903',
'1-415293922',
'1-415294961',
'1-415315521',
'1-415325751',
'1-415325881',
'1-41533013',
'1-415334541',
'1-415341911',
'1-415342031',
'1-415342051',
'1-415343821',
'1-415358592',
'1-4154504',
'1-4154771',
'1-4154814',
'1-4154841',
'1-4154914',
'1-4156271',
'1-4156434',
'1-4156651',
'1-4156934',
'1-4157231',
'1-4157324',
'1-4157457',
'1-415769223',
'1-4157792',
'1-415988701',
'1-415999691',
'1-416002203',
'1-4160291',
'1-416031301',
'1-416067161',
'1-416073582',
'1-4160781',
'1-416086257',
'1-4161548',
'1-4161824',
'1-4162001',
'1-4162221',
'1-4163451',
'1-4163641',
'1-4163761',
'1-4163997',
'1-4164294',
'1-4164411',
'1-4164674',
'1-4165413',
'1-4165514',
'1-4165591',
'1-4166249',
'1-4166771',
'1-4166824',
'1-4166917',
'1-416727641',
'1-416755581',
'1-416756271',
'1-416758821',
'1-416761071',
'1-4167651',
'1-416765691',
'1-416765851',
'1-416767661',
'1-416774855',
'1-416775421',
'1-416779041',
'1-4167841',
'1-4167936',
'1-4167997',
'1-4168991',
'1-4169101',
'1-4169394',
'1-417986971',
'1-417987195',
'1-418164793',
'1-41828223',
'1-41838661',
'1-4184101',
'1-418422491',
'1-4184374',
'1-4184724',
'1-4184811',
'1-4185454',
'1-4185681',
'1-4185958',
'1-418658877',
'1-4187241',
'1-4187271',
'1-4187806',
'1-4187991',
'1-4189475',
'1-4190301',
'1-4190331',
'1-4190371',
'1-4190526',
'1-4190881',
'1-4192288',
'1-4192996',
'1-4193641',
'1-4193903',
'1-419413641',
'1-419461753',
'1-41947601',
'1-419545563',
'1-419546067',
'1-419556751',
'1-419599491',
'1-419604461',
'1-419619921',
'1-419622541',
'1-4196297',
'1-4196391',
'1-4196401',
'1-419647891',
'1-419653461',
'1-419653551',
'1-419682231',
'1-419690107',
'1-419705601',
'1-4197094',
'1-419718011',
'1-4197331',
'1-419764751',
'1-4197831',
'1-419787687',
'1-4197921',
'1-419800731',
'1-419801111',
'1-419856914',
'1-419864321',
'1-419868141',
'1-419886011',
'1-419919593',
'1-4199411',
'1-419944661',
'1-419947173',
'1-4199473',
'1-419950391',
'1-419953991',
'1-4199621',
'1-4199791',
'1-419984144',
'1-419996835',
'1-420003301',
'1-420003941',
'1-420011951',
'1-4201211',
'1-4201361',
'1-4201485',
'1-4201494',
'1-4201514',
'1-4201911',
'1-4202073',
'1-42022435',
'1-420285851',
'1-4204281',
'1-4205347',
'1-4205664',
'1-420973431',
'1-420978581',
'1-420991455',
'1-421036543',
'1-421055011',
'1-4210711',
'1-421093071',
'1-421103554',
'1-421103811',
'1-42110451',
'1-421137101',
'1-421143073',
'1-4211511',
'1-4211523',
'1-421166773',
'1-421175351',
'1-421178451',
'1-4211871',
'1-421190141',
'1-421193161',
'1-421206141',
'1-421207891',
'1-421232751',
'1-421236331',
'1-421236411',
'1-421286153',
'1-421292021',
'1-421316381',
'1-421340621',
'1-421357494',
'1-421371541',
'1-421375471',
'1-421377381',
'1-421398371',
'1-4214681',
'1-421475401',
'1-4215395',
'1-4215441',
'1-4215787',
'1-4215821',
'1-4217161',
'1-421769571',
'1-42178011',
'1-421788122',
'1-421801471',
'1-421807411',
'1-421808231',
'1-421814274',
'1-421820701',
'1-421836391',
'1-421846681',
'1-421853003',
'1-421855101',
'1-421870511',
'1-421870871',
'1-422426431',
'1-422426931',
'1-422436343',
'1-422436441',
'1-422442881',
'1-422444201',
'1-4224475',
'1-422450631',
'1-4224633',
'1-422467281',
'1-422475211',
'1-422478412',
'1-4225061',
'1-4225451',
'1-4225601',
'1-4225700',
'1-4225801',
'1-422660141',
'1-422675541',
'1-422693501',
'1-422701081',
'1-422711244',
'1-422715511',
'1-422725321',
'1-422736341',
'1-422740721',
'1-422748121',
'1-422759961',
'1-422760001',
'1-422761541',
'1-422761623',
'1-422762601',
'1-422766721',
'1-422767431',
'1-422786171',
'1-422807121',
'1-422808431',
'1-422811081',
'1-4229501',
'1-4229961',
'1-4230157',
'1-4230371',
'1-423082411',
'1-4231040',
'1-4231084',
'1-423116251',
'1-423117483',
'1-423118263',
'1-423118991',
'1-423127371',
'1-423130357',
'1-423131932',
'1-423137401',
'1-423141001',
'1-423150903',
'1-423151321',
'1-423154421',
'1-423159431',
'1-423179251',
'1-423181221',
'1-423188921',
'1-423192951',
'1-423193241',
'1-423198001',
'1-423199941',
'1-423210721',
'1-423214147',
'1-4232491',
'1-4232581',
'1-423280381',
'1-4233034',
'1-4233861',
'1-4234205',
'1-4234661',
'1-4235331',
'1-4235471',
'1-4235787',
'1-4235854',
'1-423856851',
'1-423856891',
'1-423857271',
'1-42399141',
'1-4240185',
'1-4240261',
'1-4240341',
'1-424048231',
'1-424048296',
'1-424052121',
'1-424068551',
'1-424068621',
'1-4240741',
'1-424082301',
'1-424083841',
'1-424086761',
'1-424088801',
'1-424089211',
'1-424089371',
'1-424095781',
'1-424097111',
'1-424101215',
'1-424110221',
'1-424112431',
'1-424114261',
'1-424116251',
'1-424116901',
'1-424128281',
'1-424139091',
'1-424141371',
'1-424152621',
'1-424178551',
'1-424179131',
'1-4241862',
'1-424318401',
'1-4243471',
'1-424401451',
'1-424541291',
'1-424545731',
'1-424545981',
'1-424547651',
'1-424547721',
'1-424551451',
'1-424559401',
'1-424562161',
'1-424563001',
'1-424568724',
'1-424572491',
'1-424573311',
'1-424583401',
'1-424584151',
'1-424590471',
'1-424592181',
'1-424592671',
'1-424663001',
'1-424677911',
'1-424721011',
'1-4247542',
'1-424764191',
'1-4247981',
'1-4249171',
'1-4249202',
'1-4252181',
'1-4252413',
'1-425306601',
'1-425311051',
'1-4254404',
'1-425453811',
'1-425453871',
'1-42546281',
'1-425482221',
'1-425510491',
'1-425514787',
'1-425517941',
'1-425521611',
'1-425522671',
'1-425524863',
'1-425528111',
'1-425528271',
'1-425537895',
'1-425537971',
'1-425538501',
'1-425541561',
'1-425541591',
'1-425542251',
'1-425557071',
'1-4255571',
'1-425559741',
'1-425560271',
'1-425565411',
'1-425567771',
'1-4255774',
'1-425577831',
'1-425578823',
'1-425580821',
'1-425584991',
'1-425593571',
'1-425597381',
'1-425600701',
'1-425600713',
'1-4256011',
'1-425603821',
'1-425633731',
'1-425658501',
'1-425736861',
'1-425753461',
'1-425765501',
'1-425769433',
'1-4257884',
'1-4257891',
'1-425803421',
'1-425809461',
'1-425826431',
'1-425851531',
'1-425854431',
'1-4259441',
'1-425986731',
'1-425987621',
'1-425987701',
'1-425988481',
'1-425991731',
'1-425998321',
'1-426003341',
'1-426004601',
'1-426006601',
'1-426011021',
'1-426016781',
'1-426026251',
'1-426030843',
'1-426031191',
'1-426031281',
'1-426033711',
'1-426067031',
'1-426071661',
'1-426086721',
'1-426092643',
'1-426092941',
'1-426093581',
'1-426109571',
'1-426127551',
'1-4261581',
'1-4261798',
'1-4263191',
'1-4263806',
'1-4264311',
'1-4264344',
'1-4264463',
'1-4264871',
'1-4266364',
'1-4266545',
'1-4266721',
'1-4266791',
'1-4266941',
'1-4266964',
'1-4267091',
'1-426739571',
'1-426749961',
'1-426750381',
'1-426756523',
'1-4267734',
'1-426785701',
'1-426785831',
'1-4269393',
'1-4269741',
'1-426981261',
'1-426985841',
'1-426992791',
'1-427000873',
'1-427010283',
'1-427016251',
'1-427026111',
'1-427049031',
'1-427088941',
'1-427092831',
'1-4271394',
'1-4271401',
'1-4271511',
'1-4272281',
'1-4274281',
'1-4274537',
'1-4274953',
'1-427546241',
'1-427569971',
'1-427614551',
'1-427627533',
'1-4277321',
'1-4278461',
'1-4279045',
'1-4279221',
'1-4279704',
'1-4279771',
'1-4279961',
'1-428031541',
'1-428117711',
'1-428152683',
'1-428161181',
'1-428165701',
'1-428171841',
'1-428206721',
'1-428224561',
'1-428262031',
'1-428268011',
'1-4285241',
'1-4285391',
'1-4285831',
'1-4285841',
'1-4287165',
'1-4287651',
'1-42876881',
'1-4287763',
'1-4288101',
'1-4288601',
'1-4288616',
'1-4289448',
'1-4289581',
'1-4290011',
'1-4290161',
'1-4290653',
'1-4290691',
'1-4290781',
'1-429143151',
'1-4292051',
'1-4293503',
'1-4293513',
'1-4293683',
'1-429391001',
'1-429391671',
'1-429406851',
'1-429407261',
'1-4294141',
'1-4294334',
'1-429433791',
'1-42943500',
'1-429435541',
'1-429457131',
'1-429457251',
'1-429469401',
'1-429478081',
'1-429484012',
'1-4294856',
'1-429487061',
'1-4294963',
'1-429549801',
'1-429566151',
'1-429578191',
'1-429594891',
'1-429609681',
'1-4296202',
'1-429623471',
'1-429623561',
'1-4296273',
'1-429684111',
'1-429694481',
'1-429696611',
'1-429708841',
'1-429709281',
'1-429710711',
'1-429711141',
'1-429714261',
'1-429718053',
'1-429752131',
'1-429773891',
'1-4298204',
'1-429823423',
'1-429826871',
'1-4298451',
'1-429863371',
'1-429932921',
'1-429946931',
'1-429989731',
'1-430154931',
'1-430159691',
'1-430173611',
'1-430192721',
'1-430193881',
'1-430194581',
'1-430200571',
'1-4302111',
'1-430212481',
'1-4302237',
'1-4302341',
'1-430237801',
'1-430245341',
'1-430286451',
'1-4303261',
'1-4303331',
'1-4303777',
'1-4304071',
'1-4304354',
'1-430856601',
'1-430954341',
'1-430985441',
'1-431000151',
'1-431009331',
'1-431017001',
'1-431030171',
'1-431033065',
'1-431036101',
'1-431049621',
'1-431052731',
'1-431062713',
'1-431065941',
'1-431068831',
'1-431090664',
'1-431125271',
'1-431135191',
'1-431158713',
'1-4311664',
'1-431167861',
'1-431168661',
'1-431174941',
'1-4311754',
'1-431177185',
'1-431177501',
'1-4311791',
'1-4311801',
'1-4311930',
'1-431198141',
'1-431206441',
'1-431233679',
'1-431257971',
'1-431258651',
'1-431264551',
'1-431266891',
'1-431272391',
'1-431277511',
'1-431290981',
'1-431327121',
'1-4313471',
'1-431347801',
'1-431355003',
'1-4313871',
'1-431391981',
'1-4314461',
'1-4314673',
'1-4314681',
'1-4314861',
'1-4314941',
'1-4316363',
'1-4316421',
'1-4316767',
'1-431712403',
'1-431720091',
'1-431725341',
'1-4317814',
'1-4317911',
'1-431798341',
'1-4318017',
'1-4318081',
'1-4318091',
'1-431809361',
'1-431834421',
'1-431880681',
'1-4319191',
'1-4319851',
'1-4321351',
'1-4322549',
'1-432339561',
'1-432345861',
'1-432349541',
'1-432350063',
'1-4323741',
'1-43254754',
'1-4325591',
'1-432697951',
'1-432791092',
'1-43284521',
'1-4330451',
'1-4330731',
'1-4330741',
'1-4331301',
'1-4331324',
'1-4331343',
'1-4331903',
'1-433574904',
'1-43360881',
'1-433614411',
'1-433678101',
'1-433679961',
'1-433684051',
'1-433684131',
'1-433701623',
'1-433702761',
'1-433705112',
'1-433740573',
'1-433749961',
'1-4337601',
'1-433761563',
'1-433763741',
'1-4337771',
'1-433797571',
'1-433799481',
'1-433821191',
'1-433830775',
'1-433844241',
'1-433844265',
'1-433850841',
'1-433875501',
'1-43388094',
'1-433883613',
'1-433885781',
'1-433888181',
'1-433903451',
'1-433907341',
'1-433907921',
'1-433952121',
'1-43398721',
'1-43399171',
'1-433995053',
'1-434019891',
'1-434024151',
'1-434031611',
'1-434044821',
'1-434046721',
'1-434059261',
'1-434084051',
'1-434093371',
'1-434101571',
'1-434106351',
'1-434113021',
'1-434118461',
'1-434124031',
'1-434137001',
'1-434161951',
'1-434171911',
'1-434194991',
'1-434208331',
'1-434211961',
'1-434212201',
'1-434218951',
'1-434257051',
'1-434288271',
'1-434327131',
'1-4343821',
'1-434387951',
'1-4345904',
'1-434630173',
'1-434666781',
'1-434671821',
'1-434680011',
'1-434688101',
'1-434712951',
'1-434721841',
'1-43476391',
'1-4348254',
'1-4348761',
'1-4348971',
'1-4351473',
'1-4351573',
'1-4351754',
'1-4351941',
'1-435210151',
'1-435225131',
'1-435225281',
'1-4352751',
'1-4353161',
'1-4353173',
'1-435364091',
'1-435376761',
'1-435381881',
'1-435383081',
'1-435399441',
'1-435409641',
'1-435419521',
'1-435426767',
'1-435493231',
'1-435504153',
'1-435509331',
'1-435531783',
'1-435536633',
'1-435547521',
'1-435561771',
'1-435568381',
'1-435572731',
'1-435573621',
'1-435592471',
'1-435593652',
'1-435613801',
'1-435619581',
'1-4356481',
'1-435734231',
'1-435753361',
'1-435754281',
'1-435758141',
'1-435786341',
'1-435792081',
'1-435792611',
'1-435800611',
'1-435827191',
'1-435837671',
'1-435886003',
'1-435893331',
'1-435898281',
'1-435919431',
'1-435922191',
'1-435925181',
'1-4361001',
'1-436255981',
'1-436278001',
'1-436289231',
'1-436301211',
'1-4365821',
'1-4365838',
'1-4367535',
'1-4368093',
'1-4369003',
'1-4369084',
'1-437017331',
'1-437046341',
'1-437052966',
'1-4370591',
'1-437094663',
'1-437101921',
'1-4371048',
'1-437155151',
'1-437161311',
'1-437194781',
'1-437195903',
'1-437213985',
'1-437242121',
'1-437274361',
'1-437279971',
'1-437352431',
'1-437374151',
'1-437384411',
'1-437494331',
'1-437500491',
'1-437545561',
'1-437556711',
'1-437574571',
'1-4376404',
'1-437652701',
'1-437657381',
'1-437661611',
'1-437662571',
'1-437663531',
'1-437672581',
'1-437673521',
'1-437676581',
'1-4376911',
'1-437703501',
'1-437704191',
'1-4378664',
'1-4378723',
'1-4380391',
'1-43855684',
'1-438785271',
'1-438808021',
'1-438820481',
'1-438833841',
'1-438905621',
'1-439083231',
'1-4391224',
'1-4391321',
'1-4391451',
'1-4391794',
'1-439215151',
'1-4392196',
'1-4392634',
'1-4393401',
'1-439350091',
'1-4395361',
'1-439765872',
'1-4398111',
'1-439816531',
'1-439824195',
'1-439833891',
'1-439836201',
'1-4398371',
'1-439844241',
'1-439847081',
'1-439860163',
'1-439860191',
'1-439862831',
'1-439892161',
'1-4399201',
'1-439920471',
'1-439939011',
'1-439959791',
'1-439963093',
'1-4399651',
'1-439978641',
'1-439979501',
'1-439989421',
'1-440016961',
'1-440028053',
'1-440030851',
'1-440033401',
'1-440046351',
'1-440051859',
'1-440056061',
'1-440071941',
'1-440116001',
'1-440124530',
'1-440129041',
'1-4401459',
'1-440146201',
'1-4401601',
'1-440169641',
'1-440178891',
'1-440183091',
'1-440197611',
'1-440200731',
'1-440210971',
'1-440219043',
'1-440229621',
'1-440254053',
'1-440270401',
'1-440277223',
'1-4403111',
'1-440311961',
'1-440315393',
'1-440315491',
'1-4403224',
'1-4403344',
'1-440336561',
'1-4403428',
'1-440344471',
'1-4403451',
'1-440350601',
'1-44036164',
'1-440393992',
'1-440418611',
'1-440434901',
'1-440448441',
'1-440465151',
'1-440465581',
'1-440472321',
'1-440472491',
'1-440475501',
'1-440478651',
'1-440495261',
'1-440509651',
'1-440610371',
'1-440615051',
'1-440670491',
'1-440681303',
'1-4410164',
'1-4410404',
'1-4410681',
'1-4410773',
'1-4410911',
'1-4412641',
'1-4413481',
'1-4414044',
'1-441406701',
'1-441413271',
'1-441418921',
'1-441433571',
'1-441462361',
'1-441465605',
'1-4414671',
'1-441479051',
'1-441490121',
'1-441496761',
'1-441516041',
'1-441537821',
'1-441550783',
'1-4415541',
'1-441567601',
'1-441579011',
'1-441580791',
'1-441584783',
'1-441611487',
'1-441620181',
'1-441620561',
'1-441650411',
'1-441658691',
'1-441669171',
'1-441720283',
'1-441722371',
'1-441723281',
'1-441728821',
'1-441757631',
'1-441758031',
'1-441760501',
'1-441768051',
'1-441786691',
'1-441812371',
'1-441812952',
'1-441833051',
'1-441844951',
'1-4418451',
'1-441855031',
'1-4418841',
'1-441892501',
'1-441900451',
'1-441921321',
'1-441937191',
'1-441945611',
'1-441952981',
'1-441962951',
'1-441996501',
'1-4420021',
'1-442009823',
'1-442009932',
'1-442022621',
'1-442026761',
'1-442032261',
'1-442038521',
'1-442049281',
'1-442075131',
'1-442084521',
'1-4421224',
'1-442128781',
'1-442128863',
'1-442138911',
'1-442211601',
'1-442231701',
'1-4425731',
'1-4425781',
'1-4427914',
'1-4428021',
'1-4429201',
'1-4429884',
'1-4431071',
'1-4431091',
'1-4431961',
'1-4432041',
'1-4435271',
'1-4436367',
'1-4438843',
'1-4439477',
'1-4439559',
'1-4441209',
'1-4441611',
'1-444172233',
'1-444172581',
'1-444175841',
'1-444176691',
'1-444177883',
'1-444178761',
'1-444178883',
'1-444179601',
'1-444181581',
'1-444182693',
'1-444183381',
'1-4441835',
'1-444184611',
'1-444187041',
'1-444187141',
'1-4441877',
'1-444190331',
'1-444197801',
'1-444204141',
'1-444205261',
'1-444205351',
'1-444205821',
'1-444208811',
'1-444210553',
'1-444211051',
'1-444215021',
'1-444215911',
'1-444216191',
'1-444218301',
'1-444222791',
'1-444225521',
'1-444227391',
'1-444227583',
'1-444229321',
'1-444243531',
'1-4442561',
'1-444257561',
'1-444260201',
'1-444260281',
'1-4444581',
'1-4447361',
'1-444928221',
'1-444928741',
'1-4449363',
'1-444952851',
'1-444957381',
'1-4449691',
'1-444979101',
'1-444979521',
'1-444988331',
'1-444991431',
'1-4449921',
'1-444992261',
'1-444998461',
'1-445003861',
'1-445015014',
'1-445015541',
'1-445019155',
'1-445021641',
'1-445022371',
'1-445024613',
'1-445032111',
'1-445034801',
'1-445039751',
'1-445042521',
'1-445046911',
'1-445051801',
'1-445053081',
'1-445056061',
'1-445056771',
'1-445064011',
'1-445068681',
'1-445103151',
'1-445115411',
'1-445131943',
'1-445139143',
'1-445166331',
'1-445192941',
'1-445216601',
'1-445227521',
'1-445239471',
'1-445247021',
'1-445248681',
'1-4452561',
'1-445270361',
'1-4452851',
'1-445286001',
'1-445302991',
'1-445318711',
'1-445323321',
'1-445325232',
'1-445327272',
'1-445341241',
'1-4453521',
'1-445360961',
'1-4453704',
'1-445372741',
'1-445415181',
'1-445432241',
'1-445460851',
'1-445465531',
'1-445465771',
'1-445474701',
'1-445487091',
'1-445499041',
'1-445510941',
'1-445514141',
'1-445516531',
'1-445542951',
'1-445545301',
'1-445548295',
'1-445612621',
'1-445619201',
'1-445619821',
'1-445639951',
'1-445641901',
'1-445642511',
'1-445643061',
'1-445652571',
'1-445667701',
'1-445676291',
'1-445695711',
'1-4457071',
'1-445713221',
'1-445720023',
'1-445737981',
'1-445778291',
'1-445778311',
'1-445813093',
'1-445842841',
'1-4458731',
'1-445897862',
'1-4459001',
'1-4459396',
'1-4459481',
'1-44596573',
'1-446040211',
'1-446057201',
'1-446140711',
'1-446145651',
'1-446147101',
'1-446151383',
'1-446151401',
'1-446152821',
'1-446164681',
'1-446171811',
'1-446181421',
'1-446188791',
'1-446189381',
'1-446229391',
'1-446233857',
'1-446238531',
'1-4466710',
'1-4467381',
'1-4469844',
'1-4470141',
'1-4472401',
'1-4472701',
'1-4475101',
'1-4475265',
'1-447612612',
'1-4476161',
'1-447621031',
'1-447630411',
'1-447672941',
'1-447689011',
'1-447694061',
'1-447696441',
'1-4477011',
'1-447713131',
'1-447718433',
'1-447720001',
'1-447723781',
'1-447728391',
'1-447740901',
'1-447742011',
'1-447755101',
'1-447755262',
'1-447764031',
'1-447770284',
'1-447787151',
'1-447794203',
'1-447805311',
'1-447830430',
'1-447835451',
'1-4478531',
'1-447854691',
'1-447854701',
'1-4478611',
'1-447884311',
'1-4479011',
'1-447908171',
'1-447912333',
'1-447912535',
'1-447932981',
'1-447948571',
'1-447958521',
'1-44797224',
'1-447979811',
'1-447985891',
'1-447997741',
'1-448000683',
'1-448021571',
'1-448042151',
'1-448062215',
'1-448065101',
'1-448090201',
'1-448139461',
'1-448224341',
'1-448291871',
'1-4482921',
'1-4483161',
'1-448339453',
'1-4483541',
'1-448359251',
'1-448360131',
'1-448362541',
'1-4483671',
'1-448372581',
'1-448378441',
'1-448381181',
'1-448393481',
'1-448394833',
'1-448395041',
'1-448409851',
'1-448410261',
'1-448410461',
'1-448474883',
'1-448505375',
'1-448505501',
'1-448560901',
'1-448565391',
'1-448567771',
'1-448588381',
'1-448618911',
'1-4487571',
'1-4487601',
'1-44881025',
'1-4488117',
'1-4488411',
'1-4488864',
'1-448945341',
'1-4490241',
'1-44918683',
'1-44923011',
'1-449289791',
'1-449295711',
'1-449399571',
'1-4494801',
'1-449505301',
'1-449514562',
'1-449520751',
'1-44955551',
'1-4496136',
'1-44969953',
'1-449744561',
'1-449823531',
'1-449823963',
'1-449844601',
'1-449855881',
'1-449857121',
'1-449860971',
'1-449864091',
'1-449864511',
'1-449869651',
'1-449870181',
'1-449881911',
'1-449910521',
'1-449916571',
'1-449917701',
'1-449919241',
'1-449922153',
'1-449922591',
'1-449928501',
'1-449929001',
'1-449940081',
'1-449943711',
'1-449945371',
'1-4499522',
'1-449952531',
'1-4499657',
'1-4499731',
'1-44997381',
'1-449987971',
'1-449988223',
'1-449988231',
'1-449991893',
'1-450014161',
'1-4500333',
'1-450060253',
'1-450062081',
'1-450078591',
'1-450085631',
'1-450090791',
'1-450110421',
'1-450134121',
'1-450152041',
'1-450160753',
'1-4501625',
'1-450174641',
'1-450175511',
'1-450196631',
'1-450209011',
'1-450230741',
'1-450248971',
'1-450255511',
'1-450258151',
'1-450263613',
'1-450289281',
'1-450302691',
'1-450312581',
'1-450324341',
'1-450326751',
'1-450329581',
'1-4503651',
'1-450382211',
'1-450416791',
'1-450417331',
'1-450437481',
'1-450459671',
'1-450459701',
'1-450571961',
'1-450580221',
'1-450586851',
'1-450592343',
'1-450595681',
'1-450600351',
'1-450615121',
'1-450617612',
'1-450629931',
'1-450637101',
'1-450654461',
'1-450864481',
'1-450923291',
'1-450941581',
'1-450942361',
'1-450950181',
'1-450955961',
'1-450976971',
'1-450995471',
'1-451018511',
'1-451032311',
'1-4510331',
'1-451140871',
'1-451261521',
'1-451302761',
'1-4513041',
'1-4513245',
'1-451358832',
'1-451380201',
'1-451387571',
'1-451396511',
'1-451401831',
'1-4514021',
'1-451404281',
'1-451415981',
'1-451427073',
'1-451434901',
'1-451438981',
'1-451449251',
'1-451453421',
'1-451467593',
'1-451473341',
'1-451476651',
'1-451493451',
'1-451532931',
'1-451533261',
'1-451550101',
'1-451550371',
'1-451550791',
'1-451556641',
'1-451556821',
'1-451562311',
'1-451567391',
'1-451597683',
'1-451599741',
'1-4516101',
'1-451629561',
'1-451648951',
'1-451654991',
'1-451658073',
'1-451660703',
'1-451667801',
'1-451673051',
'1-451678845',
'1-451685341',
'1-451725501',
'1-451728211',
'1-451749001',
'1-451763001',
'1-451774951',
'1-451778741',
'1-451815071',
'1-4518161',
'1-451819501',
'1-451819581',
'1-451822701',
'1-451824831',
'1-4518381',
'1-451838221',
'1-451838581',
'1-451843001',
'1-4518485',
'1-451849271',
'1-451863931',
'1-451870255',
'1-451877301',
'1-451882421',
'1-451886891',
'1-4518991',
'1-451910481',
'1-451917201',
'1-451958991',
'1-451963041',
'1-451965541',
'1-451967501',
'1-451985031',
'1-452016561',
'1-452024511',
'1-452071211',
'1-452073541',
'1-452074091',
'1-452087811',
'1-452090031',
'1-452137561',
'1-452140361',
'1-452176511',
'1-452187491',
'1-452245653',
'1-452257567',
'1-452266671',
'1-4523463',
'1-4523651',
'1-452560021',
'1-452599631',
'1-452668973',
'1-4527041',
'1-452747911',
'1-452762051',
'1-452765541',
'1-452786231',
'1-452838981',
'1-452864731',
'1-452881331',
'1-452885211',
'1-452903291',
'1-452909201',
'1-452937981',
'1-452946243',
'1-452952771',
'1-452963869',
'1-452979601',
'1-453002861',
'1-453010201',
'1-453022272',
'1-453047441',
'1-453048233',
'1-453049821',
'1-453072271',
'1-453088403',
'1-453092033',
'1-4531121',
'1-453114111',
'1-453148861',
'1-453155911',
'1-453161421',
'1-453167813',
'1-453173081',
'1-453180211',
'1-4531814',
'1-453205773',
'1-453221041',
'1-453225941',
'1-4532306',
'1-453230981',
'1-453279241',
'1-453355571',
'1-453364831',
'1-453379161',
'1-453388051',
'1-453395091',
'1-453439997',
'1-453497791',
'1-4535261',
'1-4535471',
'1-453692811',
'1-453703631',
'1-453744211',
'1-453791809',
'1-453814511',
'1-453821961',
'1-453856651',
'1-453861811',
'1-453902411',
'1-453945621',
'1-453965471',
'1-453969251',
'1-453990531',
'1-453999711',
'1-454002961',
'1-454006851',
'1-454008531',
'1-454027401',
'1-454063381',
'1-454064831',
'1-454069293',
'1-454071331',
'1-454074371',
'1-454133761',
'1-454135583',
'1-454146571',
'1-4541531',
'1-454166791',
'1-454174721',
'1-4541951',
'1-454208831',
'1-454209341',
'1-454237241',
'1-4542493',
'1-454262761',
'1-454264853',
'1-454268781',
'1-4542939',
'1-454303651',
'1-454342221',
'1-454346873',
'1-454353601',
'1-4543611',
'1-454374661',
'1-454375261',
'1-4543811',
'1-454382011',
'1-4544051',
'1-4544061',
'1-454435501',
'1-454448071',
'1-454450051',
'1-454487571',
'1-454519561',
'1-454561201',
'1-454561923',
'1-454565561',
'1-454576631',
'1-4545783',
'1-454585981',
'1-454592681',
'1-454654161',
'1-454661183',
'1-454711601',
'1-454734055',
'1-454804141',
'1-454804841',
'1-454806201',
'1-454818971',
'1-454823691',
'1-454834343',
'1-454838931',
'1-4548453',
'1-454848011',
'1-454848061',
'1-454851511',
'1-454857101',
'1-454858411',
'1-454870201',
'1-454872263',
'1-454872639',
'1-454872851',
'1-454877051',
'1-454877101',
'1-454891891',
'1-454911861',
'1-454921201',
'1-455067971',
'1-455084151',
'1-455133991',
'1-455145772',
'1-455167931',
'1-455172651',
'1-455192161',
'1-455197861',
'1-455201421',
'1-455216641',
'1-455219361',
'1-455223731',
'1-455224771',
'1-455228141',
'1-455233041',
'1-455240393',
'1-455243423',
'1-455245931',
'1-455249781',
'1-455255111',
'1-455262197',
'1-455276361',
'1-455294551',
'1-455297281',
'1-455302511',
'1-455317781',
'1-455317911',
'1-455325061',
'1-455330211',
'1-455334892',
'1-4553351',
'1-455337361',
'1-455338411',
'1-455341613',
'1-455348061',
'1-4553557',
'1-455368221',
'1-455371191',
'1-4553795',
'1-455387341',
'1-455387651',
'1-455400381',
'1-455425541',
'1-455434311',
'1-455470741',
'1-455493441',
'1-455495241',
'1-455497591',
'1-455503501',
'1-455515611',
'1-455533651',
'1-455535001',
'1-455538151',
'1-455539161',
'1-4555431',
'1-455544541',
'1-455561401',
'1-455563181',
'1-455567471',
'1-455571083',
'1-455583141',
'1-455597101',
'1-455602811',
'1-455616311',
'1-455617021',
'1-455626311',
'1-455628121',
'1-455631951',
'1-455633101',
'1-455648621',
'1-455686471',
'1-455699961',
'1-455701861',
'1-455715171',
'1-455715581',
'1-455718741',
'1-455718981',
'1-455736761',
'1-455740241',
'1-455743861',
'1-455744611',
'1-455746771',
'1-455751941',
'1-455756111',
'1-455760951',
'1-455767611',
'1-455790931',
'1-455811521',
'1-455818941',
'1-4558233',
'1-455824501',
'1-4558284',
'1-455832283',
'1-455836391',
'1-455836651',
'1-455837081',
'1-455847541',
'1-455858691',
'1-455861861',
'1-455887591',
'1-455893171',
'1-455893651',
'1-455900671',
'1-455900841',
'1-455911331',
'1-455915321',
'1-455915773',
'1-455929981',
'1-455937761',
'1-455939013',
'1-455946701',
'1-455966761',
'1-455978301',
'1-455978431',
'1-455978691',
'1-455983111',
'1-455989161',
'1-455997111',
'1-455999511',
'1-456009201',
'1-4560117',
'1-456019751',
'1-456031671',
'1-456033771',
'1-456042871',
'1-456043271',
'1-456070991',
'1-456075541',
'1-456085791',
'1-456114171',
'1-456131701',
'1-456136021',
'1-456138111',
'1-456138611',
'1-456139121',
'1-456183351',
'1-456228303',
'1-456228451',
'1-456255941',
'1-456261781',
'1-4562803',
'1-4562889',
'1-456316141',
'1-456321193',
'1-456333111',
'1-4563957',
'1-456405373',
'1-456420291',
'1-456457381',
'1-4565021',
'1-456567881',
'1-456570201',
'1-456570581',
'1-4565811',
'1-4565987',
'1-456616621',
'1-456632341',
'1-456639051',
'1-456657391',
'1-456662611',
'1-456662651',
'1-456682113',
'1-456691411',
'1-456702831',
'1-456704601',
'1-4567431',
'1-456744621',
'1-456781091',
'1-4567821',
'1-456794323',
'1-456809141',
'1-456830121',
'1-456830541',
'1-456843931',
'1-456849763',
'1-456861321',
'1-456871981',
'1-456876091',
'1-456877921',
'1-456878841',
'1-456895673',
'1-456899381',
'1-456963951',
'1-456992652',
'1-456992901',
'1-457004891',
'1-457006281',
'1-457026801',
'1-457039751',
'1-457040901',
'1-457048161',
'1-457063031',
'1-457063561',
'1-457064031',
'1-457079051',
'1-457109711',
'1-4571211',
'1-457121925',
'1-457130041',
'1-457130941',
'1-4571491',
'1-457154461',
'1-457154483',
'1-457201331',
'1-457216711',
'1-457237741',
'1-457263301',
'1-457314461',
'1-457323531',
'1-457324093',
'1-457328011',
'1-457332971',
'1-457344531',
'1-457352971',
'1-4573581',
'1-457385231',
'1-457404111',
'1-457406501',
'1-457441571',
'1-457458521',
'1-457465291',
'1-457474151',
'1-457501841',
'1-457551171',
'1-4575591',
'1-457564291',
'1-4575758',
'1-457620731',
'1-457649691',
'1-457658221',
'1-457702521',
'1-457708191',
'1-4578010',
'1-4579266',
'1-4579354',
'1-457940921',
'1-457944773',
'1-4579473',
'1-457956483',
'1-457994881',
'1-458016181',
'1-458025121',
'1-458049191',
'1-458066531',
'1-458243421',
'1-458272761',
'1-458276801',
'1-458278921',
'1-458286343',
'1-458309533',
'1-458319451',
'1-458331831',
'1-458335301',
'1-458360541',
'1-458364331',
'1-458405201',
'1-458410801',
'1-458411721',
'1-458433155',
'1-458456821',
'1-458464351',
'1-458464852',
'1-458507381',
'1-458534241',
'1-458549791',
'1-458571121',
'1-458577671',
'1-458581531',
'1-458581591',
'1-4585894',
'1-458601741',
'1-458602431',
'1-458612491',
'1-4586261',
'1-458637481',
'1-458637901',
'1-458668021',
'1-458675412',
'1-458678271',
'1-458679111',
'1-458692761',
'1-458699461',
'1-4587015',
'1-458718281',
'1-458720471',
'1-458725891',
'1-458726391',
'1-458745535',
'1-458768391',
'1-4587924',
'1-458825761',
'1-458853671',
'1-458858441',
'1-458901111',
'1-458944503',
'1-458944651',
'1-458970131',
'1-458986541',
'1-458992353',
'1-4590251',
'1-4590381',
'1-459050071',
'1-459066431',
'1-4590801',
'1-459095821',
'1-459101984',
'1-459110221',
'1-459150391',
'1-459156251',
'1-459178681',
'1-459215421',
'1-459230197',
'1-459233181',
'1-4592571',
'1-4592583',
'1-4592760',
'1-459282671',
'1-459290621',
'1-459307713',
'1-459316821',
'1-459338411',
'1-459352761',
'1-459359051',
'1-459366372',
'1-459374291',
'1-4593797',
'1-459436203',
'1-4594595',
'1-459476713',
'1-459478981',
'1-4594881',
'1-459772571',
'1-459778831',
'1-459797351',
'1-459809441',
'1-459828561',
'1-459828611',
'1-459874841',
'1-459944721',
'1-459988421',
'1-459996711',
'1-460040295',
'1-460082281',
'1-460091841',
'1-460099321',
'1-460124211',
'1-460208261',
'1-460238021',
'1-460260961',
'1-460411741',
'1-460448591',
'1-460470211',
'1-460475841',
'1-460487413',
'1-460503211',
'1-460505371',
'1-460505561',
'1-460508361',
'1-4605084',
'1-460508593',
'1-460509291',
'1-460522461',
'1-460571721',
'1-460597801',
'1-460630771',
'1-460632911',
'1-460640153',
'1-4606451',
'1-460653221',
'1-460654091',
'1-4606651',
'1-460665451',
'1-460693031',
'1-460699071',
'1-460701771',
'1-460717271',
'1-460722875',
'1-460724781',
'1-460724841',
'1-460725903',
'1-460740377',
'1-460765031',
'1-460807441',
'1-460808091',
'1-460834051',
'1-460840883',
'1-460860281',
'1-460860791',
'1-460873021',
'1-460885041',
'1-460890181',
'1-460901471',
'1-460908921',
'1-460915511',
'1-460928631',
'1-460928701',
'1-460937221',
'1-460939251',
'1-461010121',
'1-461017691',
'1-461022893',
'1-461064441',
'1-461064671',
'1-461073681',
'1-461076641',
'1-461081721',
'1-461090841',
'1-461102793',
'1-461109021',
'1-461109041',
'1-461123389',
'1-461126651',
'1-461140651',
'1-461155451',
'1-461168981',
'1-461186721',
'1-461205761',
'1-461211011',
'1-461217081',
'1-461238661',
'1-461239001',
'1-461242361',
'1-461245561',
'1-461259591',
'1-461303875',
'1-461308191',
'1-461316291',
'1-461322231',
'1-461324461',
'1-461332761',
'1-4613331',
'1-461349751',
'1-461367741',
'1-461408861',
'1-461417722',
'1-461457001',
'1-461477081',
'1-461491971',
'1-461494531',
'1-461529121',
'1-461530291',
'1-4615371',
'1-461575441',
'1-461628791',
'1-461642271',
'1-461642301',
'1-461651251',
'1-461654381',
'1-461659951',
'1-461664851',
'1-461677211',
'1-461684541',
'1-461687451',
'1-461807531',
'1-461813733',
'1-461962591',
'1-461999251',
'1-462007101',
'1-462027571',
'1-462068941',
'1-462119051',
'1-462120351',
'1-462131501',
'1-462184841',
'1-462197695',
'1-462199661',
'1-462213385',
'1-462239141',
'1-462248861',
'1-462258093',
'1-462264351',
'1-462292111',
'1-462302433',
'1-462304843',
'1-462305741',
'1-462314211',
'1-462318401',
'1-462330021',
'1-462337375',
'1-462352901',
'1-462354711',
'1-462385081',
'1-462386831',
'1-462392563',
'1-462392761',
'1-462396161',
'1-462403251',
'1-462403981',
'1-462404861',
'1-462411871',
'1-462417781',
'1-462444021',
'1-462445888',
'1-462447131',
'1-462450421',
'1-462452961',
'1-462453641',
'1-462506571',
'1-462513221',
'1-462545051',
'1-462548911',
'1-462550481',
'1-462557131',
'1-462563721',
'1-462573331',
'1-462578741',
'1-462578871',
'1-462583171',
'1-462592651',
'1-462607211',
'1-462620601',
'1-462629961',
'1-462630131',
'1-462631611',
'1-462641751',
'1-462645162',
'1-462663311',
'1-4626934',
'1-462702311',
'1-462735221',
'1-462735411',
'1-4627612',
'1-462765461',
'1-462765721',
'1-462766911',
'1-462792101',
'1-462818292',
'1-462834281',
'1-462839861',
'1-462840503',
'1-462851201',
'1-462869143',
'1-462873341',
'1-462877831',
'1-462880891',
'1-462883441',
'1-462904271',
'1-462905091',
'1-462917021',
'1-462934263',
'1-462941063',
'1-462942695',
'1-462963795',
'1-462973971',
'1-462982511',
'1-463104201',
'1-463122211',
'1-463156901',
'1-4631931',
'1-4631951',
'1-4632141',
'1-4632392',
'1-463246411',
'1-463251785',
'1-463260371',
'1-463262551',
'1-463267231',
'1-463269041',
'1-463272131',
'1-463273201',
'1-463274081',
'1-463276851',
'1-463287531',
'1-463291591',
'1-463298351',
'1-463299131',
'1-4633001',
'1-4633060',
'1-463353781',
'1-463362451',
'1-463415071',
'1-463422591',
'1-463450161',
'1-463478151',
'1-463560831',
'1-463592031',
'1-4636134',
'1-463628091',
'1-4636751',
'1-463685531',
'1-463703261',
'1-4637054',
'1-463712011',
'1-463716241',
'1-463717181',
'1-463720683',
'1-463728061',
'1-463743451',
'1-463760631',
'1-463771133',
'1-463792451',
'1-463799471',
'1-463824941',
'1-463825051',
'1-463835941',
'1-463849211',
'1-463859621',
'1-463860721',
'1-463864301',
'1-463865741',
'1-463870661',
'1-463879121',
'1-463882101',
'1-463889211',
'1-463893321',
'1-463896781',
'1-463913523',
'1-463924471',
'1-463954781',
'1-463964011',
'1-463976071',
'1-463976721',
'1-464002001',
'1-464010951',
'1-464011391',
'1-464030461',
'1-464050921',
'1-464054631',
'1-464056681',
'1-464073281',
'1-464094161',
'1-464123671',
'1-464126911',
'1-464135081',
'1-464136493',
'1-464142459',
'1-464146401',
'1-464150471',
'1-464174091',
'1-464251611',
'1-464255611',
'1-464284381',
'1-464304761',
'1-464307971',
'1-464318451',
'1-464322671',
'1-464322751',
'1-464323173',
'1-464345861',
'1-464346021',
'1-464362401',
'1-464388321',
'1-464418071',
'1-464456581',
'1-464457241',
'1-464468731',
'1-464508391',
'1-4645651',
'1-4645686',
'1-464572791',
'1-464597681',
'1-464602391',
'1-464648961',
'1-464715881',
'1-464730711',
'1-464781906',
'1-464891911',
'1-464900201',
'1-464908431',
'1-464922171',
'1-464922281',
'1-464944731',
'1-464954441',
'1-464969221',
'1-464995041',
'1-465029691',
'1-465029841',
'1-465030131',
'1-465035071',
'1-465044147',
'1-4651081',
'1-465144811',
'1-465179911',
'1-465223073',
'1-4652951',
'1-4653721',
'1-4653901',
'1-465421101',
'1-465501701',
'1-465501833',
'1-465503741',
'1-465503761',
'1-465512581',
'1-465541201',
'1-465544951',
'1-465548143',
'1-465564601',
'1-465574941',
'1-465576233',
'1-465579911',
'1-465580013',
'1-4655811',
'1-465586101',
'1-465607771',
'1-465626741',
'1-465629101',
'1-465642583',
'1-465642921',
'1-465653091',
'1-465653481',
'1-465653531',
'1-465660191',
'1-465661211',
'1-465665481',
'1-465666171',
'1-465666361',
'1-465680953',
'1-465683671',
'1-465683701',
'1-465688831',
'1-465689281',
'1-465702401',
'1-4657124',
'1-465719371',
'1-465721943',
'1-465752251',
'1-465755671',
'1-465756641',
'1-465761041',
'1-465762081',
'1-4657681',
'1-4657771',
'1-465782551',
'1-4657934',
'1-465814851',
'1-465814881',
'1-465819111',
'1-465822431',
'1-4658615',
'1-4658711',
'1-465872931',
'1-465893641',
'1-465904731',
'1-465916581',
'1-465928151',
'1-465931641',
'1-465935091',
'1-465939881',
'1-465940751',
'1-465941501',
'1-465948641',
'1-465949211',
'1-465963811',
'1-465973021',
'1-465974991',
'1-465989121',
'1-465990781',
'1-465995545',
'1-466001723',
'1-466015261',
'1-466017371',
'1-466021511',
'1-4660305',
'1-466034941',
'1-466036321',
'1-466036451',
'1-466044331',
'1-466046963',
'1-466049695',
'1-466056241',
'1-466063671',
'1-466080731',
'1-466092341',
'1-466095961',
'1-4661421',
'1-4661491',
'1-466150731',
'1-466196671',
'1-466232411',
'1-466239891',
'1-466243801',
'1-466246701',
'1-466263861',
'1-466304091',
'1-4663161',
'1-466334603',
'1-466343581',
'1-466352601',
'1-466421821',
'1-466441841',
'1-466447981',
'1-466462151',
'1-4664791',
'1-4665661',
'1-466577341',
'1-466590541',
'1-466592421',
'1-466597743',
'1-466670311',
'1-466670321',
'1-466711811',
'1-466720281',
'1-4667511',
'1-466794921',
'1-466809041',
'1-466881441',
'1-466915401',
'1-466937181',
'1-467086781',
'1-467087191',
'1-467099851',
'1-4671968',
'1-467237941',
'1-467246871',
'1-467250051',
'1-467271751',
'1-467272471',
'1-467275591',
'1-467281381',
'1-467287581',
'1-4673183',
'1-4673355',
'1-4673381',
'1-467341191',
'1-467357021',
'1-467376721',
'1-467388701',
'1-467400571',
'1-467422911',
'1-467424873',
'1-467432523',
'1-4674361',
'1-467437941',
'1-467438493',
'1-467459501',
'1-467476193',
'1-467477641',
'1-467500601',
'1-467509761',
'1-467514391',
'1-467540701',
'1-467543583',
'1-467566801',
'1-467570171',
'1-467576523',
'1-467599631',
'1-4676241',
'1-467625663',
'1-4676331',
'1-467647771',
'1-4676552',
'1-4676771',
'1-467680573',
'1-467727335',
'1-467733873',
'1-467753611',
'1-467779461',
'1-467802101',
'1-467821741',
'1-467832381',
'1-467850013',
'1-467853871',
'1-467862471',
'1-467914131',
'1-467928841',
'1-467939061',
'1-467944651',
'1-467957621',
'1-467963733',
'1-468009933',
'1-468010621',
'1-4680190',
'1-468092481',
'1-468116611',
'1-468147951',
'1-468153821',
'1-4681541',
'1-468163081',
'1-468165361',
'1-468167351',
'1-468190441',
'1-468191151',
'1-468225051',
'1-4682711',
'1-468355781',
'1-4684994',
'1-4688751',
'1-4690594',
'1-4690647',
'1-4691071',
'1-4692891',
'1-469696259',
'1-4697197',
'1-4697911',
'1-4699944',
'1-4702181',
'1-4702603',
'1-4702766',
'1-4703945',
'1-4705186',
'1-4705811',
'1-4706854',
'1-4708241',
'1-4708546',
'1-470930961',
'1-4710371',
'1-4710961',
'1-4711994',
'1-4714663',
'1-4717591',
'1-4717671',
'1-4719461',
'1-4724421',
'1-4726374',
'1-4726786',
'1-4727841',
'1-4730843',
'1-4734112',
'1-4734751',
'1-4734871',
'1-4735697',
'1-4735791',
'1-4736451',
'1-4736951',
'1-4736974',
'1-473828641',
'1-473834521',
'1-473835571',
'1-473835671',
'1-473836533',
'1-473836921',
'1-473837681',
'1-473837791',
'1-473841031',
'1-473841301',
'1-473841731',
'1-473844331',
'1-473846691',
'1-473847871',
'1-473850571',
'1-473852783',
'1-473855591',
'1-473856021',
'1-473857591',
'1-473860531',
'1-473861171',
'1-473861931',
'1-473862781',
'1-473862841',
'1-473865721',
'1-473869551',
'1-473869761',
'1-473871641',
'1-473872751',
'1-473876871',
'1-473880821',
'1-473881761',
'1-473882653',
'1-473884201',
'1-473885581',
'1-473885601',
'1-4738886',
'1-473889271',
'1-4738926',
'1-473897431',
'1-473905341',
'1-473906061',
'1-473911691',
'1-473952651',
'1-4739621',
'1-473977601',
'1-474009353',
'1-474009413',
'1-4740133',
'1-474023711',
'1-4740311',
'1-474040451',
'1-474045941',
'1-474053841',
'1-474053851',
'1-474054481',
'1-474055771',
'1-474065881',
'1-474065941',
'1-474069551',
'1-474074021',
'1-474076001',
'1-474079801',
'1-474091821',
'1-474113981',
'1-474135851',
'1-474141607',
'1-474152553',
'1-474178841',
'1-474190551',
'1-474191761',
'1-474195581',
'1-474205681',
'1-474220803',
'1-474224129',
'1-474241451',
'1-474249861',
'1-474252121',
'1-474252861',
'1-474267171',
'1-474267571',
'1-474299561',
'1-474308851',
'1-474311203',
'1-474326871',
'1-474397663',
'1-474398581',
'1-4744511',
'1-474460451',
'1-474501411',
'1-4745031',
'1-474535051',
'1-474573111',
'1-474628861',
'1-474634141',
'1-4746394',
'1-474649311',
'1-474656361',
'1-474661871',
'1-4747061',
'1-474717311',
'1-474733671',
'1-474749221',
'1-474759041',
'1-474763251',
'1-474775711',
'1-474806531',
'1-474834941',
'1-474840171',
'1-474845331',
'1-474848651',
'1-474920181',
'1-474922151',
'1-474934283',
'1-474948161',
'1-474951661',
'1-474956411',
'1-474974291',
'1-474986121',
'1-474990191',
'1-475003932',
'1-475006541',
'1-475008881',
'1-475013801',
'1-475019251',
'1-475026781',
'1-475037561',
'1-475047513',
'1-475064381',
'1-475071421',
'1-475093041',
'1-475096201',
'1-475107481',
'1-475109953',
'1-475119771',
'1-475120351',
'1-475123901',
'1-475129943',
'1-475130491',
'1-475136221',
'1-475136291',
'1-475151131',
'1-475155741',
'1-475165361',
'1-475166095',
'1-475174231',
'1-475182883',
'1-475183311',
'1-475184201',
'1-475193061',
'1-475193221',
'1-475194153',
'1-475194163',
'1-475194211',
'1-475198031',
'1-475203423',
'1-475206581',
'1-475206661',
'1-475207451',
'1-475207671',
'1-475212585',
'1-475212911',
'1-475215631',
'1-475216661',
'1-475218391',
'1-475220731',
'1-475220781',
'1-475221403',
'1-475226051',
'1-475232091',
'1-475234551',
'1-475234701',
'1-475245811',
'1-475246851',
'1-475250471',
'1-475251651',
'1-475252321',
'1-475255181',
'1-475257241',
'1-475257681',
'1-475263761',
'1-475266551',
'1-475273387',
'1-475274531',
'1-475274703',
'1-475275711',
'1-475279121',
'1-475280201',
'1-475286551',
'1-475286631',
'1-475289081',
'1-475289501',
'1-475295651',
'1-475309641',
'1-475319561',
'1-475320983',
'1-475328691',
'1-475340681',
'1-475350377',
'1-475364881',
'1-475365011',
'1-475368891',
'1-475384387',
'1-475403013',
'1-475411011',
'1-475419225',
'1-475420653',
'1-475426153',
'1-475427401',
'1-475432291',
'1-475434091',
'1-475434761',
'1-475435423',
'1-475446921',
'1-475478011',
'1-475485431',
'1-475488301',
'1-475493125',
'1-475497154',
'1-475498331',
'1-475501231',
'1-475504021',
'1-475512653',
'1-475520981',
'1-475526611',
'1-475529453',
'1-475533653',
'1-475538171',
'1-475564615',
'1-475576863',
'1-475579843',
'1-475591623',
'1-475613261',
'1-475613401',
'1-475680441',
'1-475703651',
'1-475712711',
'1-475713393',
'1-475734621',
'1-475761341',
'1-475800583',
'1-475885601',
'1-475913553',
'1-475921541',
'1-475922551',
'1-475927671',
'1-475935771',
'1-475941291',
'1-475946533',
'1-475972421',
'1-475972451',
'1-476020081',
'1-476053711',
'1-476065432',
'1-476065901',
'1-476099451',
'1-476113871',
'1-476118971',
'1-476125311',
'1-476131831',
'1-476134131',
'1-476146011',
'1-476147571',
'1-476149491',
'1-476166431',
'1-476171123',
'1-476228951',
'1-476291461',
'1-476309571',
'1-476324101',
'1-476328731',
'1-476352761',
'1-476366521',
'1-476386581',
'1-476408821',
'1-476410511',
'1-476424681',
'1-476496781',
'1-476497031',
'1-476504581',
'1-476551631',
'1-476559861',
'1-476630493',
'1-476642761',
'1-476653971',
'1-476678311',
'1-476895581',
'1-476905101',
'1-476905351',
'1-476911551',
'1-476952621',
'1-477008575',
'1-477008861',
'1-477035521',
'1-477036216',
'1-477119421',
'1-4773481',
'1-4773886',
'1-4773911',
'1-4774074',
'1-477414661',
'1-477475681',
'1-4775471',
'1-4775974',
'1-477606471',
'1-477609065',
'1-477610091',
'1-477614251',
'1-477616701',
'1-477619731',
'1-477626921',
'1-477628461',
'1-477630871',
'1-4776331',
'1-4776344',
'1-477638333',
'1-477639331',
'1-4776561',
'1-477659611',
'1-477659651',
'1-477671661',
'1-477725151',
'1-477730261',
'1-477730271',
'1-477750473',
'1-477753671',
'1-477756801',
'1-477773773',
'1-477786221',
'1-477802431',
'1-477826721',
'1-477848821',
'1-477860851',
'1-4779181',
'1-477920101',
'1-477935925',
'1-477936031',
'1-4779461',
'1-477946931',
'1-4779671',
'1-477970935',
'1-477978001',
'1-4781081',
'1-478111211',
'1-478111381',
'1-478111401',
'1-4781171',
'1-478117321',
'1-478120251',
'1-478132151',
'1-478133211',
'1-478144201',
'1-478163251',
'1-478166301',
'1-478170101',
'1-4781874',
'1-4782194',
'1-478219981',
'1-478226261',
'1-4782353',
'1-478239231',
'1-478241871',
'1-478242841',
'1-478248101',
'1-478250021',
'1-478259021',
'1-478259131',
'1-478264351',
'1-478264681',
'1-478268271',
'1-478301451',
'1-478308181',
'1-478311721',
'1-478323311',
'1-478323581',
'1-478353551',
'1-478354121',
'1-478370451',
'1-478371641',
'1-478375891',
'1-478377521',
'1-478378551',
'1-478381221',
'1-478389881',
'1-478394691',
'1-478397411',
'1-478399111',
'1-478403761',
'1-478412091',
'1-478416861',
'1-478425611',
'1-478429761',
'1-478440551',
'1-478445051',
'1-4784471',
'1-478448411',
'1-478480081',
'1-478506581',
'1-478533511',
'1-478557941',
'1-478643081',
'1-478732393',
'1-4787341',
'1-4787416',
'1-478892761',
'1-478904853',
'1-478982751',
'1-478993881',
'1-4790201',
'1-479023391',
'1-479033531',
'1-479033741',
'1-4790481',
'1-479071691',
'1-479088221',
'1-479106291',
'1-479112201',
'1-4791124',
'1-479139981',
'1-4791491',
'1-4791571',
'1-479191791',
'1-479198411',
'1-4792001',
'1-479228611',
'1-479242731',
'1-4792596',
'1-479286841',
'1-4792871',
'1-479296511',
'1-479325151',
'1-479325185',
'1-479351361',
'1-479356451',
'1-479364451',
'1-479368112',
'1-479386701',
'1-479388911',
'1-479396381',
'1-479416321',
'1-479464511',
'1-479474841',
'1-479477983',
'1-4795091',
'1-479579621',
'1-479589481',
'1-479595311',
'1-479638061',
'1-479642611',
'1-479655381',
'1-4796841',
'1-479716461',
'1-479725151',
'1-479725391',
'1-479731891',
'1-479766391',
'1-479769481',
'1-479774571',
'1-479776471',
'1-479777621',
'1-479782641',
'1-479808442',
'1-479812301',
'1-479812321',
'1-4798263',
'1-479830451',
'1-479831861',
'1-479832441',
'1-479882101',
'1-4799121',
'1-479940721',
'1-479941681',
'1-479949421',
'1-479957701',
'1-479984091',
'1-479984361',
'1-479988671',
'1-4799921',
'1-479994891',
'1-480049681',
'1-480105851',
'1-4801204',
'1-480133081',
'1-480172121',
'1-480219541',
'1-480231081',
'1-480242611',
'1-480272543',
'1-480297331',
'1-480325701',
'1-480329801',
'1-480351431',
'1-480361021',
'1-480371471',
'1-480387011',
'1-480394561',
'1-480399401',
'1-480403641',
'1-480406231',
'1-4804114',
'1-4804261',
'1-4804947',
'1-480512611',
'1-480562801',
'1-4805659',
'1-480570161',
'1-480571991',
'1-480586901',
'1-480592981',
'1-480601301',
'1-4806461',
'1-480672011',
'1-480676131',
'1-480681131',
'1-4806871',
'1-480694091',
'1-480703211',
'1-480822241',
'1-480854391',
'1-480895001',
'1-480917461',
'1-480928731',
'1-480945431',
'1-4809801',
'1-480985591',
'1-481028041',
'1-481028141',
'1-481174431',
'1-481191431',
'1-481227503',
'1-481299411',
'1-4813121',
'1-4813222',
'1-4813295',
'1-481366451',
'1-4813751',
'1-481386261',
'1-4813901',
'1-481395681',
'1-481402431',
'1-481405833',
'1-4814144',
'1-481620021',
'1-481628601',
'1-481630821',
'1-481672041',
'1-481700771',
'1-481762581',
'1-481809011',
'1-481810821',
'1-481814731',
'1-481845421',
'1-481848141',
'1-481878661',
'1-481883371',
'1-481942981',
'1-4819813',
'1-481983501',
'1-481984631',
'1-482001351',
'1-482005211',
'1-482019753',
'1-482041911',
'1-482101721',
'1-4821121',
'1-482116771',
'1-482121061',
'1-482121751',
'1-4821331',
'1-4821520',
'1-482152491',
'1-482155591',
'1-482157361',
'1-482159671',
'1-482195121',
'1-4821964',
'1-482209715',
'1-482219681',
'1-4822221',
'1-4822661',
'1-482283071',
'1-4823033',
'1-482340011',
'1-482347071',
'1-482432591',
'1-4824481',
'1-482451854',
'1-4824541',
'1-482459471',
'1-4824676',
'1-482471901',
'1-482487061',
'1-482516391',
'1-4826111',
'1-482619181',
'1-482621081',
'1-482629801',
'1-4826621',
'1-482714771',
'1-482728561',
'1-482788911',
'1-4828311',
'1-4828734',
'1-482943741',
'1-4830121',
'1-4830192',
'1-4830453',
'1-4830701',
'1-483073513',
'1-483093641',
'1-483099841',
'1-483107441',
'1-4831184',
'1-4831705',
'1-4831741',
'1-483176941',
'1-4831783',
'1-4833881',
'1-483406591',
'1-483409782',
'1-483474741',
'1-483489881',
'1-483503761',
'1-483524131',
'1-483541711',
'1-483549151',
'1-483596771',
'1-483601601',
'1-4836141',
'1-4836457',
'1-483647721',
'1-483654421',
'1-4836731',
'1-4836951',
'1-483703601',
'1-4837226',
'1-4837851',
'1-483795101',
'1-483811564',
'1-4838164',
'1-483835411',
'1-483860731',
'1-483864131',
'1-483909511',
'1-483935131',
'1-483969241',
'1-4839781',
'1-4839901',
'1-483999291',
'1-484019501',
'1-484034091',
'1-484082281',
'1-484105931',
'1-4841381',
'1-4841495',
'1-484161921',
'1-4841690',
'1-484188181',
'1-484201141',
'1-4843131',
'1-484319121',
'1-484319691',
'1-4843271',
'1-4843294',
'1-4843441',
'1-4843631',
'1-4843687',
'1-484611381',
'1-484620061',
'1-484628011',
'1-484631901',
'1-484639071',
'1-484648641',
'1-484668241',
'1-4847141',
'1-484758993',
'1-4847761',
'1-484796881',
'1-4848273',
'1-4848471',
'1-4849231',
'1-4849291',
'1-484950331',
'1-484968011',
'1-484980531',
'1-485007171',
'1-485033091',
'1-485046991',
'1-485055081',
'1-485079651',
'1-485080981',
'1-485089711',
'1-4851061',
'1-485172261',
'1-485186941',
'1-485203981',
'1-485220721',
'1-4852621',
'1-4852891',
'1-485304161',
'1-4853161',
'1-485350441',
'1-4854264',
'1-4854921',
'1-485591091',
'1-485660671',
'1-485682111',
'1-485740861',
'1-485792811',
'1-485799331',
'1-485804111',
'1-485831871',
'1-485854731',
'1-485896331',
'1-485911381',
'1-485960131',
'1-486005441',
'1-486107131',
'1-486108121',
'1-486143161',
'1-4861526',
'1-486158331',
'1-486164201',
'1-4861701',
'1-486173471',
'1-4862166',
'1-486282911',
'1-486291521',
'1-486293203',
'1-486295633',
'1-4863001',
'1-486301191',
'1-486302691',
'1-486305231',
'1-486314211',
'1-4863336',
'1-486349571',
'1-486351161',
'1-486378513',
'1-486425993',
'1-486488521',
'1-486552551',
'1-486560843',
'1-486569621',
'1-486597751',
'1-486617451',
'1-486627323',
'1-4866341',
'1-4866573',
'1-486671591',
'1-486681621',
'1-486710761',
'1-486827181',
'1-486840961',
'1-4868561',
'1-486883911',
'1-486884682',
'1-486943331',
'1-487083191',
'1-487104651',
'1-487115803',
'1-487130861',
'1-487132803',
'1-487148641',
'1-487157891',
'1-487178951',
'1-487215391',
'1-487265541',
'1-487268181',
'1-487270291',
'1-487285891',
'1-487322491',
'1-487337191',
'1-487347841',
'1-487391551',
'1-487428891',
'1-487472261',
'1-487472383',
'1-487484701',
'1-487502421',
'1-487620591',
'1-487623791',
'1-487630871',
'1-487639381',
'1-487640671',
'1-487646591',
'1-487651221',
'1-487692541',
'1-487699231',
'1-487719961',
'1-487762261',
'1-487852141',
'1-4878661',
'1-487878833',
'1-4878796',
'1-487904031',
'1-487923953',
'1-4879253',
'1-4879691',
'1-487979463',
'1-487990271',
'1-4879971',
'1-4880051',
'1-488005631',
'1-488049531',
'1-488049741',
'1-4881161',
'1-488121675',
'1-4881408',
'1-488164671',
'1-488233171',
'1-488234111',
'1-488256645',
'1-488288631',
'1-4883231',
'1-4884011',
'1-4884718',
'1-4884771',
'1-4885121',
'1-4885441',
'1-4885479',
'1-4885880',
'1-4886911',
'1-488700101',
'1-488757261',
'1-4888681',
'1-488879141',
'1-4889341',
'1-4889431',
'1-489030201',
'1-489130201',
'1-489210653',
'1-489218631',
'1-4892651',
'1-489482541',
'1-4895291',
'1-4897321',
'1-4897352',
'1-4898041',
'1-4898091',
'1-489846411',
'1-490016731',
'1-490030001',
'1-490031631',
'1-490035511',
'1-490050423',
'1-490060591',
'1-4901941',
'1-4903321',
'1-4904307',
'1-490465401',
'1-490560413',
'1-490594401',
'1-490619431',
'1-4906401',
'1-490691401',
'1-490723491',
'1-490747501',
'1-4907791',
'1-490805411',
'1-4908763',
'1-491038511',
'1-4910613',
'1-491290501',
'1-491330521',
'1-491346501',
'1-491388531',
'1-491392521',
'1-4914383',
'1-491715601',
'1-4917161',
'1-4917231',
'1-491988341',
'1-491988351',
'1-491997703',
'1-492104721',
'1-492427581',
'1-492434861',
'1-492437315',
'1-492440781',
'1-492443161',
'1-492444141',
'1-492446681',
'1-492453991',
'1-492459001',
'1-492459241',
'1-492521921',
'1-492650641',
'1-492706231',
'1-492711691',
'1-492742791',
'1-492752721',
'1-492789631',
'1-492801611',
'1-492801871',
'1-492805483',
'1-492831601',
'1-492834411',
'1-492848691',
'1-492853671',
'1-492856391',
'1-492861561',
'1-492869131',
'1-492879031',
'1-492879771',
'1-492897551',
'1-492904741',
'1-492922931',
'1-492927751',
'1-492931501',
'1-492932031',
'1-492934291',
'1-492934391',
'1-492953871',
'1-492954991',
'1-492974821',
'1-493006031',
'1-493008751',
'1-493065351',
'1-493065731',
'1-493073991',
'1-493083881',
'1-493088031',
'1-493113241',
'1-493136293',
'1-493143771',
'1-493158351',
'1-493160741',
'1-493166031',
'1-493178931',
'1-493189491',
'1-493198401',
'1-493204651',
'1-493457241',
'1-493511761',
'1-493600953',
'1-493691643',
'1-493709963',
'1-493745675',
'1-493784071',
'1-493804671',
'1-493882871',
'1-493887551',
'1-493892501',
'1-493925061',
'1-493932241',
'1-493970971',
'1-494181731',
'1-494294081',
'1-494311941',
'1-494348551',
'1-494355911',
'1-494407861',
'1-494408131',
'1-494458211',
'1-494480521',
'1-494498071',
'1-494499738',
'1-494511941',
'1-494515831',
'1-494585761',
'1-494595791',
'1-494635571',
'1-494670781',
'1-494857171',
'1-495015761',
'1-495052571',
'1-495053021',
'1-495127641',
'1-495149841',
'1-495163101',
'1-495189751',
'1-495194001',
'1-495212541',
'1-495274881',
'1-495279501',
'1-495282161',
'1-495291521',
'1-495315041',
'1-495352521',
'1-495353761',
'1-495358941',
'1-495403331',
'1-495462611',
'1-495530741',
'1-495532861',
'1-495566375',
'1-495583181',
'1-495597721',
'1-495770371',
'1-495954021',
'1-495959991',
'1-495967961',
'1-496075191',
'1-496075421',
'1-496078411',
'1-496090011',
'1-496120431',
'1-496120531',
'1-496132791',
'1-4962358',
'1-496291671',
'1-496299171',
'1-496372761',
'1-496387901',
'1-496406701',
'1-496520901',
'1-496576373',
'1-496599595',
'1-4966091',
'1-496671981',
'1-496776521',
'1-496788751',
'1-4969921',
'1-497077711',
'1-497080871',
'1-497211951',
'1-497212971',
'1-497258551',
'1-497321981',
'1-497355503',
'1-497390421',
'1-497408461',
'1-497457901',
'1-497473291',
'1-4974801',
'1-497483751',
'1-497484481',
'1-497484511',
'1-497512909',
'1-497561871',
'1-4976011',
'1-497619091',
'1-497842991',
'1-497991461',
'1-498003581',
'1-498030456',
'1-498036141',
'1-498041272',
'1-498117111',
'1-498117821',
'1-498139141',
'1-498157721',
'1-498201591',
'1-498207103',
'1-4984471',
'1-498607293',
'1-4986111',
'1-498612847',
'1-498630241',
'1-4986546',
'1-498658531',
'1-498710071',
'1-498722191',
'1-498871051',
'1-499144373',
'1-499147891',
'1-499150121',
'1-499155241',
'1-499204827',
'1-499253171',
'1-4992573',
'1-4992711',
'1-4992722',
'1-499301243',
'1-499304164',
'1-499328471',
'1-499333761',
'1-499336211',
'1-499339191',
'1-499343091',
'1-499373221',
'1-499378841',
'1-499393291',
'1-499418051',
'1-499418321',
'1-499442131',
'1-499481061',
'1-499498571',
'1-4995001',
'1-499642371',
'1-499735681',
'1-499944794',
'1-499988491',
'1-499995971',
'1-500004921',
'1-500008781',
'1-500038921',
'1-500047301',
'1-500053181',
'1-500053382',
'1-500151591',
'1-500200521',
'1-500216061',
'1-500237231',
'1-500246291',
'1-500254461',
'1-500276221',
'1-500278151',
'1-500279071',
'1-500307591',
'1-500318721',
'1-500353381',
'1-500365881',
'1-500371091',
'1-500380598',
'1-500401101',
'1-500548281',
'1-500556191',
'1-500558333',
'1-500768191',
'1-500833931',
'1-500857221',
'1-500888221',
'1-500892721',
'1-500930171',
'1-500940531',
'1-5009511',
'1-5009813',
'1-500984231',
'1-501005211',
'1-501005591',
'1-501048591',
'1-501105191',
'1-501133691',
'1-501145301',
'1-501163661',
'1-5012101',
'1-501211281',
'1-5012373',
'1-501263641',
'1-5013792',
'1-501464161',
'1-501470081',
'1-5015921',
'1-501668061',
'1-501741201',
'1-501744371',
'1-501779781',
'1-501796031',
'1-501842331',
'1-501848271',
'1-5018541',
'1-501867751',
'1-5018761',
'1-501888881',
'1-501890611',
'1-501927801',
'1-501930861',
'1-501945791',
'1-5019688',
'1-5019701',
'1-5019839',
'1-5019991',
'1-502035121',
'1-502041321',
'1-502053141',
'1-502072833',
'1-5020796',
'1-502083741',
'1-5020881',
'1-502094501',
'1-5021765',
'1-502247021',
'1-5022601',
'1-502264951',
'1-502344331',
'1-502390221',
'1-502391041',
'1-5024521',
'1-5025246',
'1-5025721',
'1-5025816',
'1-502588491',
'1-5025906',
'1-502651481',
'1-502653541',
'1-5026891',
'1-502739463',
'1-502872221',
'1-5028851',
'1-502893511',
'1-5029173',
'1-5029511',
'1-5029546',
'1-503033891',
'1-503069261',
'1-503347763',
'1-503350661',
'1-503373111',
'1-503506511',
'1-503531621',
'1-503580441',
'1-503599301',
'1-5036551',
'1-5037261',
'1-503732761',
'1-503772371',
'1-5037801',
'1-5039493',
'1-5040371',
'1-504053691',
'1-504150511',
'1-5041803',
'1-5042133',
'1-5042458',
'1-504269371',
'1-504424911',
'1-504463093',
'1-504495251',
'1-5045171',
'1-5045181',
'1-504528583',
'1-5045576',
'1-504597251',
'1-5046106',
'1-504672733',
'1-504686351',
'1-5047081',
'1-504738301',
'1-504796451',
'1-504799671',
'1-504811141',
'1-504828821',
'1-504837541',
'1-504844461',
'1-504869141',
'1-504871021',
'1-504899711',
'1-504946321',
'1-504984543',
'1-505033593',
'1-505054421',
'1-505141471',
'1-505281231',
'1-505310841',
'1-505343821',
'1-505375991',
'1-505396871',
'1-505398161',
'1-505405631',
'1-505421321',
'1-505438771',
'1-505508451',
'1-505527671',
'1-505573851',
'1-505599131',
'1-505603571',
'1-505614231',
'1-505670061',
'1-505680711',
'1-505713481',
'1-505728861',
'1-505789101',
'1-505907631',
'1-505932461',
'1-5059511',
'1-505999181',
'1-506058351',
'1-506307781',
'1-506342471',
'1-506411851',
'1-506425183',
'1-506435031',
'1-506453681',
'1-506463161',
'1-506465731',
'1-506477541',
'1-506482491',
'1-506488121',
'1-506494903',
'1-506517641',
'1-506518011',
'1-506527441',
'1-506668731',
'1-506694781',
'1-506726551',
'1-506729231',
'1-506738931',
'1-506771961',
'1-506782631',
'1-5067851',
'1-506816551',
'1-506835291',
'1-506962621',
'1-506964341',
'1-507017443',
'1-507243361',
'1-507255993',
'1-507329985',
'1-507334521',
'1-507393521',
'1-507406261',
'1-507411621',
'1-507490551',
'1-507552477',
'1-507648541',
'1-507651181',
'1-507660261',
'1-507665791',
'1-507727571',
'1-507772031',
'1-507818601',
'1-507825591',
'1-507956111',
'1-508259583',
'1-508349109',
'1-5083966',
'1-508415751',
'1-508444131',
'1-508455283',
'1-508484995',
'1-508493831',
'1-5085481',
'1-508591641',
'1-508595621',
'1-508604031',
'1-508608181',
'1-508618511',
'1-508619531',
'1-508619601',
'1-508620721',
'1-508638391',
'1-508649771',
'1-508675161',
'1-508686121',
'1-508687111',
'1-508740041',
'1-508787873',
'1-508807461',
'1-508835181',
'1-508861131',
'1-5088856',
'1-5088891',
'1-508932221',
'1-508956191',
'1-5089727',
'1-5090043',
'1-509052633',
'1-509138261',
'1-509161281',
'1-509206951',
'1-509207631',
'1-509208791',
'1-509218491',
'1-509234121',
'1-5092646',
'1-5092683',
'1-5092741',
'1-509289541',
'1-5094741',
'1-509534691',
'1-5095624',
'1-509572531',
'1-509591241',
'1-509602311',
'1-509673301',
'1-509679253',
'1-509701431',
'1-509704291',
'1-509732261',
'1-509798751',
'1-509856271',
'1-5099131',
'1-5099471',
'1-5099544',
'1-509976141',
'1-509981471',
'1-510006321',
'1-510013331',
'1-510065211',
'1-510099441',
'1-510100011',
'1-510103631',
'1-510108341',
'1-510112701',
'1-510129781',
'1-510146471',
'1-5101644',
'1-5101681',
'1-510196521',
'1-510283111',
'1-510336271',
'1-510342091',
'1-510388701',
'1-5104051',
'1-510437731',
'1-510437831',
'1-510473731',
'1-510547301',
'1-5105511',
'1-5105683',
'1-510615501',
'1-510643281',
'1-510668711',
'1-510726391',
'1-510772911',
'1-510782393',
'1-5108463',
'1-510856141',
'1-5108633',
'1-5108651',
'1-510893201',
'1-510893321',
'1-5109151',
'1-510933341',
'1-510965701',
'1-510969201',
'1-510978191',
'1-5112281',
'1-511301151',
'1-511310971',
'1-511311581',
'1-511312441',
'1-511381701',
'1-511424471',
'1-511440821',
'1-511453611',
'1-511454251',
'1-511462171',
'1-511475601',
'1-511484751',
'1-511484801',
'1-511503091',
'1-5115146',
'1-511581341',
'1-511582183',
'1-511604771',
'1-511605991',
'1-511663091',
'1-511663341',
'1-5116811',
'1-511689081',
'1-511699541',
'1-511759291',
'1-511872301',
'1-511915001',
'1-5119231',
'1-511941231',
'1-511989461',
'1-512009781',
'1-512025611',
'1-512077921',
'1-512193791',
'1-512199401',
'1-5122161',
'1-512217183',
'1-5122316',
'1-5122665',
'1-512267571',
'1-512287611',
'1-5123173',
'1-5123711',
'1-512464961',
'1-512465051',
'1-512483011',
'1-512494351',
'1-5125301',
'1-5125491',
'1-512591661',
'1-512597581',
'1-5126091',
'1-512619431',
'1-512619981',
'1-5126364',
'1-512688231',
'1-512726941',
'1-5127303',
'1-5127424',
'1-512750241',
'1-512774071',
'1-5128007',
'1-512803681',
'1-512850081',
'1-512869913',
'1-512905521',
'1-512921241',
'1-5130501',
'1-513082061',
'1-513089491',
'1-513090141',
'1-513112193',
'1-513118781',
'1-513157241',
'1-513173701',
'1-5131841',
'1-513224101',
'1-513234641',
'1-513250301',
'1-513257381',
'1-513275341',
'1-513329321',
'1-513330401',
'1-513360501',
'1-513396441',
'1-513460971',
'1-513467611',
'1-513518311',
'1-513542071',
'1-513580301',
'1-513605971',
'1-513694591',
'1-513710511',
'1-5138551',
'1-513855641',
'1-513861321',
'1-513868571',
'1-5139051',
'1-513913311',
'1-513920761',
'1-513922261',
'1-513929261',
'1-513931101',
'1-513933981',
'1-513935931',
'1-513962641',
'1-513982421',
'1-513985981',
'1-513988191',
'1-513990011',
'1-513996281',
'1-514002281',
'1-514006201',
'1-514044051',
'1-514098605',
'1-514159911',
'1-514162291',
'1-514200661',
'1-514201194',
'1-514226023',
'1-5142601',
'1-514277361',
'1-5143223',
'1-514335343',
'1-5143736',
'1-514424411',
'1-514619561',
'1-5146256',
'1-5146491',
'1-5146681',
'1-514668511',
'1-514683761',
'1-5147475',
'1-5147831',
'1-514792211',
'1-5148246',
'1-5148253',
'1-514915151',
'1-514934923',
'1-5149491',
'1-5150099',
'1-515044431',
'1-5150569',
'1-515068561',
'1-515086231',
'1-5150926',
'1-515102021',
'1-515192161',
'1-515260181',
'1-5153633',
'1-5154583',
'1-515472551',
'1-5154731',
'1-5156851',
'1-5157064',
'1-5157181',
'1-5157651',
'1-515991181',
'1-515993691',
'1-516015561',
'1-5161683',
'1-516235421',
'1-5165001',
'1-5166151',
'1-5166917',
'1-5167031',
'1-5167081',
'1-516716421',
'1-516735331',
'1-5169471',
'1-5169861',
'1-5171073',
'1-5171127',
'1-5171171',
'1-517117261',
'1-5171601',
'1-517170861',
'1-517247631',
'1-517641581',
'1-5176651',
'1-5177079',
'1-5177771',
'1-5177941',
'1-517869531',
'1-517904441',
'1-5179827',
'1-5181141',
'1-518179761',
'1-5182261',
'1-518253041',
'1-518279641',
'1-518645961',
'1-518646593',
'1-5186471',
'1-518648463',
'1-518660891',
'1-518690991',
'1-5188481',
'1-518886741',
'1-518894391',
'1-518946111',
'1-5191241',
'1-519164011',
'1-519204561',
'1-519326961',
'1-5194211',
'1-519634701',
'1-5206141',
'1-5206275',
'1-520728611',
'1-5209661',
'1-521017041',
'1-521025701',
'1-5210591',
'1-5210731',
'1-5211676',
'1-5212041',
'1-521245043',
'1-521293631',
'1-521335291',
'1-5213396',
'1-5213608',
'1-5213714',
'1-5213961',
'1-5214121',
'1-521511711',
'1-5216166',
'1-5217011',
'1-5217111',
'1-5217916',
'1-5218833',
'1-5218873',
'1-5219551',
'1-5219860',
'1-5219901',
'1-5220016',
'1-5220438',
'1-522120191',
'1-522234101',
'1-522262181',
'1-522269491',
'1-5222901',
'1-5223331',
'1-5223351',
'1-5223471',
'1-5223571',
'1-522663081',
'1-522684051',
'1-522715191',
'1-522871121',
'1-522871631',
'1-522874141',
'1-522877031',
'1-522882021',
'1-522882493',
'1-522890691',
'1-522894761',
'1-522899491',
'1-523253203',
'1-523369471',
'1-523681721',
'1-523711011',
'1-524079751',
'1-524082511',
'1-524317447',
'1-524328261',
'1-524341001',
'1-524508581',
'1-524513341',
'1-524513921',
'1-524545071',
'1-524621661',
'1-524758461',
'1-524761751',
'1-524765351',
'1-524770821',
'1-524786081',
'1-524786611',
'1-524787191',
'1-525319411',
'1-525400571',
'1-525450081',
'1-525725721',
'1-526668681',
'1-527369871',
'1-5276325',
'1-5277031',
'1-5277521',
'1-5278418',
'1-5278441',
'1-5279541',
'1-5279601',
'1-5279648',
'1-5281981',
'1-5283611',
'1-5284031',
'1-5284561',
'1-5284685',
'1-5285551',
'1-5285631',
'1-5286661',
'1-5287211',
'1-5287366',
'1-5289481',
'1-5289751',
'1-5295261',
'1-5295661',
'1-5295891',
'1-5296001',
'1-5297311',
'1-529862811',
'1-5298871',
'1-5298941',
'1-5299413',
'1-5300011',
'1-5301801',
'1-5303206',
'1-5303346',
'1-5305130',
'1-5305236',
'1-530694751',
'1-5307303',
'1-530749861',
'1-5310093',
'1-5310118',
'1-5310383',
'1-5311834',
'1-5313073',
'1-5316519',
'1-5317789',
'1-5320346',
'1-5320383',
'1-5320601',
'1-5323603',
'1-5324901',
'1-5325021',
'1-5325066',
'1-5325231',
'1-5325531',
'1-5329571',
'1-5331141',
'1-5333621',
'1-5335283',
'1-5337541',
'1-5337631',
'1-5338244',
'1-5338481',
'1-5338791',
'1-5338951',
'1-5340141',
'1-5340771',
'1-5340783',
'1-5340985',
'1-5343001',
'1-5343036',
'1-5343571',
'1-5346531',
'1-5347931',
'1-5350211',
'1-5351055',
'1-5353321',
'1-5353491',
'1-5354121',
'1-5354501',
'1-5354601',
'1-5354821',
'1-5355081',
'1-5357526',
'1-5359141',
'1-5359211',
'1-5365136',
'1-5365483',
'1-5367771',
'1-5368091',
'1-5368841',
'1-536924901',
'1-5369287',
'1-536946181',
'1-5369913',
'1-5371281',
'1-5371663',
'1-5372125',
'1-5372991',
'1-5373023',
'1-5375226',
'1-5375991',
'1-5377191',
'1-5377821',
'1-5379021',
'1-5385273',
'1-5386171',
'1-5386664',
'1-5386841',
'1-5387201',
'1-538728541',
'1-5390251',
'1-5390541',
'1-539082885',
'1-5390911',
'1-5392591',
'1-5393161',
'1-5393731',
'1-5395971',
'1-5395981',
'1-5396281',
'1-5398301',
'1-5398497',
'1-5399421',
'1-5399791',
'1-5403541',
'1-5404081',
'1-5415751',
'1-5417391',
'1-5418431',
'1-5418481',
'1-5424141',
'1-5428401',
'1-5431161',
'1-5433431',
'1-5433687',
'1-5433851',
'1-5434371',
'1-5435425',
'1-5435581',
'1-5436091',
'1-5443411',
'1-5444576',
'1-5445871',
'1-5447386',
'1-5448829',
'1-5449452',
'1-5451438',
'1-5452869',
'1-5452991',
'1-5453871',
'1-5454311',
'1-5454733',
'1-5457321',
'1-5459701',
'1-5465006',
'1-5465151',
'1-5465881',
'1-5470601',
'1-5470901',
'1-5473501',
'1-5473611',
'1-5475881',
'1-5476191',
'1-5481255',
'1-5483831',
'1-5488781',
'1-5488881',
'1-5492400',
'1-5492406',
'1-5492471',
'1-5494186',
'1-5494536',
'1-5495146',
'1-5495323',
'1-5497121',
'1-5497151',
'1-5497656',
'1-5498501',
'1-5498631',
'1-5500661',
'1-5502776',
'1-5502878',
'1-5504011',
'1-5511241',
'1-5511961',
'1-5512441',
'1-5520871',
'1-5523281',
'1-5523291',
'1-5525241',
'1-5525976',
'1-5526772',
'1-5526861',
'1-5527081',
'1-5530321',
'1-5531051',
'1-5535384',
'1-5536381',
'1-5536831',
'1-5543171',
'1-5543607',
'1-5543891',
'1-5548901',
'1-5550561',
'1-5550741',
'1-5551151',
'1-5551791',
'1-5551864',
'1-5552294',
'1-5557656',
'1-5557711',
'1-5557823',
'1-5561835',
'1-5562941',
'1-5567336',
'1-5568101',
'1-5568181',
'1-5568611',
'1-5568726',
'1-5570271',
'1-5571961',
'1-5573141',
'1-5575241',
'1-5581558',
'1-5585441',
'1-558823201',
'1-5592509',
'1-5593191',
'1-5601571',
'1-5605309',
'1-5605772',
'1-5607686',
'1-5609893',
'1-5612456',
'1-5614801',
'1-5615403',
'1-561580431',
'1-5618571',
'1-5623211',
'1-5623431',
'1-5627221',
'1-5678405',
'1-5679511',
'1-5679579',
'1-5681261',
'1-5686541',
'1-5687186',
'1-5691521',
'1-5693791',
'1-5697366',
'1-5715647',
'1-5716001',
'1-5716171',
'1-5716861',
'1-5716916',
'1-5716940',
'1-5717021',
'1-5717519',
'1-5719293',
'1-5719813',
'1-5719951',
'1-5721041',
'1-5722221',
'1-5722606',
'1-5723141',
'1-5723161',
'1-5724641',
'1-5724931',
'1-5724943',
'1-5725821',
'1-5725961',
'1-5726191',
'1-5726301',
'1-5726851',
'1-5727759',
'1-5728076',
'1-5728161',
'1-5729181',
'1-5729671',
'1-5729824',
'1-5744326',
'1-5746611',
'1-5747283',
'1-5747631',
'1-5748201',
'1-5750031',
'1-5750084',
'1-5750211',
'1-5750691',
'1-5753860',
'1-5754558',
'1-5755071',
'1-5756261',
'1-5756646',
'1-5756861',
'1-5757271',
'1-5760068',
'1-5760171',
'1-5760474',
'1-5764481',
'1-5764511',
'1-5767341',
'1-5767351',
'1-5767361',
'1-5767611',
'1-5768853',
'1-5768921',
'1-5769621',
'1-5770711',
'1-5772171',
'1-5772271',
'1-5772986',
'1-5773001',
'1-5774831',
'1-5775241',
'1-5775453',
'1-5776303',
'1-5776943',
'1-5777341',
'1-5777491',
'1-5783126',
'1-5783134',
'1-5788131',
'1-5788733',
'1-5790641',
'1-5790681',
'1-5791301',
'1-5791846',
'1-5793836',
'1-5793941',
'1-5795381',
'1-5795571',
'1-5795818',
'1-5796311',
'1-5796654',
'1-5796751',
'1-5796891',
'1-5798929',
'1-5799221',
'1-5800621',
'1-5803481',
'1-5803523',
'1-5810911',
'1-5811791',
'1-5813921',
'1-5815121',
'1-5815501',
'1-5815974',
'1-581901631',
'1-5820043',
'1-5822911',
'1-5823051',
'1-5823276',
'1-5823533',
'1-5825411',
'1-5825801',
'1-5828281',
'1-5828391',
'1-5828514',
'1-5828930',
'1-5829693',
'1-5830171',
'1-5830191',
'1-5831296',
'1-5831671',
'1-5835121',
'1-5837292',
'1-5837461',
'1-5837611',
'1-5838003',
'1-5838769',
'1-5838786',
'1-5840581',
'1-5841586',
'1-5841791',
'1-5842011',
'1-5843561',
'1-5843591',
'1-5843821',
'1-5850086',
'1-5851521',
'1-5852691',
'1-5854166',
'1-5854201',
'1-5854481',
'1-5854561',
'1-5855674',
'1-5857311',
'1-5859091',
'1-5861771',
'1-5862011',
'1-5864731',
'1-5865043',
'1-5865411',
'1-5865421',
'1-5865768',
'1-5866037',
'1-5868171',
'1-5869441',
'1-5870961',
'1-5871331',
'1-5871501',
'1-5871703',
'1-5872421',
'1-5872951',
'1-5874241',
'1-5877111',
'1-5877131',
'1-5878161',
'1-5878261',
'1-5878861',
'1-5878961',
'1-5880891',
'1-5880923',
'1-5881081',
'1-5881274',
'1-5881510',
'1-5883726',
'1-5883793',
'1-5884273',
'1-5884509',
'1-5884543',
'1-5887353',
'1-5889751',
'1-5891216',
'1-5891471',
'1-5891675',
'1-5893611',
'1-5894701',
'1-5901008',
'1-5902261',
'1-5902521',
'1-5903678',
'1-5903911',
'1-5906481',
'1-5906491',
'1-5906541',
'1-5907771',
'1-5909156',
'1-5911301',
'1-5912076',
'1-5912561',
'1-5914631',
'1-5916676',
'1-5916691',
'1-5917364',
'1-5919432',
'1-5922537',
'1-5924171',
'1-5924315',
'1-5924881',
'1-5926046',
'1-5926100',
'1-5926311',
'1-5926911',
'1-5928231',
'1-5928501',
'1-5928695',
'1-5928831',
'1-5929321',
'1-5931131',
'1-5931381',
'1-5931511',
'1-5931531',
'1-5931571',
'1-5931783',
'1-5931951',
'1-5931971',
'1-5932353',
'1-5932421',
'1-5932831',
'1-5933071',
'1-5935951',
'1-5936076',
'1-5937291',
'1-5937581',
'1-5937743',
'1-5939831',
'1-5942025',
'1-5942801',
'1-5943068',
'1-5943171',
'1-5943351',
'1-5945861',
'1-5947321',
'1-5947441',
'1-5952471',
'1-5952491',
'1-5954416',
'1-5977441',
'1-5977491',
'1-5977963',
'1-5978291',
'1-5978601',
'1-5978774',
'1-5979231',
'1-5979304',
'1-5979501',
'1-5979543',
'1-5979691',
'1-5980181',
'1-5980241',
'1-5980361',
'1-5980601',
'1-5980831',
'1-5981391',
'1-5981451',
'1-5981816',
'1-598267561',
'1-5982875',
'1-5983471',
'1-5983743',
'1-5984130',
'1-5984516',
'1-5984601',
'1-5986051',
'1-5986711',
'1-5987871',
'1-5987991',
'1-5989171',
'1-5989201',
'1-5993199',
'1-6015551',
'1-6016011',
'1-6016693',
'1-6017201',
'1-6020193',
'1-6020371',
'1-6020421',
'1-6020731',
'1-6020781',
'1-6020851',
'1-6020926',
'1-6021351',
'1-6021856',
'1-6021971',
'1-6023211',
'1-6023791',
'1-6024001',
'1-6025791',
'1-6025841',
'1-6027111',
'1-6028161',
'1-6028469',
'1-6028541',
'1-6029336',
'1-6029701',
'1-6029771',
'1-6030019',
'1-6031331',
'1-6032221',
'1-6032491',
'1-6037381',
'1-6038211',
'1-6038961',
'1-6040521',
'1-6040783',
'1-6041831',
'1-6044471',
'1-6048271',
'1-6048681',
'1-6048723',
'1-6049211',
'1-6049371',
'1-6049461',
'1-6050376',
'1-6050421',
'1-6050501',
'1-6050863',
'1-6051340',
'1-6051826',
'1-6055691',
'1-6055761',
'1-6056701',
'1-6056851',
'1-6059776',
'1-6059891',
'1-6060126',
'1-6060311',
'1-6063286',
'1-6064091',
'1-6064861',
'1-6066341',
'1-6066612',
'1-6066726',
'1-6067221',
'1-6067694',
'1-6069421',
'1-6069901',
'1-6069941',
'1-6071721',
'1-6072006',
'1-6072921',
'1-6074153',
'1-6075311',
'1-6075381',
'1-6076981',
'1-6078286',
'1-6078971',
'1-6080441',
'1-6081478',
'1-6084002',
'1-6084041',
'1-6087121',
'1-6088380',
'1-6088401',
'1-6088619',
'1-6089375',
'1-6089771',
'1-6092011',
'1-6092176',
'1-6092911',
'1-6093391',
'1-6093421',
'1-6094871',
'1-6096431',
'1-6098191',
'1-6098386',
'1-6098731',
'1-6102166',
'1-6102931',
'1-6102961',
'1-6104121',
'1-6104161',
'1-6104394',
'1-6104871',
'1-6106153',
'1-6106621',
'1-6106961',
'1-6109446',
'1-6111471',
'1-6112171',
'1-6112721',
'1-6113531',
'1-6113691',
'1-6114086',
'1-6114441',
'1-6114996',
'1-6116177',
'1-6119516',
'1-6119531',
'1-6119771',
'1-6121771',
'1-6122011',
'1-6123221',
'1-6124036',
'1-6125401',
'1-6125851',
'1-6127201',
'1-6127661',
'1-612895941',
'1-6129521',
'1-6129861',
'1-6130631',
'1-6133641',
'1-6133981',
'1-6136821',
'1-6136831',
'1-6138791',
'1-6138871',
'1-6139181',
'1-6139301',
'1-6139491',
'1-6139811',
'1-6140036',
'1-6141046',
'1-6141821',
'1-6142201',
'1-6142911',
'1-6145231',
'1-6147581',
'1-6147591',
'1-6147734',
'1-6149613',
'1-6150061',
'1-6150161',
'1-6150741',
'1-6151161',
'1-6153016',
'1-6154233',
'1-6154331',
'1-6156121',
'1-6156361',
'1-6156963',
'1-6157111',
'1-6161361',
'1-6161461',
'1-6161693',
'1-6165951',
'1-6167316',
'1-6168226',
'1-6168231',
'1-6168461',
'1-6168914',
'1-6169101',
'1-6169361',
'1-6171671',
'1-6173151',
'1-6173441',
'1-6174053',
'1-6174801',
'1-6174891',
'1-6175071',
'1-6175741',
'1-6178206',
'1-6178831',
'1-6181978',
'1-6182209',
'1-6182378',
'1-6187519',
'1-6187991',
'1-6190191',
'1-6190781',
'1-6192217',
'1-6192316',
'1-6193504',
'1-6193901',
'1-6195066',
'1-6197406',
'1-6199786',
'1-6200381',
'1-6200491',
'1-6203331',
'1-6204071',
'1-6206571',
'1-6209186',
'1-6209801',
'1-6211781',
'1-6212413',
'1-6212691',
'1-6213193',
'1-6213621',
'1-6213839',
'1-6216391',
'1-6217333',
'1-6217615',
'1-6218791',
'1-6220111',
'1-6220393',
'1-6223901',
'1-6223991',
'1-6225301',
'1-6226746',
'1-6227191',
'1-6227501',
'1-6227996',
'1-6229334',
'1-623096411',
'1-6231206',
'1-6232061',
'1-6233042',
'1-6234091',
'1-6234736',
'1-6234761',
'1-6236493',
'1-6240341',
'1-6240581',
'1-6243731',
'1-6244931',
'1-6246531',
'1-6246711',
'1-6246981',
'1-6248771',
'1-6248896',
'1-6249341',
'1-6249736',
'1-6251466',
'1-6252241',
'1-6253181',
'1-6256425',
'1-6259831',
'1-6259971',
'1-6260203',
'1-6260931',
'1-6261411',
'1-6262181',
'1-6262713',
'1-6262776',
'1-6264231',
'1-6264633',
'1-6267841',
'1-6270536',
'1-6270815',
'1-6270973',
'1-6271369',
'1-6271581',
'1-6271657',
'1-6273620',
'1-6273803',
'1-6275131',
'1-6275241',
'1-6275721',
'1-6278271',
'1-6281131',
'1-6281266',
'1-6281741',
'1-6281771',
'1-628527921',
'1-6285771',
'1-6286037',
'1-6290995',
'1-6293241',
'1-6294210',
'1-6294581',
'1-6294717',
'1-6296166',
'1-6296754',
'1-6296993',
'1-6301601',
'1-6302767',
'1-6303540',
'1-6304281',
'1-6304628',
'1-6304921',
'1-6306667',
'1-6308351',
'1-6308916',
'1-6309051',
'1-6312054',
'1-6313851',
'1-6315191',
'1-6315961',
'1-6315986',
'1-6317875',
'1-6317941',
'1-6319331',
'1-6323463',
'1-6323851',
'1-6324311',
'1-6324431',
'1-6324891',
'1-6326571',
'1-6328381',
'1-6328951',
'1-6341911',
'1-6343361',
'1-6343661',
'1-6349161',
'1-6349431',
'1-6349626',
'1-6350061',
'1-6350609',
'1-6351267',
'1-6353175',
'1-6353931',
'1-6364391',
'1-6364411',
'1-6364918',
'1-6367471',
'1-6369181',
'1-6370726',
'1-6370901',
'1-6373301',
'1-6374003',
'1-6374075',
'1-6375432',
'1-6376872',
'1-6378041',
'1-6383362',
'1-6383651',
'1-6384145',
'1-6384651',
'1-6384946',
'1-6392801',
'1-6392831',
'1-6395131',
'1-6395381',
'1-6395631',
'1-6398703',
'1-6400741',
'1-6400991',
'1-6401561',
'1-6401721',
'1-6407676',
'1-6409161',
'1-6409261',
'1-6409323',
'1-6409691',
'1-6414321',
'1-6414801',
'1-6414891',
'1-6417203',
'1-6417606',
'1-6417641',
'1-6419651',
'1-6420061',
'1-6420081',
'1-6423721',
'1-6423781',
'1-6432161',
'1-6432691',
'1-6432851',
'1-6436511',
'1-6446231',
'1-6467161',
'1-6471241',
'1-648003051',
'1-6481181',
'1-6486163',
'1-6499401',
'1-6501238',
'1-6502331',
'1-6504386',
'1-6506121',
'1-6508273',
'1-6510031',
'1-6510076',
'1-6510779',
'1-6511341',
'1-6512852',
'1-6514963',
'1-6517471',
'1-6518111',
'1-6519175',
'1-6521571',
'1-6521751',
'1-6531631',
'1-6536096',
'1-6538045',
'1-6538611',
'1-6539141',
'1-6539764',
'1-6541777',
'1-6542011',
'1-6542111',
'1-6543583',
'1-6545116',
'1-6545176',
'1-6547301',
'1-6547531',
'1-6548771',
'1-6549861',
'1-6551241',
'1-6551711',
'1-6552301',
'1-6553931',
'1-6554821',
'1-6562361',
'1-6562663',
'1-6564101',
'1-6566681',
'1-6567348',
'1-6567564',
'1-6567641',
'1-6568171',
'1-6568251',
'1-6568776',
'1-6569021',
'1-6571001',
'1-6571396',
'1-6571441',
'1-6571501',
'1-6572141',
'1-6574391',
'1-6574531',
'1-6574966',
'1-6576371',
'1-6576661',
'1-6577131',
'1-6577885',
'1-6578261',
'1-6580491',
'1-6582071',
'1-6584821',
'1-6584941',
'1-6585621',
'1-6588351',
'1-6588841',
'1-6590696',
'1-6590991',
'1-6592231',
'1-6594636',
'1-6595181',
'1-6595591',
'1-6596191',
'1-6596801',
'1-6598721',
'1-6599101',
'1-6601471',
'1-6602056',
'1-6602191',
'1-6603261',
'1-6603931',
'1-6607571',
'1-6608069',
'1-6609101',
'1-6609371',
'1-6609971',
'1-6610161',
'1-6610171',
'1-6612945',
'1-6614146',
'1-6614521',
'1-6614651',
'1-6615441',
'1-6618301',
'1-6618491',
'1-6618871',
'1-6620311',
'1-6621371',
'1-6621766',
'1-6622841',
'1-6625711',
'1-6629801',
'1-6632298',
'1-6632691',
'1-6634646',
'1-6635391',
'1-6635691',
'1-6637819',
'1-6639671',
'1-6641291',
'1-6647171',
'1-6648161',
'1-6648336',
'1-6648541',
'1-6651676',
'1-6656101',
'1-6658581',
'1-6662873',
'1-6666186',
'1-6666611',
'1-6667271',
'1-6667321',
'1-6670251',
'1-6670991',
'1-6672856',
'1-6675541',
'1-6676151',
'1-6676614',
'1-6676621',
'1-6680321',
'1-6680349',
'1-6680611',
'1-6680731',
'1-6684315',
'1-6690913',
'1-669228311',
'1-6693031',
'1-6695771',
'1-6696263',
'1-6697511',
'1-6697953',
'1-6700391',
'1-6700436',
'1-6700643',
'1-6700831',
'1-6705431',
'1-6705566',
'1-6705621',
'1-6706611',
'1-6706904',
'1-6708331',
'1-6710791',
'1-6711745',
'1-6715081',
'1-6718691',
'1-6719022',
'1-6726501',
'1-6731253',
'1-6735801',
'1-6739959',
'1-6743781',
'1-6746221',
'1-6746931',
'1-6749149',
'1-6749453',
'1-6750361',
'1-6753251',
'1-6754053',
'1-6754801',
'1-6754941',
'1-6755881',
'1-6756021',
'1-6758201',
'1-6758589',
'1-6759901',
'1-6761423',
'1-6761494',
'1-6762341',
'1-6762411',
'1-6764161',
'1-6764371',
'1-6777301',
'1-6778601',
'1-6780783',
'1-6780826',
'1-6780865',
'1-6782231',
'1-6782526',
'1-6782811',
'1-6783501',
'1-6785781',
'1-6791586',
'1-6806714',
'1-6806761',
'1-6810331',
'1-6810351',
'1-6810456',
'1-6810591',
'1-6812066',
'1-6813291',
'1-6813381',
'1-6813406',
'1-6813821',
'1-6816581',
'1-6816681',
'1-6838931',
'1-6840181',
'1-6840831',
'1-6842066',
'1-6842441',
'1-6844921',
'1-6845583',
'1-6848216',
'1-6848501',
'1-6848541',
'1-6850391',
'1-6855414',
'1-6856057',
'1-685705071',
'1-6857053',
'1-6858637',
'1-6859031',
'1-6859521',
'1-6860571',
'1-6865131',
'1-6865271',
'1-6865563',
'1-6865901',
'1-6866051',
'1-6866661',
'1-6866821',
'1-6869802',
'1-6872191',
'1-6872884',
'1-6873236',
'1-6874071',
'1-6875541',
'1-6876496',
'1-6880861',
'1-6883891',
'1-6884317',
'1-6892549',
'1-6893691',
'1-6893721',
'1-6894121',
'1-6894281',
'1-6894511',
'1-6898451',
'1-6898813',
'1-6899059',
'1-6899081',
'1-6899131',
'1-6899661',
'1-6900041',
'1-6902041',
'1-6905081',
'1-6906301',
'1-6906323',
'1-6906351',
'1-6908013',
'1-6909001',
'1-6909156',
'1-6909701',
'1-6914231',
'1-6922731',
'1-6923342',
'1-6923391',
'1-6923941',
'1-692714701',
'1-6927381',
'1-6933761',
'1-6934391',
'1-6938071',
'1-6940306',
'1-6941351',
'1-6943529',
'1-6944656',
'1-6944964',
'1-6946521',
'1-6948153',
'1-6948333',
'1-6948556',
'1-6951116',
'1-6951246',
'1-6952050',
'1-6955435',
'1-6956081',
'1-6960824',
'1-696121727',
'1-6968411',
'1-6969521',
'1-6969851',
'1-6972361',
'1-6975531',
'1-6976671',
'1-6983761',
'1-698924111',
'1-6992891',
'1-6993410',
'1-699990243',
'1-7004331',
'1-7008336',
'1-7008441',
'1-7008681',
'1-7010767',
'1-7013641',
'1-7016606',
'1-7020471',
'1-7020848',
'1-7020905',
'1-7021304',
'1-7024851',
'1-7026151',
'1-7027041',
'1-702730101',
'1-7029481',
'1-7029521',
'1-7030093',
'1-7030265',
'1-7030281',
'1-7032356',
'1-7033311',
'1-7039191',
'1-7039411',
'1-7040081',
'1-7042551',
'1-7048771',
'1-7049806',
'1-705015511',
'1-7055411',
'1-7058815',
'1-7060681',
'1-706111901',
'1-7064655',
'1-7066901',
'1-7067101',
'1-706724951',
'1-7067588',
'1-706793821',
'1-706874981',
'1-7073511',
'1-7073831',
'1-7073904',
'1-7073935',
'1-7074014',
'1-7074128',
'1-7074331',
'1-7079744',
'1-7081408',
'1-708606061',
'1-7092659',
'1-7092961',
'1-7095411',
'1-7095791',
'1-709582941',
'1-7099091',
'1-7099231',
'1-7101321',
'1-7101687',
'1-7105471',
'1-7105991',
'1-710825071',
'1-7112201',
'1-7112551',
'1-7112741',
'1-7114966',
'1-7118101',
'1-711815081',
'1-711818921',
'1-7118671',
'1-7119716',
'1-7120156',
'1-7121751',
'1-7123965',
'1-7125781',
'1-7126517',
'1-7126701',
'1-7126777',
'1-7127091',
'1-7130781',
'1-7130971',
'1-7135225',
'1-7135571',
'1-7135671',
'1-7136301',
'1-7136731',
'1-7141211',
'1-7141623',
'1-714167571',
'1-7143028',
'1-7143401',
'1-7143411',
'1-7145111',
'1-7145711',
'1-7146261',
'1-715036277',
'1-7151925',
'1-7152031',
'1-7152601',
'1-7152971',
'1-715329491',
'1-7158603',
'1-7158893',
'1-7160831',
'1-7162801',
'1-7162981',
'1-7163671',
'1-7168226',
'1-7169286',
'1-7169671',
'1-717056491',
'1-7174661',
'1-7174854',
'1-7174971',
'1-7176281',
'1-7176521',
'1-7177811',
'1-7178941',
'1-7181941',
'1-7182681',
'1-7183342',
'1-7183661',
'1-718745651',
'1-7188451',
'1-7189633',
'1-7190111',
'1-7196721',
'1-7196843',
'1-7197448',
'1-7201793',
'1-7203021',
'1-7204651',
'1-7205151',
'1-720615521',
'1-720645801',
'1-7207540',
'1-7207856',
'1-7212911',
'1-7213341',
'1-7216281',
'1-721886391',
'1-7220761',
'1-7221073',
'1-7225791',
'1-722616521',
'1-722650141',
'1-7235276',
'1-7235463',
'1-7236451',
'1-723703171',
'1-723727861',
'1-723979581',
'1-7249111',
'1-7269511',
'1-7269941',
'1-7270423',
'1-7271426',
'1-7272143',
'1-7272311',
'1-7272341',
'1-7272891',
'1-7273243',
'1-7277487',
'1-7277651',
'1-7278641',
'1-7279151',
'1-727961251',
'1-728004151',
'1-7280069',
'1-728030324',
'1-7281021',
'1-728166611',
'1-7282291',
'1-7284376',
'1-728926571',
'1-728998271',
'1-729015861',
'1-729945741',
'1-7299801',
'1-7300201',
'1-730259821',
'1-730273011',
'1-7304809',
'1-7305321',
'1-7305829',
'1-7309818',
'1-7310636',
'1-7312731',
'1-7314021',
'1-731472021',
'1-731607931',
'1-7316171',
'1-7317231',
'1-7318876',
'1-7321561',
'1-7321741',
'1-7329303',
'1-7330181',
'1-7330301',
'1-7331151',
'1-7333686',
'1-7334211',
'1-7334481',
'1-7334961',
'1-7335953',
'1-7337111',
'1-733875641',
'1-734002761',
'1-7341145',
'1-7341265',
'1-7341791',
'1-7342871',
'1-734505621',
'1-7345501',
'1-7346941',
'1-7348591',
'1-7349863',
'1-7351531',
'1-7351948',
'1-7351981',
'1-735366791',
'1-7356231',
'1-7356291',
'1-7361306',
'1-7361831',
'1-7361851',
'1-7366266',
'1-736892491',
'1-7371126',
'1-7372161',
'1-7372541',
'1-737388281',
'1-7374515',
'1-7375321',
'1-7376611',
'1-7377251',
'1-7377901',
'1-738157451',
'1-7385460',
'1-7386063',
'1-7387191',
'1-738756751',
'1-7388461',
'1-7392431',
'1-739347891',
'1-7397595',
'1-7398831',
'1-7399581',
'1-7401711',
'1-7403991',
'1-7406516',
'1-7408501',
'1-740986281',
'1-7410231',
'1-7412362',
'1-7412871',
'1-7414141',
'1-7414498',
'1-741455941',
'1-7414931',
'1-7416116',
'1-7427161',
'1-7427271',
'1-7431041',
'1-7431721',
'1-743178481',
'1-7432071',
'1-743359941',
'1-7434398',
'1-7434645',
'1-7435011',
'1-743613981',
'1-7442051',
'1-7442371',
'1-7442826',
'1-7443046',
'1-744338841',
'1-744480121',
'1-7448591',
'1-744895411',
'1-7449581',
'1-745374491',
'1-7455037',
'1-7458026',
'1-745879211',
'1-7459631',
'1-746040221',
'1-7465033',
'1-7465441',
'1-7466761',
'1-7468271',
'1-7468481',
'1-7471601',
'1-7471826',
'1-7474950',
'1-7475971',
'1-7476032',
'1-747612601',
'1-7476286',
'1-7478471',
'1-7479321',
'1-747960624',
'1-748008761',
'1-748017861',
'1-748062551',
'1-748068151',
'1-748077511',
'1-748085771',
'1-7482741',
'1-7486461',
'1-7488345',
'1-748992371',
'1-7491093',
'1-7491716',
'1-749295341',
'1-7494271',
'1-7494841',
'1-7498801',
'1-749983901',
'1-750184671',
'1-750694384',
'1-750781611',
'1-750841201',
'1-7509401',
'1-750954671',
'1-7509991',
'1-751012551',
'1-751030791',
'1-751036241',
'1-751157391',
'1-7511871',
'1-7515521',
'1-7516031',
'1-752005981',
'1-7521941',
'1-7523506',
'1-7524321',
'1-7525401',
'1-7529531',
'1-7532291',
'1-7535941',
'1-753703681',
'1-753723611',
'1-7537381',
'1-7541361',
'1-754526009',
'1-754664881',
'1-7549465',
'1-7549771',
'1-7555099',
'1-7559153',
'1-756813531',
'1-756920924',
'1-757065121',
'1-7575618',
'1-7576231',
'1-7576531',
'1-757676991',
'1-757755871',
'1-757772991',
'1-757792951',
'1-757826371',
'1-7578753',
'1-7578891',
'1-757981154',
'1-7583431',
'1-758379701',
'1-758497831',
'1-7585801',
'1-7588616',
'1-7590971',
'1-759235811',
'1-759245681',
'1-759283101',
'1-7595011',
'1-759651851',
'1-759724751',
'1-7597681',
'1-7599781',
'1-760017261',
'1-7601261',
'1-7601361',
'1-7602401',
'1-7603141',
'1-7603741',
'1-7604096',
'1-760947961',
'1-7612608',
'1-7612991',
'1-7616699',
'1-761888251',
'1-7621581',
'1-7625071',
'1-763222791',
'1-763225831',
'1-7637861',
'1-763797961',
'1-7638031',
'1-7640561',
'1-7640651',
'1-7644701',
'1-7645211',
'1-764550321',
'1-7646071',
'1-7646641',
'1-764916831',
'1-7650521',
'1-765361541',
'1-7662741',
'1-7676341',
'1-7680551',
'1-7687391',
'1-7689101',
'1-7689391',
'1-769059621',
'1-7691511',
'1-769344861',
'1-769447851',
'1-7695191',
'1-769597771',
'1-769736991',
'1-770234221',
'1-7703211',
'1-770364011',
'1-7703667',
'1-770375921',
'1-7703971',
'1-770413661',
'1-770432344',
'1-7708841',
'1-7711233',
'1-7717771',
'1-7718254',
'1-7718584',
'1-7718681',
'1-771928081',
'1-771966441',
'1-772170991',
'1-772173001',
'1-772251391',
'1-7723031',
'1-772318091',
'1-772364381',
'1-7725831',
'1-7727121',
'1-7727349',
'1-772777131',
'1-772888231',
'1-773063121',
'1-773103991',
'1-7731231',
'1-7731386',
'1-773259041',
'1-773306871',
'1-773397351',
'1-773451931',
'1-773483001',
'1-773520091',
'1-773561721',
'1-773602371',
'1-773986211',
'1-774130911',
'1-774226501',
'1-774444761',
'1-775008921',
'1-7750107',
'1-775019991',
'1-775104551',
'1-775270911',
'1-775301441',
'1-775330441',
'1-775476011',
'1-775501071',
'1-775533841',
'1-775540461',
'1-776026831',
'1-776363164',
'1-776709841',
'1-776749511',
'1-776839441',
'1-7771083',
'1-777456101',
'1-7774661',
'1-777525641',
'1-7775415',
'1-7780701',
'1-7780916',
'1-7782051',
'1-7782181',
'1-778250551',
'1-7783571',
'1-7786147',
'1-7786644',
'1-778749174',
'1-7787601',
'1-779046081',
'1-779050261',
'1-779129551',
'1-779188651',
'1-7808301',
'1-7808421',
'1-780961391',
'1-7809651',
'1-7810573',
'1-7810581',
'1-7811511',
'1-7811791',
'1-781193011',
'1-7813641',
'1-781370051',
'1-781430011',
'1-781576811',
'1-781732581',
'1-7818863',
'1-781908421',
'1-7820661',
'1-7821771',
'1-7822305',
'1-7822601',
'1-7823606',
'1-7823641',
'1-7824526',
'1-7826157',
'1-7826356',
'1-7826511',
'1-782665331',
'1-782795311',
'1-782811331',
'1-7829021',
'1-782960221',
'1-7830096',
'1-7830251',
'1-783046151',
'1-783273961',
'1-783401161',
'1-7838001',
'1-784106261',
'1-7841385',
'1-7841463',
'1-7841521',
'1-7842176',
'1-7844961',
'1-7845476',
'1-784771241',
'1-784811821',
'1-7848431',
'1-7849341',
'1-7851008',
'1-7852236',
'1-7853426',
'1-7853771',
'1-7854956',
'1-785587541',
'1-7855979',
'1-7856143',
'1-7856393',
'1-7856637',
'1-785757044',
'1-785972071',
'1-7859771',
'1-786007711',
'1-786130741',
'1-786232601',
'1-786271971',
'1-786387751',
'1-786487441',
'1-786605261',
'1-7866169',
'1-7866621',
'1-7873343',
'1-7873991',
'1-787467971',
'1-7876191',
'1-7878501',
'1-788052211',
'1-788173141',
'1-7883217',
'1-788393901',
'1-7884691',
'1-7884761',
'1-788675091',
'1-789295801',
'1-7897131',
'1-789816101',
'1-7902011',
'1-7902992',
'1-7908946',
'1-7909571',
'1-7911251',
'1-791148811',
'1-7916986',
'1-7925911',
'1-792836711',
'1-792887491',
'1-7930703',
'1-7931436',
'1-7935026',
'1-7935081',
'1-7936901',
'1-7937511',
'1-793906591',
'1-7943091',
'1-7944883',
'1-794496894',
'1-7944996',
'1-7946861',
'1-794688951',
'1-7948351',
'1-7950126',
'1-795926001',
'1-7959282',
'1-7960121',
'1-7961001',
'1-796115801',
'1-796189501',
'1-7963031',
'1-7963511',
'1-7966151',
'1-7967291',
'1-7969303',
'1-7969525',
'1-797037901',
'1-797101161',
'1-7971423',
'1-7972146',
'1-7973013',
'1-7973851',
'1-7976363',
'1-798094521',
'1-7982651',
'1-798486521',
'1-7987181',
'1-798852341',
'1-798862511',
'1-7990024',
'1-7990651',
'1-7993083',
'1-799349581',
'1-7995104',
'1-7995581',
'1-7999221',
'1-8000411',
'1-8002681',
'1-800355284',
'1-8003811',
'1-8003891',
'1-8003948',
'1-800482551',
'1-800502274',
'1-8005616',
'1-800693881',
'1-800798731',
'1-800891771',
'1-801015091',
'1-801051431',
'1-8011436',
'1-8012851',
'1-8014851',
'1-8015176',
'1-801525501',
'1-8019071',
'1-8019451',
'1-8019991',
'1-8021301',
'1-8022246',
'1-8022253',
'1-802455021',
'1-802485841',
'1-8025581',
'1-8027433',
'1-802843961',
'1-8029311',
'1-8029983',
'1-803000081',
'1-8033533',
'1-803364411',
'1-8033647',
'1-8033791',
'1-8033931',
'1-8036091',
'1-803649271',
'1-8037351',
'1-8039336',
'1-8039591',
'1-8040846',
'1-8044051',
'1-8044251',
'1-804439741',
'1-804497011',
'1-805199031',
'1-805954011',
'1-806010621',
'1-806650341',
'1-806676854',
'1-8067451',
'1-806797101',
'1-8068015',
'1-8069196',
'1-8069621',
'1-8069644',
'1-806968231',
'1-807370181',
'1-807394691',
'1-8077171',
'1-8077204',
'1-8078541',
'1-8078801',
'1-8082201',
'1-808250151',
'1-8083401',
'1-808346981',
'1-808357074',
'1-8083811',
'1-808690791',
'1-8088311',
'1-8088571',
'1-8089121',
'1-809075111',
'1-8091921',
'1-809266041',
'1-8093711',
'1-8096533',
'1-8097021',
'1-8098211',
'1-8098563',
'1-8101953',
'1-8102131',
'1-8102521',
'1-810325221',
'1-8109501',
'1-8110711',
'1-811903371',
'1-811944711',
'1-8119871',
'1-8120736',
'1-812129264',
'1-812225461',
'1-812243731',
'1-812320421',
'1-8131421',
'1-8135311',
'1-8141341',
'1-8141561',
'1-814552571',
'1-814665831',
'1-814725631',
'1-814729991',
'1-8147561',
'1-8153121',
'1-815329621',
'1-815441194',
'1-8155938',
'1-815687181',
'1-8162241',
'1-816340371',
'1-8166056',
'1-8170961',
'1-8172099',
'1-817913391',
'1-8182841',
'1-8184211',
'1-818873271',
'1-8192881',
'1-8194771',
'1-819643631',
'1-819657251',
'1-8198061',
'1-8199673',
'1-820057954',
'1-820176031',
'1-8203021',
'1-820395951',
'1-8204790',
'1-8208411',
'1-8209311',
'1-8209546',
'1-820961291',
'1-8209791',
'1-8210006',
'1-8212922',
'1-8213321',
'1-8213393',
'1-8213921',
'1-8215871',
'1-8217461',
'1-8223121',
'1-8223731',
'1-822637731',
'1-8227801',
'1-8228763',
'1-8228831',
'1-8229341',
'1-8233943',
'1-8236266',
'1-8240121',
'1-8240621',
'1-8242293',
'1-8242721',
'1-824447841',
'1-8247181',
'1-8247401',
'1-8249463',
'1-8249626',
'1-8252381',
'1-825368541',
'1-8254391',
'1-8256481',
'1-8259251',
'1-8262311',
'1-8263941',
'1-8264661',
'1-8266435',
'1-8268641',
'1-8270621',
'1-8270741',
'1-827190151',
'1-827280391',
'1-827313171',
'1-827603701',
'1-8277341',
'1-827825441',
'1-8280790',
'1-8284991',
'1-8286121',
'1-828858381',
'1-8290661',
'1-829123311',
'1-8292806',
'1-829978581',
'1-8300461',
'1-830478897',
'1-8305183',
'1-830555401',
'1-8305746',
'1-8305761',
'1-8307021',
'1-8307616',
'1-8307885',
'1-8311101',
'1-8313203',
'1-8313441',
'1-831518141',
'1-831614121',
'1-8319261',
'1-8319401',
'1-8319751',
'1-8319871',
'1-8323181',
'1-8323471',
'1-832469401',
'1-8328101',
'1-832887941',
'1-8329501',
'1-833085941',
'1-8331469',
'1-8335331',
'1-8336019',
'1-8336081',
'1-833629111',
'1-833641561',
'1-8337487',
'1-833811462',
'1-8340341',
'1-8344254',
'1-8346971',
'1-834915561',
'1-834921361',
'1-8349791',
'1-835070791',
'1-835210071',
'1-8353711',
'1-8354691',
'1-8356313',
'1-8363021',
'1-8370541',
'1-837103261',
'1-8371913',
'1-837271951',
'1-8375251',
'1-8375615',
'1-8376041',
'1-8379251',
'1-8379380',
'1-8380341',
'1-8380521',
'1-8380605',
'1-8381459',
'1-8381763',
'1-8386221',
'1-8386601',
'1-8393741',
'1-8395312',
'1-8398021',
'1-839862281',
'1-8399441',
'1-8401971',
'1-8408029',
'1-8408209',
'1-8410741',
'1-8416571',
'1-8421826',
'1-8424504',
'1-8424969',
'1-8426391',
'1-8430846',
'1-8431271',
'1-8431686',
'1-8432201',
'1-8432431',
'1-8435341',
'1-8436501',
'1-8436911',
'1-8446051',
'1-8448956',
'1-8455463',
'1-8458558',
'1-8460521',
'1-8461364',
'1-8463248',
'1-8464021',
'1-8468269',
'1-8469061',
'1-847024631',
'1-8471796',
'1-8472709',
'1-847659861',
'1-8481761',
'1-8485451',
'1-8486881',
'1-848846411',
'1-849055451',
'1-849235741',
'1-851152151',
'1-851545034',
'1-8517201',
'1-8518149',
'1-853008531',
'1-853566191',
'1-853917901',
'1-854082611',
'1-8546471',
'1-8547466',
'1-8547648',
'1-8548903',
'1-8548971',
'1-8549271',
'1-8549371',
'1-8554901',
'1-8557671',
'1-8558991',
'1-8559191',
'1-8559385',
'1-8559729',
'1-8560201',
'1-857114671',
'1-8578781',
'1-8582444',
'1-8585383',
'1-8585471',
'1-8588881',
'1-8591623',
'1-8593121',
'1-8593851',
'1-8595181',
'1-8596101',
'1-8603266',
'1-8603771',
'1-8603971',
'1-8609801',
'1-8609891',
'1-8612046',
'1-8614633',
'1-8615681',
'1-8617021',
'1-8618657',
'1-8618981',
'1-8619361',
'1-8620461',
'1-8622121',
'1-8623201',
'1-8623695',
'1-8627091',
'1-8628371',
'1-8631696',
'1-8632071',
'1-8635241',
'1-8635271',
'1-8637024',
'1-8638646',
'1-8641511',
'1-8644106',
'1-8654201',
'1-8654601',
'1-8656531',
'1-8656721',
'1-8661111',
'1-8664581',
'1-8665521',
'1-8665621',
'1-8667860',
'1-8668238',
'1-8673763',
'1-8674451',
'1-8677681',
'1-8679761',
'1-8683301',
'1-8683328',
'1-8687183',
'1-8687576',
'1-8691231',
'1-8693693',
'1-8695406',
'1-8697261',
'1-8698761',
'1-8704601',
'1-8706161',
'1-8708051',
'1-8711201',
'1-8716254',
'1-8718336',
'1-8718443',
'1-8719631',
'1-8723211',
'1-8725091',
'1-8726441',
'1-8726961',
'1-8729307',
'1-8729791',
'1-8757014',
'1-8764429',
'1-8770941',
'1-8773881',
'1-8777591',
'1-8777711',
'1-8795141',
'1-8806181',
'1-8806621',
'1-8807851',
'1-8809371',
'1-8811131',
'1-8811246',
'1-8811696',
'1-8816211',
'1-8816651',
'1-8819121',
'1-8820101',
'1-8821121',
'1-8823343',
'1-8823573',
'1-8824101',
'1-8825041',
'1-8833781',
'1-8833916',
'1-8834414',
'1-8834571',
'1-8834719',
'1-8837461',
'1-8839031',
'1-8839841',
'1-8840571',
'1-8841171',
'1-8841661',
'1-8842201',
'1-8843583',
'1-8844031',
'1-8845941',
'1-8852191',
'1-8852854',
'1-8853391',
'1-8855436',
'1-8860461',
'1-8869281',
'1-8869884',
'1-8889121',
'1-8893009',
'1-8897103',
'1-8898721',
'1-8898831',
'1-8902191',
'1-8903591',
'1-8909931',
'1-8915681',
'1-8926061',
'1-8932081',
'1-8935501',
'1-8935701',
'1-8943251',
'1-8947251',
'1-8947741',
'1-8947866',
'1-8948771',
'1-8955201',
'1-8955671',
'1-8969151',
'1-8976101',
'1-8998658',
'1-8998977',
'1-9004017',
'1-9004851',
'1-9006541',
'1-9006601',
'1-9007611',
'1-9008081',
'1-9009026',
'1-9009071',
'1-9015139',
'1-9015181',
'1-9016151',
'1-9017377',
'1-9019611',
'1-9034164',
'1-9038683',
'1-9039911',
'1-9046111',
'1-9046801',
'1-9053231',
'1-9085241',
'1-9085821',
'1-9086181',
'1-9089221',
'1-9090311',
'1-9093771',
'1-9094371',
'1-910005991',
'1-9102121',
'1-9103125',
'1-9103761',
'1-9126551',
'1-9131301',
'1-9137776',
'1-9141921',
'1-9142231',
'1-9144791',
'1-9157111',
'1-9218101',
'1-9275063',
'1-9275577',
'1-9276495',
'1-9278111',
'1-9291501',
'1-9291946',
'1-9292656',
'1-9292671',
'1-9293531',
'1-9305653',
'1-9309231',
'1-9310541',
'1-9314151',
'1-935761941',
'1-9362581',
'1-9363131',
'1-9363159',
'1-9383545',
'1-9395634',
'1-9396921',
'1-9397684',
'1-9406071',
'1-9406211',
'1-9406551',
'1-9408471',
'1-940901',
'1-9430701',
'1-9437076',
'1-9445501',
'1-9453413',
'1-9458741',
'1-9458825',
'1-9460541',
'1-9513591',
'1-9522465',
'1-9552144',
'1-9554293',
'1-9554891',
'1-9559201',
'1-9561191',
'1-9565565',
'1-9565781',
'1-9568933',
'1-9569051',
'1-9589391',
'1-9589451',
'1-9589834',
'1-9598767',
'1-9600671',
'1-9600884',
'1-9605311',
'1-9605749',
'1-9607491',
'1-9620101',
'1-9627871',
'1-9629541',
'1-9639011',
'1-9647544',
'1-9656461',
'1-9661494',
'1-9663711',
'1-9667291',
'1-9669141',
'1-9669321',
'1-9674811',
'1-9706141',
'1-9707111',
'1-9711631',
'1-9713541',
'1-9713621',
'1-9713911',
'1-9716101',
'1-9717591',
'1-9721979',
'1-9722913',
'1-9724511',
'1-9728941',
'1-9742141',
'1-9742451',
'1-9742601',
'1-9743714',
'1-9745861',
'1-9748533',
'1-9749331',
'1-9751201',
'1-9751251',
'1-9752331',
'1-9753233',
'1-9754810',
'1-9756351',
'1-9757731',
'1-9760743',
'1-9762911',
'1-9763251',
'1-9766101',
'1-9775911',
'1-9777366',
'1-9777553',
'1-9784761',
'1-9784936',
'1-9785275',
'1-9785611',
'1-9786545',
'1-9790301',
'1-9790901',
'1-9791844',
'1-9804281',
'1-9809955',
'1-9823433',
'1-9830477',
'1-9844570',
'1-9847593',
'1-9849991',
'1-9850784',
'1-9851031',
'1-9851811',
'1-9855475',
'1-9856556',
'1-9856701',
'1-9858001',
'1-9862061',
'1-9870303',
'1-9870715',
'1-9870741',
'1-9875623',
'1-9877061',
'1-9879281',
'1-9881661',
'1-9882271',
'1-9882363',
'1-9890951',
'1-9895651',
'1-9904061',
'1-9904271',
'1-9907754',
'1-9908131',
'1-9909984',
'1-9910811',
'1-9915321',
'1-9932280',
'1-9993283',
'1-9994480',
'1-9994524',
'1-9995654',
'1-9996551',
'1-9998453',
'1-9999203',

                ];
                collegeIds = collegeIds.slice($scope.skip, $scope.limit + $scope.skip);
                //console.info(collegeIds.length);
                var collegesInfo = {
                    collegeIds: collegeIds,
                    page: 'Faculty'
                };
                
                MasterService.knowyourcollege(collegesInfo).success(function (data, status, headers) {
                    console.log(data);
                    $scope.skip = parseInt($scope.skip) + parseInt($scope.limit);
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            };
            $scope.extractEmailsfromId = function(){
                var collegeId = '1-493160741';
                collegeService.getEmails(collegeId).success(function (data, status, headers) {
                    console.log(data);
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            };
            $scope.extractAllEmails = function(){
                
                collegeService.getAllEmails().success(function (data, status, headers) {
                    console.log(data);
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            };
    }]); 
    
    exambazaar.controller("allblogtagsController", 
        [ '$scope', '$http', '$rootScope','blogTagService','allblogtags', 'blogTagsSummary', '$state', '$mdDialog', '$cookies', 'Notification', function($scope, $http, $rootScope, blogTagService, allblogtags, blogTagsSummary, $state, $mdDialog, $cookies, Notification){
            $scope.allblogtags = allblogtags.data;
            $scope.blogTagsSummary = blogTagsSummary.data;
            var blogTagIds = $scope.blogTagsSummary.map(function(a) {return a._id;});
            var thisTagId = null;
            var tagIndex = null;
            
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
            }else{
                $scope.user = null;
            }
            
            var reloadBlog = function(){
                blogTagService.getblogTags().success(function (data, status, headers) {
                     $scope.allblogtags = data;
                     blogTagService.blogTagsSummary().success(function (btdata, status, headers) {
                         $scope.blogTagsSummary = btdata;
                         setCounts();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            $scope.sortTags = function(property, ascending){
                if(ascending){
                    $scope.allblogtags.sort(function(a,b) {return (a[property] > b[property]) ? 1 : ((b[property] > a[property]) ? -1 : 0);});
                }else{
                    $scope.allblogtags.sort(function(a,b) {return (b[property] > a[property]) ? 1 : ((a[property] > b[property]) ? -1 : 0);});
                }  
            };
            var setCounts = function(){
                $scope.allblogtags.forEach(function(thisTag, tindex){
                    thisTagId = thisTag._id.toString();
                    tagIndex = blogTagIds.indexOf(thisTagId);
                    if(tagIndex != -1){
                        $scope.allblogtags[tindex].count = $scope.blogTagsSummary[tagIndex].count;
                    }else{
                        $scope.allblogtags[tindex].count = 0;
                    }
                });
                $scope.sortTags('count', false);
            };
            setCounts();
            
            
            
            $scope.editBlogTag = function(blogtag){
                var blogTagForm = {
                    _id: blogtag._id, 
                    user: $scope.user._id,
                    tag: blogtag.tag,
                };
                 blogTagService.saveblogTag(blogTagForm).success(function (data, status, headers) {
                     Notification.success("Your blog tag has been saved!");
                     reloadBlog();
                     
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            
            $scope.removeBlogTag = function(blogtag){
                var blogTagId = blogtag._id;
                
                 blogTagService.removeblogTag(blogTagId).success(function (data, status, headers) {
                     Notification.primary("Your blog tag has been removed!");
                     reloadBlog();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            
            $scope.usedinBlogs = function(blogtag){
                var blogTagId = blogtag._id;
                
                 blogTagService.usedinBlogs(blogTagId).success(function (data, status, headers) {
                     blogtag.blogs = data;
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            $rootScope.pageTitle = 'All Blog Tags';
            
           
            
    }]); 
    
     exambazaar.controller("testAssessmentResultController", 
        [ '$scope', '$http', '$rootScope','UserService','assessments','$state', '$mdDialog', 'assessmentService', function($scope, $http, $rootScope, UserService, assessments, $state, $mdDialog, assessmentService){
            $scope.assessments = assessments.data;
            var allAssessments = [];
            var assessmentTestIds = [];
             $scope.assessments.forEach(function(thisAssessment, aindex){
                if(thisAssessment.evaluation && thisAssessment.evaluation.score){
                    thisAssessment.evaluation.score = Number(thisAssessment.evaluation.score);
                }
                if(aindex == $scope.assessments.length - 1){
                    allAssessments = $scope.assessments;
                    assessmentTestIds = $scope.assessments.map(function(a) {return a.test.toString();});
                }
            });
            
            
            $scope.userevaluate = function(thisAssessment){
                
                var assessmentForm = {
                    user: thisAssessment.user,
                    test: thisAssessment.test,
                };
                assessmentService.userevaluate(assessmentForm).success(function (edata, status, headers) {
                    console.log(edata);
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 1000});
                    console.log('Error ' + data + ' ' + status);
                });
            };
            
            $scope.filterByTest = function(testId){
                var testAssessments = [];
                assessmentTestIds.forEach(function(thisAssessment, aindex){
                    if(thisAssessment == testId){
                        testAssessments.push(allAssessments[aindex]);
                    }
                });
                
                $scope.assessments = testAssessments;
                
            };
            
            $rootScope.pageTitle = 'All Assessments';
            
            $scope.sortByScore = function(){
                $scope.assessments.sort(function(a,b) {return (a.evaluation.score > b.evaluation.score) ? -1 : ((b.evaluation.score > a.evaluation.score) ? 1 : 0);} );  
                allAssessments = $scope.assessments;
                assessmentTestIds = $scope.assessments.map(function(a) {return a.test.toString();});
            };
            $scope.sortByDate = function(){
                $scope.assessments.sort(function(a,b) {return (a._start > b._start) ? -1 : ((b._start > a._start) ? 1 : 0);} );  
                allAssessments = $scope.assessments;
                assessmentTestIds = $scope.assessments.map(function(a) {return a.test.toString();});
            };
            $scope.sortByDate();
    }]); 
    exambazaar.controller("allreviewsController", 
        [ '$scope', '$http', '$rootScope','reviewService','allReviews', 'targetStudyProviderService','$state', '$mdDialog', function($scope, $http, $rootScope, reviewService, allReviews, targetStudyProviderService, $state, $mdDialog){
            $scope.allReviews = allReviews.data;
            
            $rootScope.pageTitle = 'All Reviews';
            
            $scope.openReview = function(review){
                var cityCoachingForm = {
                    city: review.institute.city,
                    coachingName: review.institute.name,
                };
                targetStudyProviderService.showGroupHelper(cityCoachingForm).success(function (data, status, headers) {
                    var examStream = data;
                    console.log(examStream);
                    
                    var url = $state.href('showGroup', {categoryName: examStream.stream, subCategoryName: examStream.exam, cityName: review.institute.city, groupName: review.institute.name,'#': 'Reviews'});
                    window.open(url,'_blank');
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });    
            };
            
            $scope.disablereview = function(review){
                
                var confirm = $mdDialog.confirm()
                .title('Would you like to disabled review of ' + review.institute.name + ' by ' + review.user.basic.name + '?')
                .textContent('You can enable it later!')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    reviewService.disablereview(review._id).success(function (data, status, headers) {
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                    
                }, function() {
                  //nothing
                }); 
            };
            
            $scope.enablereview = function(review){
                
                var confirm = $mdDialog.confirm()
                .title('Would you like to enable review of ' + review.institute.name + ' by ' + review.user.basic.name + '?')
                .textContent('You can enable it later!')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    reviewService.enablereview(review._id).success(function (data, status, headers) {
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                    
                }, function() {
                  //nothing
                }); 
            };
            
    }]); 
    
    exambazaar.controller("allOffersController", 
        [ '$scope', '$http', '$state', '$rootScope','offerService','allOffers', 'targetStudyProviderService', function($scope, $http, $state, $rootScope, offerService, allOffers, targetStudyProviderService){
            $scope.allOffers = allOffers.data;
            
            $rootScope.pageTitle = 'All Offers';
            
            $scope.activateOffer = function(offer){
                 offerService.activate(offer._id).success(function (data, status, headers) {
                    alert('Done');
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
                
            };
            $scope.deactivateOffer = function(offer){
                 offerService.deactivate(offer._id).success(function (data, status, headers) {
                    alert('Done');
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
                
            };
            
    }]);     
        
    exambazaar.controller("rankerswallController", 
        [ '$scope', '$http','$state', '$stateParams','$rootScope','targetStudyProviderService','allResults', 'thisExam','$location', 'Socialshare','$cookies', 'viewService', function($scope, $http, $state, $stateParams, $rootScope, targetStudyProviderService, allResults, thisExam,$location, Socialshare, $cookies, viewService){
            
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
            }else{
                
            }
            
            if(!$scope.user || !$scope.user.userId){
                $scope.showLoginForm();
            }
            
            $scope.currURL = $location.absUrl();
            
            $scope.allResults = allResults.data;
            $scope.exam = thisExam.data;
            var examStream = {
                exam: $scope.exam.name,
                stream: $scope.exam.stream.name,
            };
            $scope.year = $stateParams.year;
            //console.log($scope.exam);
            $scope.yearResults = [];
            $scope.coachingMode = false;
            $scope.flipAll = function(){
                $scope.coachingMode = !$scope.coachingMode;
            };
            $scope.flipRank = function(resultPair){
                resultPair.coachingMode = !resultPair.coachingMode;
            };
            
            $scope.shareFacebook = function(){
                Socialshare.share({
                  'provider': 'facebook',
                  'attrs': {
                    'socialshareType': 'send',
                    'socialshareUrl': $scope.currURL,
                    'socialshareVia':"1236747093103286",  'socialshareRedirectUri': 'https://www.exambazaar.com',
                  }
                });
            };
            
            $scope.logMouseEvent = function(resultPair) {
                switch (event.type) {
                  case "mouseenter":
                        
                        //console.log("Hey Mouse Entered");
                        break;
                  case "mouseover":{
                        //$scope.flipRank(resultPair);
                        resultPair.coachingMode = true;
                        //console.log("Hey Mouse Over");
                        break;
                  }
                  case "mouseout":{
                        resultPair.coachingMode = false;
                        //console.log("Hey Mouse Out");
                        break;
                  }

                  case "mouseleave":
                    //console.log("Mouse Gone");
                    break;

                  default:
                    //console.log(event.type);
                    break;
                };
            };
            
            for (var i=1;i<=100;i++) {
                $scope.yearResults.push({});
            };
            
            $scope.goToCoaching = function(resultPair){
                
                var url = $state.href('showGroup', {categoryName: examStream.stream, subCategoryName: examStream.exam, cityName: resultPair.coaching.city, groupName: resultPair.coaching.name});
                window.open(url,'_blank');
                
            };
            $scope.allResults.forEach(function(thisResultPair, rindex){
                thisResultPair.result.rank = parseInt(thisResultPair.result.rank);
                var thisRank = thisResultPair.result.rank -1;
                thisResultPair.coachingMode = false;
                
                if(thisResultPair.result.year == $scope.year && thisRank<100){
                    
                    $scope.yearResults[thisRank] = thisResultPair;
                   
                }
                
            });
            
            var viewForm = {
                state: $state.current.name,
                claim: false
            };
            if($scope.user && $scope.user.userId){
                viewForm.user = $scope.user.userId
            }
            //console.log(JSON.stringify(viewForm));
            if($cookies.getObject('ip')){
                var ip = $cookies.getObject('ip');
                viewForm.ip = ip;
            }
            viewService.saveview(viewForm).success(function (data, status, headers) {
                //console.log('View Marked');
            })
            .error(function (data, status, header, config) {
                console.log();
            });
            
            
            $scope.shareText = "Hey! This list of Top 100 AIRs (" + $scope.exam.displayname + " " + $scope.year + ") on Exambazaar is sensational. Do check it out! ";
            $scope.shareText2 = "Check out the inspirational list of Top 100 (" + $scope.exam.displayname + " " + $scope.year + ")! ";
            $scope.hashtags = "exambazaar, " + $scope.exam.displayname;
            $rootScope.pageTitle =$scope.exam.displayname + " " + $scope.year + ' Rankers Wall';
            
            
    }]); 
        
    exambazaar.controller("searchController", 
        [ '$scope', '$http','$state','$rootScope','NgMap','targetStudyProviderService','targetStudyProvidersList', '$facebook', '$location', function($scope, $http, $state, $rootScope,NgMap, targetStudyProviderService, targetStudyProvidersList, $facebook, $location){
            
            
            $rootScope.pageTitle ='Search & Review Coaching Classes';
            
            
    }]); 
    
function getLatLng(thisData) {
    //console.log(thisData);
    GMaps.geocode({
        address: thisData.address,
        callback: function(results, status) {
            if (status == 'OK') {
                console.log(results[0].geometry.location.lat());
                thisData.lat = results[0].geometry.location.lat();
                thisData.lng = results[0].geometry.location.lng();
            }else{
                console.log(thisData + ' ' + status);
                thisData.na = true;
            }
        }
    });
};
        
        
        
     exambazaar.controller("assignedToAddContactInfoController", 
        [ '$scope', 'thisuser' , 'thisuserAssignedToAddContactInfo',  '$http','$state','$rootScope', function($scope, thisuser, thisuserAssignedToAddContactInfo, $http, $state, $rootScope){
        $scope.user = thisuser.data;
        $scope.assigned = thisuserAssignedToAddContactInfo.data;
        $scope.assignedCount = 0;
        if($scope.user.userType =='Master' || $scope.user.userType =='Intern - Business Development'){
            $scope.authorized = true;
        }
        $scope.assigned.forEach(function(thisAssigned, index){
            
            if(thisAssigned.active){
                $scope.assignedCount += 1;
            }
        });
        //console.log($scope.assignedCount);
        $rootScope.pageTitle =$scope.user.basic.name;
    }]);    
        
    exambazaar.controller("assignedToVerifyController", 
        [ '$scope', 'thisuser' , 'thisuserAssignedToVerify',  '$http','$state','$rootScope', function($scope, thisuser, thisuserAssignedToVerify, $http, $state, $rootScope){
        $scope.user = thisuser.data;
        $scope.assigned = thisuserAssignedToVerify.data;
        console.log($scope.assigned);
        $scope.assignedCount = 0;
        if($scope.user.userType =='Master' || $scope.user.userType =='Intern - Business Development'){
            $scope.authorized = true;
        }
        $scope.assigned.forEach(function(thisAssigned, index){
            
            if(thisAssigned.active){
                $scope.assignedCount += 1;
            }
        });
        //console.log($scope.assignedCount);
        $rootScope.pageTitle =$scope.user.basic.name;
    }]);  
      
    exambazaar.controller("assignedToRateController", 
        [ '$scope', 'thisuser' , 'thisuserAssignedToRate',  '$http','$state','$rootScope', function($scope, thisuser, thisuserAssignedToRate, $http, $state, $rootScope){
        $scope.user = thisuser.data;
        $scope.assigned = thisuserAssignedToRate.data;
        console.log($scope.assigned);
        $scope.assignedCount = 0;
        if($scope.user.userType =='Master' || $scope.user.userType =='Intern - Business Development'){
            $scope.authorized = true;
        }
        $scope.assigned.forEach(function(thisAssigned, index){
            
            if(thisAssigned.active){
                $scope.assignedCount += 1;
            }
        });
        //console.log($scope.assignedCount);
        $rootScope.pageTitle =$scope.user.basic.name;
    }]);    
        
        
        
    exambazaar.controller("fciController", 
        [ '$scope' ,  '$http','$state','$rootScope', '$cookies', 'UserService', 'tofillciService', 'targetStudyProviderService', 'Notification', 'ebteam', 'tofillciList', function($scope, $http, $state, $rootScope, $cookies, UserService, tofillciService, targetStudyProviderService, Notification, ebteam, tofillciList){
            $scope.ebteam = ebteam.data;
            $scope.fullScope = false;
            var fullScopeUsers = ["5a1831f0bd2adb260055e352"];
        
        if($cookies.getObject('sessionuser')){
            var sessionuser = $cookies.getObject( 'sessionuser');
            if(sessionuser && sessionuser._id){
                UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                    $scope.user = data;
                    $scope.authorized = true;
                    $rootScope.pageTitle ="FCI Report for " + $scope.user.basic.name;
                    
                    tofillciService.getusertofillcis($scope.user._id).success(function (adata, status, headers) {
                        $scope.assigned = adata;
                        $scope.assignedCount = 0;
                        $scope.dueDeadlineCount = 0;
                        Notification.primary({message: "Welcome " + $scope.user.basic.name + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                        $scope.assigned.forEach(function(thisAssigned, index){

                            $scope.assignedCount += 1;
                           
                            if(thisAssigned.active && moment(thisAssigned._deadline).diff(moment()) < 0){
                                $scope.dueDeadlineCount += 1;
                            }
                            
                            if(fullScopeUsers.indexOf($scope.user._id) != -1 || $scope.user.userType == "Master"){
                                $scope.fullScope =  true;
                            }
                        });
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                $cookies.remove("sessionuser");
                $rootScope.$emit("CallBlogLogin", {});
            }
            
        }else{
            $cookies.remove("sessionuser");
        }
            
        $scope.tofillciList = tofillciList.data;
        $scope.newAssign = {
            coachingId: '',
            intern: null,
            deadline: moment(),
            
        };
            
        var tofillGroupNames = $scope.tofillciList.map(function(a) {return a.institute.groupName;});
        
        $scope.assignToFill = function(){
            var assignable = true;
            if(!$scope.newAssign.coachingId || $scope.newAssign.coachingId == '' || $scope.newAssign.coachingId.length < 15){
                assignable = false;
            }
            if(!$scope.newAssign.deadline){
                assignable = false;
            }
            if(!$scope.newAssign.intern || $scope.newAssign.intern == ''){
                assignable = false;
            }
            if($scope.newAssign.deadline){
                $scope.newAssign.deadline = moment($scope.newAssign.deadline);
                $scope.newAssign.deadline = $scope.newAssign.deadline.endOf('day')
               
            }
            if($scope.newAssign.coachingId){
                var newValueArr = $scope.newAssign.coachingId.split("/");
                $scope.newAssign.coachingId = newValueArr[newValueArr.length-1];
            }
            
            
            if(assignable){
                var tofillciForm = {
                    institute: $scope.newAssign.coachingId,
                    user: $scope.newAssign.intern,
                    _deadline: $scope.newAssign.deadline,
                };
                console.log(JSON.stringify(tofillciForm));
                tofillciService.savetofillci(tofillciForm).success(function (data, status, headers) {
                    Notification.primary({message: "Ok cool, assigned!",  positionY: 'top', positionX: 'right', delay: 1000});
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log(status + " " + data);
                });
            }else{
                Notification.warning({message: "Please fill all details correctly!",  positionY: 'top', positionX: 'right', delay: 1000});
            }
        };
            
        $scope.assignCIFill = function(){
            var intern = $scope.ciIntern;
            var coaching = $scope.instituteInput;
            var ciDeadline = $scope.ciDeadline;
            ciDeadline.setHours(23,59,59);
            var res = coaching.split("/");
            var coaching = res[res.length-1];
            if(coaching.length < 15 || !ciDeadline){
                alert('Check Coaching Id or URL and deadline date');
            }else{

                var tofillciForm = {
                    institute: coaching,
                    user: intern,
                    _deadline: ciDeadline,
                };
                console.log(JSON.stringify(tofillciForm));
                tofillciService.savetofillci(tofillciForm).success(function (data, status, headers) {
                    $scope.showSavedDialog();
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log(status + " " + data);
                });
            }
        };    
            
        $scope.$watch('newAssign.coachingId', function (newValue, oldValue, scope){
            if(newValue != null && newValue != ''){
                
                var newValueArr = newValue.split("/");
                newValue = newValueArr[newValueArr.length-1];
                
                if(newValue.length > 5){
                    
                    $scope.fetching = true;
                    $scope.assignError = false;
                    
                    targetStudyProviderService.getGroupName(newValue).success(function (data, status, headers) {
                        
                        if(data){
                            $scope.assignGroup = data;
                            if(tofillGroupNames.indexOf(data) == -1){
                                $scope.prevFilledLength = 0;
                            }else{
                                $scope.prevFilledLength = 1;
                            }
                        }else{
                            $scope.assignError = true;
                        }
                        
                        $scope.fetching = false;
                    }).error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    
                    //tofillGroupNames 
                    /*tofillciService.prevFilled(newValue).success(function (prevfilleddata, status, headers) {
                        $scope.prevFilledLength = prevfilleddata;
                        
                        $scope.fetching = false;
                    })
                    .error(function (data, status, header, config) {
                        console.log(status + " " + data);
                    });*/
                    
                    
                    
                    
                }

            }

            }, true);
        
        
        //console.log($scope.assignedCount);
        
    }]);  
    
    exambazaar.controller("filledCIController", 
        [ '$scope', 'thisuser' , 'thisuserFilled',  '$http','$state','$rootScope', function($scope, thisuser, thisuserFilled, $http, $state, $rootScope){
        $scope.user = thisuser.data;
        $scope.authorized = true;
        if($state.current.name == 'filledAll' ){
            if($scope.user.userType !='Master'){
                $scope.authorized = false;
                if($scope.user._id){
                    $state.go('filled', {userId: $scope.user._id});
                }
            }
        }
            
        $scope.filterText = '';
        $scope.setUser = function(name){
            $scope.filterText = name;
        };
        $scope.clear = function(){
            $scope.filterText = '';
        };
        $scope.filled = thisuserFilled.data;
        $scope.uniqueUsers = [];
        $scope.uniqueInstitutes = [];
        $scope.filled.forEach(function(thisFill, index){
            if($scope.uniqueUsers.indexOf(thisFill.userName) == -1){
                $scope.uniqueUsers.push(thisFill.userName);
            }
        });
        $rootScope.pageTitle =$scope.user.basic.name;
    }]);    
    exambazaar.controller("shortlistedController", 
        [ '$scope', 'thisuser' , 'thisuserShortlisted',  '$http','$state','$rootScope', function($scope, thisuser, thisuserShortlisted, $http, $state, $rootScope){
        $scope.user = thisuser.data;
        $scope.shortlisted = thisuserShortlisted.data;
        
        $rootScope.pageTitle =$scope.user.basic.name;
    }]);    
    exambazaar.controller("viewedController", 
        [ '$scope', 'thisuser' , 'thisuserViewed',  '$http','$state','$rootScope', function($scope, thisuser, thisuserViewed, $http, $state, $rootScope){
        $scope.user = thisuser.data;
        $scope.viewed = thisuserViewed.data;
        console.log($scope.viewed);    
            
        $rootScope.pageTitle =$scope.user.basic.name;
    }]);     
        
    exambazaar.controller("checkLogoController", 
        [ '$scope', 'thisuser','logoList' , '$http','$state', '$rootScope', '$cookies', 'UserService', 'targetStudyProviderService', function($scope, thisuser, logoList, $http,$state,$rootScope, $cookies, UserService, targetStudyProviderService){
        $scope.user = thisuser.data;
        $scope.logoList = logoList.data;
        if($scope.user.userType =='Master'){
            $scope.showLevel = 10;
        }
        $scope.logoList.forEach(function(thisLogo, index){
            //if(index >= 24)
            thisLogo.mark = true;
        });
        $scope.markChecked = function(){
            var ids = [];
            $scope.logoList.forEach(function(thisLogo, index){
                if(thisLogo.mark){
                    ids.push(thisLogo._id);
                }
            });
            var checkLogoForm = {
                ids: ids    
            };
            targetStudyProviderService.bulkCheckLogos(checkLogoForm).success(function (data, status, headers) {
               
                alert('Marked');
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
            
        if($scope.user.basic)
            $rootScope.pageTitle =$scope.user.basic.name;
    }]); 
    
    exambazaar.controller("academicsController", 
        [ '$scope', '$http','$state', '$rootScope', '$cookies', 'UserService', '$mdDialog', '$timeout', 'Notification', function($scope,$http,$state,$rootScope, $cookies, UserService, $mdDialog, $timeout, Notification){
        $scope.col1Width = 40;
        $scope.col1WidthAcademic = 20;
        var setPage = function(pageName){
            $scope.components.forEach(function(thisCategory, index){
                if(thisCategory.name == pageName){
                    thisCategory.active = true;
                    $scope.activeCategory = thisCategory;
                    $scope.currentSubcategories = thisCategory.subcategories;
                }
            });
        };
        $scope.components = [
            {
                name: 'Profile',
                active: false,
                state: 'profile',
                subcategories: [
                    {
                        name: 'Personal',
                    },
                    {
                        name: 'Social',
                    },
                    {
                        name: 'Blogging',
                    },
                    {
                        name: 'Contact',
                    },
                    /*{
                        name: 'Preferences',
                    },*/

                ],
            },
            {
                name: 'Academic Details',
                active: false,
                state: 'academics',
                subcategories: [
                    {
                        name: 'Education Level',
                    },
                    {
                        name: 'School Class XII',
                    },
                    {
                        name: 'Undergraduate',
                    },
                    {
                        name: 'Postgraduate',
                    },
                ],
            },
            {
                name: 'Your Reviews',
                active: false,
                state: 'reviewed',
                subcategories: [
                    {
                        name: 'Coaching Reviews',
                    },
                ],
            },
            {
                name: 'Your Coachings',
                active: false,
                state: 'userInstitutes',
                subcategories: [
                    {
                        name: 'Coachings Viewed',
                    },
                    {
                        name: 'Coachings Shortlisted',
                    },
                ],
            },
        ];
        setPage('Academic Details');
        
            
        $scope.educationLevels = [
            {
                level: 0,
                name: "I-X"
            },
            {
                level: 2,
                name: "XI / XII / After XII"
            },
            /*{
                level: 2,
                name: "After XII (Drop Year)"
            },*/
            {
                level: 3,
                name: "In UG or equivalent"
            },
            {
                level: 4,
                name: "During or After Final Year of UG"
            },
            {
                level: 5,
                name: "During or After Final Year of PG"
            },
        ];
        $scope.class12Subjects = [
            {
                name: "english",
                displayname: "English"
            },
            {
                name: "physics",
                displayname: "Physics"
            },
            {
                name: "chemistry",
                displayname: "Chemistry"
            },
            {
                name: "mathematics",
                displayname: "Mathematics"
            },
            {
                name: "biology",
                displayname: "Biology"
            },
            {
                name: "biotechnology",
                displayname: "Biotechnology"
            },
            {
                name: "others",
                displayname: "Others"
            },
        ];
        $scope.undergradMajors = [
            {
                name: "btech",
                displayname: "B.Tech.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "be",
                displayname: "B.E.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "mbbs",
                displayname: "M.B.B.S.",
                stream:{
                    name: "medical",
                    displayname: "Medical",
                },
            },
            {
                name: "bds",
                displayname: "B.D.S.",
                stream:{
                    name: "medical",
                    displayname: "Medical",
                },
            },
            {
                name: "bsc",
                displayname: "B.Sc.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "ba",
                displayname: "B.A.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "bftech",
                displayname: "NIFT B.F.Tech.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "bcom",
                displayname: "B.Com.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },	
            {
                name: "barch",
                displayname: "B. Arch.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "llb",
                displayname: "LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "others",
                displayname: "Others"
            },
            {
                name: "fiveyearballb",
                displayname: "Five Year B.A. LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "fiveyearintegratedllb",
                displayname: "Five Year Integrated LL.B. (Hons.)",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            
            {
                name: "lawdegreeequivalenttollb",
                displayname: "Law Degree equivalent to LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "professionalcourseequivalenttobtech",
                displayname: "Professional Courses equivalent to B.E. / B.Tech.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },

        ];
        $scope.postgradMajors = [
            {
                name: "mba",
                displayname: "M.B.A."
            },
            {
                name: "ms",
                displayname: "M.S."
            },
            {
                name: "mtech",
                displayname: "M.Tech."
            },
            {
                name: "mcom",
                displayname: "M.Com."
            },
            {
                name: "msc",
                displayname: "M.Sc."
            },
            {
                name: "ma",
                displayname: "M.A."
            },
            {
                name: "mca",
                displayname: "M.C.A."
            },
            {
                name: "llm",
                displayname: "LL.M."
            },
            {
                name: "others",
                displayname: "Others"
            },

        ];
        $scope.sanitizeEligibility = function(){
            if($scope.user.eligibility){
                if($scope.user.eligibility.age){
                    $scope.user.eligibility.age = Number($scope.user.eligibility.age);
                }
                if($scope.user.eligibility.class12Percentage){
                    $scope.user.eligibility.class12Percentage = Number($scope.user.eligibility.class12Percentage);
                }
                if($scope.user.eligibility.undergradPercentage){
                    $scope.user.eligibility.undergradPercentage = Number($scope.user.eligibility.undergradPercentage);
                }
                if($scope.user.eligibility.postgradPercentage){
                    $scope.user.eligibility.postgradPercentage = Number($scope.user.eligibility.postgradPercentage);
                }
            }
        };    
        if($cookies.getObject('sessionuser')){
            var sessionuser = $cookies.getObject( 'sessionuser');
            if(sessionuser && sessionuser._id){
                UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                    $scope.user = data;
                    $scope.sanitizeEligibility();
                    Notification.primary({message: "Welcome " + $scope.user.basic.name + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                    if($scope.user.basic)
                        $rootScope.pageTitle =$scope.user.basic.name;
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                $cookies.remove("sessionuser");
                $rootScope.$emit("CallBlogLogin", {});
            }
            
        }else{
            $cookies.remove("sessionuser");
        }
        
        
        
        $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
        
        $scope.setActiveSubcategory = function(subcategoryName){
            $scope.activeCategory.subcategories.forEach(function(thisSubcategory, index){
                if(thisSubcategory.name == subcategoryName){
                    $scope.activeSubcategory = thisSubcategory;
                }
            });
        };
        
        $scope.setNextActiveSubcategory = function(){
            var thisIndex = null;
            var nSubcategories = $scope.activeCategory.subcategories.length;
            $scope.activeCategory.subcategories.forEach(function(thisSubcategory, index){
                if(thisSubcategory.name == $scope.activeSubcategory.name){
                    thisIndex = index;
                }
            });
            if(thisIndex != null){
                if(thisIndex == nSubcategories - 1){
                    console.log('Do nothing');
                }else{

                    $scope.activeSubcategory = $scope.activeCategory.subcategories[thisIndex + 1];
                }
            }
        };
            
        $scope.elgInput = {
            category: {
                general: true,
                sc: false,
                st: false,
                obc: false,
                pwd: false,
            },
            age: null,
            educationLevel:{
                level: null,
                name: null
            },
            class12Subjects:{
                biology: false,
                chemistry: false,
                biotechnology: false,
                physics: false,
                mathematics: false,
                english: false,
                others: false
            },
            class12Percentage: null,
            undergradMajor:{
                mbbs: false,
                bds: false,
                bsc: false,
                bftech: false,
                be: false,
                btech: false,
                bcom: false,
                ba: false,
                barch: false,
                llb: false,
                fiveyearintegratedllb: false,
                fiveyearballb: false,
                lawdegreeequivalenttollb: false,
                others: false,
            },
            undergradPercentage: null,
            postgradMajor:{
                mcom: false,
                msc: false,
                ma: false,
                mca: false,
                mtech: false,
                mba: false,
                ms: false,
                llm: false,
                others: false,
            },
            postgradPercentage: null,
            
        };    
        $scope.userVariables ={
            genders: [
                "Male",
                "Female",
            ],
            categories:[
                'GENERAL',    
                'OBC-NCL',    
                'SC',
                'ST',
            ],
        };
        $scope.setGender = function(gender){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            $scope.user.basic.gender = gender;
        };
        $scope.setCategory = function(caste){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            $scope.user.basic.category = caste;
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.category){
                $scope.user.eligibility.category = {};
            }
            if(caste == 'GENERAL'){
                $scope.user.eligibility.category.general = true;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = false;
            }
            if(caste == 'OBC-NCL'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = true;
            }
            if(caste == 'SC'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = true;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = false;
            }
            if(caste == 'ST'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = true;
                $scope.user.eligibility.category.obc = false;
            }
        };    
        $scope.setPwD = function(PwD){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.category){
                $scope.user.eligibility.category = {};
            }
            $scope.user.basic.PwD = PwD;
            $scope.user.eligibility.category.pwd = PwD;
        };
        
        $scope.setAge = function(){
            if($scope.user.basic && $scope.user.basic.dob){
                var dob = moment($scope.user.basic.dob);
                var age = moment().diff(dob, 'years');
                if(!$scope.user.eligibility){
                    $scope.user.eligibility = {};
                }
                $scope.user.eligibility.age = age;
            }
        };
        
        $scope.setEducationLevel = function(educationLevel){
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.educationLevel){
                $scope.user.eligibility.educationLevel = {};
            }
            
            $scope.user.eligibility.educationLevel = educationLevel;
        };
            
        $scope.setClass12Subjects = function(subjectName){
            //console.log($scope.user.eligibility.class12Subjects);
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.class12Subjects){
                $scope.user.eligibility.class12Subjects = {};
            }
            
            if(!$scope.user.eligibility.class12Subjects[subjectName]){
                $scope.user.eligibility.class12Subjects[subjectName] = true;
            }else{
                $scope.user.eligibility.class12Subjects[subjectName] = false;
            }
        };     
        $scope.setUndergradMajor = function(degreeName){
            
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.undergradMajor){
                $scope.user.eligibility.undergradMajor = {};
            }
            $scope.undergradMajors.forEach(function(thisDegree, index){
                if(thisDegree.name == degreeName){
                    if(!$scope.user.eligibility.undergradMajor[degreeName]){
                        $scope.user.eligibility.undergradMajor[degreeName] = true;
                    }else{
                        $scope.user.eligibility.undergradMajor[degreeName] = false;
                    }
                    
                }else{
                    $scope.user.eligibility.undergradMajor[thisDegree.name] = false;   
                }
            });
            
        };  
            
        $scope.setPostgradMajor = function(degreeName){
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.postgradMajor){
                $scope.user.eligibility.postgradMajor = {};
            }
            $scope.postgradMajors.forEach(function(thisDegree, index){
                if(thisDegree.name == degreeName){
                    if(!$scope.user.eligibility.postgradMajor[degreeName]){
                        $scope.user.eligibility.postgradMajor[degreeName] = true;
                    }else{
                        $scope.user.eligibility.postgradMajor[degreeName] = false;
                    }
                    
                }else{
                    $scope.user.eligibility.postgradMajor[thisDegree.name] = false;   
                }
            });
            
        };
            
         
            
        $scope.saveUser = function(){
            console.log($scope.user);
            $scope.setAge();
            UserService.updateUser($scope.user).success(function (data, status, headers) {
                Notification.success({message: "Changes successfully saved!",  positionY: 'top', positionX: 'right', delay: 1000});
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });    
        };
    }]);
        
        
    exambazaar.controller("cirfController", 
        [ '$scope', '$http','$state', '$rootScope', '$cookies', 'UserService', 'Notification', '$mdDialog', 'examList', 'cirfFactorService', function($scope,$http,$state,$rootScope, $cookies, UserService, Notification, $mdDialog, examList, cirfFactorService){
        $scope.col1width = 30;
        var examIds = [];
        $scope.subfactorTypes = ['Bucket', 'Checklist'];
        $scope.authorized = false;
        
        $scope.getFactorColor = function(index){
            index = index % 5 + 1;
            var classname = "factor" + index;
            return(classname);
        };
        if($cookies.getObject('sessionuser')){
            var sessionuser = $cookies.getObject( 'sessionuser');
            if(sessionuser && sessionuser._id){
                UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                    $scope.user = data;
                    $scope.exams = examList.data;
                    examIds = $scope.exams.map(function(a) {return a._id;});
                    if($scope.user.userType == 'Master'){
                        $scope.authorized = true; 
                    }
                    if($scope.user._id == '5a1831f0bd2adb260055e352'){
                        $scope.authorized = true; 
                    }
                    Notification.primary({message: "Welcome " + $scope.user.basic.name + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                    
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                //$cookies.remove("sessionuser");
                //$rootScope.$emit("CallBlogLogin", {});
            }
            
        }else{
            
        }
         
        $scope.saveFactor = function(factor, index){
             cirfFactorService.saveCirfFactor(factor).success(function (data, status, headers) {
                
                if(data && $scope.exam.factors && $scope.exam.factors.length > index){
                    $scope.exam.factors[index] = data;
                    Notification.success({message: "Factor successfully saved!",  positionY: 'top', positionX: 'right', delay: 2000});
                }
                
                
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        }; 
        $scope.setExam = function(exam){
            $scope.exam = exam;
            
            cirfFactorService.getExamCirfFactors($scope.exam._id).success(function (data, status, headers) {
                
                if(data){
                    $scope.exam.factors = data;
                }
                
                
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
            
            
        };
        $scope.deleteFactorConfirm = function(factor, index){
            var confirm = $mdDialog.confirm()
                .title('Would you like to delete this factor?')
                .textContent('You will not be able to recover it after this!')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.deleteFactor(factor, index);
                }, function() {
                  //nothing
                });
        };
        $scope.deleteFactor = function(factor, index){
            
            if(factor._id){
                cirfFactorService.removeCirfFactor(factor._id).success(function (data, status, headers) {
                
                    if(data){
                        Notification.success({message: "Factor successfully deleted!",  positionY: 'top', positionX: 'right', delay: 2000});
                        $state.reload();
                    }else{
                        Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 2000});
                    }


                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                $scope.exam.factors.splice(index, 1);
            }
            
                
        }; 
        $scope.addNewFactor = function(){
            if($scope.exam){
                var newFactor = {
                    name: '',
                    weight: '',
                    exam: examIds,
                    subfactors: [],
                };
                $scope.addNewSubFactor(newFactor);
                if(!$scope.exam.factors){
                    $scope.exam.factors = [];
                }
                $scope.exam.factors.push(newFactor);
            }    
        };
        $scope.addNewExamFactor = function(){
            if($scope.exam){
                var newFactor = {
                    name: '',
                    weight: '',
                    exam: [$scope.exam._id],
                    subfactors: [],
                };
                $scope.addNewSubFactor(newFactor);
                if(!$scope.exam.factors){
                    $scope.exam.factors = [];
                }
                $scope.exam.factors.push(newFactor);
            }    
        };
        
            
        $scope.addNewSubFactor = function(factor){
            if(!factor.subfactors){
                factor.subfactors = [];
            }
            var newSubFactor = {
                name: '',
                type: 'Bucket',
                buckets: [],
                checklists: [],
                weight: '',
                variable: '',
            };
            factor.subfactors.push(newSubFactor);
        };
        $scope.removeSubFactor = function(factor, index){
            if(!factor.subfactors){
                factor.subfactors = [];
            }
            if(index < factor.subfactors.length){
                factor.subfactors.splice(index, 1);
            }
            
        };
        $scope.addSubFactorBucket = function(factor, index){
            if(!factor.subfactors){
                factor.subfactors = [];
            }
            if(factor.subfactors.length > index){
                if(!factor.subfactors[index].buckets){
                    factor.subfactors[index].buckets = [];
                }
                var newBucket = {
                    range: {
                        min: '',
                        max: ''
                    },
                    score: '',
                };
                factor.subfactors[index].buckets.push(newBucket);
            }
            
        };
        $scope.addSubFactorChecklist = function(factor, index){
            if(!factor.subfactors){
                factor.subfactors = [];
            }
            if(factor.subfactors.length > index){
                if(!factor.subfactors[index].checklists){
                    factor.subfactors[index].checklists = [];
                }
                var newChecklist = {
                    score: '',
                    variable: '',
                };
                factor.subfactors[index].checklists.push(newChecklist);
            }
            
        };    
    }]);    
    exambazaar.controller("profileController", 
        [ '$scope', '$http','$state', '$rootScope', '$cookies', '$geolocation', 'Upload', 'ImageService', 'UserService', '$facebook', '$mdDialog', '$timeout', 'Notification', function($scope,$http,$state,$rootScope, $cookies, $geolocation, Upload, ImageService, UserService, $facebook, $mdDialog, $timeout, Notification){
        $scope.col1Width = 40;
        $scope.col1WidthAcademic = 20;
            
        var setPage = function(pageName){
            $scope.components.forEach(function(thisCategory, index){
                if(thisCategory.name == pageName){
                    thisCategory.active = true;
                    $scope.activeCategory = thisCategory;
                    $scope.currentSubcategories = thisCategory.subcategories;
                }
            });
        };
        $scope.components = [
            {
                name: 'Profile',
                active: false,
                state: 'profile',
                subcategories: [
                    {
                        name: 'Personal',
                    },
                    {
                        name: 'Social',
                    },
                    {
                        name: 'Blogging',
                    },
                    {
                        name: 'Contact',
                    },
                    /*{
                        name: 'Preferences',
                    },*/

                ],
            },
            {
                name: 'Academic Details',
                active: false,
                state: 'academics',
                subcategories: [
                    {
                        name: 'Education Level',
                    },
                    {
                        name: 'School Class XII',
                    },
                    {
                        name: 'Undergraduate',
                    },
                    {
                        name: 'Postgraduate',
                    },
                ],
            },
            {
                name: 'Your Reviews',
                active: false,
                state: 'reviewed',
                subcategories: [
                    {
                        name: 'Coaching Reviews',
                    },
                ],
            },
            {
                name: 'Your Coachings',
                active: false,
                state: 'userInstitutes',
                subcategories: [
                    {
                        name: 'Coachings Viewed',
                    },
                    {
                        name: 'Coachings Shortlisted',
                    },
                ],
            },
        ];
        setPage('Profile');    
            
        $scope.educationLevels = [
            {
                level: 0,
                name: "I-X"
            },
            {
                level: 2,
                name: "XI / XII / After XII"
            },
            /*{
                level: 2,
                name: "After XII (Drop Year)"
            },*/
            {
                level: 3,
                name: "In UG or equivalent"
            },
            {
                level: 4,
                name: "During or After Final Year of UG"
            },
            {
                level: 5,
                name: "During or After Final Year of PG"
            },
        ];
        $scope.class12Subjects = [
            {
                name: "english",
                displayname: "English"
            },
            {
                name: "physics",
                displayname: "Physics"
            },
            {
                name: "chemistry",
                displayname: "Chemistry"
            },
            {
                name: "mathematics",
                displayname: "Mathematics"
            },
            {
                name: "biology",
                displayname: "Biology"
            },
            {
                name: "biotechnology",
                displayname: "Biotechnology"
            },
            {
                name: "others",
                displayname: "Others"
            },
        ];
        $scope.undergradMajors = [
            {
                name: "btech",
                displayname: "B.Tech.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "be",
                displayname: "B.E.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "mbbs",
                displayname: "M.B.B.S.",
                stream:{
                    name: "medical",
                    displayname: "Medical",
                },
            },
            {
                name: "bds",
                displayname: "B.D.S.",
                stream:{
                    name: "medical",
                    displayname: "Medical",
                },
            },
            {
                name: "bsc",
                displayname: "B.Sc.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "ba",
                displayname: "B.A.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "bftech",
                displayname: "NIFT B.F.Tech.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },
            {
                name: "bcom",
                displayname: "B.Com.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },	
            {
                name: "barch",
                displayname: "B. Arch.",
                stream:{
                    name: "engineering",
                    displayname: "Engineering",
                },
            },
            {
                name: "llb",
                displayname: "LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "others",
                displayname: "Others"
            },
            {
                name: "fiveyearballb",
                displayname: "Five Year B.A. LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "fiveyearintegratedllb",
                displayname: "Five Year Integrated LL.B. (Hons.)",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            
            {
                name: "lawdegreeequivalenttollb",
                displayname: "Law Degree equivalent to LL.B.",
                stream:{
                    name: "law",
                    displayname: "Law",
                },
            },
            {
                name: "professionalcourseequivalenttobtech",
                displayname: "Professional Courses equivalent to B.E. / B.Tech.",
                stream:{
                    name: "other",
                    displayname: "Other",
                },
            },

        ];
        $scope.postgradMajors = [
            {
                name: "mba",
                displayname: "M.B.A."
            },
            {
                name: "ms",
                displayname: "M.S."
            },
            {
                name: "mtech",
                displayname: "M.Tech."
            },
            {
                name: "mcom",
                displayname: "M.Com."
            },
            {
                name: "msc",
                displayname: "M.Sc."
            },
            {
                name: "ma",
                displayname: "M.A."
            },
            {
                name: "mca",
                displayname: "M.C.A."
            },
            {
                name: "llm",
                displayname: "LL.M."
            },
            {
                name: "others",
                displayname: "Others"
            },

        ];
        $scope.sanitizeEligibility = function(){
            if($scope.user.eligibility){
                if($scope.user.eligibility.age){
                    $scope.user.eligibility.age = Number($scope.user.eligibility.age);
                }
                if($scope.user.eligibility.class12Percentage){
                    $scope.user.eligibility.class12Percentage = Number($scope.user.eligibility.class12Percentage);
                }
                if($scope.user.eligibility.undergradPercentage){
                    $scope.user.eligibility.undergradPercentage = Number($scope.user.eligibility.undergradPercentage);
                }
                if($scope.user.eligibility.postgradPercentage){
                    $scope.user.eligibility.postgradPercentage = Number($scope.user.eligibility.postgradPercentage);
                }
            }
        };    
        if($cookies.getObject('sessionuser')){
            var sessionuser = $cookies.getObject( 'sessionuser');
            if(sessionuser && sessionuser._id){
                UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                    $scope.user = data;
                    console.log($scope.user);
                    $scope.sanitizeEligibility();
                    Notification.primary({message: "Welcome " + $scope.user.basic.name + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                    if($scope.user.basic)
                        $rootScope.pageTitle =$scope.user.basic.name;
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            }else{
                $cookies.remove("sessionuser");
                $rootScope.$emit("CallBlogLogin", {});
            }
            
        }else{
            $cookies.remove("sessionuser");
        }
        
        $scope.uploadPic = function (newPic) {
            //var pic = $scope.newPic;
            var pic = [newPic];
            var nFiles = pic.length;
            
            var counter = 0;
            console.log(JSON.stringify($scope.user));
            var userId = $scope.user._id;
            if (pic && pic.length) {
            
            pic.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var picLink = $(resp.data).find('Location').text();
                
                var newPicForm ={
                    image: picLink,
                    userId: userId
                };
                
                UserService.addPic(newPicForm).success(function (data, status, headers) {
                    counter = counter + 1;
                    if(counter == nFiles){
                    
                        
                    if($cookies.getObject('sessionuser')){
                        var sessionuser = $cookies.getObject( 'sessionuser');
                        sessionuser.image = picLink;
                        $cookies.putObject('sessionuser', sessionuser);
                    }

                    $state.reload();
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
         };
            
        $scope.saveBlogger = function(){
            UserService.updateUser($scope.user).success(function (data, status, headers) {
                $scope.showSavedDialog();
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });    
        };
        $scope.fblogin = function() {
            $facebook.getLoginStatus().then(function(response) {
                $scope.fbLoginStatus = response;
            });
            //console.log('Loggin into fb');
            $facebook.login().then(function(response) {
                $scope.fbLoginStatus = response;
                refresh();
            });   
        };
        function refresh() {
            
            $facebook.api("/me", {fields: 'id, name, age_range, link, gender, picture, email'}).then(
                function(response) {
                    //console.log($scope.user);

                    if($scope.user && $scope.user._id){
                        //link the user's fb id to the current user
                        $scope.user.fbuser = {
                            name: response.name,
                            gender: response.gender,
                            image: response.picture.data.url,
                            email: response.email,
                            facebook: {
                                link: response.link,
                                id: response.id,
                            }
                        };


                    }else{
                        $scope.user = {};
                        $scope.user.fbuser = {
                            name: response.name,
                            gender: response.gender,
                            image: response.picture.data.url,
                            email: response.email,
                            facebook: {
                                link: response.link,
                                id: response.id,
                            }
                        };
                        //add a new user with facebook id
                    }

                },
                function(err) {
                    $scope.welcomeMsg = "Please log in";
                    $scope.isLoggedIn = false;
            });
            $facebook.api("/me/permissions").then(
                function(response) {
                    //console.log(response);
                    $scope.permissions = response;
                },
                function(err) {
                $scope.welcomeMsg = "Permissions Error";
            });
                
        };            
        $scope.$watch('[fbLoginStatus.status, user.fbuser.facebook.id]', function (newValue, oldValue, scope) {
            //console.log(newValue);
        if(newValue[0] == 'connected' && newValue[1]){
            $scope.fbUser = true;
            $scope.user.fbuser.facebook.accessToken = $scope.fbLoginStatus.authResponse.accessToken;
            if(!$scope.user.facebookId || $scope.user.facebookId == ''){
                //console.log($scope.user);
                UserService.fbSave($scope.user).success(function (data, status, headers) {

                    var fulluser = data;
                    //console.log(fulluser);
                    var sessionuser = {
                        userId: fulluser._id,
                        facebookId: fulluser.facebookId,
                        userType: fulluser.userType,
                        basic: fulluser.basic,
                        image: fulluser.image,
                        mobile: fulluser.mobile,
                        email: fulluser.email,

                    };
                    $cookies.putObject('sessionuser', sessionuser);
                    $scope.user = sessionuser;

                    //console.log(sessionuser.userType);
                    //alert('Done');
                    $scope.showSavedDialog();

                    //$state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            }




        }

        }, true);
        $scope.showSavedDialog = function(ev) {
        $mdDialog.show({
              contentElement: '#savedDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
            
        
        $scope.components.forEach(function(thisCategory, index){
            if(thisCategory.active){
                $scope.activeCategory = thisCategory;
                $scope.currentSubcategories = thisCategory.subcategories;
            }
        });
        $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
        
        $scope.setActiveSubcategory = function(subcategoryName){
            $scope.activeCategory.subcategories.forEach(function(thisSubcategory, index){
                if(thisSubcategory.name == subcategoryName){
                    $scope.activeSubcategory = thisSubcategory;
                }
            });
        };
            
        $scope.elgInput = {
            category: {
                general: true,
                sc: false,
                st: false,
                obc: false,
                pwd: false,
            },
            age: null,
            educationLevel:{
                level: null,
                name: null
            },
            class12Subjects:{
                biology: false,
                chemistry: false,
                biotechnology: false,
                physics: false,
                mathematics: false,
                english: false,
                others: false
            },
            class12Percentage: null,
            undergradMajor:{
                mbbs: false,
                bds: false,
                bsc: false,
                bftech: false,
                be: false,
                btech: false,
                bcom: false,
                ba: false,
                barch: false,
                llb: false,
                fiveyearintegratedllb: false,
                fiveyearballb: false,
                lawdegreeequivalenttollb: false,
                others: false,
            },
            undergradPercentage: null,
            postgradMajor:{
                mcom: false,
                msc: false,
                ma: false,
                mca: false,
                mtech: false,
                mba: false,
                ms: false,
                llm: false,
                others: false,
            },
            postgradPercentage: null,
            
        };    
        $scope.userVariables ={
            genders: [
                "Male",
                "Female",
            ],
            categories:[
                'GENERAL',    
                'OBC-NCL',    
                'SC',
                'ST',
            ],
        };
        $scope.setGender = function(gender){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            $scope.user.basic.gender = gender;
        };
        $scope.setCategory = function(caste){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            $scope.user.basic.category = caste;
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.category){
                $scope.user.eligibility.category = {};
            }
            if(caste == 'GENERAL'){
                $scope.user.eligibility.category.general = true;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = false;
            }
            if(caste == 'OBC-NCL'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = true;
            }
            if(caste == 'SC'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = true;
                $scope.user.eligibility.category.st = false;
                $scope.user.eligibility.category.obc = false;
            }
            if(caste == 'ST'){
                $scope.user.eligibility.category.general = false;
                $scope.user.eligibility.category.sc = false;
                $scope.user.eligibility.category.st = true;
                $scope.user.eligibility.category.obc = false;
            }
        };    
        $scope.setPwD = function(PwD){
            if(!$scope.user.basic){
                $scope.user.basic = {};
            }
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.category){
                $scope.user.eligibility.category = {};
            }
            $scope.user.basic.PwD = PwD;
            $scope.user.eligibility.category.pwd = PwD;
        };
        
        $scope.setAge = function(){
            if($scope.user.basic && $scope.user.basic.dob){
                var dob = moment($scope.user.basic.dob);
                var age = moment().diff(dob, 'years');
                if(!$scope.user.eligibility){
                    $scope.user.eligibility = {};
                }
                $scope.user.eligibility.age = age;
            }
        };
        
        $scope.setEducationLevel = function(educationLevel){
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.educationLevel){
                $scope.user.eligibility.educationLevel = {};
            }
            
            $scope.user.eligibility.educationLevel = educationLevel;
        };
            
        $scope.setClass12Subjects = function(subjectName){
            //console.log($scope.user.eligibility.class12Subjects);
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.class12Subjects){
                $scope.user.eligibility.class12Subjects = {};
            }
            
            if(!$scope.user.eligibility.class12Subjects[subjectName]){
                $scope.user.eligibility.class12Subjects[subjectName] = true;
            }else{
                $scope.user.eligibility.class12Subjects[subjectName] = false;
            }
        };     
        $scope.setUndergradMajor = function(degreeName){
            
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.undergradMajor){
                $scope.user.eligibility.undergradMajor = {};
            }
            $scope.undergradMajors.forEach(function(thisDegree, index){
                if(thisDegree.name == degreeName){
                    if(!$scope.user.eligibility.undergradMajor[degreeName]){
                        $scope.user.eligibility.undergradMajor[degreeName] = true;
                    }else{
                        $scope.user.eligibility.undergradMajor[degreeName] = false;
                    }
                    
                }else{
                    $scope.user.eligibility.undergradMajor[thisDegree.name] = false;   
                }
            });
            
        };  
            
        $scope.setPostgradMajor = function(degreeName){
            if(!$scope.user.eligibility){
                $scope.user.eligibility = {};
            }
            if(!$scope.user.eligibility.postgradMajor){
                $scope.user.eligibility.postgradMajor = {};
            }
            $scope.postgradMajors.forEach(function(thisDegree, index){
                if(thisDegree.name == degreeName){
                    if(!$scope.user.eligibility.postgradMajor[degreeName]){
                        $scope.user.eligibility.postgradMajor[degreeName] = true;
                    }else{
                        $scope.user.eligibility.postgradMajor[degreeName] = false;
                    }
                    
                }else{
                    $scope.user.eligibility.postgradMajor[thisDegree.name] = false;   
                }
            });
            
        };
            
            
        $scope.locateUser = function(){
            if (navigator.geolocation) {
                  var timeoutVal = 10 * 1000;
                  navigator.geolocation.getCurrentPosition(
                    displayPosition, 
                    displayError,
                    { enableHighAccuracy: true, timeout: timeoutVal, maximumAge: 0 }
                  );
                }
                else {
                  alert("Geolocation is not supported by your browser");
                    //use ip info
                }  
        };
            
        function reverseGeocodeUser(lat, lng){
            console.log("Reverse Geocode is called!");
            var geocoder = new google.maps.Geocoder();
            var latlng = new google.maps.LatLng(lat, lng);
            geocoder.geocode({ 'latLng': latlng }, function (results, status){
                if (status == google.maps.GeocoderStatus.OK) {
                if (results[1]) {
                    var gResults = results[1].address_components;
                    var userAddress = {
                        lat: lat,
                        lng: lng,
                        sublocality_level_2: null,    
                        sublocality: null,    
                        city: null,    
                        state: null,    
                        country: null,    
                    };
                    if($scope.user._id){
                        userAddress._id = $scope.user._id;
                    }

                    //console.log(gResults);    
                    gResults.forEach(function(thisComp, cindex){
                    var cTypes = thisComp.types;

                    if(cTypes.indexOf("sublocality_level_2") != -1){
                        userAddress.sublocality_level_2 = thisComp.long_name;
                    } 
                    if(cTypes.indexOf("sublocality_level_1") != -1){
                        userAddress.sublocality = thisComp.long_name;
                    }    
                    if(cTypes.indexOf("administrative_area_level_2") != -1){
                        userAddress.city = thisComp.long_name;
                    }
                    if(cTypes.indexOf("administrative_area_level_1") != -1){
                        userAddress.state = thisComp.long_name;
                    }
                    if(cTypes.indexOf("country") != -1){
                        userAddress.country = thisComp.long_name;
                    }
                    });

                    
                    if(userAddress.sublocality && userAddress.city){
                         //console.log(userAddress);
                        UserService.saveUserLocation(userAddress).success(function (data, status, headers) {
                            if(data){
                                console.log(data);
                                $scope.user = data;
                                Notification.success({message: "Great, we have located you at " + userAddress.sublocality + ", " + userAddress.city,  positionY: 'top', positionX: 'right', delay: 1000});
                            }else{
                                Notification.warning({message: "Oops! Where are you located? Mars?",  positionY: 'top', positionX: 'right', delay: 1000});
                            }
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                        
                        
                        
                    }


                    //console.log(results[1].formatted_address);
                    } else {
                        console.log('Location not found');
                    }
                } else {
                    console.log('Geocoder failed due to: ' + status);
                }
            });
        };
        function latlngfromIP(){
            if($cookies.getObject('ip')){
                var thisIP = $cookies.getObject('ip');
                console.log("Using IP to geolocate user");
                console.log(thisIP);
                $scope.currLocation = [thisIP.lat, thisIP.long];
                Notification.warning("Exambazaar couldn't locate you with accuracy");
            }    
        };
        $scope.currLocation = null;
        
            
        function displayPosition(position) {
            $scope.currLocation = [position.coords.latitude, position.coords.longitude];
            reverseGeocodeUser($scope.currLocation[0], $scope.currLocation[1]);
            console.log($scope.currLocation);
        }
        function displayError(error) {
          var errors = { 
            1: 'Permission denied',
            2: 'Position unavailable',
            3: 'Request timeout'
          };
          console.log("Error: " + errors[error.code]);
            //use ip info
            latlngfromIP();
        }   
            
        $scope.saveUser = function(){
            console.log($scope.user);
            $scope.setAge();
            UserService.updateUser($scope.user).success(function (data, status, headers) {
                Notification.success({message: "Changes successfully saved!",  positionY: 'top', positionX: 'right', delay: 1000});
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });    
        };
    }]);    
    
       
    
    exambazaar.controller("reviewedController", 
        [ '$scope', '$http','$state','$rootScope', '$cookies', 'UserService', 'reviewService', 'targetStudyProviderService', '$location', 'Notification', function($scope, $http, $state, $rootScope, $cookies, UserService, reviewService, targetStudyProviderService, $location, Notification){
            $scope.col1Width = 40;
            $scope.col1WidthAcademic = 20;
        
            var setPage = function(pageName){
                $scope.components.forEach(function(thisCategory, index){
                    if(thisCategory.name == pageName){
                        thisCategory.active = true;
                        $scope.activeCategory = thisCategory;
                        $scope.currentSubcategories = thisCategory.subcategories;
                    }
                });
            };
            $scope.components = [
                {
                    name: 'Profile',
                    active: false,
                    state: 'profile',
                    subcategories: [
                        {
                            name: 'Personal',
                        },
                        {
                            name: 'Social',
                        },
                        {
                            name: 'Blogging',
                        },
                        {
                            name: 'Contact',
                        },
                        /*{
                            name: 'Preferences',
                        },*/

                    ],
                },
                {
                    name: 'Academic Details',
                    active: false,
                    state: 'academics',
                    subcategories: [
                        {
                            name: 'Education Level',
                        },
                        {
                            name: 'School Class XII',
                        },
                        {
                            name: 'Undergraduate',
                        },
                        {
                            name: 'Postgraduate',
                        },
                    ],
                },
                {
                    name: 'Your Reviews',
                    active: false,
                    state: 'reviewed',
                    subcategories: [
                        {
                            name: 'Coaching Reviews',
                        },
                    ],
                },
                {
                    name: 'Your Coachings',
                    active: false,
                    state: 'userInstitutes',
                    subcategories: [
                        {
                            name: 'Coachings Viewed',
                        },
                        {
                            name: 'Coachings Shortlisted',
                        },
                    ],
                },
            ];
            setPage('Your Reviews');
            
            $scope.components.forEach(function(thisCategory, index){
                if(thisCategory.active){
                    $scope.activeCategory = thisCategory;
                    $scope.currentSubcategories = thisCategory.subcategories;
                }
            });
            $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
            if($cookies.getObject('sessionuser')){
                var sessionuser = $cookies.getObject( 'sessionuser');
                if(sessionuser && sessionuser._id){
                    UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                        $scope.user = data;
                         reviewService.getuserReviews($scope.user._id).success(function (rdata, status, headers) {
                            $scope.userReviewed = rdata;
                            
                            
                            $rootScope.pageTitle ='Reviews by ' + $scope.user.basic.name;

                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                        
                       
                        
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                }else{
                    $cookies.remove("sessionuser");
                    $rootScope.$emit("CallBlogLogin", {});
                }

            }else{
                $cookies.remove("sessionuser");
            }
            
            
            $scope.reviews = [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0];
            $scope.reviewsClasses = ["review1","review2","review3","review4","review5","review6","review7","review8","review9"];
            $scope.reviewParams = [
                {name: "faculty", displayname:"Faculty and Teaching Experience", hoverVal: -1},
                {name: "competitive_environment", displayname:"Competitive Environment", hoverVal: -1},
                {name: "quality_of_material", displayname:"Quality of material", hoverVal: -1},
                {name: "infrastructure", displayname:"Infrastructure", hoverVal: -1},
            ];
            var paramNames = $scope.reviewParams.map(function(a) {return a.name;});
            
            $scope.getBackgroundColour = function(reviewParam, paramIndex, userReview){
                var pIndex = paramNames.indexOf(reviewParam.name);
                var className = "noreview";

                var propName = $scope.reviewParams[pIndex].name;
                
                if(userReview && userReview[propName]){
                    var review = userReview[propName];
                    var rIndex = $scope.reviews.indexOf(Number(review));
                    if(paramIndex <= rIndex){
                        var rIndex2 = rIndex + 1;
                        className = "review" + rIndex2;    
                    }
                }

                if($scope.reviewParams[pIndex].hoverVal >= 0){
                    className = "noreview";
                };

                if($scope.reviewParams[pIndex].hoverVal >= paramIndex){

                    var paramIndex2 = paramIndex + 1;
                    className = "review" + paramIndex2;
                }

                //console.log(propName + " " + className);
                return className;
            };
            
            
            $scope.logMouseEvent = function(reviewParam,  paramIndex) {
                switch (event.type) {
                  case "mouseenter":
                        console.log("Hey Mouse Entered");
                        break;
                  case "mouseover":{
                        var pIndex = paramNames.indexOf(reviewParam.name);
                        $scope.reviewParams[pIndex].hoverVal = paramIndex;
                        break;
                  }
                  case "mouseout":{
                        var pIndex = paramNames.indexOf(reviewParam.name);
                        $scope.reviewParams[pIndex].hoverVal = -1;
                        break;
                  }

                  case "mouseleave":
                    console.log("Mouse Gone");
                    break;

                  default:
                    console.log(event.type);
                    break;
                };
            };
            
            
            //$scope.showCouponOptions = false;
            $scope.flipShowCoupon = function(userReview){
                $state.go('availOffer', {userId: $scope.user._id, reviewId: userReview._id});
                
            };
            
            /*var currURL = $location.absUrl();
            $rootScope.pageURL = currURL;*/
            $rootScope.pageImage = 'https://www.exambazaar.com/images/logo/cover.png';
    }]);
    
    
        
     exambazaar.controller("userInstitutesController", 
        [ '$scope', '$http','$state','$rootScope', '$cookies', 'UserService', 'targetStudyProviderService', 'viewService', '$location', 'Notification', function($scope, $http, $state, $rootScope, $cookies, UserService, targetStudyProviderService, viewService, $location, Notification){
            $scope.col1Width = 40;
            $scope.col1WidthAcademic = 20;
            
            var setPage = function(pageName){
                $scope.components.forEach(function(thisCategory, index){
                    if(thisCategory.name == pageName){
                        thisCategory.active = true;
                        $scope.activeCategory = thisCategory;
                        $scope.currentSubcategories = thisCategory.subcategories;
                    }
                });
            };
            $scope.components = [
                {
                    name: 'Profile',
                    active: false,
                    state: 'profile',
                    subcategories: [
                        {
                            name: 'Personal',
                        },
                        {
                            name: 'Social',
                        },
                        {
                            name: 'Blogging',
                        },
                        {
                            name: 'Contact',
                        },
                        /*{
                            name: 'Preferences',
                        },*/

                    ],
                },
                {
                    name: 'Academic Details',
                    active: false,
                    state: 'academics',
                    subcategories: [
                        {
                            name: 'Education Level',
                        },
                        {
                            name: 'School Class XII',
                        },
                        {
                            name: 'Undergraduate',
                        },
                        {
                            name: 'Postgraduate',
                        },
                    ],
                },
                {
                    name: 'Your Reviews',
                    active: false,
                    state: 'reviewed',
                    subcategories: [
                        {
                            name: 'Coaching Reviews',
                        },
                    ],
                },
                {
                    name: 'Your Coachings',
                    active: false,
                    state: 'userInstitutes',
                    subcategories: [
                        {
                            name: 'Coachings Viewed',
                        },
                        {
                            name: 'Coachings Shortlisted',
                        },
                    ],
                },
            ];
            setPage('Your Coachings');
            
            $scope.activeSubcategory = $scope.activeCategory.subcategories[0];
            
            $scope.setActiveSubcategory = function(subcategoryName){
                $scope.activeCategory.subcategories.forEach(function(thisSubcategory, index){
                    if(thisSubcategory.name == subcategoryName){
                        $scope.activeSubcategory = thisSubcategory;
                    }
                });
            };
            
            if($cookies.getObject('sessionuser')){
                var sessionuser = $cookies.getObject( 'sessionuser');
                if(sessionuser && sessionuser._id){
                   
                    UserService.getUser(sessionuser._id).success(function (data, status, headers) {
                        $scope.user = data;
                        $rootScope.pageTitle ='Coachings for ' + $scope.user.basic.name;
                        
                        viewService.getuserviews($scope.user._id).success(function (vdata, status, headers) {
                            $scope.viewed = vdata;
                            
                            UserService.getUserShortlisted($scope.user._id).success(function (sdata, status, headers) {
                                $scope.shortlisted = sdata;


                            })
                            .error(function (data, status, header, config) {
                                console.log('Error ' + data + ' ' + status);
                            });
                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                        
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                }else{
                    $cookies.remove("sessionuser");
                    $rootScope.$emit("CallBlogLogin", {});
                }

            }else{
                $cookies.remove("sessionuser");
            }
            
            
            $scope.reviews = [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0];
            $scope.reviewsClasses = ["review1","review2","review3","review4","review5","review6","review7","review8","review9"];
            $scope.reviewParams = [
                {name: "faculty", displayname:"Faculty and Teaching Experience", hoverVal: -1},
                {name: "competitive_environment", displayname:"Competitive Environment", hoverVal: -1},
                {name: "quality_of_material", displayname:"Quality of material", hoverVal: -1},
                {name: "infrastructure", displayname:"Infrastructure", hoverVal: -1},
            ];
            var paramNames = $scope.reviewParams.map(function(a) {return a.name;});
            
            $scope.getBackgroundColour = function(reviewParam, paramIndex, userReview){
                var pIndex = paramNames.indexOf(reviewParam.name);
                var className = "noreview";

                var propName = $scope.reviewParams[pIndex].name;
                
                if(userReview && userReview[propName]){
                    var review = userReview[propName];
                    var rIndex = $scope.reviews.indexOf(Number(review));
                    if(paramIndex <= rIndex){
                        var rIndex2 = rIndex + 1;
                        className = "review" + rIndex2;    
                    }
                }

                if($scope.reviewParams[pIndex].hoverVal >= 0){
                    className = "noreview";
                };

                if($scope.reviewParams[pIndex].hoverVal >= paramIndex){

                    var paramIndex2 = paramIndex + 1;
                    className = "review" + paramIndex2;
                }

                //console.log(propName + " " + className);
                return className;
            };
            
            
            $scope.logMouseEvent = function(reviewParam,  paramIndex) {
                switch (event.type) {
                  case "mouseenter":
                        console.log("Hey Mouse Entered");
                        break;
                  case "mouseover":{
                        var pIndex = paramNames.indexOf(reviewParam.name);
                        $scope.reviewParams[pIndex].hoverVal = paramIndex;
                        break;
                  }
                  case "mouseout":{
                        var pIndex = paramNames.indexOf(reviewParam.name);
                        $scope.reviewParams[pIndex].hoverVal = -1;
                        break;
                  }

                  case "mouseleave":
                    console.log("Mouse Gone");
                    break;

                  default:
                    console.log(event.type);
                    break;
                };
            };
            
            
            //$scope.showCouponOptions = false;
            $scope.flipShowCoupon = function(userReview){
                $state.go('availOffer', {userId: $scope.user._id, reviewId: userReview._id});
                
            };
            
            /*var currURL = $location.absUrl();
            $rootScope.pageURL = currURL;*/
            $rootScope.pageImage = 'https://www.exambazaar.com/images/logo/cover.png';
    }]);   
        
        
        
        
    exambazaar.controller("addSubscriberController", 
        [ '$scope',  'subscribersList','subscriberService','$http','$state', function($scope, subscribersList, subscriberService,$http,$state){
        
            $scope.subscribersList = subscribersList.data;
            $scope.newSubscribers = [
                {
                    name: '',
                    email: '',
                    mobile: '',
                }
            ];
            
            
            $scope.addSubscribers = function(){
                var toAddSubscribers = [];
                console.log("New Subscribers are: " + $scope.newSubscribers.length);
                
                $scope.newSubscribers.forEach(function(thisSubscriber, index){
                    if(thisSubscriber && thisSubscriber.name && (thisSubscriber.email ||  thisSubscriber.mobile)){
                        toAddSubscribers.push(thisSubscriber);
                    }
                });
                console.log("Adding subscribers: " + toAddSubscribers.length);
                subscriberService.saveSubscribers(toAddSubscribers).success(function (data, status, headers) {
               
                    alert("Subscribers saved!");
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
                
            };
            
            $scope.subscribersList.sort(function(a,b) {return (a.name > b.name) ? 1 : ((b.name > a.name) ? -1 : 0);});  
            
            
            $scope.selectedUser = [];
            
            $scope.setUser = function(subscriber){
                if(!$scope.selectedUser || $scope.selectedUser.length == 0){
                    $scope.selectedUser = [];
                }
                
                var selectedUserIds = [];
                if($scope.selectedUser && $scope.selectedUser.length > 0){
                    selectedUserIds = $scope.selectedUser.map(function(a) {return a._id;});
                }
                
                var sIndex = selectedUserIds.indexOf(subscriber._id);
                if(sIndex == -1){
                    //console.log($scope.selectedUser);
                    var subscriberUserIds = $scope.subscribersList.map(function(a) {return a._id;});
                    var selectedIndex = subscriberUserIds.indexOf(subscriber._id);
                    //console.log(selectedIndex);
                    var totalInvite = 200;
                    var totalSubscribers = $scope.subscribersList.length;
                    totalInvite = Math.min(selectedIndex + totalInvite, totalSubscribers);
                    //console.log(totalInvite);
                    var i = 0;

                    for(i=selectedIndex; i<totalInvite; i++){
                       $scope.selectedUser.push($scope.subscribersList[i]); 
                    }
                    //console.log($scope.selectedUser);
                    
                }else{
                    $scope.selectedUser.splice(sIndex,1);
                    console.log(subscriber._id + " already exists!");
                }
            };
            $scope.selectedBackground = function(subscriber){
                var selectedUserIds = $scope.selectedUser.map(function(a) {return a._id;});
                var sIndex = selectedUserIds.indexOf(subscriber._id);
                if(sIndex == -1){
                    return false;
                }else{
                    return true;
                }
            };
            
            $scope.sendReviewInvite = function(){
                
                if($scope.selectedUser){
                    var reviewInviteForm = {
                        userList: $scope.selectedUser,
                    };
                    subscriberService.sendReviewInvites(reviewInviteForm).success(function (data, status, headers) {
                        console.log('Delivered');
                        $scope.userSocial = true;
                    }).error(function (data, status, header, config) {
                        console.log("Error ");
                    });    
                }
                
                
            };
    }]);
        
    exambazaar.controller("addAwsCredentialController", 
        [ '$scope',  'awsCredentialList','AwsCredentialService','$http','$state', function($scope, awsCredentialList, AwsCredentialService,$http,$state){
        $scope.awsCredentials = awsCredentialList.data;
        
        $scope.addAwsCredential = function () {
            var saveAwsCredential = AwsCredentialService.saveAwsCredential($scope.awsCredential).success(function (data, status, headers) {
               
                alert("AWS Credential saved: " + $scope.awsCredential.accessKey);
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
            
        
        $scope.setAwsCredential = function(awsCredential){
            $scope.awsCredential = awsCredential;
        };
    }]);
    
    exambazaar.controller("whyReviewController", 
        [ '$scope','$http','$state','$rootScope', 'viewService', '$cookies', function($scope, $http, $state, $rootScope, viewService, $cookies){
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
            }else{
                
            }
            
            $rootScope.pageTitle = 'Why review at Exambazaar?';
            //alert('Starting');
            $rootScope.$emit("ShowReviewDialog", {});
            
            
            
            var viewForm = {
                state: $state.current.name,
                claim: false
            };
            if($scope.user && $scope.user.userId){
                viewForm.user = $scope.user.userId
            }
            //console.log(JSON.stringify(viewForm));
            if($cookies.getObject('ip')){
                var ip = $cookies.getObject('ip');
                viewForm.ip = ip;
            }
            viewService.saveview(viewForm).success(function (data, status, headers) {
                //console.log('View Marked');
            })
            .error(function (data, status, header, config) {
                console.log();
            });
    }]);    
    exambazaar.controller("aboutController", 
        [ '$scope','$http','$state','$rootScope', function($scope, $http, $state, $rootScope){
            $rootScope.pageTitle = "About | Exambazaar";
    }]);
    function validateEmail(email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    };
    function validateMobile(mobile) {
        var re = /^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[789]\d{9}$/;
        return re.test(mobile);
    };  
    exambazaar.controller("contactController", 
        [ '$scope','$http','$state','$rootScope', '$cookies', 'screenSize', 'contactService', 'EmailService', 'Notification', function($scope, $http, $state, $rootScope, $cookies, screenSize, contactService, EmailService, Notification){
            $rootScope.pageTitle = "Contact Us | Exambazaar";
            if (screenSize.is('xs, sm')){
                $scope.mobileDevice = true;
            }else{
                //console.log('Laptop');
                $scope.mobileDevice = false;
            }
            $scope.masterUser = false;
            if($cookies.getObject('sessionuser')){
            
                $scope.user = $cookies.getObject('sessionuser');
                if($scope.user.userType=='Master'){
                    $scope.masterUser = true;
                }
            }
            
            $scope.contactoptions = [
                "I would like to feature Expert Review of a coaching",
                "I found incorrect/outdated information on a page",
                "There is a photo/review that is bothering me and I would like to report it",
                "The website is not working the way it should",
                "I would like to give feedback/suggestions",
                "Other",
             ];
            $scope.messageSent = false;
            $scope.collegeMessageSent = false;
            $scope.contactForm = {
                name: '',
                email: '',
                mobile: '',
                about: null,
                message: '',
            };
            $scope.collegeForm = {
                collegename: '',
                email: '',
                mobile: '',
            };
            $scope.validate = function(){
                var valid = true;
                if($scope.contactForm.name.length < 3){
                    valid = false;
                }
                if(!validateEmail($scope.contactForm.email)){
                    valid = false;
                }
                if(!validateMobile($scope.contactForm.mobile)){
                    valid = false;
                }
                if(!$scope.contactForm.about){
                    valid = false;
                }
                if($scope.contactForm.message.length < 3){
                    valid = false;
                }
                return valid;
            };
            
            $scope.submitMessage = function(){
                //console.log($scope.contactForm);
                var valid = $scope.validate();
                //console.log(valid);
                if(valid){
                    contactService.saveContact($scope.contactForm).success(function (data, status, headers) {
                        
                        
                        var emailForm = {
                            templateName: 'Contact Receipt',
                            to: $scope.contactForm.email,
                            contactName: $scope.contactForm.name,
                            contactMobile: $scope.contactForm.mobile,
                            contactAbout: $scope.contactForm.about,
                            contactMessage: $scope.contactForm.message,
                        };
                        
                         EmailService.contactEmail(emailForm).success(function (thisData, status, headers) {
                            console.log(thisData);
                            $scope.messageSent = true;
                            Notification.success("Your message has been received. We will get back to you shortly!");

                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                }else{
                    Notification.warning("Please fill all form details correctly before submitting!");
                }
                
            };
            
            
            $scope.recruitmentEmail = function(){
                var emailForm = {
                    templateName: 'College Recruitment',
                    to: $scope.collegeForm.email,
                    collegename: $scope.collegeForm.collegename,
                };
                EmailService.recruitmentEmail(emailForm).success(function (thisData, status, headers) {
                    console.log(thisData);
                    //$scope.collegeMessageSent = true;
                    Notification.success("Email sent to college " + $scope.collegeForm.collegename + " at " + $scope.collegeForm.email + "!");
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });    
            };
    }]);    
    exambazaar.controller("addMediaTagController", 
        [ '$scope',  'mediaTagList','mediaTypeList','MediaTagService','$http','$state', function($scope, mediaTagList,mediaTypeList, MediaTagService,$http,$state){
            
        $scope.mediaTags = mediaTagList.data;
        $scope.mediaTypes = mediaTypeList.data;
        $scope.newmediaTags = [
            {
                media: 'Image',
                type: 'External',
                subType: 'Institute Logo'
            }
        ];
        $scope.bulkAddMode = false;
        $scope.setBulkAddMode = function(){
            $scope.bulkAddMode = !$scope.bulkAddMode;
        };
         
        $scope.addMediaTag = function () {
            var saveMediaTag = MediaTagService.saveMediaTags([$scope.mediaTag]).success(function (data, status, headers) {
               
                alert("Media Tag saved: " + $scope.mediaTag.media + ' > ' + $scope.mediaTag.type + ' > ' + $scope.mediaTag.subType);
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
            
        $scope.addMediaTags = function(){
            $scope.newmediaTags.pop();
            $scope.newmediaTags.pop();
            $scope.newmediaTags.pop();
            $scope.newmediaTags.pop();
            $scope.newmediaTags.pop();
            
            MediaTagService.saveMediaTags($scope.newmediaTags).success(function (data, status, headers) {
                alert('MediaTags Saved!');
                })
                .error(function (data, status, header, config) {
                    console.log('Error: ' + data);
                });      
        };
        $scope.setMediaTag = function(mediaTag){
            $scope.mediaTag = mediaTag;
        };
    }]); 
    exambazaar.controller("addGroupController", 
        [ '$scope',  'groupList','GroupService','$http','$state', function($scope, groupList, GroupService,$http,$state){
            
        $scope.groups = groupList.data;
        $scope.newgroups = [
            {
                group: 'Jamboree'
            }
        ];
        $scope.bulkAddMode = true;
        $scope.setBulkAddMode = function(){
            $scope.bulkAddMode = !$scope.bulkAddMode;
        };
         
        $scope.addGroup = function () {
            var saveGroup = GroupService.saveGroups([$scope.group]).success(function (data, status, headers) {
               
                alert("Group saved: " + $scope.group.media + ' > ' + $scope.group.type + ' > ' + $scope.group.subType);
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
            
        $scope.addGroups = function(){
            $scope.newgroups.pop();
            $scope.newgroups.pop();
            $scope.newgroups.pop();
            $scope.newgroups.pop();
            $scope.newgroups.pop();
            
            GroupService.saveGroups($scope.newgroups).success(function (data, status, headers) {
                alert('Groups Saved!');
                })
                .error(function (data, status, header, config) {
                    console.log('Error: ' + data);
                });      
        };
        $scope.setGroup = function(group){
            $scope.group = group;
        };
    }]);  
    exambazaar.controller("addLocationController", 
        [ '$scope',  'locationList','cityList','LocationService','$http','$state', function($scope, locationList,cityList, LocationService,$http,$state){
        $scope.locations = locationList.data;
        $scope.cities = cityList.data;
        $scope.bulkAddMode = false;
        $scope.setBulkAddMode = function(){
            $scope.bulkAddMode = !$scope.bulkAddMode;
        };
        $scope.newlocations = [
            {
                city:'Jaipur',
                area:'Malviya Nagar'
            }
        ];
        $scope.addLocation = function () {
            var saveLocation = LocationService.saveLocation($scope.location).success(function (data, status, headers) {
               
                alert("Location saved: " + $scope.location.area);
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
            
        $scope.addLocations = function(){
            $scope.newlocations.pop();
            $scope.newlocations.pop();
            $scope.newlocations.pop();
            $scope.newlocations.pop();
            $scope.newlocations.pop();
            
            LocationService.saveLocations($scope.newlocations).success(function (data, status, headers) {
                alert('Locations Saved!');
                })
                .error(function (data, status, header, config) {
                    console.log('Error: ' + data);
                });      
        };
        $scope.setLocation = function(location){
            $scope.location = location;
        };
    }]);
    
    
    exambazaar.controller("addEligibilityController", 
        [ '$scope',  'examList','streamList','EligibilityService','$http','$state', '$rootScope', 'eligibilityList', function($scope, examList,streamList, EligibilityService,$http, $state, $rootScope, eligibilityList){
        $scope.examNames = '';    
        $scope.exams = examList.data;
        
        $scope.newEligibility = eligibilityList.data;
        if(!$scope.newEligibility){
            $scope.newEligibility = [];
        }
        $rootScope.pageTitle = 'Eligibility Matrix';
        var examNameHelper = $scope.exams.map(function(a) {return a.displayname;});
        var examIdHelper = $scope.exams.map(function(a) {return a._id;});
        $scope.newEligibility.forEach(function(thisEligibility, index){
            
            var examName = thisEligibility.exam.displayname;
            thisEligibility.examName = examName;
        });
            
        $scope.newEligibility.sort(function(a,b) {return (a.examName > b.examName) ? 1 : ((b.examName > a.examName) ? -1 : 0);} );    
            
        $scope.exams.forEach(function(thisExam, eIndex){
            $scope.examNames += thisExam.displayname+',';
        });
        //console.log($scope.examNames);    
        $scope.streams = streamList.data;
        
        $scope.addEligibility = function () {
            var eligibilitys = [];
            $scope.newEligibility.forEach(function(thisEligibility, index){
                var eIndex = examNameHelper.indexOf(thisEligibility.examName);
               
                var exam = null;
                if(eIndex != -1){
                    exam = $scope.exams[eIndex]._id;
                    thisEligibility.exam = exam;
                }
                if(exam){
                    eligibilitys.push(thisEligibility);
                }else{
                    if(thisEligibility.examName){
                        console.log("Please check exam name: " + thisEligibility.examName +". You need to match it exactly.");
                    }
                    
                }
                
            });
            
            var saveEligibility = EligibilityService.bulksaveEligibility(eligibilitys).success(function (data, status, headers) {
                alert("Eligibilities saved!");
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
        $scope.setExam = function(exam){
            $scope.exam = exam;
        };
    }]);
        
        
         
    exambazaar.controller("addQuestionController", 
        [ '$scope', 'Notification', '$rootScope', 'thisTest', 'Upload', 'ImageService', 'questionService', 'testService', '$state', '$mdDialog', '$timeout', 'thisTestQuestions', '$cookies', function($scope, Notification, $rootScope, thisTest, Upload, ImageService, questionService, testService, $state, $mdDialog, $timeout, thisTestQuestions, $cookies){
            $scope.fullScope = false;
            $scope.test = thisTest.data;
            $scope.thisTestQuestions = thisTestQuestions.data;
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
                
                if($scope.user.userType == 'Master' || $scope.user._id == '5a1831f0bd2adb260055e352'){
                   $scope.fullScope = true;
                }
                
            }else{
                //$rootScope.$emit("CallBlogLogin", {});
            }
            
            
            
            $scope.customMarking = {
                correct: '',
                incorrect: ''
            };
            $scope.showCustomMarkingDialog = function(ev){
                $scope.customMarkingQuestions = [];
                $mdDialog.show({
                  contentElement: '#customMarkingDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });    
            };
            
            $scope.updateSections = function(){
                $scope.allSectionNames = [];
                
                $scope.thisTestQuestions.forEach(function(thisQuestion, index){
                    var thisSection = thisQuestion.section;
                    /*if(!thisSection){
                        thisSection = 'null';
                    }*/
                    var tIndex = $scope.allSectionNames.indexOf(thisSection);
                    if(tIndex == -1){
                        $scope.allSectionNames.push(thisSection);
                    }
                    
                });
                
            };
            $scope.selectedClass = function(question){
                var className = 'unselectedbadge';
                var selectedQuestionIds = $scope.selectedQuestions.map(function(a) {return a._id;});
                if(selectedQuestionIds.indexOf(question._id) != -1){
                    className = 'selectedbadge';
                }
                return className;
            };
            $scope.selectedQuestions = [];
            $scope.newSectionName = '';
            $scope.addtoSelection = function(question){
                
                
                if(!$scope.selectedQuestions){
                    $scope.selectedQuestions = [];
                }
                var selectedQuestionIds = $scope.selectedQuestions.map(function(a) {return a._id;});
                var sIndex = selectedQuestionIds.indexOf(question._id);
                if(sIndex == -1){
                    $scope.selectedQuestions.push(question);
                }
                
                
            };
            
            $scope.removeFromSelection = function(question){
                if(!$scope.selectedQuestions){
                    $scope.selectedQuestions = [];
                }
                var selectedQuestionIds = $scope.selectedQuestions.map(function(a) {return a._id;});
                var sIndex = selectedQuestionIds.indexOf(question._id);
                if(sIndex != -1){
                    $scope.selectedQuestions.splice(sIndex, 1);
                }
            };
            $scope.clearSelection = function(){
                $scope.selectedQuestions = [];
            };
            $scope.syncTestSections = function(){
                
                if(!$scope.test.simulate.sections){
                    $scope.test.simulate.sections = [];
                }
                var existingSectionNames = $scope.test.simulate.sections.map(function(a) {return a.name;});
                if($scope.allSectionNames && $scope.allSectionNames.length > 1){
                    $scope.allSectionNames.forEach(function(thisSectionName, index){
                        var secIndex = existingSectionNames.indexOf(thisSectionName);
                        if(secIndex == -1){
                            var section = {
                                name: thisSectionName,
                                timedSeparately: false,
                                time: '', //in minutes
                                break: '', //in minutes
                                order: '', //in minutes
                            };
                            $scope.test.simulate.sections.push(section);
                        }
                        
                    });
                    
                    
                }
            };
            $scope.saveSectionNames = function(sectionName){
                var selectedQuestionIds = $scope.selectedQuestions.map(function(a) {return a._id;});
               
                var sectionForm = {
                    sectionName: sectionName,
                    questionIds: selectedQuestionIds,
                    testId: $scope.test._id,
                };
                
                questionService.markSection(sectionForm).success(function (data, status, headers) {
                         
                     if(data){
                         Notification.success({message: "All done!",  positionY: 'top', positionX: 'right', delay: 5000});
                         $state.reload();
                     }else{
                         Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 5000});
                     }

                })
                .error(function (data, status, header, config) {
                     Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 5000});
                    console.log('Error ' + data + ' ' + status);
                });
            };
            $scope.testSections = function(){
                
            };
            
            $scope.showCustomSections = false;
            $scope.customMarkingQuestions = [];
            $scope.showSectionsMarkingDialog = function(ev){
                $scope.updateSections();
                $scope.syncTestSections();
                $scope.showCustomSections = true;
            };
            $scope.addCustomMarkingQuestion = function(question){
                if(!$scope.customMarkingQuestions){
                   $scope.customMarkingQuestions = [];
                }
                var questionIds = $scope.customMarkingQuestions.map(function(a) {return a._id;});
                var qIndex = questionIds.indexOf(question._id);
                if(qIndex == -1){
                    $scope.customMarkingQuestions.push(question);
                }  
            };
            
            $scope.setAllCustomMarkingQuestion = function(){
                if(!$scope.customMarkingQuestions){
                   $scope.customMarkingQuestions = [];
                }
                $scope.customMarkingQuestions = $scope.thisTestQuestions;
            };
            
            $scope.removeAllCustomMarkingQuestion = function(){
                $scope.customMarkingQuestions = [];
            };
            
            $scope.removeCustomMarkingQuestion = function(question){
                if(!$scope.customMarkingQuestions){
                   $scope.customMarkingQuestions = [];
                }
                var questionIds = $scope.customMarkingQuestions.map(function(a) {return a._id;});
                var qIndex = questionIds.indexOf(question._id);
                if(qIndex != -1){
                    $scope.customMarkingQuestions.splice(qIndex, 1);
                }
                
            };
            $scope.setCustomMarkingForAll = function(){
                //console.log($scope.customMarkingQuestions);
                var questionIds = $scope.customMarkingQuestions.map(function(a) {return a._id;});
                if($scope.customMarkingQuestions.length > 0){
                    
                    var valid = true;
                    if($scope.customMarking.correct == ''){
                        valid = false;
                    }
                    if($scope.customMarking.incorrect == '' && $scope.customMarking.incorrect != 0){
                        valid = false;
                    }
                    if($scope.customMarking.incorrect > 0){
                        valid = false;
                        Notification.warning({message: "The marks for incorrect answer should be NEGATIVE!",  positionY: 'top', positionX: 'right', delay: 5000});
                    }
                    if($scope.customMarking.correct < 0){
                        valid = false;
                        Notification.warning({message: "The marks for correct answer should be POSITIVE!",  positionY: 'top', positionX: 'right', delay: 5000});
                    }
                    if($scope.customMarking.correct + $scope.customMarking.incorrect < 0){
                        valid = false;
                        Notification.warning({message: "The NEGATIVE marks for incorrect answer cannot be greater than POSITIVE marks for correct answer!",  positionY: 'top', positionX: 'right', delay: 10000});
                    }

                    if(!valid){
                        Notification.warning({message: "Your custom marking scheme does not fit the requirements at EB!",  positionY: 'top', positionX: 'right', delay: 5000});
                    }else{
                        var customMarkingForm = {
                            testId: $scope.test._id,
                            questionIds: questionIds,
                            customMarking: $scope.customMarking
                        };

                        testService.customMarking(customMarkingForm).success(function (data, status, headers) {
                            if(data){
                                Notification.success({message: "Custom marking synched!",  positionY: 'top', positionX: 'right', delay: 5000});
                            }else{
                                Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 5000});
                            }

                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                    }
                    
                }else{
                    Notification.warning({message: "No question selected!",  positionY: 'top', positionX: 'right', delay: 5000});
                }
                
                
                
                
            };
            
            $scope.numericalAnswerTypes = [
                {
                    display: 'Exact Match',
                    value: 'Exact'
                },
                {
                    display: 'Within a range',
                    value: 'Range'
                },
                                          
            ];
            
            
            $scope.sortQuestions = function(){
                $scope.thisTestQuestions.forEach(function(thisQuestion, index){
                    thisQuestion._startnumber = parseInt(thisQuestion._startnumber);
                    thisQuestion._endnumber = parseInt(thisQuestion._endnumber);
                    
                    
                });    
            };
            $scope.sortQuestions();
            
            $scope.missingQuestions = [];
            $scope.findMissingQuestions = function(){
                var startingNo = 10000;
                var endingNo = 0;
                var qnos = [];
                $scope.thisTestQuestions.forEach(function(thisQuestion, index){
                    if(thisQuestion._startnumber > endingNo){
                        endingNo = thisQuestion._startnumber;
                    }
                    if(thisQuestion._endnumber > endingNo){
                        endingNo = thisQuestion._endnumber;
                    }
                    if(thisQuestion._startnumber < startingNo){
                        startingNo = thisQuestion._startnumber;
                    }
                });
                for (var i = startingNo; i <= endingNo; i++) { 
                    qnos.push(i);
                }
                
                $scope.thisTestQuestions.forEach(function(thisQuestion, index){
                    var start = thisQuestion._startnumber;
                    var end = thisQuestion._endnumber;
                    if(end && end != ''){
                        for (var i = start; i <= end; i++) { 
                            var qIndex = qnos.indexOf(i);
                            qnos.splice(qIndex, 1);
                        }
                    }else{
                        var qIndex = qnos.indexOf(start);
                        qnos.splice(qIndex, 1);
                    }
                });
                $scope.missingQuestions = qnos;
                
            };
            $scope.findMissingQuestions();
            
            
            var find_duplicate_in_array = function (thisArray) {
                thisArray = thisArray.sort();
                var nElements = thisArray.length;
                var duplicates = [];
                thisArray.forEach(function(thisElement, index){
                    if(index < nElements - 1){
                        if(thisArray[index] == thisArray[index + 1]){
                            var dIndex = duplicates.indexOf(thisArray[index]);
                            if(dIndex == -1){
                                duplicates.push(thisArray[index]);
                            }
                        }
                    }
                });
                return duplicates;
            };
            
            $scope.repeatQuestions = [];
            $scope.findRepeatQuestions = function(){
                var startingNo = 10000;
                var endingNo = 0;
                var qnos = [];
                var startNumbers = $scope.thisTestQuestions.map(function(a) {return a._startnumber;});
                qnos = find_duplicate_in_array(startNumbers);
                $scope.repeatQuestions = qnos;
            };
            $scope.findRepeatQuestions();
            
            
            $scope.markCreator = function(){
                if($scope.user.userType = 'Master'){
                     questionService.markCreator().success(function (data, status, headers) {
                         
                         if(data){
                             Notification.success({message: "All done!",  positionY: 'top', positionX: 'right', delay: 5000});
                         }else{
                             Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 5000});
                         }
                        
                    })
                    .error(function (data, status, header, config) {
                         Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 5000});
                        console.log('Error ' + data + ' ' + status);
                    });
                }
            };
            
            $scope.markAnswerExists = function(){
                questionService.markAnswerExists().success(function (data, status, headers) {
                    if(data){
                        Notification.primary({message: "Questions with answers marked successfully!",  positionY: 'top', positionX: 'right', delay: 1000});
                    }
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });       
            };
            
            $scope.flipwatermarked = function(testId){
                if($scope.user.userType = 'Master'){
                    testService.flipwatermarked(testId).success(function (data, status, headers) {
                        
                        if(data != null){
                            $scope.test.watermarked = data;
                           
                        }
                        //console.log(data);
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    }); 
                }
            };
            
            $scope.addTestInstruction = function(){
                if(!$scope.test.instructions){
                    $scope.test.instructions = [];
                }
                $scope.test.instructions.push('');
            };
            $scope.removeTestInstruction = function(index){
                if(!$scope.test.instructions){
                    $scope.test.instructions = [];
                }
                if($scope.test.instructions.length > index){
                    $scope.test.instructions.splice(index, 1);
                }
                
            };
            
            $scope.manualMarkforEBSimulation = function(){
                $scope.test.simulationactive = true;
                $scope.saveTest();
            };
            $scope.manualUnmarkforEBSimulation = function(){
                $scope.test.simulationactive = false;
                $scope.saveTest();
            };
            $scope.simulateNow = function(){
                var url = $state.href('assessment', {testId: $scope.test._id});
                window.open(url,'_blank');
            };
            $scope.saveTest = function(){
                
                if(!$scope.test._actualdate){
                    $scope.test._actualdate = null;
                    Notification.warning({message: "Not saving actual exam date as it is not set!",  positionY: 'top', positionX: 'right', delay: 3000});
                }
                if($scope.test._actualdate && moment($scope.test._actualdate).isSame(moment(), 'day')){
                    $scope.test._actualdate = null;
                    Notification.warning({message: "Not saving actual exam date as it is the same as today!",  positionY: 'top', positionX: 'right', delay: 3000});
                }
                testService.saveTest($scope.test).success(function (data, status, headers) {
                    $scope.test = data;
                    $scope.markSimulate();
                    Notification.success({message: "Test simulation details saved!",  positionY: 'top', positionX: 'right', delay: 3000});
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            };
            $scope.removeQuestionDialog = function(){
                var questionSet = $scope.toAddQuestion;
                var confirm = $mdDialog.confirm()
                .title('Would you like to delete this question?')
                .textContent('You will not be able to recover them after this!')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.deleteQuestion(questionSet);
                }, function() {
                  //nothing
                });   
            };
            $scope.deleteQuestion = function(questionSet){
                if(questionSet._id){
                    questionService.removeQuestion(questionSet._id).success(function (data, status, headers) {
                        $scope.showSavedDialog();
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
                }
                
            };
            
            
            
            $scope.splitQuestions = function(){
                var questionSet = $scope.toAddQuestion;
                var nQuestions = questionSet.questions.length;
                var allSplitQuestions = [];
                if(nQuestions > 1){
                    questionSet.questions.forEach(function(thisQuestion, index){
                        var newQuestion = {
                            _groupOfQuestions: false,
                            //_multipleCorrect: false,
                            _startnumber: questionSet._startnumber + index,
                            _endnumber: '',
                            _hascontext: false,
                            context: '',
                            images: null,
                            questions:[],
                            test: $scope.test._id,
                            exam: $scope.test.exam,

                        };
                        newQuestion.questions = [];
                        var thisNewQuestion = {};
                        for (var property in thisQuestion) {
                            thisNewQuestion[property] = thisQuestion[property];
                            
                        }
                        
                        if(questionSet.context && questionSet.context != ''){
                            thisNewQuestion.question = questionSet.context + '\r\n\r\n' + thisQuestion.question;
                        }
                        newQuestion.questions.push(thisNewQuestion);
                        newQuestion._createdBy = $scope.user._id;
                        allSplitQuestions.push(newQuestion);
                    });
                    var addingQuestions = allSplitQuestions.length;
                    var counter = 0;
                    console.log(allSplitQuestions);
                    allSplitQuestions.forEach(function(thisQuestion, index){
                         questionService.saveQuestion(thisQuestion).success(function (data, status, headers) {
                            counter += 1;
                            if(counter == addingQuestions){
                                $scope.showSavedDialog();
                                $state.reload();
                            }
                            
                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                        
                    });
                    
                    
                }
            };
            
            $scope.toAddQuestion = null;
            $scope.questionTypes = ["MCQ"];
            
            
            
            $scope.addNewQuestionSet = function(){
                $scope.toAddQuestion = {
                    
                    _groupOfQuestions: false,
                    //_multipleCorrect: false,
                    _startnumber: '',
                    _endnumber: '',
                    _hascontext: false,
                    context: '',
                    images: null,
                    questions:[],
                    test: $scope.test._id,
                    exam: $scope.test.exam,
                    
                };
                if($scope.user){
                    $scope.toAddQuestion._createdBy = $scope.user._id;
                    //console.log($scope.toAddQuestion);
                }
                $scope.addNewQuestion();
                
                $scope.sortQuestions();
            };
            
            $scope.reload = function(){
                $state.reload();
            };
            $scope.readyToSave = function(){
                var ready = true;
                if($scope.toAddQuestion._startnumber == ''){
                    ready = false;
                }
                if($scope.toAddQuestion.questions.length > 1 && $scope.toAddQuestion._endnumber == ''){
                   ready = false;
                }
                if($scope.toAddQuestion.questions.length == 1){
                   /*$scope.toAddQuestion._endnumber = '';
                   $scope.toAddQuestion.context = '';
                   $scope.toAddQuestion._groupOfQuestions = false;
                   $scope.toAddQuestion._hascontext = false;*/
                }
                if($scope.toAddQuestion.questions.length > 1){
                    $scope.toAddQuestion._groupOfQuestions = true;
                    $scope.toAddQuestion._hascontext = true;
                }
                $scope.toAddQuestion.questions.forEach(function(thisQuestion, index){
                    if(thisQuestion.question.length < 10){
                        ready = false;
                    }
                    thisQuestion.options.forEach(function(thisOption, oindex){
                        if(thisOption.option == ''){
                            ready = false;
                        }
                    });
                });
                ready = !ready;
                return ready;
            };
            var standardMarking = {
                correct: '3',
                incorrect: '-1',
            };
            $scope.addNewQuestion = function(){
                if($scope.toAddQuestion){
                    var newQuestion = {
                        type: 'mcq',
                        marking: standardMarking,
                        question: '',
                        options: [],
                        solution: {
                            solution: '',
                            images: [],
                        },
                        answer: '',
                        images: [],
                    };
                    $scope.addNewOption(newQuestion);
                    $scope.addNewOption(newQuestion);
                    $scope.addNewOption(newQuestion);
                    $scope.addNewOption(newQuestion);
                    $scope.toAddQuestion.questions.push(newQuestion);
                    
                    
                }
                
                $scope.sortQuestions();
            };
            $scope.numericalType = function(subquestion){
                if(subquestion.type != 'numerical'){
                    subquestion.type = 'numerical';
                }
                subquestion.numericalAnswerType = 'Range';
                if(!subquestion.numericalAnswers){
                    subquestion.numericalAnswers = [''];
                }
                subquestion.options = [];
            };
            $scope.addNumericalAnswer = function(subquestion){
                
                if(!subquestion.numericalAnswers){
                    subquestion.numericalAnswers = [''];
                }
                subquestion.numericalAnswers.push('');
            };
            $scope.removeNumericalAnswer = function(subquestion, index){
                
                if(subquestion.numericalAnswers && subquestion.numericalAnswers.length > index){
                    subquestion.numericalAnswers.splice(index, 1);
                }
            };
            
            $scope.mcqType = function(subquestion){
                if(subquestion.type != 'mcq'){
                    subquestion.type = 'mcq';
                }
                if(!subquestion.options || (subquestion.options && subquestion.options.length == 0)){
                    subquestion.options = [];
                    $scope.addNewOption(subquestion);
                    $scope.addNewOption(subquestion);
                    $scope.addNewOption(subquestion);
                    $scope.addNewOption(subquestion);
                }
                subquestion.numericalAnswers = [];
            };
            $scope.removeQuestionFromSet = function(question, index){
                console.log('I am here ' + index);
                if(index && index < $scope.toAddQuestion.questions.length){
                    $scope.toAddQuestion.questions.splice(index, 1);
                    console.log('Done');
                }    
            };
            $scope.addNewOption = function(question){
                if(!question.options){
                    question.options = [];
                }
                var newOption = {
                    option: '',
                    _correct: false,
                };
                question.options.push(newOption);
            };
            $scope.removeOption = function(question, option, index){
                if(question.options && question.options.length > index){
                    question.options.splice(index, 1);
                }
            };
            $scope.addNewQuestionSet();
            
            $scope.saveNewQuestion = function(){
                console.log($scope.toAddQuestion);
                questionService.saveQuestion($scope.toAddQuestion).success(function (data, status, headers) {
                    console.log(data);
                    $scope.toAddQuestion = data;
                    $scope.showSavedDialog();
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
            };
            
            
            
            $scope.setQuestion = function(question){
                $scope.toAddQuestion = question;
                
                
                $scope.toAddQuestion.questions.forEach(function(thisQuestion, index){
                    if(!thisQuestion.marking){
                        thisQuestion.marking = standardMarking;
                    }
                    
                    if(!thisQuestion.solution){
                        thisQuestion.solution = {
                            solution: '',
                            images: [],
                        };
                    }
                });
            };
            $scope.showSavedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#savedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            
            $scope.$watch('toAddQuestion.text', function (newValue, oldValue, scope) {
                if(newValue != null && newValue != '' && !$scope.addNewQuestion._id){
                    newValue = newValue.replace(/(\r\n|\n|\r)/gm," ");
                    $scope.toAddQuestion.text = newValue;
                }

            }, true);
        
            $scope.removeImage = function(image){
                if($scope.toAddQuestion.images && $scope.toAddQuestion.images.length > 0){
                    var iIndex = $scope.toAddQuestion.images.indexOf(image);
                    if(iIndex != -1){
                        $scope.toAddQuestion.images.splice(iIndex, 1);
                    }
                }
            };
            $scope.uploadImage = function (images) {
                
                var nFiles = images.length;
                
                var counter = 0;
                $scope.imageProgess = 0;
                if (images && images.length) {
                    images.forEach(function(thisFile, index){

                        var fileInfo = {
                            filename: thisFile.name,
                            contentType: thisFile.type
                        };
                         ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                        var s3Request = {};
                        var allParams = data.params;
                        for (var key in allParams) {
                          if (allParams.hasOwnProperty(key)) {
                            s3Request[key] = allParams[key];
                          }
                        }
                        s3Request.file = thisFile;
                        Upload.upload({
                            url: data.endpoint_url,
                            data: s3Request
                        }).then(function (resp) {
                                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                                thisFile.link = $(resp.data).find('Location').text();
                                if(!$scope.toAddQuestion.images){
                                    $scope.toAddQuestion.images = [];
                                }
                                $scope.toAddQuestion.images.push(thisFile.link);
                                console.log($scope.toAddQuestion);

                            }, function (resp){
                                console.log('Error status: ' + resp.status);
                            }, function (evt) {
                                $scope.imageProgess = 0;
                                thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                                images.forEach(function(thisPhoto, index){
                                    //console.log(index + ' ' + thisPhoto.uploadProgress + ' ' + nFiles);
                                    if(!thisPhoto.uploadProgress){
                                        thisPhoto.uploadProgress = 0;
                                    }
                                    $scope.imageProgess += thisPhoto.uploadProgress;
                                    //console.log($scope.imageProgess);
                                });
                                $scope.imageProgess = $scope.imageProgess / nFiles;
                                //console.log('progress: ' + thisFile.uploadProgress + '% ' + thisFile.name);
                            });

                        })
                        .error(function (data, status, header, config) {
                            console.log("Error");
                        });   

                    });
                }
             };
            
            $scope.removeSolutionImage = function(question, image){
                if(question.solution.images && question.solution.images.length > 0){
                    var iIndex = question.solution.images.indexOf(image);
                    if(iIndex != -1){
                        question.solution.images.splice(iIndex, 1);
                    }
                }
            };
            
            $scope.uploadSolutionImages = function (question, images) {
                
                var nFiles = images.length;
                
                var counter = 0;
                $scope.imageProgess = 0;
                if (images && images.length) {
                    images.forEach(function(thisFile, index){

                        var fileInfo = {
                            filename: thisFile.name,
                            contentType: thisFile.type
                        };
                         ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                        var s3Request = {};
                        var allParams = data.params;
                        for (var key in allParams) {
                          if (allParams.hasOwnProperty(key)) {
                            s3Request[key] = allParams[key];
                          }
                        }
                        s3Request.file = thisFile;
                        Upload.upload({
                            url: data.endpoint_url,
                            data: s3Request
                        }).then(function (resp) {
                                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                                thisFile.link = $(resp.data).find('Location').text();
                                
                                if(!question.solution.images){
                                    question.solution.images = [];
                                }
                                question.solution.images.push(thisFile.link);

                            }, function (resp){
                                console.log('Error status: ' + resp.status);
                            }, function (evt) {
                                $scope.imageProgess = 0;
                                thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                                images.forEach(function(thisPhoto, index){
                                    //console.log(index + ' ' + thisPhoto.uploadProgress + ' ' + nFiles);
                                    if(!thisPhoto.uploadProgress){
                                        thisPhoto.uploadProgress = 0;
                                    }
                                    $scope.imageProgess += thisPhoto.uploadProgress;
                                    //console.log($scope.imageProgess);
                                });
                                $scope.imageProgess = $scope.imageProgess / nFiles;
                                //console.log('progress: ' + thisFile.uploadProgress + '% ' + thisFile.name);
                            });

                        })
                        .error(function (data, status, header, config) {
                            console.log("Error");
                        });   

                    });
                }
             };
            
            $scope.markSimulate = function(){
                var testIds = [$scope.test._id];
                testService.markSimulate(testIds).success(function (data, status, headers) {
                    Notification.primary({message: "Simulation check resut fetched!",  positionY: 'top', positionX: 'right', delay: 3000});
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                }); 
            };
            
    }]);
    Date.prototype.addDays = function(days) {
        var date = new Date(this.valueOf())
        date.setDate(date.getDate() + days);
        return date;
    }
    function getDateRange(startDate, endDate, addFn, interval) {
        
        addFn = addFn || Date.prototype.addDays;
        interval = interval || 1;
        var retVal = [];
        var current = new Date(startDate);
        var endDate = new Date(endDate);
        while (current <= endDate) {
            //console.log(current);
            retVal.push(new Date(current));
            current = addFn.call(current, interval);
        }
        return retVal;
    }
    exambazaar.controller("officialPapersController", 
        [ '$scope', '$rootScope', '$cookies', 'thisexam', 'ExamService', '$http', '$state', '$mdDialog', '$timeout', 'testService', 'Notification', 'officialPapers', 'officialPapersStreamExam', 'Carousel', 'viewService', '$location', 'screenSize', function($scope, $rootScope, $cookies, thisexam, ExamService, $http, $state, $mdDialog, $timeout, testService, Notification, officialPapers, officialPapersStreamExam, Carousel, viewService, $location, screenSize){
            $scope.slideCount = 2;
            $scope.exam = thisexam.data;
            $scope.defaultCoverPhoto = 'https://www.exambazaar.com/images/generic_question_papers.jpg';
            if($scope.exam.officialpaperscoverphoto && $scope.exam.officialpaperscoverphoto != ''){
                $scope.defaultCoverPhoto = $scope.exam.officialpaperscoverphoto;
            };
            
            
            
            $scope.officialPapers = officialPapers.data;
            $scope.officialPapersStreamExam = officialPapersStreamExam.data;
            var opStreamIds = $scope.officialPapersStreamExam.map(function(a) {return a._id.toString();});
            
            var streamId = $scope.exam.stream._id.toString();
            var sIndex = opStreamIds.indexOf(streamId);
            $scope.thisStream = $scope.officialPapersStreamExam[sIndex];
            
            console.log(streamId);
            console.log($scope.officialPapersStreamExam);
            $scope.years = {
                min: '',
                max: '',
            };
            $scope.examSummary = {
                papers: $scope.officialPapers.length,
                hours: 0,
                questions: 0
            };
            $scope.officialPapers.forEach(function(thisPaper, index){
                $scope.examSummary.hours += Number(thisPaper.duration);
                $scope.examSummary.questions += Number(thisPaper.nQuestions);
                
                thisPaper.durationFormatted = '';
                var hours = Math.floor( thisPaper.duration / 60);
                var minutes = thisPaper.duration % 60;
                if(hours > 0){
                    var hText = 'hours';
                    if(hours == 1){
                        hText = 'hour';
                    }
                    thisPaper.durationFormatted += hours + ' ' + hText;
                }
                if(minutes > 0){
                    thisPaper.durationFormatted += ' and ' + minutes + ' minutes';
                }
                
                var thisYear = thisPaper.year;
                if($scope.years.min == ''){
                    $scope.years.min = thisYear;
                }
                if($scope.years.max == ''){
                    $scope.years.max = thisYear;
                }
                
                if($scope.years.min > thisYear){
                    $scope.years.min = thisYear;
                }
                if($scope.years.max < thisYear){
                    $scope.years.max = thisYear;
                }
                if($scope.years.min == '' || $scope.years.min == ''){
                    $scope.years = null;
                }
                
                if(thisPaper._actualdate){
                    thisPaper.fromnow = moment(thisPaper._actualdate).fromNow();
                }
            });
            $scope.examSummary.hours = $scope.examSummary.hours/60;
            
            $rootScope.pageImage = $scope.defaultCoverPhoto;
            $rootScope.pageTitle = $scope.exam.displayname + " Question Papers | " + $scope.examSummary.papers + " Papers, " + $scope.examSummary.hours + " Hours, " + $scope.examSummary.questions + " Questions";
            var yearString = "years";
            if($scope.years.min && $scope.years.max && $scope.years.min != $scope.years.max){
                yearString = $scope.years.min + ' - ' + $scope.years.max;
            }
            
            
            $rootScope.pageDescription = 'Seal your ' + $scope.exam.seoname + ' preparation by attempting the Official ' + $scope.exam.seoname + ' Papers for ' + yearString + ' in a Live, Timed, Exam Environment for FREE!';
            var keywordString = '';
            var suffix = [' Question Papers ', ' Question Papers PDF ', ' Question Papers & Answers PDF ' , ' Official Papers '];
            
            for(var i = $scope.years.max; i >= $scope.years.min; i--) {
                suffix.forEach(function(thisSuffix, index){
                    var newKeyWord = $scope.exam.seoname + ' ' + i +thisSuffix;
                    keywordString = keywordString + newKeyWord + ', ';
                });
                
                 
            }
            
            $rootScope.pageKeywords = keywordString;
            
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
            }else{
                //$scope.signupNeeded = true;
            }
            var viewForm = {
                state: $state.current.name,
                claim: false,
                url: $location.url()
            };
            if($scope.user && $scope.user.userId){
                viewForm.user = $scope.user.userId;
            }
            if($cookies.getObject('ip')){
                var ip = $cookies.getObject('ip');
                viewForm.ip = ip;
            }
            viewService.saveview(viewForm).success(function (data, status, headers) {
                //console.log('View Marked');
            })
            .error(function (data, status, header, config) {
                console.log('View not saved!');
            });
            
            $scope.userLogin = function(){
                $rootScope.$emit("CallBlogLogin", {});    
            };
            
            
    }]);
    exambazaar.controller("examController", 
        [ '$scope', '$rootScope', '$cookies', 'thisexam', 'ExamService', '$http', '$state', '$mdDialog', '$timeout', 'testService', 'Notification', 'testList', 'thisExamPattern', 'thisExamBooks', 'thisExamDegrees', 'suggestedblogs', 'Carousel', 'targetStudyProviderService', 'viewService', '$location', 'screenSize', function($scope, $rootScope, $cookies, thisexam, ExamService, $http, $state, $mdDialog, $timeout, testService, Notification, testList, thisExamPattern, thisExamBooks, thisExamDegrees, suggestedblogs, Carousel, targetStudyProviderService, viewService, $location, screenSize){
            $scope.slideCount = 2;
            $scope.mobileDevice = false;
            if (screenSize.is('xs, sm')){
                //console.log('Mobile or tablet');
                $scope.mobileDevice = true;
                $scope.slideCount = 1;
            }else{
                //console.log('Laptop');
                $scope.mobileDevice = false;
                $scope.slideCount = 2;
            }
            $scope.components = [
                /*'Overview',*/
                'Contact',
                'Exams',
                'Results',
                'Courses',
                'Photos',
                'Videos',
                'Faculty',
                'Location',
                'Reviews'
            ];
            $scope.exam = thisexam.data;
            $scope.suggestedblogs = suggestedblogs.data;
            var thisExamPattern = thisExamPattern.data;
            var thisExamBooks = thisExamBooks.data;
            var thisExamDegrees = thisExamDegrees.data;
            $scope.exam.tests = testList.data;
            if(thisExamPattern){
                $scope.exam.pattern = thisExamPattern;
            }
            if(thisExamBooks){
                $scope.exam.books = thisExamBooks;
            }
            if(thisExamDegrees && thisExamDegrees.length > 0){
                $scope.exam.examdegrees = thisExamDegrees;
                $scope.examdegrees = thisExamDegrees;
            }
            
            //console.log($scope.suggestedblogs);
            //console.log($scope.exam.examdegrees);
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
            }else{
                //$scope.signupNeeded = true;
            }
            var viewForm = {
                state: $state.current.name,
                claim: false,
                url: $location.url()
            };
            if($scope.user && $scope.user.userId){
                viewForm.user = $scope.user.userId
            }
            //console.log(JSON.stringify(viewForm));
            if($cookies.getObject('ip')){
                var ip = $cookies.getObject('ip');
                viewForm.ip = ip;
            }
            viewService.saveview(viewForm).success(function (data, status, headers) {
                //console.log('View Marked');
            })
            .error(function (data, status, header, config) {
                console.log();
            });
            
            $scope.currCity = null;
            $scope.currCountry = null;
            
            function latlngfromIP(){
                if($cookies.getObject('ip')){
                    var thisIP = $cookies.getObject('ip');
                    //console.log("Using IP to geolocate user");
                    //console.log(thisIP);
                    $scope.currLocation = [thisIP.lat, thisIP.long];
                    $scope.currCity = thisIP.city;
                    $scope.currCountry = thisIP.country;
                    Notification.warning("Exambazaar couldn't locate you with accuracy");
                }
            };
            if (navigator.geolocation) {
              var timeoutVal = 10 * 1000 * 1000;
              navigator.geolocation.getCurrentPosition(
                displayPosition, 
                displayError,
                { enableHighAccuracy: true, timeout: timeoutVal, maximumAge: 0 }
              );
            }
            else {
                alert("Geolocation is not supported by your browser");
                latlngfromIP();
                //use ip info
            }
            
            

            function displayPosition(position) {
                $scope.currLocation = [position.coords.latitude, position.coords.longitude];
                //console.log($scope.currLocation);
            }
            function displayError(error) {
              var errors = { 
                1: 'Permission denied',
                2: 'Position unavailable',
                3: 'Request timeout'
              };
              console.log("Error: " + errors[error.code]);
                //use ip info
                latlngfromIP();
            }
            //suggestedcoachings
            
            $scope.$watch('currLocation', function (newValue, oldValue, scope) {
                if(newValue != null && newValue != ''){
                    
                    if(newValue && newValue.length == 2){
                        $scope.currLatLng = {
                            lat: newValue[0],
                            lng: newValue[1],
                        }
                        
                        var examUserinfo = {
                            exam: $scope.exam._id,
                            userinfo: {
                                user: null,
                                latlng: $scope.currLatLng,
                                city: $scope.currCity,
                                country: $scope.currCountry,
                            },
                        };
                        if($scope.user && $scope.user._id){
                            examUserinfo.userinfo.user = $scope.user._id;
                        }
                        targetStudyProviderService.suggestedcoachings(examUserinfo).success(function (data, status, headers) {
                            $scope.suggestedcoachings = data;
                            //console.log(data);
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                    }
                    
                    
                    
                }
            }, true);
            
            var badgeIconClasses = ['fa fa-user-plus', 'fa fa-bath'];
            var badgeClasses = ['info', 'warning'];
            var badgeIcons = {
                "Registration": "fa fa-user-circle",
                "Admit Card": "fa fa-id-card",
                "Written": "fa fa-pencil",
                "Counselling": "fa fa-users",
                "Interview": "fa fa-black-tie",
            };
            var badgeBackgrounds = {
                "Registration": "warning",
                "Admit Card": "warning",
                "Written": "primary",
                "Counselling": "info",
                "Interview": "primary",
            };
            
            //console.log($scope.user);
            $scope.noUserDownload = function(){
                if(!$scope.user || !$scope.user.userId){
                    $rootScope.$emit("CallShowLogin", {});
                    if($cookies.getObject('sessionuser')){
                        $scope.user = $cookies.getObject('sessionuser');
                    }else{
                        $scope.signupNeeded = true;
                    }
                }
            }
            
            $scope.activeExamCycle = null;
            $scope.exam.cycle.forEach(function(thisCycle, index){
                //console.log(thisCycle);
                if(thisCycle.active){
                    $scope.activeExamCycle = thisCycle;
                }
            });
            
            if(!$scope.activeExamCycle && $scope.exam.cycle && $scope.exam.cycle.length > 0){
                $scope.activeExamCycle = $scope.exam.cycle[$scope.exam.cycle.length-1];
            }
            
            $scope.setCycle = function(examCycle){
                $scope.events = [];
                $scope.activeExamCycle = examCycle;
                if($scope.activeExamCycle){
                    var steps = $scope.activeExamCycle.examSteps;
                    //console.log($scope.activeExamCycle); 
                    steps.forEach(function(thisStep, index){
                        var random = Math.floor(Math.random() * badgeIconClasses.length);
                        var dateRange = thisStep.stepDate.dateRange;
                        var timeRanges = thisStep.stepDate.timeRange;
                        var dateRanges = thisStep.stepDate.dates;
                        var dateArray = thisStep.stepDate.dateArray;
                        
                        var allDay = false;
                        var dateString = '';
                        var timeString = '';
                        var fullString = '';
                        timeRanges.forEach(function(timeRange, index){
                            if(timeRange && timeRange.startTime && timeRange.endTime){
                                if(timeRange.startTime == "00:00" && timeRange.endTime == "23:00"){
                                    allDay = true;
                                }else{
                                    //console.log(timeRange);
                                    if(index > 0){
                                        timeString += " & "
                                    }
                                    timeString += dateRanges[index].name + " (" + timeRange.startTime + " to " + timeRange.endTime + ")";
                                }
                            }
                            if(!timeRange || !timeRange.startTime && !dateRange.endTime){
                                allDay = true;
                            }
                        });
                        
                        if(dateRange && dateRange.startDate && dateRange.endDate){
                            var startDate = moment(dateRange.startDate);
                            var endDate = moment(dateRange.endDate);
                            dateString = "" + moment(startDate).format('DD MMM YYYY');
                           
                            
                            if(compareDates(startDate, endDate) == -1){
                                dateString += " to " + moment(dateRange.endDate).format('DD MMM YYYY');
                            }
                            
                        }
                        if(!dateString || dateString == ''){
                            if(dateArray && dateArray.length > 0){
                                dateArray.forEach(function(thisDate, index){
                                    dateString += moment(thisDate).format('DD MMM YYYY');
                                    if(index == dateArray.length - 2){
                                        dateString += ' & ';
                                    }
                                    if(index < dateArray.length - 2){
                                        dateString += ', ';
                                    }
                                });
                                
                            }
                        }
                        if(allDay){
                            timeString = "All Day ";
                        }
                        fullString = dateString + timeString;
                        var newEvent = {
                            badgeClass: badgeBackgrounds[thisStep.stepType],
                            badgeIconClass: badgeIcons[thisStep.stepType],
                            title: thisStep.stepType,
                            dateString: dateString,
                            timeString: timeString,
                        };
                        //console.log(thisStep);
                        $scope.events.push(newEvent);
                    });   
                }
            };
            $scope.setCycle($scope.activeExamCycle);
            
            
            $scope.goToCoaching = function(provider){
                var coachingForm = {
                    _id: provider._id 
                };
                targetStudyProviderService.showGroupHelperById(coachingForm).success(function (data, status, headers) {
                        var examStream = data;
                        
                        var url = $state.href('showGroup', {categoryName: examStream.stream, subCategoryName: examStream.exam, cityName: examStream.city, groupName: examStream.groupName});
                        window.open(url,'_blank');
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });
            };
            
            
            $rootScope.pageTitle = $scope.exam.displayname + " Exam - All about the Exam - Recommended Readings & Previous Papers";
            $rootScope.pageDescription = $scope.exam.displayname + " Exam - Registration, Syllabus & Brochure, Exam Dates, Pattern, Recommended Preparation Books, Online coaching resources, Recommended Reading, Previous Papers";
            var keyWordString = '';
            var keywordArray = ["Registration",	"Syllabus & Brochure", "Exam Dates", "Pattern", "Recommended Preparation Books", "Online coaching resources", "Recommended Reading", "Previous Papers"];
            var years = ['','2018', '2017', '2016'];
            years.forEach(function(thisYear, yindex){
                keywordArray.forEach(function(thisKeyword, kindex){
                
                    keyWordString += $scope.exam.seoname + ' ' + thisYear + ' ' + thisKeyword + ', ';
                });
            });
            $rootScope.pageKeywords = keyWordString;
    }]);
            
    exambazaar.controller("editExamController", 
        [ '$scope',  'thisexam', 'streamList', 'ExamService', '$http', '$state', '$mdDialog', 'ImageService', 'Upload', '$timeout', 'testService', 'Notification', '$rootScope', '$cookies', 'testList', function($scope, thisexam, streamList, ExamService, $http, $state, $mdDialog, ImageService, Upload, $timeout, testService, Notification, $rootScope, $cookies, testList){
        $scope.exam = thisexam.data;
        $scope.exam.tests = testList.data;
            
        if(!$scope.exam.registration){
            $scope.exam.registration = {
                website: '',
                mode: '',
                fee:{
                    general_obc: '',
                    sc_st_ph: '',
                    females: '',
                    paymentModes: [],
                },
                otherInformation:'',
            };
        }    
        $scope.streams = streamList.data;
        if($cookies.getObject('sessionuser')){
            $scope.user = $cookies.getObject('sessionuser');
        }else{
            $scope.user = null;
        }
        $scope.masterUser = false;
        if($scope.user && $scope.user.userType == 'Master'){
            $scope.masterUser = true;
        }
            
        $rootScope.pageTitle = $scope.exam.displayname;        
        $scope.reload = function(){
            $state.reload();
        };
        
        $scope.resultFormats = [
            "Rank",
            "Percentile",
            "Percentage",
            "Marks",
            "Pass/Fail",
        ];
        $scope.examFrequencies = [
            "Yearly",
            "Half-Yearly",
            "Quarter-Yearly",
            "Monthly",
            "Anytime",
        ];
        $scope.registrationModes = [
            "Online",
            "Offline",
            "Both Online & Offline",
        ];
        $scope.examModes = [
            "Online",
            "Offline",
            "Both Online & Offline",
        ];
        $scope.feePaymentModes = [
            "Netbanking",
            "Credit Card",
            "Debit Card",
            "Wallets",
            "Demand Draft",
            "Challan",
            "Cash",
        ];
        $scope.cycleYears = ["2016","2017","2018","2019","2020"];
        $scope.timeSlots = ["06:00", "06:30", "07:00", "07:30", "08:00", "08:30", "09:00", "09:30", "10:00", "10:30", "11:00", "11:30", "12:00", "12:30", "13:00", "13:30", "14:00", "14:30", "15:00", "15:30", "16:00", "16:30", "17:00", "17:30", "18:00", "18:30", "19:00", "19:30", "20:00", "20:30", "21:00", "21:30", "22:00", "22:30", "23:00", "23:30", "00:00", "00:30", "01:00", "01:30", "02:00", "02:30", "03:00", "03:30", "04:00", "04:30", "05:00", "05:30"];
        $scope.cycleNumbers = ["1","2","3","4","5","6","7","8","9","10","11","12"];
        
        $scope.newOfficialLink = null;   
        $scope.addNewOfficialLink = function(){
            $scope.newOfficialLink = {
                url: '',
                description: '',
            };
        };
        $scope.removeOfficialLink = function(link, index){
            if(index < $scope.exam.links.length ){
                $scope.exam.links.splice(index, 1);
            }
        };
        $scope.removeNewOfficialLink = function(){
            $scope.newOfficialLink = null;
        };
        $scope.saveNewOfficialLink = function(){
            
            if($scope.newOfficialLink.url){
                if(!$scope.exam.links){
                    $scope.exam.links = [];
                }
                $scope.exam.links.push($scope.newOfficialLink);
                console.log('Done');
                $scope.newOfficialLink = null;
            }
        };
        $scope.saveExam = function () {
            //console.log($scope.exam);
            if($scope.exam.examdegrees){
                var degrees = [];
                $scope.exam.examdegrees.forEach(function(thisDegree, index){
                    if(thisDegree != ''){
                        degrees.push(thisDegree);
                    }
                });
                $scope.exam.examdegrees = degrees;
            }
            
            var saveExam = ExamService.saveExam($scope.exam).success(function (data, status, headers) {
                $scope.showSavedDialog();
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
        $scope.showSavedDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#savedDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        $scope.feePaymentModeToggle = function(feePaymentMode){
            var pIndex = $scope.exam.registration.fee.paymentModes.indexOf(feePaymentMode);
            console.log(pIndex);
            if(pIndex == -1){
                $scope.exam.registration.fee.paymentModes.push(feePaymentMode);
                console.log($scope.exam.registration.fee.paymentModes);
            }else{
                $scope.exam.registration.fee.paymentModes.splice(pIndex, 1);
            }
        };
        $scope.feePaymentBadge = function(feePaymentMode){
            var thisClass = "notExistingBage";
            var pIndex = $scope.exam.registration.fee.paymentModes.indexOf(feePaymentMode);
            if(pIndex != -1){
                thisClass = "existingBadge";
            }
            return thisClass;
            
        };
        
        $scope.$watch('exam.exampattern', function (newValue, oldValue, scope) {
            //Do anything with $scope.letters
            if(newValue != null){
                $scope.verifyOTP();
            }
            
        }, true);
        //start of functions for tests
        $scope.toAddTest = null;
        $scope.removeTestConfirm = function(test){
            if(test._id){
                var confirm = $mdDialog.confirm()
                .title('Would you like to delete test titled '+ test.name +'  ?')
                .textContent('You will not be able to recover them after this!')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.removeTest(test);
                }, function() {
                  //nothing
                });   
            }else{
                $scope.cancelNewTest();
            }
        };
        $scope.removeTest = function(test){ 
            testService.removeTest(test._id).success(function (data, status, headers) {
                $scope.toAddTest = null;
                $scope.getExamTests();
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
            
        }; 
        $scope.addNewTest = function(){
            $scope.toAddTest = {
                name: '',
                description: '',
                year: '2016',
                url: {
                    question: null,
                    answer: null,
                },
                screenshots: [],
                exam: $scope.exam._id,
                official: true,
                mockPaper: false,
                solved: false,
                questionWithAnswer: false,
            };
        };
        
        
        $scope.setTest = function(test){
            $scope.toAddTest = test;
        };
        $scope.removeQuestionPaper = function(){
            $scope.toAddTest.url.question = null;
        };
        $scope.removeAnswerKey = function(){
            $scope.toAddTest.url.answer = null;
        };
        $scope.removeScreenshots = function(){
            $scope.toAddTest.screenshots = [];
        };
        $scope.getExamTests = function(){
            testService.getExamTests($scope.exam._id).success(function (data, status, headers) {
            //console.log(data);
                $scope.exam.tests = data;

                if(data && data.length > 0){
                    Notification.success("Great, we have found " + data.length + " tests of " + $scope.exam.displayname);
                    $scope.showSavedDialog();
                $scope.cancelNewTest();
                }else{
                    Notification.warning("Ok, we found no tests of " + $scope.exam.displayname + '. Lets add some!');
                }
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        }
        $scope.saveNewTest = function(){
            testService.saveTest($scope.toAddTest).success(function (data, status, headers) {
                console.log(data);
                $scope.toAddTest = data;
                $scope.getExamTests();
                
                
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
        $scope.cancelNewTest = function(){
            $scope.toAddTest = null;
        };    
            
        //end of functions for tests
        $scope.addDegree = function(){
            if(!$scope.exam.examdegrees){
                $scope.exam.examdegrees = [];
            }
            $scope.exam.examdegrees.push('');
        };
        $scope.removeLastDegree = function(){
            if($scope.exam.examdegrees){
                $scope.exam.examdegrees.pop();
            }
        };    
        
        //start of upload functions
        //upload helper functions for test papers
        $scope.uploadAnswerKey = function (newanswerkey) {
            var answerkey = [newanswerkey];
            var nFiles = answerkey.length;
            
            var counter = 0;
            if (answerkey && answerkey.length) {
            
            answerkey.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            }; 
            ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var answerkeyLink = $(resp.data).find('Location').text();
                $scope.toAddTest.url.answer = answerkeyLink;
                
                
                
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
        };    
        $scope.uploadQuestionPaper = function (newquestionpaper) {
            var questionpaper = [newquestionpaper];
            var nFiles = questionpaper.length;
            
            var counter = 0;
            if (questionpaper && questionpaper.length) {
            
            questionpaper.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            };
            console.log(thisFile);
            console.log(thisFile.size);
            var fileName = fileInfo.filename;
            var splits = fileName.split('.');
            fileName = splits[0];
            ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var questionpaperLink = $(resp.data).find('Location').text();
                $scope.toAddTest.url.question = questionpaperLink;
                $scope.toAddTest.name = fileName;
                }, function (resp) {
                    $scope.respError = resp;
                    console.log($scope.respError);
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    $scope.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                    console.log($scope.uploadProgress);
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
        };
        $scope.uploadOPCoverPhoto = function (newcoverphoto) {
            var coverphoto = [newcoverphoto];
            var nFiles = coverphoto.length;
            
            var counter = 0;
            if (coverphoto && coverphoto.length) {
            
            coverphoto.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var coverphotoLink = $(resp.data).find('Location').text();
                
                var newCoverPhotoForm ={
                    coverphoto: coverphotoLink,
                    examId: $scope.exam._id
                };
                
                if(newCoverPhotoForm.examId){
                    ExamService.addCoverPhoto(newCoverPhotoForm).success(function (data, status, headers) {
                        counter = counter + 1;
                        $scope.showSavedDialog();
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                }else{
                    $scope.saveExamFirstDialog();
                }
                
                
                
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
        };
            
        $scope.uploadLogo = function (newlogo) {
            var logo = [newlogo];
            var nFiles = logo.length;
            
            var counter = 0;
            if (logo && logo.length) {
            
            logo.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var logoLink = $(resp.data).find('Location').text();
                
                var newLogoForm ={
                    logo: logoLink,
                    examId: $scope.exam._id
                };
                
                if(newLogoForm.examId){
                    ExamService.addLogo(newLogoForm).success(function (data, status, headers) {
                        counter = counter + 1;
                        $scope.showSavedDialog();
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                }else{
                    $scope.saveExamFirstDialog();
                }
                
                
                
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
        };
            
        $scope.uploadScreenshots = function (photos) {
            var nFiles = photos.length;
            var counter = 0;
            $scope.photoProgess = 0;
            if (photos && photos.length) {
                photos.forEach(function(thisFile, index){

                    var fileInfo = {
                        filename: thisFile.name,
                        contentType: thisFile.type
                    };
                     ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                    var s3Request = {};
                    var allParams = data.params;
                    for (var key in allParams) {
                      if (allParams.hasOwnProperty(key)) {
                        s3Request[key] = allParams[key];
                      }
                    }
                    s3Request.file = thisFile;
                    Upload.upload({
                        url: data.endpoint_url,
                        data: s3Request
                    }).then(function (resp) {
                            console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                            thisFile.link = $(resp.data).find('Location').text();
                        
                            $scope.toAddTest.screenshots.push(thisFile.link);

                        }, function (resp) {
                            console.log('Error status: ' + resp.status);
                        }, function (evt) {
                            $scope.photoProgess = 0;
                            thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                            photos.forEach(function(thisPhoto, index){
                                console.log(index + ' ' + thisPhoto.uploadProgress + ' ' + nFiles);
                                if(!thisPhoto.uploadProgress){
                                    thisPhoto.uploadProgress = 0;
                                }
                                $scope.photoProgess += thisPhoto.uploadProgress;
                                //console.log($scope.photoProgess);
                            });
                            $scope.photoProgess = $scope.photoProgess / nFiles;
                            //console.log('progress: ' + thisFile.uploadProgress + '% ' + thisFile.name);
                        });

                    })
                    .error(function (data, status, header, config) {
                        console.log("Error");
                    });   

                });
            }
         };
            
        //upload helper functions for exam cycles  
        $scope.uploadSyllabus = function (syllabuses) {
            var nFiles = syllabuses.length;
            var counter = 0;
            if (syllabuses && syllabuses.length) {
                syllabuses.forEach(function(thisFile, index){

                    var fileInfo = {
                        filename: thisFile.name,
                        contentType: thisFile.type
                    };
                     ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                    var s3Request = {};
                    var allParams = data.params;
                    for (var key in allParams) {
                      if (allParams.hasOwnProperty(key)) {
                        s3Request[key] = allParams[key];
                      }
                    }
                    s3Request.file = thisFile;
                    Upload.upload({
                        url: data.endpoint_url,
                        data: s3Request
                    }).then(function (resp) {
                            console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                            thisFile.link = $(resp.data).find('Location').text();
                        
                           var newSyllabus = {
                                name: '',
                                description: '',
                                url: thisFile.link,
                            };
                            $scope.newExamCycle.syllabus.push(newSyllabus);

                        }, function (resp) {
                            console.log('Error status: ' + resp.status);
                        }, function (evt) {
                            
                        });

                    })
                    .error(function (data, status, header, config) {
                        console.log("Error");
                    });   

                });
            }
         };
        $scope.uploadDocs = function (docs) {
            var nFiles = docs.length;
            var counter = 0;
            if (docs && docs.length) {
                docs.forEach(function(thisFile, index){

                    var fileInfo = {
                        filename: thisFile.name,
                        contentType: thisFile.type
                    };
                     ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                    var s3Request = {};
                    var allParams = data.params;
                    for (var key in allParams) {
                      if (allParams.hasOwnProperty(key)) {
                        s3Request[key] = allParams[key];
                      }
                    }
                    s3Request.file = thisFile;
                    Upload.upload({
                        url: data.endpoint_url,
                        data: s3Request
                    }).then(function (resp) {
                            console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                            thisFile.link = $(resp.data).find('Location').text();
                        
                           var newDoc = {
                                name: '',
                                description: '',
                                url: thisFile.link,
                            };
                            if(!$scope.newExamCycle.docs){
                                $scope.newExamCycle.docs = [];
                            }
                            $scope.newExamCycle.docs.push(newDoc);

                        }, function (resp) {
                            console.log('Error status: ' + resp.status);
                        }, function (evt) {
                            
                        });

                    })
                    .error(function (data, status, header, config) {
                        console.log("Error");
                    });   

                });
            }
         };
        $scope.uploadBrochure = function (brochures) {
            var nFiles = brochures.length;
            var counter = 0;
            $scope.photoProgess = 0;
            if (brochures && brochures.length) {
                brochures.forEach(function(thisFile, index){

                    var fileInfo = {
                        filename: thisFile.name,
                        contentType: thisFile.type
                    };
                     ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                    var s3Request = {};
                    var allParams = data.params;
                    for (var key in allParams) {
                      if (allParams.hasOwnProperty(key)) {
                        s3Request[key] = allParams[key];
                      }
                    }
                    s3Request.file = thisFile;
                    Upload.upload({
                        url: data.endpoint_url,
                        data: s3Request
                    }).then(function (resp) {
                            console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                            thisFile.link = $(resp.data).find('Location').text();
                        
                           var newBrochure = {
                                name: '',
                                description: '',
                                url: thisFile.link,
                            };
                            $scope.newExamCycle.brochure.push(newBrochure);

                        }, function (resp) {
                            console.log('Error status: ' + resp.status);
                        }, function (evt) {
                            $scope.photoProgess = 0;
                            thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                            brochures.forEach(function(thisBrochure, index){
                                console.log(index + ' ' + thisBrochure.uploadProgress + ' ' + nFiles);
                                if(!thisBrochure.uploadProgress){
                                    thisBrochure.uploadProgress = 0;
                                }
                                $scope.photoProgess += thisBrochure.uploadProgress;
                                //console.log($scope.photoProgess);
                            });
                            $scope.photoProgess = $scope.photoProgess / nFiles;
                            //console.log('progress: ' + thisFile.uploadProgress + '% ' + thisFile.name);
                        });

                    })
                    .error(function (data, status, header, config) {
                        console.log("Error");
                    });   

                });
            }
         };    
        //end of upload functions
        
            
        $scope.newExamCycle = null;   
        $scope.addNewExamCycle = function(){
            
            $scope.newExamCycle = {
                year: '2018',
                cycleNumber: '1',
                name: '',
                description: '',
                brochure: [],
                syllabus: [],
                docs: [],
                active: false,
                examMode: false,
                studentsAppearing: '',
                studentSeats: '',
                steps: {
                    registration: false,
                    admitCard: false,
                    examDate: false,
                    writtenResultDate: false,
                    counselling: false,
                    interview: false,
                    finalResultDate: false,
                    text: ''
                },
                examdates:{
                    registration:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        endwithlatefees: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    admitCard:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    examDate:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    writtenResultDate:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    counselling:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    interview:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    finalResultDate:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                },
            };
        };
            
        $scope.cancelNewExamCycle = function(){
            $scope.newExamCycle = null;
        };
        $scope.setExamCycle = function(cycle){
            $scope.newExamCycle = cycle;
            //console.log(cycle);
        };
            
        $scope.stepTypes = ["Registration", "Admit Card", "Written", "Counselling", "Interview"];
        $scope.writtenStepNames = ["Prelims", "Mains", "Other"];    
        $scope.newExamStep = null;
        var today = moment();
        $scope.toAddDate = new Date();
        $scope.toAddDate.setUTCHours(0,0,0,0);
        var today = new Date();
        today.setUTCHours(0,0,0,0);
        $scope.toAddTimeRange = null;
        $scope.addNewExamStep = function(newExamCycle){
            $scope.newExamStep = {
                name: 'Prelims',
                description: '',
                stepType: 'Written', //Written, Counselling, Interview
                otherName: '',
                stepDate:{
                    dateRangeBool: true,
                    timeRangeBool: true,
                    dateRange:{
                        startDate: today,
                        endDate: today,
                    },
                    dateArray:[],
                    timeRange:[],
                    dates:[],
                    allDates:[],
                },
            };
            
            if(!newExamCycle.examSteps){
                newExamCycle.examSteps = [];
            }
            newExamCycle.examSteps.push($scope.newExamStep);
            $scope.toAddTimeRange = $scope.newExamStep.stepDate.timeRange[0];
            console.log($scope.toAddTimeRange);
        };
            //"Registration", "Admit Card", "Written", "Counselling", "Interview"
        $scope.addRegistration = function(newExamCycle){
            $scope.newExamStep = {
                name: '',
                description: '',
                stepType: 'Registration', //Written, Counselling, Interview
                otherName: '',
                stepDate:{
                    dateRangeBool: true,
                    timeRangeBool: true,
                    dateRange:{
                        startDate: today,
                        endDate: today,
                    },
                    dateArray:[],
                    timeRange:[],
                    dates:[],
                    allDates:[],
                },
            };
            if(!newExamCycle.examSteps){
                newExamCycle.examSteps = [];
            }
            newExamCycle.examSteps.push($scope.newExamStep);
        };
        $scope.addAdmitCard = function(newExamCycle){
            $scope.newExamStep = {
                name: '',
                description: '',
                stepType: 'Admit Card', //Written, Counselling, Interview
                otherName: '',
                stepDate:{
                    dateRangeBool: true,
                    timeRangeBool: true,
                    dateRange:{
                        startDate: today,
                        endDate: today,
                    },
                    dateArray:[],
                    timeRange:[],
                    dates:[],
                    allDates:[],
                },
            };
            if(!newExamCycle.examSteps){
                newExamCycle.examSteps = [];
            }
            newExamCycle.examSteps.push($scope.newExamStep);
        };
        $scope.addWritten = function(newExamCycle){
            $scope.newExamStep = {
                name: '',
                description: '',
                stepType: 'Written', //Written, Counselling, Interview
                otherName: '',
                stepDate:{
                    dateRangeBool: true,
                    timeRangeBool: true,
                    dateRange:{
                        startDate: today,
                        endDate: today,
                    },
                    dateArray:[],
                    timeRange:[],
                    dates:[],
                    allDates:[],
                },
            };
            if(!newExamCycle.examSteps){
                newExamCycle.examSteps = [];
            }
            newExamCycle.examSteps.push($scope.newExamStep);
        };
        $scope.addCounselling = function(newExamCycle){
            $scope.newExamStep = {
                name: '',
                description: '',
                stepType: 'Counselling', //Written, Counselling, Interview
                otherName: '',
                stepDate:{
                    dateRangeBool: true,
                    timeRangeBool: true,
                    dateRange:{
                        startDate: today,
                        endDate: today,
                    },
                    dateArray:[],
                    timeRange:[],
                    dates:[],
                    allDates:[],
                },
            };
            if(!newExamCycle.examSteps){
                newExamCycle.examSteps = [];
            }
            newExamCycle.examSteps.push($scope.newExamStep);
        };
        $scope.addInterview = function(newExamCycle){
            $scope.newExamStep = {
                name: '',
                description: '',
                stepType: 'Interview', //Written, Counselling, Interview
                otherName: '',
                stepDate:{
                    dateRangeBool: true,
                    timeRangeBool: true,
                    dateRange:{
                        startDate: today,
                        endDate: today,
                    },
                    dateArray:[],
                    timeRange:[],
                    dates:[],
                    allDates:[],
                },
            };
            if(!newExamCycle.examSteps){
                newExamCycle.examSteps = [];
            }
            newExamCycle.examSteps.push($scope.newExamStep);
        };
            
        $scope.moveStepBefore = function(newExamCycle, $index){
            var nLength = newExamCycle.examSteps.length;
            if($index > 0){
                var stepBefore = newExamCycle.examSteps[$index - 1];
                var thisStep = newExamCycle.examSteps[$index];
                newExamCycle.examSteps[$index - 1] = thisStep;
                newExamCycle.examSteps[$index] = stepBefore;
            }
        };
        $scope.moveStepAfter = function(newExamCycle, $index){
            var nLength = newExamCycle.examSteps.length;
            if($index < nLength-1){
                var stepAfter = newExamCycle.examSteps[$index + 1];
                var thisStep = newExamCycle.examSteps[$index];
                newExamCycle.examSteps[$index + 1] = thisStep;
                newExamCycle.examSteps[$index] = stepAfter;
            }
        };
        
        $scope.addNewExamDate = function(newExamCycle, toAddDate){
            if(!$scope.newExamStep.stepDate.dateArray){
                $scope.newExamStep.stepDate.dateArray = [];
            }
            toAddDate.setUTCHours(0,0,0,0);
            console.log(toAddDate);
            $scope.newExamStep.stepDate.dateArray.push(toAddDate);
            $scope.buildSlots();
        };
        $scope.addNewTimeRange = function(newExamCycle, toAddTimeRange){
            if(!$scope.newExamStep.stepDate.timeRange){
                $scope.newExamStep.stepDate.timeRange = [];
            }
            var exists = false;
            var overlaps = false;
            $scope.newExamStep.stepDate.timeRange.forEach(function(thisRange, rindex){
                if(thisRange.startTime == toAddTimeRange.startTime && thisRange.endTime == toAddTimeRange.endTime){
                   exists = true;
                }
                
                var trst = $scope.timeSlots.indexOf(thisRange.startTime);
                var tret = $scope.timeSlots.indexOf(thisRange.endTime);
                var tast = $scope.timeSlots.indexOf(toAddTimeRange.startTime);
                var taet = $scope.timeSlots.indexOf(toAddTimeRange.endTime);
                
                if(trst < tast && tret > tast){
                    overlaps = true;
                }
                if(trst < taet && tret > taet){
                    overlaps = true;
                }
            });
            if(!exists && !overlaps){
                var newTimeRange = {
                    startTime: toAddTimeRange.startTime,
                    endTime: toAddTimeRange.endTime,
                }
                $scope.newExamStep.stepDate.timeRange.push(newTimeRange);
                Notification.success("Time slot added successfully!");
                
            }else{
                if(exists){
                    Notification.warning("Did not add this time slot, as it already exists!");
                }
                if(overlaps){
                    Notification.warning("Did not add this time slot, as it overlaps with an existing timeslot!");
                }
            }
            
            $scope.buildSlots();
            
        };
        
        $scope.removeExamDate = function(index){
            if(index < $scope.newExamStep.stepDate.allDates.length){
                $scope.newExamStep.stepDate.allDates.splice(index, 1); 
            }
        };
        
        $scope.removeTimeRange = function(index){
            if(index < $scope.newExamStep.stepDate.timeRange.length){
                $scope.newExamStep.stepDate.timeRange.splice(index, 1); 
            }
        };
        $scope.removeDates = function(index){
            if(index < $scope.newExamStep.stepDate.dates.length){
                $scope.newExamStep.stepDate.dates.splice(index, 1); 
            }
        };
            
        $scope.buildSlots = function(){
            var allDates = $scope.newExamStep.stepDate.allDates;
            var timeRange = $scope.newExamStep.stepDate.timeRange;
            
            if(allDates.length > 0 && timeRange.length > 0){
                $scope.newExamStep.stepDate.dates = [];
                allDates.forEach(function(thisDate, dindex){
                    timeRange.forEach(function(thisRange, tindex){
                        var startTime = thisRange.startTime;
                        var endTime = thisRange.endTime;
                        var startDateTime = new Date(thisDate);
                        var endDateTime = new Date(thisDate);
                        
                        if(startTime){
                            var res = startTime.split(":");
                            var hours = res[0];
                            var minutes = res[1];
                            startDateTime.setHours(hours);
                            startDateTime.setMinutes(minutes);
                        }
                        if(endTime){
                            var res = endTime.split(":");
                            var hours = res[0];
                            var minutes = res[1];
                            endDateTime.setHours(hours);
                            endDateTime.setMinutes(minutes);
                        }
                        var newDate = {
                            start: startDateTime,
                            end: endDateTime,
                            name: '',
                        };
                        $scope.newExamStep.stepDate.dates.push(newDate);
                    });
                });
            }
            //console.log($scope.newExamStep.stepDate.dates);
        };
        $scope.$watch('newExamStep.stepDate.dateRange', function (newValue, oldValue, scope) {
            if(newValue != null){
                if($scope.newExamStep.stepDate.dateRangeBool){
                    var dateRange = getDateRange($scope.newExamStep.stepDate.dateRange.startDate, $scope.newExamStep.stepDate.dateRange.endDate);
                    $scope.newExamStep.stepDate.allDates = dateRange;
                }
            }

        }, true);
            
        $scope.$watch('newExamStep.stepDate.timeRangeBool', function (newValue, oldValue, scope) {
            if(newValue != null){
                if(newValue == true){
                    $scope.newExamStep.stepDate.timeRange = [{
                        startTime: '00:00',
                        endTime: '23:00',
                    }];
                }else{
                   if($scope.newExamStep.stepDate.timeRange){
                       //console.log($scope.newExamStep.stepDate.timeRange);
                       $scope.newExamStep.stepDate.timeRange.forEach(function(thisRange, rindex){
                           if(thisRange.startTime == "00:00" && thisRange.endTime == "23:00"){
                               $scope.newExamStep.stepDate.timeRange.splice(rindex, 1);
                           }
                       });
                   }
                }

            }

        }, true);
            
        $scope.$watch('newExamStep.stepDate.dateRangeBool', function (newValue, oldValue, scope) {
            if(newValue != null){
                if(newValue == true){
                    if(!$scope.newExamStep.stepDate.dateRange.startDate){
                        $scope.newExamStep.stepDate.dateRange.startDate = new Date();
                        $scope.newExamStep.stepDate.dateRange.startDate.setUTCHours(0,0,0,0);
                    }
                    if(!$scope.newExamStep.stepDate.dateRange.endDate){
                        $scope.newExamStep.stepDate.dateRange.endDate = new Date();
                        $scope.newExamStep.stepDate.dateRange.endDate.setUTCHours(0,0,0,0);
                    }
                    var dateRange = getDateRange($scope.newExamStep.stepDate.dateRange.startDate, $scope.newExamStep.stepDate.dateRange.endDate);
                    
                    $scope.newExamStep.stepDate.allDates = dateRange;
                    
                    $scope.newExamStep.stepDate.dateArray = [];
                    
                }else{
                    $scope.newExamStep.stepDate.dates = [];
                    $scope.newExamStep.stepDate.allDates = [];
                    $scope.newExamStep.stepDate.dateRange.startDate = null;
                    $scope.newExamStep.stepDate.dateRange.endDate = null;
                    if(!$scope.newExamStep.stepDate.dateArray){
                        $scope.newExamStep.stepDate.dateArray = [];
                    }
                    $scope.newExamStep.stepDate.allDates = $scope.newExamStep.stepDate.dateArray;
                    $scope.buildSlots();
                    //$scope.newExamStep.stepDate.dateArray = [];
                }

            }

        }, true);
        $scope.setExamStep = function(examStep){
            $scope.newExamStep = examStep;
            //console.log(examStep);
        };
        $scope.removeExamStep = function(newExamCycle, index){
            if(index < newExamCycle.examSteps.length){
                newExamCycle.examSteps.splice(index, 1);
            }
            
            //console.log(examStep);
        };
            
        $scope.saveNewExamCycle = function(){
            
            if(!$scope.exam.cycle){
               $scope.exam.cycle = [];
            }
            var examCylceIds = $scope.exam.cycle.map(function(a) {return a._id;});
            var examCycleNames = $scope.exam.cycle.map(function(a) {return a.name;});
            if($scope.newExamCycle._id){
                console.log($scope.newExamCycle);
                
                var cIndex = examCylceIds.indexOf($scope.newExamCycle._id);
                if(cIndex != -1){
                    $scope.exam.cycle[cIndex] = $scope.newExamCycle;
                }else{
                    $scope.exam.cycle.push($scope.newExamCycle);
                }
            }else{
                var thisCycleName = $scope.newExamCycle.name;
                var cIndex = examCycleNames.indexOf(thisCycleName);
                if(cIndex != -1){
                    $scope.exam.cycle[cIndex] = $scope.newExamCycle;
                }else{
                    $scope.exam.cycle.push($scope.newExamCycle);
                }
            }
            //$scope.showSavedDialog();
            $scope.cancelNewExamCycle();
        };
            
            
        $scope.removeExamCycleConfirm = function(examcycle){
            if(examcycle._id){
                var confirm = $mdDialog.confirm()
                .title('Would you like to delete exam cycle titled '+ examcycle.name +'  ?')
                .textContent('You will not be able to recover them after this!')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.removeExamCycle(examcycle);
                }, function() {
                  //nothing
                });   
            }else{
                $scope.cancelNewExamCycle();
            }
        };
        $scope.removeExamCycle = function(examcycle){ 
            if(!$scope.exam.cycle){
               $scope.exam.cycle = [];
            }
            var examCylceIds = $scope.exam.cycle.map(function(a) {return a._id;});
            var examCycleNames = $scope.exam.cycle.map(function(a) {return a.name;});
            if($scope.newExamCycle._id){
                var cIndex = examCylceIds.indexOf($scope.newExamCycle._id);
                if(cIndex != -1){
                    $scope.exam.cycle.splice(cIndex);
                }else{
                    //$scope.exam.cycle.push($scope.newExamCycle);
                }
            }else{
                var thisCycleName = $scope.newExamCycle.name;
                var cIndex = examCycleNames.indexOf(thisCycleName);
                if(cIndex != -1){
                    $scope.exam.cycle.splice(cIndex);
                }else{
                    //$scope.exam.cycle.push($scope.newExamCycle);
                }
            }
            //$scope.showSavedDialog();
            $scope.cancelNewExamCycle();
            
            
        }; 
        
            
        $scope.removeSyllabus = function(syllabus){
            var syllabusIds = $scope.newExamCycle.syllabus.map(function(a) {return a.url;});
            var sIndex = syllabusIds.indexOf(syllabus.url);
            if(sIndex!= -1){
                $scope.newExamCycle.syllabus.splice(sIndex,1);
            }
        };    
    }]);
        
        
        
    exambazaar.controller("addExamController", 
        [ '$scope',  'examList', 'streamList', 'ExamService', '$http', '$state', '$mdDialog', 'ImageService', 'Upload', '$timeout', 'testService', 'Notification', '$rootScope', '$cookies', 'questionService', function($scope, examList, streamList, ExamService, $http, $state, $mdDialog, ImageService, Upload, $timeout, testService, Notification, $rootScope, $cookies, questionService){
        $scope.masteruser = null;
        if($cookies.getObject('sessionuser')){
            $scope.user = $cookies.getObject('sessionuser');
            if($scope.user.userType == 'Master'){
                $scope.masteruser = true;
            }

        }else{
            $scope.user = null;
        }
        
        $scope.changeQuestionUsers = function(){
                
            questionService.changeUser().success(function (data, status, headers) {
                if(data){
                    Notification.success("Done!");
                }else{
                    console.log('Error');
                }
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $rootScope.pageTitle = 'All Exams listed on EB';        
        $scope.exams = examList.data;
        $scope.streams = streamList.data;
        $scope.showAllExams = true;    
        $scope.resultFormats = [
            "Rank",
            "Percentile",
            "Percentage",
            "Marks",
            "Pass/Fail",
        ];
        $scope.examFrequencies = [
            "Yearly",
            "Half-Yearly",
            "Quarter-Yearly",
            "Monthly",
            "Anytime",
        ];
        $scope.cycleYears = ["2016","2017","2018","2019","2020"];
        
        $scope.cycleNumbers = ["1","2","3","4","5","6","7","8","9","10","11","12"];
            
        $scope.$watch('exam.frequency', function (newValue, oldValue, scope) {
            if(newValue != null && newValue != ''){
                if(newValue == 'Yearly'){
                    $scope.cycleNumbers = ["1"];
                }
                if(newValue == 'Half-Yearly'){
                    $scope.cycleNumbers = ["1","2"];
                }
                if(newValue == 'Quarter-Yearly'){
                    $scope.cycleNumbers = ["1","2","3","4"];
                }
                if(newValue == 'Monthly'){
                    $scope.cycleNumbers = ["1","2","3","4","5","6","7","8","9","10","11","12"];
                }
                if(newValue == 'Anytime'){
                    $scope.cycleNumbers = ["N/A"];
                    
                }
                
            }

            }, true);    
        $scope.addNewExam = function(){
            $scope.showAllExams = false;
            $scope.exam = {
                
            };
        }; 
        $scope.addExam = function () {
            var saveExam = ExamService.saveExam($scope.exam).success(function (data, status, headers) {
                $scope.showSavedDialog();
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
            
        $scope.setExam = function(exam){
            $scope.showAllExams = false;
            $scope.exam = exam;
            if(!$scope.exam.logo){
                $scope.exam.logo = '';
            }
            testService.getExamTests($scope.exam._id).success(function (data, status, headers) {
                //console.log(data);
                $scope.exam.tests = data;
                
                if(data && data.length > 0){
                    Notification.success("Great, we have found " + data.length + " tests of " + $scope.exam.displayname);
                }else{
                    Notification.warning("Ok, we found no tests of " + $scope.exam.displayname + '. Lets add some!');
                }
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
        $scope.unsetExam = function(){
            $scope.showAllExams = true;
            $scope.exam = null;
            $scope.toAddTest = null;
            $scope.newExamCycle = null;
        };
        $scope.showSavedDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#savedDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        $scope.saveExamFirstDialog = function(ev) {
            $mdDialog.show({
              contentElement: '#saveExamFirstDialog',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
            $timeout(function(){
                $mdDialog.cancel();
            },1000)
        };
        $scope.toAddTest = null;
        $scope.removeTestConfirm = function(test){
            if(test._id){
                var confirm = $mdDialog.confirm()
                .title('Would you like to delete test titled '+ test.name +'  ?')
                .textContent('You will not be able to recover them after this!')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.removeTest(test);
                }, function() {
                  //nothing
                });   
            }else{
                $scope.cancelNewTest();
            }
        };
        $scope.removeTest = function(test){ 
            testService.removeTest(test._id).success(function (data, status, headers) {
                $scope.toAddTest = null;
                $scope.showSavedDialog();
                $scope.setExam($scope.exam);
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
            
        };
        $scope.addNewTest = function(){
            $scope.toAddTest = {
                name: '',
                description: '',
                year: '2016',
                url: {
                    question: null,
                    answer: null,
                },
                screenshots: [],
                exam: $scope.exam._id,
                official: true,
                mockPaper: false,
                solved: false,
                questionWithAnswer: false,
            };
        };
        
        
        $scope.setTest = function(test){
            $scope.toAddTest = test;
        };
        $scope.removeQuestionPaper = function(){
            $scope.toAddTest.url.question = null;
        };
        $scope.removeAnswerKey = function(){
            $scope.toAddTest.url.answer = null;
        };
        $scope.removeScreenshots = function(){
            $scope.toAddTest.screenshots = [];
        };
        $scope.saveNewTest = function(){
            testService.saveTest($scope.toAddTest).success(function (data, status, headers) {
                console.log(data);
                $scope.toAddTest = data;
                $scope.showSavedDialog();
                $scope.cancelNewTest();
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
        $scope.cancelNewTest = function(){
            $scope.toAddTest = null;
            $scope.setExam($scope.exam);
        };
        
        $scope.newOfficialLink = null;   
        $scope.addNewOfficialLink = function(){
            $scope.newOfficialLink = {
                url: '',
                description: '',
            };
        };
        $scope.saveNewOfficialLink = function(){
            
            if($scope.newOfficialLink.url){
                if(!$scope.exam.links){
                    $scope.exam.links = [];
                }
                $scope.exam.links.push($scope.newOfficialLink);
                console.log('Done');
                $scope.newOfficialLink = null;
            }
            
        };
            
        $scope.newExamCycle = null;   
        $scope.addNewExamCycle = function(){
            
            $scope.newExamCycle = {
                year: '2018',
                cycleNumber: '1',
                name: '',
                description: '',
                brochure: [],
                syllabus: [],
                docs: [],
                active: false,
                examMode: false,
                studentsAppearing: '',
                studentSeats: '',
                steps: {
                    registration: false,
                    admitCard: false,
                    examDate: false,
                    writtenResultDate: false,
                    counselling: false,
                    interview: false,
                    finalResultDate: false,
                    text: ''
                },
                examdates:{
                    registration:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        endwithlatefees: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    admitCard:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    examDate:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    writtenResultDate:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    counselling:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    interview:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                    finalResultDate:{
                        start: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        end: {
                            _date: new Date(),
                            tentative: false,
                            applicable: false,
                        },
                        text: '',
                    },
                },
            };
        };
            
        $scope.cancelNewExamCycle = function(){
            $scope.newExamCycle = null;
            $scope.setExam($scope.exam);
        };
        $scope.setExamCycle = function(cycle){
            $scope.newExamCycle = cycle;
            //console.log(cycle);
        };
        $scope.saveNewExamCycle = function(){
            
            if(!$scope.exam.cycle){
               $scope.exam.cycle = [];
            }
            var examCylceIds = $scope.exam.cycle.map(function(a) {return a._id;});
            var examCycleNames = $scope.exam.cycle.map(function(a) {return a.name;});
            if($scope.newExamCycle._id){
                var cIndex = examCylceIds.indexOf($scope.newExamCycle._id);
                if(cIndex != -1){
                    $scope.exam.cycle[cIndex] = $scope.newExamCycle;
                }else{
                    $scope.exam.cycle.push($scope.newExamCycle);
                }
            }else{
                var thisCycleName = $scope.newExamCycle.name;
                var cIndex = examCycleNames.indexOf(thisCycleName);
                if(cIndex != -1){
                    $scope.exam.cycle[cIndex] = $scope.newExamCycle;
                }else{
                    $scope.exam.cycle.push($scope.newExamCycle);
                }
            }
            //$scope.showSavedDialog();
            $scope.cancelNewExamCycle();
        };
            
            
        $scope.removeExamCycleConfirm = function(examcycle){
            if(examcycle._id){
                var confirm = $mdDialog.confirm()
                .title('Would you like to delete exam cycle titled '+ examcycle.name +'  ?')
                .textContent('You will not be able to recover them after this!')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.removeExamCycle(examcycle);
                }, function() {
                  //nothing
                });   
            }else{
                $scope.cancelNewExamCycle();
            }
        };
        $scope.removeExamCycle = function(examcycle){ 
            if(!$scope.exam.cycle){
               $scope.exam.cycle = [];
            }
            var examCylceIds = $scope.exam.cycle.map(function(a) {return a._id;});
            var examCycleNames = $scope.exam.cycle.map(function(a) {return a.name;});
            if($scope.newExamCycle._id){
                var cIndex = examCylceIds.indexOf($scope.newExamCycle._id);
                if(cIndex != -1){
                    $scope.exam.cycle.splice(cIndex);
                }else{
                    //$scope.exam.cycle.push($scope.newExamCycle);
                }
            }else{
                var thisCycleName = $scope.newExamCycle.name;
                var cIndex = examCycleNames.indexOf(thisCycleName);
                if(cIndex != -1){
                    $scope.exam.cycle.splice(cIndex);
                }else{
                    //$scope.exam.cycle.push($scope.newExamCycle);
                }
            }
            //$scope.showSavedDialog();
            $scope.cancelNewExamCycle();
            
            
        }; 
            
        $scope.removeBrochure = function(brochure){
            var brochureIds = $scope.newExamCycle.brochure.map(function(a) {return a.url;});
            var bIndex = brochureIds.indexOf(brochure.url);
            if(bIndex!= -1){
                $scope.newExamCycle.brochure.splice(bIndex,1);
            }
        };
        
        $scope.registrationText = function(ev) {
            $mdDialog.show({
              contentElement: '#registrationText',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.admitCardText = function(ev) {
            $mdDialog.show({
              contentElement: '#admitCardText',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.examDateText = function(ev) {
            $mdDialog.show({
              contentElement: '#examDateText',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.writtenResultDateText = function(ev) {
            $mdDialog.show({
              contentElement: '#writtenResultDateText',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.counsellingText = function(ev) {
            $mdDialog.show({
              contentElement: '#counsellingText',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.interviewText = function(ev) {
            $mdDialog.show({
              contentElement: '#interviewText',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
        $scope.finalResultDateText = function(ev) {
            $mdDialog.show({
              contentElement: '#finalResultDateText',
              parent: angular.element(document.body),
              targetEvent: ev,
              clickOutsideToClose: true
            });
        };
            
        $scope.removeSyllabus = function(syllabus){
            console.log(syllabus);
            var syllabusIds = $scope.newExamCycle.syllabus.map(function(a) {return a.url;});
            console.log(syllabusIds);
            var sIndex = syllabusIds.indexOf(syllabus.url);
            if(sIndex!= -1){
                $scope.newExamCycle.syllabus.splice(sIndex,1);
            }
        };
          
        $scope.removeDoc = function(doc){
            var docIds = $scope.newExamCycle.docs.map(function(a) {return a.url;});
            var dIndex = docIds.indexOf(doc.url);
            if(dIndex!= -1){
                $scope.newExamCycle.docs.splice(dIndex,1);
            }
        };    
        //upload helper functions for test papers
        $scope.uploadAnswerKey = function (newanswerkey) {
            var answerkey = [newanswerkey];
            var nFiles = answerkey.length;
            
            var counter = 0;
            if (answerkey && answerkey.length) {
            
            answerkey.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            }; 
            ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var answerkeyLink = $(resp.data).find('Location').text();
                $scope.toAddTest.url.answer = answerkeyLink;
                
                
                
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
        };    
        $scope.uploadQuestionPaper = function (newquestionpaper) {
            var questionpaper = [newquestionpaper];
            var nFiles = questionpaper.length;
            
            var counter = 0;
            if (questionpaper && questionpaper.length) {
            
            questionpaper.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            };
            console.log(thisFile);
            console.log(thisFile.size);
            var fileName = fileInfo.filename;
            var splits = fileName.split('.');
            fileName = splits[0];
            ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var questionpaperLink = $(resp.data).find('Location').text();
                $scope.toAddTest.url.question = questionpaperLink;
                $scope.toAddTest.name = fileName;
                }, function (resp) {
                    $scope.respError = resp;
                    console.log($scope.respError);
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    $scope.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                    console.log($scope.uploadProgress);
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
        };
            
        $scope.uploadLogo = function (newlogo) {
            var logo = [newlogo];
            var nFiles = logo.length;
            
            var counter = 0;
            if (logo && logo.length) {
            
            logo.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var logoLink = $(resp.data).find('Location').text();
                
                var newLogoForm ={
                    logo: logoLink,
                    examId: $scope.exam._id
                };
                console.log(newLogoForm);
                
                if(newLogoForm.examId){
                    ExamService.addLogo(newLogoForm).success(function (data, status, headers) {
                        counter = counter + 1;
                        $scope.showSavedDialog();
                        $state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                }else{
                    $scope.saveExamFirstDialog();
                }
                
                
                
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
        };
            
        $scope.uploadScreenshots = function (photos) {
            var nFiles = photos.length;
            var counter = 0;
            $scope.photoProgess = 0;
            if (photos && photos.length) {
                photos.forEach(function(thisFile, index){

                    var fileInfo = {
                        filename: thisFile.name,
                        contentType: thisFile.type
                    };
                     ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                    var s3Request = {};
                    var allParams = data.params;
                    for (var key in allParams) {
                      if (allParams.hasOwnProperty(key)) {
                        s3Request[key] = allParams[key];
                      }
                    }
                    s3Request.file = thisFile;
                    Upload.upload({
                        url: data.endpoint_url,
                        data: s3Request
                    }).then(function (resp) {
                            console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                            thisFile.link = $(resp.data).find('Location').text();
                        
                            $scope.toAddTest.screenshots.push(thisFile.link);

                        }, function (resp) {
                            console.log('Error status: ' + resp.status);
                        }, function (evt) {
                            $scope.photoProgess = 0;
                            thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                            photos.forEach(function(thisPhoto, index){
                                console.log(index + ' ' + thisPhoto.uploadProgress + ' ' + nFiles);
                                if(!thisPhoto.uploadProgress){
                                    thisPhoto.uploadProgress = 0;
                                }
                                $scope.photoProgess += thisPhoto.uploadProgress;
                                //console.log($scope.photoProgess);
                            });
                            $scope.photoProgess = $scope.photoProgess / nFiles;
                            //console.log('progress: ' + thisFile.uploadProgress + '% ' + thisFile.name);
                        });

                    })
                    .error(function (data, status, header, config) {
                        console.log("Error");
                    });   

                });
            }
         };
            
        //upload helper functions for exam cycles  
        $scope.uploadSyllabus = function (syllabuses) {
            var nFiles = syllabuses.length;
            var counter = 0;
            if (syllabuses && syllabuses.length) {
                syllabuses.forEach(function(thisFile, index){

                    var fileInfo = {
                        filename: thisFile.name,
                        contentType: thisFile.type
                    };
                     ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                    var s3Request = {};
                    var allParams = data.params;
                    for (var key in allParams) {
                      if (allParams.hasOwnProperty(key)) {
                        s3Request[key] = allParams[key];
                      }
                    }
                    s3Request.file = thisFile;
                    Upload.upload({
                        url: data.endpoint_url,
                        data: s3Request
                    }).then(function (resp) {
                            console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                            thisFile.link = $(resp.data).find('Location').text();
                        
                           var newSyllabus = {
                                name: '',
                                description: '',
                                url: thisFile.link,
                            };
                            $scope.newExamCycle.syllabus.push(newSyllabus);

                        }, function (resp) {
                            console.log('Error status: ' + resp.status);
                        }, function (evt) {
                            
                        });

                    })
                    .error(function (data, status, header, config) {
                        console.log("Error");
                    });   

                });
            }
         };
        $scope.uploadDocs = function (docs) {
            var nFiles = docs.length;
            var counter = 0;
            if (docs && docs.length) {
                docs.forEach(function(thisFile, index){

                    var fileInfo = {
                        filename: thisFile.name,
                        contentType: thisFile.type
                    };
                     ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                    var s3Request = {};
                    var allParams = data.params;
                    for (var key in allParams) {
                      if (allParams.hasOwnProperty(key)) {
                        s3Request[key] = allParams[key];
                      }
                    }
                    s3Request.file = thisFile;
                    Upload.upload({
                        url: data.endpoint_url,
                        data: s3Request
                    }).then(function (resp) {
                            console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                            thisFile.link = $(resp.data).find('Location').text();
                        
                           var newDoc = {
                                name: '',
                                description: '',
                                url: thisFile.link,
                            };
                            if(!$scope.newExamCycle.docs){
                                $scope.newExamCycle.docs = [];
                            }
                            $scope.newExamCycle.docs.push(newDoc);

                        }, function (resp) {
                            console.log('Error status: ' + resp.status);
                        }, function (evt) {
                            
                        });

                    })
                    .error(function (data, status, header, config) {
                        console.log("Error");
                    });   

                });
            }
         };
        $scope.uploadBrochure = function (brochures) {
            var nFiles = brochures.length;
            var counter = 0;
            $scope.photoProgess = 0;
            if (brochures && brochures.length) {
                brochures.forEach(function(thisFile, index){

                    var fileInfo = {
                        filename: thisFile.name,
                        contentType: thisFile.type
                    };
                     ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                    var s3Request = {};
                    var allParams = data.params;
                    for (var key in allParams) {
                      if (allParams.hasOwnProperty(key)) {
                        s3Request[key] = allParams[key];
                      }
                    }
                    s3Request.file = thisFile;
                    Upload.upload({
                        url: data.endpoint_url,
                        data: s3Request
                    }).then(function (resp) {
                            console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                            thisFile.link = $(resp.data).find('Location').text();
                        
                           var newBrochure = {
                                name: '',
                                description: '',
                                url: thisFile.link,
                            };
                            $scope.newExamCycle.brochure.push(newBrochure);

                        }, function (resp) {
                            console.log('Error status: ' + resp.status);
                        }, function (evt) {
                            $scope.photoProgess = 0;
                            thisFile.uploadProgress = parseInt(100.0 * evt.loaded / evt.total);
                            brochures.forEach(function(thisBrochure, index){
                                console.log(index + ' ' + thisBrochure.uploadProgress + ' ' + nFiles);
                                if(!thisBrochure.uploadProgress){
                                    thisBrochure.uploadProgress = 0;
                                }
                                $scope.photoProgess += thisBrochure.uploadProgress;
                                //console.log($scope.photoProgess);
                            });
                            $scope.photoProgess = $scope.photoProgess / nFiles;
                            //console.log('progress: ' + thisFile.uploadProgress + '% ' + thisFile.name);
                        });

                    })
                    .error(function (data, status, header, config) {
                        console.log("Error");
                    });   

                });
            }
         };
            
        
            
    }]);
    exambazaar.controller("addStreamController", 
        [ '$scope',  'streamList','StreamService','$http','$state', 'Notification', 'ImageService', 'Upload', function($scope, streamList, StreamService, $http, $state, Notification, ImageService, Upload){
        $scope.streams = streamList.data;
        console.log(streamList.data);
        $scope.addStream = function () {
            var saveStream = StreamService.saveStream($scope.stream).success(function (data, status, headers) {
               //$state.go('master-dashboard', {masterId: masterId});
            
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
        $scope.setStream = function(stream){
            $scope.newlogo = null;
            
            $scope.stream = stream;
        };
            
            
        $scope.uploadLogo = function (newlogo, color) {
            var logo = [newlogo];
            var nFiles = logo.length;
            
            var counter = 0;
            if (logo && logo.length) {
            
            logo.forEach(function(thisFile, index){
            var fileInfo = {
                filename: thisFile.name,
                contentType: thisFile.type
            }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
            var s3Request = {};
            var allParams = data.params;
            for (var key in allParams) {
              if (allParams.hasOwnProperty(key)) {
                s3Request[key] = allParams[key];
              }
            }
                 
            s3Request.file = thisFile;
            Upload.upload({
                url: data.endpoint_url,
                data: s3Request
            }).then(function (resp) {
                console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                var logoLink = $(resp.data).find('Location').text();
                
                var newLogoForm ={
                    logo: logoLink,
                    streamId: $scope.stream._id,
                    color: color,
                };
                
                if(newLogoForm.streamId){
                    StreamService.addLogo(newLogoForm).success(function (data, status, headers) {
                        if(data){
                            counter = counter + 1;
                            Notification.primary({message: "Great! All saved!",  positionY: 'top', positionX: 'right', delay: 5000});
                            
                            
                            $state.reload();
                        }else{
                            Notification.warning({message: "Something went wrong!",  positionY: 'top', positionX: 'right', delay: 5000});
                        }
                        
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                }else{
                    //$scope.saveExamFirstDialog();
                }
                
                
                
                }, function (resp) {
                    console.log('Error status: ' + resp.status);
                }, function (evt) {
                    
                });

            })
            .error(function (data, status, header, config) {
                console.log("Error");
            });   
                 
            });
            }
        };    
    }]);
    
        
        
    exambazaar.controller("addOfferController", 
        [ '$scope',  'offersList','offerService','$http','$state', function($scope, offersList, offerService,$http,$state){
        $scope.offersList = offersList.data;
        $scope.addOffer = function () {
            var saveOffer = offerService.saveOffer($scope.offer).success(function (data, status, headers) {
               //$state.go('master-dashboard', {masterId: masterId});
            
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
        };
        $scope.setOffer = function(offer){
            $scope.offer = offer;
        };
    }]);    
        
    exambazaar.controller("addInternController", 
        [ '$scope', 'UserService','$http','$state', function($scope, UserService,$http,$state){
        $scope.genders = ["Female", "Male"];
        $scope.intern = {
            userType: 'Intern',
            password: '',
            basic: {
                name: 'Lakshana Gopi',
                gender: 'Female',
                //dob: new Date("April 29, 1989")
            },
            contact: {
                mobile: '9940179709',
                email: 'lakiilaksh28@gmail.com'
            }
        };
            
        $scope.internTypes =[
            'Intern - Business Development',
            'Intern - Content'
        ];    
        
        $scope.addIntern = function () {
            console.log(JSON.stringify($scope.intern));
            var saveIntern = UserService.saveUser($scope.intern).success(function (data, status, headers) {
                var internId = data;
            //$scope.formmessage = "Intern " + $scope.intern.basic.firstName + " " + $scope.intern.basic.lastName + " saved!";
            
            alert('Done');    
                //$state.go('intern-dashboard', {internId: internId});
                
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
            };
    }]);          
            
    exambazaar.controller("addMasterController", 
        [ '$scope', 'UserService','$http','$state', function($scope, UserService,$http,$state){
        $scope.genders = ["Female", "Male"];
        $scope.master = {
            userType: 'Master',
            password: '',
            basic: {
                name: 'Gaurav Parashar',
                gender: 'Male',
                dob: new Date("April 29, 1989")
            },
            contact: {
                mobile: '9829685919',
                email: 'gauravparashar294@gmail.com'
            }
        };
        
        $scope.addMaster = function () {
            var saveMaster = UserService.saveUser($scope.master).success(function (data, status, headers) {
                var masterId = data;
            $scope.formmessage = "Master " + $scope.master.basic.firstName + " " + $scope.master.basic.lastName + " saved!";
            $state.go('master-dashboard', {masterId: masterId});
                
            })
            .error(function (data, status, header, config) {
                console.log('Error ' + data + ' ' + status);
            });
            };
    }]);
    
    exambazaar.controller("manageUsersController", 
        [ '$scope', 'UserService', 'viewService', 'EmailService','$http','$state', '$rootScope', '$mdDialog', '$timeout', 'Notification', function($scope, UserService, viewService, EmailService, $http,$state, $rootScope, $mdDialog, $timeout, Notification){
            $scope.properNames = function(){
                UserService.properNames().success(function (data, status, headers) {
                    if(data){
                        console.log('Done');
                    }else{
                        console.log('Error');
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            
            $rootScope.pageTitle = "Manage users on EB";
            $rootScope.$on("setBloggerUser", function(event, data){
                if(data && data.user){
                    $scope.thisuser = data.user;
                     /*viewService.getuserviews($scope.thisuser._id).success(function (data2, status, headers) {
                        $scope.thisuserViewed = data2;
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    viewService.getuserBlogviews($scope.thisuser._id).success(function (data3, status, headers) {
                        $scope.thisuserBlogViewed = data3;
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });*/
                    
                }
            });
            $scope.showSavedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#savedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            $scope.showErrorDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#errorDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            
            $scope.partnerInstituteId = null;
            $scope.makePartner = function(){
                if($scope.partnerInstituteId && $scope.thisuser._id){
                    $scope.partnerUser = {
                        userId: $scope.thisuser._id,
                        partnerInstituteId: $scope.partnerInstituteId
                    };
                    UserService.makePartner($scope.partnerUser).success(function (data, status, headers) {
                        if(data){
                            $scope.showSavedDialog();
                        }else{
                            $scope.showErrorDialog();
                        }
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    
                }
                
            };
            
            $scope.hundredblogEmail = function(userId){
                
                UserService.getUserBasic(userId).success(function (data, status, headers) {
                    var marketingUser = data;
                    console.log(marketingUser);
                    if(marketingUser.mobile == '9829685919'){
                        /*var emailForm = {
                            to: marketingUser.email,
                            username: marketingUser.basic.name,
                        };*/
                        EmailService.hundredblogEmail().success(function (thisData, status, headers) {
                            console.log(thisData);
                            //$scope.collegeMessageSent = true;
                            Notification.success("Email sent to user " + marketingUser.basic.name + " at " + marketingUser.email + "!");
                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                        
                        
                    }
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
                
                    
            };
            
            
            var internshipEmailList = [
"gaurav@exambazaar.com"

            ];
            $scope.internshipEmail = function(userId){
                
                UserService.getUserBasic(userId).success(function (data, status, headers) {
                    var marketingUser = data;
                    console.log(marketingUser);
                    if(marketingUser.mobile == '9829685919'){
                        var emailForm = {
                            //body: "Hi Pratik, though this email is for interns, we are also looking for full time employees in Jaipur. Let us know if you have anyone in mind. Thanks Gaurav",
                            //body: "Dear Candidate, thank you for attending our campus drive yesterday. While we cannot extend you an offer to join us as a Web Developer, we will consider you for any of the below 6-month internships (January - June 2018). Do reach out to us after completing the steps below with your resume &  preferred Internship Programme - Business Development, Design or Business Analyst. In a short paragraph, do tell us why we should hire you for the role. Good luck!",
                            emailList: internshipEmailList,
                            templateName: 'Internship at Exambazaar',
                        };
                        EmailService.internshipEmail(emailForm).success(function (thisData, status, headers) {
                            console.log(thisData);
                            //$scope.collegeMessageSent = true;
                            Notification.success("Internship emails sent!");
                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                        
                        
                    }
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
                
                    
            };
            
            $scope.introductionofEB = function(userId){
                
                UserService.getUserBasic(userId).success(function (data, status, headers) {
                    var marketingUser = data;
                    if(marketingUser.mobile == '9829685919'){
                        EmailService.introductionofEB().success(function (thisData, status, headers) {
                            console.log(thisData);
                             Notification.success("Introduction emails sent!");
                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                        
                        
                    }
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
                
                    
            };
            
            
            $scope.EventsEmail = function(userId){
                UserService.getUserBasic(userId).success(function (data, status, headers) {
                    var marketingUser = data;
                    if(marketingUser.mobile == '9829685919'){
                         EmailService.EventsEmail().success(function (thisData, status, headers) {
                            
                            Notification.success("All done!");
                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                        
                        
                    }
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
                
                    
            };
            
            $scope.CATEmail = function(userId){
                console.log(userId);
                 UserService.getUserBasic(userId).success(function (data, status, headers) {
                    var marketingUser = data;
                    console.log(marketingUser);
                    if(marketingUser.mobile == '9829685919'){
                        /*var emailForm = {
                            to: marketingUser.email,
                            username: marketingUser.basic.name,
                        };*/
                        var thisUser = {
                            _id: marketingUser._id//'58932d3ac419333af4aadfb4'
                        };
                        //console.log(thisUser);
                        EmailService.CATEmail().success(function (thisData, status, headers) {
                            console.log(thisData);
                            //$scope.collegeMessageSent = true;
                            Notification.success("Email sent to user " + marketingUser.basic.name + " at " + marketingUser.email + "!");
                        })
                        .error(function (data, status, header, config) {
                            console.log('Error ' + data + ' ' + status);
                        });
                        
                        
                    }
                    
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });
                
                    
            };
            
            $scope.unmakePartner = function(){
                if($scope.thisuser.partner && $scope.thisuser.partner.length > 0 && $scope.thisuser._id){
                    $scope.partnerUser = {
                        userId: $scope.thisuser._id,
                        partnerInstituteId: $scope.thisuser.partner[0],
                    };
                    UserService.unmakePartner($scope.partnerUser).success(function (data, status, headers) {
                        if(data){
                            $scope.showSavedDialog();
                        }else{
                            $scope.showErrorDialog();
                        }
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    
                }
                
            };
            $scope.makePartnerDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#parnterDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            $scope.activateIntern = function(thisuser){
                UserService.activateIntern(thisuser._id).success(function (data, status, headers) {
                    console.log("Done");
                    alert(data);
                    if($scope.thisuser){
                        $scope.thisuser = data;
                    }
                    
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            $scope.deactivateIntern = function(thisuser){
                UserService.deactivateIntern(thisuser._id).success(function (data, status, headers) {
                    console.log("Done");
                    $scope.thisuser = data;
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            $scope.closeInternship = function(thisuser){
                UserService.closeInternship(thisuser._id).success(function (data, status, headers) {
                    console.log("Done");
                    $scope.thisuser = data;
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            $scope.activateBlogger = function(thisuser){
                UserService.activateBlogger(thisuser._id).success(function (data, status, headers) {
                    console.log("Done");
                    $scope.thisuser = data;
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            $scope.deactivateBlogger = function(thisuser){
                UserService.deactivateBlogger(thisuser._id).success(function (data, status, headers) {
                    console.log("Done");
                    $scope.thisuser = data;
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
    }]);    
        
    exambazaar.controller("bulkDisableController", 
        [ '$scope', '$rootScope', 'UserService', '$http', '$state', 'thisuser', 'targetStudyProviderService', function($scope, $rootScope, UserService,$http,$state, thisuser, targetStudyProviderService){
        $scope.user = thisuser.data;
        if($scope.user.userType =='Master'){
            $scope.showLevel = 10;
        }
        console.log($rootScope.permittedToDisable.indexOf($scope.user._id));
        if($rootScope.permittedToDisable.indexOf($scope.user._id) != -1){
            $scope.showLevel = 10;
        }
        /*if($scope.user._id == '5a1831f0bd2adb260055e352'){
            $scope.showLevel = 10;
        }*/
        $scope.disableinstitutes =[];
        $scope.disableinstitute = {
            _id: ''
        };
        
        $scope.disableInstitutes = function(){
            var institutes = [];
            $scope.disableinstitutes.forEach(function(thisinstitute, iIndex){
                if(thisinstitute._id){
                    //console.log(thisinstitute._id);
                    institutes.push(thisinstitute);
                }
            });
            
            var disableForm = {
                user: $scope.user._id,
                instituteIds: institutes
            };
            $scope.disabledIds = institutes;
            console.log(institutes.length);
            targetStudyProviderService.bulkDisableProviders(disableForm).success(function (data, status, headers) {
                //$scope.disabledIds = data;
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.claimInstitute = function(){
            if($scope.addedInstituteId){
                $state.go('claim', {coachingId: $scope.addedInstituteId});
            }
        };
    }]);        
        
    exambazaar.controller("addInstituteController", 
        [ '$scope', 'UserService', '$http', '$state', 'thisuser', 'targetStudyProviderService', 'examList', 'streamList', '$rootScope', 'Notification', function($scope, UserService,$http,$state, thisuser, targetStudyProviderService, examList, streamList,$rootScope, Notification){
            
        $rootScope.pageTitle = 'Add Coaching in EB';    
        $scope.user = thisuser.data;
        $scope.exams = examList.data;
            //console.log($scope.exams);
        $scope.streams = streamList.data;
        
        if($scope.user.userType =='Master'){
            $scope.showLevel = 10;
        }
        if($rootScope.permittedToAdd.indexOf($scope.user._id) != -1){
            $scope.showLevel = 10;
        }
        /*if($scope.user._id == '59a9749112e754442af93d43' || $scope.user._id == '59a24d743011356248da915e'  || $scope.user._id == '59085f0fc7289d0011d6ea8c'){
            $scope.showLevel = 10;
        }*/
            
        $scope.newinstitutes =[];
        $scope.commonExams = [];
            
        $scope.addExam = function(examId){
            if($scope.commonExams.indexOf(examId) == -1){
                
                $scope.commonExams.push(examId);
                //console.log($scope.commonExams);
            }
        };
        $scope.removeExam = function(examId){
            var eIndex = $scope.commonExams.indexOf(examId);
            
            if(eIndex != -1){
                $scope.commonExams.splice(eIndex,1);
            }
        };
        $scope.newInstitute = {
            name:'',
            groupName:'',
            address:'',
            city:'',
            state:'',
            pincode:'',
        };
        $scope.addInstitute = function(){
            //DEF
            $scope.newInstitute.groupName = $scope.newInstitute.name;
             var saveProvider = {
                targetStudyProvider:$scope.newInstitute,
                user: $scope.user.userId
            };
            targetStudyProviderService.saveProvider(saveProvider).success(function (data, status, headers) {
                $scope.addedInstituteId = data;
                console.log("Done");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.refreshPage = function(){
            $state.reload();    
        };
        $scope.adding = null;
        $scope.addInstitutes = function(){
            $scope.adding = true;
            var institutes = [];
            $scope.newinstitutes.forEach(function(thisinstitute, iIndex){
                if(thisinstitute.name && thisinstitute.name != ''){
                    thisinstitute.name = thisinstitute.name.trim();
                    thisinstitute.groupName = thisinstitute.name;
                    
                    
                    if(thisinstitute.city && thisinstitute.city != ''){
                        thisinstitute.city = titleCase(thisinstitute.city);
                    }
                    if(thisinstitute.state && thisinstitute.state != ''){
                        thisinstitute.state = titleCase(thisinstitute.state);
                    }
                    if(thisinstitute.email && thisinstitute.email != ''){
                        thisinstitute.email = thisinstitute.email.replace(/\s+/g, '');
                        thisinstitute.email = thisinstitute.email.toLowerCase();
                    }
                    if(thisinstitute.phone && thisinstitute.phone != ''){
                        thisinstitute.phone = thisinstitute.phone.replace(/\s+/g, '');
                    }
                    if(thisinstitute.mobile && thisinstitute.mobile != ''){
                        thisinstitute.mobile = thisinstitute.mobile.replace(/\s+/g, '');
                    }
                    if(thisinstitute.website && thisinstitute.website != ''){
                        thisinstitute.website = thisinstitute.website.replace(/\s+/g, '');
                        thisinstitute.website = thisinstitute.website.toLowerCase();
                        
                        var find ="http";
                        var fIndex = thisinstitute.website.indexOf(find);
                        if(fIndex == -1){
                            thisinstitute.website = "http://" + thisinstitute.website;
                        }
                    }
                    if(thisinstitute.pincode && thisinstitute.pincode != ''){
                        thisinstitute.pincode = thisinstitute.pincode.replace(/\s+/g, '');
                    }
                    
                    var saveProvider = {
                        targetStudyProvider:thisinstitute,
                        user: $scope.user._id,
                        
                    };
                    if($scope.commonExams.length > 0){
                        saveProvider.targetStudyProvider.exams = $scope.commonExams;
                    }
                        
                    institutes.push(saveProvider);
                }
            });
            targetStudyProviderService.bulkSaveProviders(institutes).success(function (data, status, headers) {
                $scope.addedInstituteIds = data;
                console.log("Done");
                Notification.success("Great, we have added " + $scope.addedInstituteIds.length + " institutes!");
                Notification.warning("You will have to refresh this page to add more!");
            })
            .error(function (data, status, header, config) {
                console.log("Error ");
            });
        };
        $scope.claimInstitute = function(){
            if($scope.addedInstituteId){
                $state.go('claim', {coachingId: $scope.addedInstituteId});
            }
        };
    }]);    
        
        
    exambazaar.controller("sitemapController", 
        [ '$scope', '$rootScope','$http','$state','cities', 'p0', 'p1', 'p2', 'p3', 'p3Aggregate', 'p5', 'blogurls', 'FileSaver', 'Blob', function($scope, $rootScope, $http, $state, cities, p0, p1, p2, p3, p3Aggregate, p5, blogurls, FileSaver, Blob){
            
            $scope.xmlStart = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>";
            $scope.urlsetStart = "<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">";
            var xmlStart = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>";
            var urlsetStart = "<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">";
            $scope.urlStart = "<url>";
            $scope.urlEnd = "</url>";
            $scope.locStart = "<loc>";
            $scope.locEnd = "</loc>";
            $scope.changefreqStart = "<changefreq>";
            $scope.changefreqEnd = "</changefreq>";
            $scope.priorityStart = "<priority>";
            $scope.priorityEnd = "</priority>";
            $scope.urlsetEnd = "</urlset>";
            var urlStart = "<url>";
            var urlEnd = "</url>";
            var locStart = "<loc>";
            var locEnd = "</loc>";
            var changefreqStart = "<changefreq>";
            var changefreqEnd = "</changefreq>";
            var priorityStart = "<priority>";
            var priorityEnd = "</priority>";
            var urlsetEnd = "</urlset>";
            
            
            var p0 = p0.data;
            var p1 = p1.data;
            var p2 = p2.data;
            var p3 = p3.data;
            
            var blogurls = blogurls.data;
            //console.log(p5);
            
            var p0Curated = [];
            var p1Curated = [];
            var p2Curated = [];
            var p3Curated = [];
            
            var blogurlsCurated = [];
            
            var p3Aggregate = p3Aggregate.data;
            var urls = [];
            var newCurated = {};
            p0.forEach(function(thisURL, uIndex){
                newCurated = {
                    url: thisURL,
                    count: "10000",
                    changefreq: 'daily',
                    priority: 1,
                };
                p0Curated.push(newCurated);
            });
            p1.forEach(function(thisURL, uIndex){
                newCurated = {
                    url: thisURL,
                    count: "10000",
                    changefreq: 'weekly',
                    priority: 0.8,
                };
                p1Curated.push(newCurated);
            });
            p2.forEach(function(thisURL, uIndex){
                newCurated = {
                    url: thisURL,
                    count: "10000",
                    changefreq: 'weekly',
                    priority: 0.6,
                };
                p2Curated.push(newCurated);
            });
            
            
            blogurls.forEach(function(thisURL, uIndex){
                newCurated = {
                    url: thisURL,
                    count: "10000",
                    changefreq: 'weekly',
                    priority: 0.8,
                };
                blogurlsCurated.push(newCurated);
            });
            urls = urls.concat(p0Curated);
            urls = urls.concat(p1Curated);
            var newCurated = {
                url: "https://www.exambazaar.com/blog",
                count: "10000",
                changefreq: 'daily',
                priority: 1,
            };
            urls.push(newCurated);
            urls = urls.concat(blogurlsCurated);
            urls = urls.concat(p2Curated);
            
            
            p3Aggregate.forEach(function(thisPair, pIndex){
                p3Aggregate[pIndex].examCity = thisPair.exam +"#"+ thisPair.city;
            });
            var p3AggregateExamCity = p3Aggregate.map(function(a) {return a.examCity;});
            
            p3.forEach(function(thisURL, uIndex){
                var prefix ="https://www.exambazaar.com/stream/";
                var remainingURL = thisURL.replace(prefix,'');
                var p3Arrays = remainingURL.split("/");
                var streamName = p3Arrays[0];
                var examName = p3Arrays[1];
                var cityName = p3Arrays[2];
                
                var examCity = examName +"#"+ cityName;
                var ecIndex = p3AggregateExamCity.indexOf(examCity);
                if(ecIndex != -1){
                    var examCityCount = p3Aggregate[ecIndex];
                    if(examCityCount.count >= 2){
                        newCurated = {
                            url: thisURL,
                            count: examCityCount.count,
                            changefreq: 'weekly',
                            priority: 0.6,
                        };
                        p3Curated.push(newCurated);
                    }
                    
                    //console.log(examName + " " + cityName + " " + examCityCount.count);
                }
                
            });
            urls = urls.concat(p3Curated);
            
            var p5 = p5.data;
            var p5Curated = [];
            p5.forEach(function(thisURL, uIndex){
                newCurated = {
                    url: thisURL,
                    count: "0",
                    changefreq: 'daily',
                    priority: 0.4,
                };
                p5Curated.push(newCurated);
            });
            urls = urls.concat(p5Curated);
            
            var sitemapText = "";
            var thisURLText = "";
            sitemapText += xmlStart;
            sitemapText += urlsetStart;
            urls.forEach(function(thisURL, uIndex){
                thisURLText = "";
                thisURLText += urlStart;
                thisURLText += locStart;
                thisURLText += thisURL.url;
                thisURLText += locEnd;
                if(thisURL.changefreq){
                   thisURLText += changefreqStart;
                   thisURLText += thisURL.changefreq;
                   thisURLText += changefreqEnd;
                }
                if(thisURL.priority){
                   thisURLText += priorityStart;
                   thisURLText += thisURL.priority;
                   thisURLText += priorityEnd;
                }
                thisURLText += urlEnd;
                sitemapText += thisURLText;
            });
            sitemapText += urlsetEnd;
            
            
            var data = new Blob([sitemapText], { type: "application/xhtml+xml;charset=utf-8" });
            FileSaver.saveAs(data, 'sitemap.xml');
            
            //console.log(sitemapText);
            //$scope.urls = urls;
            $rootScope.pageTitle = "Exambazaar Sitemap";
    }]);       
    
    String.prototype.EncodeXMLEscapeChars = function () {
        var OutPut = this;
        if (OutPut.trim() != "") {
            OutPut = OutPut.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#39;");
            OutPut = OutPut.replace(/&(?!(amp;)|(lt;)|(gt;)|(quot;)|(#39;)|(apos;))/g, "&amp;");
            OutPut = OutPut.replace(/([^\\])((\\\\)*)\\(?![\\/{])/g, "$1\\\\$2");  //replaces odd backslash(\\) with even.
        }
        else {
            OutPut = "";
        }
        return OutPut;
    };    
        
    exambazaar.controller("blogsitemapController", 
        [ '$scope', '$rootScope','$http','$state', 'blogurls', 'FileSaver', 'Blob', function($scope, $rootScope, $http, $state, blogurls, FileSaver, Blob){
            var blogurls = blogurls.data;
            console.log(blogurls);
            //var exams = exams.data;
            var urls = [];
            var blogurlsCurated = [];
            //var examsCurated = [];
            
            $scope.xmlStart = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>";
            $scope.urlsetStart = "<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">";
            var xmlStart = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>";
            var urlsetStart = "<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">";
            
            var rssxmlStart = "<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>";
            var rssStart = "<rss version=\"2.0\">";
            var channelStart = "<channel>";
            var channelInfoStrings = [];
            var channelInfo = "";
            var itemsInfo = "";
            var channelEnd = "</channel>";
            var rssEnd = "</rss>";
            
            channelInfoStrings.push("<title>Exambazaar Blog</title>");
            channelInfoStrings.push("<link>https://www.exambazaar.com/blog</link>");
            channelInfoStrings.push("<description>Exambazaar Resources, tips and material to help you ace your exam preparation</description>");
            channelInfoStrings.push("<language>en-us</language>");
            channelInfoStrings.push("<pubDate>" + moment().format('ddd, DD MMM YYYY HH:mm:ss ZZ') + "</pubDate>");
            channelInfoStrings.push("<lastBuildDate>" + moment().format('ddd, DD MMM YYYY HH:mm:ss ZZ') + "</lastBuildDate>");
            channelInfoStrings.push("<docs>http://www.rssboard.org/rss-specification</docs>");
            channelInfoStrings.push("<managingEditor>always@exambazaar.com</managingEditor>");
            channelInfoStrings.push("<webMaster>always@exambazaar.com</webMaster>");
            channelInfoStrings.forEach(function(thisString, uIndex){
                channelInfo += thisString;
            });
            
            var itemStart = "<item>";
            var titleStart = "<title>";
            var linkStart = "<link>";
            var descriptionStart = "<description>";
            var pubDateStart = "<pubDate>";
            var guidStart = "<guid>";
            var itemEnd = "</item>";
            var titleEnd = "</title>";
            var linkEnd = "</link>";
            var descriptionEnd = "</description>";
            var pubDateEnd = "</pubDate>";
            var guidEnd = "</guid>";
            
            blogurls.forEach(function(thisBlog, uIndex){
                var thisItemString = itemStart + titleStart + thisBlog.title.EncodeXMLEscapeChars() + titleEnd + linkStart + thisBlog.urlslug + linkEnd + descriptionStart + thisBlog.seoDescription.EncodeXMLEscapeChars() + descriptionEnd + pubDateStart + moment(thisBlog._published).format('ddd, DD MMM YYYY HH:mm:ss ZZ') + pubDateEnd + guidStart + thisBlog.urlslug + guidEnd + itemEnd;
                itemsInfo += thisItemString;
            });
            var rssText = "";
            rssText = rssStart + channelStart + channelInfo + itemsInfo + channelEnd + rssEnd;
            var data = new Blob([rssText], { type: "application/xhtml+xml;ISO-8859-1" });
            FileSaver.saveAs(data, 'blogrss.xml');
            
            
            
            $scope.urlStart = "<url>";
            $scope.urlEnd = "</url>";
            $scope.locStart = "<loc>";
            $scope.locEnd = "</loc>";
            $scope.changefreqStart = "<changefreq>";
            $scope.changefreqEnd = "</changefreq>";
            $scope.priorityStart = "<priority>";
            $scope.priorityEnd = "</priority>";
            $scope.urlsetEnd = "</urlset>";
            var urlStart = "<url>";
            var urlEnd = "</url>";
            var locStart = "<loc>";
            var locEnd = "</loc>";
            var changefreqStart = "<changefreq>";
            var changefreqEnd = "</changefreq>";
            var priorityStart = "<priority>";
            var priorityEnd = "</priority>";
            var urlsetEnd = "</urlset>";
            
            
            blogurls.forEach(function(thisURL, uIndex){
                newCurated = {
                    url: thisURL,
                    count: "10000",
                    changefreq: 'weekly',
                    priority: 0.8,
                };
                blogurlsCurated.push(newCurated);
            });
            var newCurated = {
                url: "https://www.exambazaar.com/blog",
                count: "10000",
                changefreq: 'daily',
                priority: 1,
            };
            urls.push(newCurated);
            urls = urls.concat(blogurlsCurated);
            
            /*
            var sitemapText = "";
            var thisURLText = "";
            sitemapText += xmlStart;
            sitemapText += urlsetStart;
            urls.forEach(function(thisURL, uIndex){
                thisURLText = "";
                thisURLText += urlStart;
                thisURLText += locStart;
                thisURLText += thisURL.url;
                thisURLText += locEnd;
                if(thisURL.changefreq){
                   thisURLText += changefreqStart;
                   thisURLText += thisURL.changefreq;
                   thisURLText += changefreqEnd;
                }
                if(thisURL.priority){
                   thisURLText += priorityStart;
                   thisURLText += thisURL.priority;
                   thisURLText += priorityEnd;
                }
                thisURLText += urlEnd;
                sitemapText += thisURLText;
            });
            sitemapText += urlsetEnd;
            var data = new Blob([sitemapText], { type: "application/xhtml+xml;charset=utf-8" });
            FileSaver.saveAs(data, 'blogsitemap.xml');
            */
            
            
            $scope.urls = urls;
            $rootScope.pageTitle = "Exambazaar Blog Sitemap";
    }]);
    exambazaar.controller("emailToPublicationsController", 
        [ '$scope','$http','$state', '$cookies', 'PublicationEmailService', 'UserService','$mdDialog', '$timeout', '$rootScope', 'Notification', 'allEmails', function($scope, $http, $state, $cookies, PublicationEmailService, UserService, $mdDialog, $timeout, $rootScope, Notification, allEmails){
            $rootScope.pageTitle = "Send Email to Publications";
            $scope.allEmails = allEmails.data;
            $scope.enabled = false;
            $scope.idsEnabled = ['58c8e895bbaebf3560545f19', '59a7eb973d71f10170dbb468'];
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser'); 
                if($scope.user && $scope.user.userType == 'Master'){
                    $scope.enabled = true;
                }
                if($scope.idsEnabled.indexOf($scope.user._id) != -1){
                    $scope.enabled = true;
                }
                
            }else{
                $scope.user = null;
            }
            
            $scope.email = {
                publication: '',
                to: '',
                contact:{
                    name: '',
                    mobile: ''
                },
                templateName: 'Press Coverage',
                sender: 'Vikrant',//$scope.user.basic.name,
                senderId: $scope.user._id,
                from: 'vikrant@exambazaar.com',//$scope.user.email,
                subject: '[Press Release] Story coverage of Exambazaar (IIT-IIM alumni Jaipur based startup)',
                html: '',
            };
            
            $scope.checkEmail = function(){
                var valid = true;
                //validate email regex
                var toCheck = validateEmail($scope.email.to);
                var fromCheck = validateEmail($scope.email.from);
                
                
                if(!toCheck){
                    valid = false;
                    Notification.warning({message: "Incorrect email To: " + $scope.email.to,  positionY: 'top', positionX: 'right', delay: 3000});
                }
                if(!fromCheck){
                    valid = false;
                    Notification.warning({message: "Incorrect email From: " + $scope.email.from,  positionY: 'top', positionX: 'right', delay: 3000});
                }
                if(!$scope.email.sender || $scope.email.sender.length < 5){
                    valid = false;
                    Notification.warning({message: "Sender Name too short: " + $scope.email.sender,  positionY: 'top', positionX: 'right', delay: 3000});
                }
                if(!$scope.email.subject || $scope.email.subject.length < 5){
                    valid = false;
                    Notification.warning({message: "Subject too short: " + $scope.email.subject,  positionY: 'top', positionX: 'right', delay: 3000});
                }
                
                if(valid){
                    $scope.sendEmail($scope.email);
                }
            };
            $scope.sendEmail = function(email) {
                PublicationEmailService.publications(email).success(function (data, status, headers) {
                    Notification.primary({message: "Email sent to: " + email.to,  positionY: 'top', positionX: 'right', delay: 30000});
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });  
            };
            $scope.sendEmailToSelf = function() {
                var selfEmail = $scope.email;
                selfEmail.to = selfEmail.from;
                $scope.sendEmail(selfEmail);
            };
            
            
    }]);    
    exambazaar.controller("sendEmailController", 
        [ '$scope','$http','$state','EmailService', 'targetStudyProviderService', 'UserService', 'thisuser','$mdDialog', '$timeout', 'thisuserEmails', 'tofillciService', '$rootScope', 'Notification', function($scope,$http,$state,EmailService, targetStudyProviderService, UserService, thisuser,$mdDialog, $timeout, thisuserEmails, tofillciService, $rootScope, Notification){
            $rootScope.pageTitle = "Send Emails via Sendgrid";
            $scope.emailService = function(){
                targetStudyProviderService.emailService().success(function (data, status, headers) {
                    //$scope.distinctStates = data;
                    console.log("Done");
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            
            $scope.procMon = function(){
                UserService.procMon().success(function (data, status, headers) {
                    //$scope.distinctStates = data;
                    console.log("Done");
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            
            $scope.fetchEmails = function(){
                tofillciService.sendEmails().success(function (data, status, headers) {
                    var response = data;
                    var uniqueIds = [];
                    
                    response.forEach(function(thisId, pIndex){
                        if(uniqueIds.indexOf(thisId) == -1){
                            uniqueIds.push(thisId);
                        }
                    });
                    
                    $scope.bulkEmails = uniqueIds;
                    console.log(JSON.stringify(uniqueIds.length));
                    
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });  
            };
            //$scope.fetchEmails();
            $scope.setBulkProvider = function(bulkEmailProviderId){
                $scope.email.instituteId = bulkEmailProviderId;
            };
            $scope.user = thisuser.data;
            $scope.userEmails = thisuserEmails.data;
            $scope.sendingMode = true;
            $scope.flipSendingMode = function(){
                $scope.sendingMode = !$scope.sendingMode;
            };
            $scope.email = {
                to: '',
                templateName: '',
                sender: '',
                senderId: '',
                from: '',
                subject: '',
                html: "",
                instituteName:'',
                instituteAddress:'',
                institutePhoneMobile:'',
                instituteId:'',
                logo:''
            };
            $scope.update = function(instituteId){
                $scope.email.instituteId = instituteId;
            };
            $scope.setEmail = function(email){
                $scope.email.to = email;
            };
            
            $scope.showSentDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#sentDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },8000)
            };
            
            $scope.showErrorDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#errorDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },9000)
            };
            $scope.templateNames = [
                
                'CI Email - Claim Your Listing - 2018',
                'CI Email - Write a Blog - 2018'
                
                /*'Survey Email - 11March2017',
                'Claim CI Email - 7thNov2017',
                'Claim CI Email - 5thApril2017',
                'Follow Up 1 to CIs',*/
            ];
            $scope.showLevel = 0;
            
            if($scope.user.userType=='Master'){
                $scope.showLevel = 10;
                $scope.email.from = $scope.user.email;
                $scope.email.sender = $scope.user.basic.name;
                $scope.email.senderId = $scope.user._id;
            }else{
                if($scope.user.userType=='Intern - Business Development'){
                    if($scope.user._id == '58c8e895bbaebf3560545f19' || $scope.user._id == '5a1831f0bd2adb260055e352'){
                        $scope.showLevel = 10;
                        $scope.email.from = $scope.user.email;
                        $scope.email.sender = $scope.user.basic.name +" from Exambazaar";
                        $scope.email.senderId = $scope.user._id;
                    }
                }
            }
            $scope.$watch('email.templateName', function (newValue, oldValue, scope) {
                if(newValue != null && newValue != ''){
                    
                    if(newValue == 'CI Email - Claim Your Listing - 2018'){
                        $scope.email.subject = $scope.provider.name + " - Get started with Exambazaar!";
                    }
                    if(newValue == 'CI Email - Write a Blog - 2018'){
                        $scope.email.subject = $scope.provider.name + " - You are the expert! Would you write with us?";
                    }
                    //$scope.email.subject = $scope.provider.name + " - You are the expert! Would you write with us?";
                }
            });
            $scope.$watch('email.instituteId', function (newValue, oldValue, scope) {
            if(newValue != null && newValue != ''){
                //console.log(newValue);
                //DEF
                var newValueArr = newValue.split("/");
                newValue = newValueArr[newValueArr.length-1];
                //$scope.email.instituteId = newValue;
                //console.log(newValue);
                if(newValue.length > 5){
                //alert($scope.email.instituteId);
                 targetStudyProviderService.getProviderBasic(newValue).success(function (data, status, headers) {
                if(data){
                    console.log(data);
                    var refreshedProvider = data.provider;
                    
                    if(data.emailSent){
                        $scope.emailSent = data.emailSent;
                        $scope.emailSent.forEach(function(thisEmail, eIndex){
                            thisEmail.fromNow = moment(thisEmail._date).fromNow();
                        });
                    }
                    
                    $scope.provider = refreshedProvider;
                    //console.log(emailSent);
                    $scope.email.to ='';
                    $scope.email.instituteName = $scope.provider.name;
                    $scope.email.instituteAddress = $scope.provider.address + ', ' + $scope.provider.city;
                    if($scope.provider.pincode){
                        $scope.email.instituteAddress += $scope.provider.pincode;
                    }
                    
                    $scope.email.institutePhoneMobile = '';
                    
                    $scope.provider.mobile.forEach(function(thisMobile, mIndex){
                        if(mIndex == 0){
                           $scope.email.institutePhoneMobile += 'Mobile: ';
                        }
                        
                        $scope.email.institutePhoneMobile += thisMobile;
                        if(mIndex != $scope.provider.mobile.length - 1){
                            $scope.email.institutePhoneMobile += ', ';
                        }
                    });

                    $scope.provider.phone.forEach(function(thisPhone, pIndex){
                        if(pIndex == 0){
                           $scope.email.institutePhoneMobile += ' Phone: ';
                        }
                        
                        $scope.email.institutePhoneMobile += thisPhone;
                        if(pIndex != $scope.provider.phone.length - 1){
                        $scope.email.institutePhoneMobile += ', ';
                        }
                    });
                    //console.log($scope.email.institutePhoneMobile);
                    
                    $scope.email.instituteId = $scope.provider._id;
                    $scope.email.logo = $scope.provider.logo;
                    
                }
                }).error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }




            }

            }, true);
            
            $scope.sendEmail = function() {
                console.log($scope.email);
                
                if($scope.email.templateName == ''){
                    Notification.warning({message: "Select Email template to send!",  positionY: 'top', positionX: 'right', delay: 5000});
                }else{
                    EmailService.sendGrid($scope.email).success(function (data, status, headers) {
                        var response = data;
                        console.log(JSON.stringify(response));
                        if(response.statusCode == '202'){
                            $scope.showSentDialog();
                        }else{
                            $scope.showErrorDialog();
                        }
                        //alert(JSON.stringify(data));
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error ' + data + ' ' + status);
                    });  
                }
                
            };
            
            $scope.blogInvite = function() {
                
                EmailService.blogInvite().success(function (data, status, headers) {
                    console.log(data);
                })
                .error(function (data, status, header, config) {
                    console.log('Error ' + data + ' ' + status);
                });  
            };
            
            
    }]);
    function extractContent(s) {
      var span= document.createElement('span');
      span.innerHTML= s;
      return span.textContent || span.innerText;
    };
    function titleCase(str) {
      str = str.toLowerCase();
      str = str.split(' ');
      for (var i = 0; i < str.length; i++) {
        str[i] = str[i].charAt(0).toUpperCase() + str[i].slice(1); 
      }
      return str.join(' ');
    }    
        
    function slugify(string) {
      return string
        .toString()
        .trim()
        .toLowerCase()
        .replace(/\s+/g, "-")
        .replace(/[^\w\-]+/g, "")
        .replace(/\-\-+/g, "-")
        .replace(/^-+/, "")
        .replace(/-+$/, "");
    };
    function getIndicesOf(searchStr, str, caseSensitive) {
        var searchStrLen = searchStr.length;
        if (searchStrLen == 0) {
            return [];
        }
        var startIndex = 0, index, indices = [];
        if (!caseSensitive) {
            str = str.toLowerCase();
            searchStr = searchStr.toLowerCase();
        }
        while ((index = str.indexOf(searchStr, startIndex)) > -1) {
            indices.push(index);
            startIndex = index + searchStrLen;
        }
        return indices;
    }    
    exambazaar.controller("editblogController", 
        [ '$scope','$http','$state','blogpostService', 'blogTagService', 'UserService', 'ExamService', 'StreamService', 'thisblog', '$rootScope','$mdDialog','$timeout', 'Upload', '$cookies', 'ImageService', 'Notification', 'allBloggers', function($scope,$http, $state, blogpostService, blogTagService, UserService, ExamService, StreamService, thisblog, $rootScope, $mdDialog,$timeout, Upload, $cookies, ImageService, Notification, allBloggers){
            $scope.blogpost = thisblog.data;
            $scope.allBloggers = allBloggers.data;
            var bloggerIds = $scope.allBloggers.map(function(a) {return a._id;});
            $scope.masteruser = null;
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser'); 
                if($scope.user && $scope.user.userType == 'Master'){
                    $scope.masteruser = true;
                }
                UserService.getBlogger($scope.user._id).success(function (data, status, headers) {
                    var userGallery = data.blogger.gallery;
                    //console.log(userGallery);
                    $scope.blogGallery = userGallery;
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                
            }else{
                $scope.user = null;
            }
            
            //"<p","</p>",
            var possibleBlocks = ["<h3","<h2","<h1"];
            var possibleBlocksClose = ["</h3>","</h2>","</h1>"];
            $scope.showSelectedText = function() {
                $scope.closestBlockText = null;
                $scope.closestTag = null;
                
                $scope.selectedText =  $scope.getSelectionText();
                //console.log($scope.selectedText);
                var contentLength = $scope.blogpost.content.length;
                
                var startTextIndex = $scope.blogpost.content.indexOf($scope.selectedText);
                //console.log(startTextIndex);
                if($scope.selectedText.length > 5 && startTextIndex != -1){
                    
                
                var stringBefore = $scope.blogpost.content.substr(0, startTextIndex);
                var startingNumbers = [];    
                possibleBlocks.forEach(function(thisBlock, bindex){
                    var thisIndex = stringBefore.lastIndexOf(thisBlock);
                    startingNumbers.push(thisIndex);
                });
                console.log(startingNumbers);
                console.log(startTextIndex);
                var innerMostBlockIndex = -1;
                var innerMostBlockNumber = -1;
                var innerMostBlock = '';
                startingNumbers.forEach(function(thisStart, sindex){
                    // && thisStart >= startTextIndex - thisBlockLen
                    var thisBlockLen = possibleBlocks[sindex].length + 1;
                    if(thisStart != -1 && thisStart >= innerMostBlockIndex && thisStart >= startTextIndex - thisBlockLen - 6){
                        innerMostBlockIndex = sindex;
                        innerMostBlockNumber = thisStart;
                    }
                });
                console.log(innerMostBlockNumber);
                if(innerMostBlockNumber != -1){
                    var closestBlockOpen = possibleBlocks[innerMostBlockIndex];
                    var closestBlockClose = possibleBlocksClose[innerMostBlockIndex];
                    //console.log(closestBlockOpen + " " + closestBlockClose);
                    var closestBlockFullText = $scope.blogpost.content.substring(innerMostBlockNumber, contentLength);
                    var closestBlockTextIndex = closestBlockFullText.indexOf(closestBlockClose) + closestBlockClose.length;
                    var closestBlockText = $scope.blogpost.content.substr(innerMostBlockNumber, closestBlockTextIndex);
                    
                    //console.log(closestBlockFullText);
                    
                    if(closestBlockText && closestBlockText.length > 0){
                        var closestTag = closestBlockOpen.substring(1, closestBlockOpen.length);
                        $scope.closestBlockText = closestBlockText;
                        $scope.closestTag = closestTag;
                        /*if($scope.masteruser){
                            $scope.replaceTag(closestBlockText, closestTag);
                        }*/
                        
                    }
                } 
                }
                //console.log($scope.selectedText);
            };
            $scope.replaceTag = function(closestBlockText, tag){
                var bIndex = $scope.blogpost.content.indexOf(closestBlockText);
                
                if(bIndex != -1){
                    var preText = $scope.blogpost.content.substring(0, bIndex);
                    var postText = $scope.blogpost.content.substring(bIndex + closestBlockText.length, $scope.blogpost.content.length);
                    
                }
                var replace1From = "<"+tag;
                var replace1To = "<p";
                var replace2From = "</"+tag+">";
                var replace2To = "</p>";
                var newBlockText = closestBlockText.replace(replace1From, replace1To);
                newBlockText = newBlockText.replace(replace2From, replace2To);
                
                var confirm = $mdDialog.confirm()
                .title('Do you want to remove the header tag?')
                .textContent("You are going replace from " + closestBlockText + " to " + newBlockText)
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.blogpost.content = preText + newBlockText + postText;
                }, function() {
                  //nothing
                });
                
                
            };
            
            $scope.getSelectionText = function() {
              var text = "";
              if (window.getSelection) {
                  text = window.getSelection().toString();
              } else if (document.selection && document.selection.type != "Control") {
                  text = document.selection.createRange().text;
              }
              return text;
            };
            var defaultBlogCover = "https://exambazaar.com/images/background/examinfo.jpg";
            if($scope.blogpost.coverPhoto){
                $scope.thisBlogCover = $scope.blogpost.coverPhoto;
            }else{
                $scope.thisBlogCover = defaultBlogCover;
            }
            //console.log($scope.blogpost.coverPhoto);
            
            
            $scope.urlslug = '';
            $scope.urlslugError = false;
            $scope.urlslugSet = false;
            
            
            $scope.addRemoveBlogExam = function(thisExam){
                if(!$scope.blogpost.exams){
                    $scope.blogpost.exams = [];
                }
                var eIndex = $scope.blogpost.exams.indexOf(thisExam._id);
                if(eIndex == -1){
                    $scope.blogpost.exams.push(thisExam._id);
                }else{
                    $scope.blogpost.exams.splice(eIndex, 1);
                }
            };
            $scope.addBlogExam = function(thisExam){
                if(!$scope.blogpost.exams){
                    $scope.blogpost.exams = [];
                }
                var eIndex = $scope.blogpost.exams.indexOf(thisExam._id);
                if(eIndex == -1){
                    $scope.blogpost.exams.push(thisExam._id);
                }else{
                    //exam already exists
                }
            };
            
            $scope.removeBlogExam = function(thisExam){
                if(!$scope.blogpost.exams){
                    //do nothing
                }else{
                    var eIndex = $scope.blogpost.exams.indexOf(thisExam._id);
                    if(eIndex == -1){
                        //do nothing
                    }else{
                         $scope.blogpost.exams.splice(eIndex, 1);
                    }
                }
            };
            
            $rootScope.$on("setBlogCoachingGroup", function(event, data){
                var newGroup = data.groupName;
                $scope.addBlogCoaching(newGroup);
            });
            
            $scope.addBlogCoaching = function(groupName){
                if(!$scope.blogpost.coachingGroups){
                    $scope.blogpost.coachingGroups = [];
                }
                var cIndex = $scope.blogpost.coachingGroups.indexOf(groupName);
                if(cIndex == -1){
                    $scope.blogpost.coachingGroups.push(groupName);
                }else{
                    //do nothing
                }
            };
            
            $scope.removeBlogCoaching = function(groupName){
                if($scope.blogpost.coachingGroups){
                    var cIndex = $scope.blogpost.coachingGroups.indexOf(groupName);
                    if(cIndex == -1){
                        //do nothing
                    }else{
                        $scope.blogpost.coachingGroups.splice(cIndex,1);
                    }
                }
            };
            
            $scope.newTagText = '';
            $scope.addGlobalBlogTag = function(newTagText){
                
                var blogTagForm = {
                    user: $scope.user._id,
                    tag: $scope.newTagText,
                };
                 blogTagService.saveblogTag(blogTagForm).success(function (data, status, headers) {
                     $scope.newTagText = '';
                     blogTagService.getblogTags().success(function (data, status, headers) {
                         $scope.allTags = data;
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            
            /*allTags: ['blogTagService',
                    function(blogTagService){
                    return blogTagService.getblogTags();
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],*/
            
            $scope.setBlogTag = function(newTag){
                if(!$scope.blogpost.blogTags){
                    $scope.blogpost.blogTags = [];
                }
                var newTagId = newTag._id;
                
                var tIndex = $scope.blogTagsList.indexOf(newTagId);
                if(tIndex == -1){
                    $scope.blogpost.blogTags.push(newTag);
                    $scope.blogTagsList = $scope.blogpost.blogTags.map(function(a) {return a._id;});
                }else{
                    //do nothing
                }
            };
            
            $scope.unsetBlogTag = function(newTag){
                if(!$scope.blogpost.blogTags){
                    $scope.blogpost.blogTags = [];
                }
                var newTagId = newTag._id;
                
                
                var tIndex = $scope.blogTagsList.indexOf(newTagId);
                if(tIndex == -1){
                    //do nothing
                }else{
                    $scope.blogpost.blogTags.splice(tIndex,1);
                    $scope.blogTagsList = $scope.blogpost.blogTags.map(function(a) {return a._id;});
                    
                }
            };
            
            
            $scope.urlslugDone = function(){
                //console.log($scope.newUrlslug);
                $scope.blogpost.urlslug = $scope.newUrlslug;
                console.log($scope.blogpost.urlslug);
                $mdDialog.hide();    
            };
            $scope.markExamsDone = function(){
                $mdDialog.hide();    
            };
            $scope.showBlogGalleryDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#blogGalleryDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            $scope.allExams = null;
            $scope.allStreams = null;
            $scope.showBlogExamDialog = function(ev) {
                if(!$scope.allExams || !$scope.allStreams){
                    ExamService.getExams().success(function (examdata, status, headers) {
                        $scope.allExams = examdata;
                        StreamService.getAllStreams().success(function (streamdata, status, headers) {
                            $scope.allStreams = streamdata;
                            $mdDialog.show({
                              contentElement: '#examDialog',
                              parent: angular.element(document.body),
                              targetEvent: ev,
                              clickOutsideToClose: true
                            }).finally(function() {
                                //$scope.userReviewMode = true;
                            });
                        })
                        .error(function (data, status, header, config) {
                            Notification.warning({message: "Something went wrong! Streams not loaded!",  positionY: 'top', positionX: 'right', delay: 1000});
                            console.log("Error ");
                        });
                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong! Exams not loaded!",  positionY: 'top', positionX: 'right', delay: 1000});
                        console.log("Error ");
                    });
                   
                }else{
                    $mdDialog.show({
                      contentElement: '#examDialog',
                      parent: angular.element(document.body),
                      targetEvent: ev,
                      clickOutsideToClose: true
                    }).finally(function() {
                        //$scope.userReviewMode = true;
                    });
                }
            };
            $scope.showBlogCoachingDialog = function(ev) {
                            
                $mdDialog.show({
                  contentElement: '#coachingDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            $scope.showBlogTagDialog = function(ev) {
                
                if(!$scope.allTags){
                    blogTagService.getblogTags().success(function (data, status, headers) {
                        console.log('Tags loaded!');
                        $scope.allTags = data;
                        $scope.blogTagsList = [];
                        if($scope.blogpost.blogTags){
                            $scope.blogTagsList = $scope.blogpost.blogTags.map(function(a) {return a._id;});
                        }
                        $mdDialog.show({
                          contentElement: '#tagDialog',
                          parent: angular.element(document.body),
                          targetEvent: ev,
                          clickOutsideToClose: true
                        }).finally(function() {
                            //$scope.userReviewMode = true;
                        });
                    })
                    .error(function (data, status, header, config) {
                        Notification.warning({message: "Something went wrong! Blog tags not loaded!",  positionY: 'top', positionX: 'right', delay: 1000});
                        console.log("Error ");
                    });
                   
                }else{
                    $mdDialog.show({
                      contentElement: '#tagDialog',
                      parent: angular.element(document.body),
                      targetEvent: ev,
                      clickOutsideToClose: true
                    }).finally(function() {
                        //$scope.userReviewMode = true;
                    });
                }
                
            };
            $scope.showVersionDialog = function(ev) {
            $mdDialog.show({
                  contentElement: '#versionDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            $scope.showHTMLDialog = function(ev) {
                
            $scope.editHTML = $scope.blogpost.content;    
            $mdDialog.show({
                  contentElement: '#HTMLDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: false,
                  escapeToClose: false,
                }).finally(function() {
                    //$scope.userReviewMode = true;
                });
            };
            $scope.markHTMLDone = function(){
                $scope.blogpost.content = $scope.editHTML;
                $mdDialog.hide();
            };
            $scope.mediumBindOptions = {
                toolbar: {
                    buttons: ['bold', 'italic', 'underline', 'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull', 'indent', 'outdent', 'anchor', 'h1','h2', 'h3', 'image', 'removeFormat', 'table', 'orderedlist', 'unorderedlist']
                },
                targetBlank: true,
                /*disableExtraSpaces: true,*/
                spellcheck: true,
                /*disableReturn: false,
                disableDoubleReturn: true,*/
                extensions: {
                    table: new MediumEditorTable()
                },
                anchor: {
                    placeholderText: 'Type a link',
                    customClassOption: 'btn',
                    customClassOptionText: 'Create Button'
                },
                keyboardCommands: {
                    /* This example includes the default options for keyboardCommands,
                       if nothing is passed this is what it used */
                    commands: [
                        {
                            command: 'bold',
                            key: 'B',
                            meta: true,
                            shift: false,
                            alt: false
                        },
                        {
                            command: 'italic',
                            key: 'I',
                            meta: true,
                            shift: false,
                            alt: false
                        },
                        {
                            command: 'underline',
                            key: 'U',
                            meta: true,
                            shift: false,
                            alt: false
                        }
                    ],
                },
                paste: {
                    
                    forcePlainText: false,
                    cleanPastedHTML: true,
                    /*cleanAttrs: ['class', 'style', 'dir'],
                    cleanTags: ['br', 'meta', 'body', 'section', 'aside', 'article',
                      'span', 'h1', 'h2','h3', 'font'],*/
                }
            };
            $scope.titleBindOptions = {
                /*toolbar: {
                    buttons: ['bold', 'italic', 'underline', 'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull', 'anchor', 'h1','h2', 'h3','removeFormat']
                },*/
                disableReturn: true,
                disableExtraSpaces: true,
                toolbar: false
            };
            
            $scope.$watch('blogpost.seoKeywords', function (newValue, oldValue, scope) {
                if(newValue && newValue.length > 0){
                    $scope.nKeywords = (newValue.match(new RegExp(",", "g")) || []).length + 1;
                    //console.log($scope.nKeywords);
                }

            }, true);
            var possibleBlocks = ["<h3","<h2","<h1"];
            var possibleBlocksClose = ["</h3>","</h2>","</h1>"];
            $scope.$watch('blogpost.content', function (newValue, oldValue, scope) {
                if(newValue && newValue.length > 0){
                    //console.log(newValue);
                    possibleBlocks.forEach(function(thisBlock, bindex){
                        var indices = getIndicesOf(thisBlock, newValue);
                        //console.log(thisBlock);
                        //console.log(indices);
                    });
                    
                }

            }, true);
            setInterval(function() {
                console.log('Autosave starting: ' + moment().format('DD-MMM HH:mm:ss'));
                $scope.saveBlogPost($scope.blogpost, 'Autosaved');
            }, 180 * 1000);
            
            $scope.saveBlogPost = function(blogpost, displayString){
                var doNotSend = ["__v", "_saved", "_autosaved"];
                if($scope.user && $scope.user._id){
                    
                
                var find = "EdBites";
                var fIndex = $scope.blogpost.title.indexOf(find);
                if(fIndex != -1){
                    $scope.blogpost.blogSeries = "EdBites";
                }
                
                $scope.blogpost.urlslug = slugify($scope.blogpost.title);
                blogpostService.slugExists($scope.blogpost.urlslug).success(function (data, status, headers) {
                    //console.log(data);
                    if(data == false){
                        var blogpostForm = {
                            savedBy: $scope.user._id,
                            autosave: false
                        };
                        if(displayString == 'Autosaved'){
                            blogpostForm.autosave = true;
                        }

                        for (var property in blogpost) {
                            blogpostForm[property] = blogpost[property];
                            
                        }
                        
                        blogpostService.saveblogpost(blogpostForm).success(function (data, status, headers) {
                            //$scope.showSavedDialog();
                            if(displayString == 'Autosaved'){
                                Notification.primary({message: "Blog "+ displayString + "!",  positionY: 'top', positionX: 'right', delay: 30000});
                            }else{
                                Notification.success({message: "Blog "+ displayString + "!",  positionY: 'top', positionX: 'right', delay: 3000});
                            }
                            
                        })
                        .error(function (data, status, header, config) {
                            Notification.warning({message: "Something went wrong! Blog not "+ displayString + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                            console.log("Error ");
                        });
                        
                        
                    }else{
                        if($scope.blogpost._id == data){
                            
                            var blogpostForm = {
                                savedBy: $scope.user._id,
                                autosave: false
                            };
                            if(displayString == 'Autosaved'){
                                blogpostForm.autosave = true;
                            }

                            for (var property in blogpost) {
                                var dIndex = doNotSend.indexOf(property);
                                if(dIndex == -1){
                                    blogpostForm[property] = blogpost[property];
                                }else{
                                    console.log('Ignored ' + property);
                                }
                            }
                            blogpostService.saveblogpost(blogpostForm).success(function (data, status, headers) {
                                $scope.blogpost = data;
                                if(displayString == 'Autosaved'){
                                    Notification.primary({message: "Blog "+ displayString + "!",  positionY: 'top', positionX: 'right', delay: 30000});
                                }else{
                                    Notification.success({message: "Blog "+ displayString + "!",  positionY: 'top', positionX: 'right', delay: 3000});
                                }
                            })
                            .error(function (data, status, header, config) {
                                Notification.warning({message: "Something went wrong! Blog not "+ displayString + "!",  positionY: 'top', positionX: 'right', delay: 1000});
                                
                                console.log("Error ");
                            });
                        }else{
                            $scope.showUrlslugDialog();
                        }
                        
                        

                    }

                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                }else{
                    Notification.warning({message: "You need to login before you can save changes!",  positionY: 'top', positionX: 'right', delay: 5000});
                }
                
            };
            
            $scope.blogPostVersions = function(blogpost){
                $scope.versions = [];
                if(blogpost._autosaved){
                    $scope.versions.push(blogpost._autosaved);
                }
                if(blogpost._saved && blogpost._saved.length > 0){
                    $scope.versions = $scope.versions.concat(blogpost._saved);
                }
                $scope.versions.forEach(function(thisVersion, vindex){
                    var thisUser = thisVersion.user;
                    if(thisUser){
                        if(thisUser._id){
                            thisUser = thisUser._id;
                        }

                        var bIndex = bloggerIds.indexOf(thisUser);
                        //console.log(bIndex);
                        if(bIndex != -1){
                            $scope.versions[vindex].user = $scope.allBloggers[bIndex];
                        }
                    }
                    
                });
                
                
                $scope.showVersionDialog();
            };
            $scope.setVersion = function(version){
                var fields = [];
                $scope.blogpost.title = version.title;
                $scope.blogpost.content = version.content;
                $scope.blogpost.coverPhoto = version.coverPhoto;
                $scope.blogpost.blogTags = version.blogTags;
                $scope.blogpost.blogSeries = version.blogSeries;
                $scope.blogpost.exams = version.exams;
                $scope.blogpost.coachingGroups = version.coachingGroups;
                $scope.blogpost.active = version.active;
                
                if($scope.blogpost.coverPhoto){
                    $scope.thisBlogCover = $scope.blogpost.coverPhoto;
                }else{
                    $scope.thisBlogCover = defaultBlogCover;
                }
                console.log($scope.thisBlogCover);
                $mdDialog.hide();
            };
            
            $scope.previewblogpost = function(blogpost){
                var blogpostSlug = blogpost.urlslug;
                var url = $state.href('showblog', {blogpostSlug: blogpostSlug});
                window.open(url,'_blank');    
            };
            
            $scope.enableblogpost = function(blogpost){
                blogpostService.enableblogpost(blogpost._id).success(function (data, status, headers) {
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            $scope.disableblogpost = function(blogpost){
                blogpostService.disableblogpost(blogpost._id).success(function (data, status, headers) {
                    $state.reload();
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
            $scope.dontsaveChanges = function(blogpost, ev){
                var confirm = $mdDialog.confirm()
                .title('Would you like to cancel all changes made?')
                .textContent('The blog will be set back to the latest save made by any user!')
                .ariaLabel('Lucky day')
                .targetEvent(ev)
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                  //$state.reload();
                    $scope.setToLastSavedVersion(blogpost);
                }, function() {
                  //nothing
                });
                
                
            };
            $scope.setToLastSavedVersion = function(blogpost){
                blogpostService.setToLastSavedVersion(blogpost._id).success(function (data, status, headers) {
                    console.log(data);
                    if(data && data._id){
                        var lastSavedBlog = data;
                        var savedBy = lastSavedBlog.user;
                        var _date = moment(lastSavedBlog._date).format("DD-MMM-YYYY HH:mm");
                        var bIndex = bloggerIds.indexOf(savedBy);
                        console.log(bIndex);
                        if(bIndex != -1){
                            savedBy = $scope.allBloggers[bIndex];
                        }
                        
                        $scope.blogpost.title = lastSavedBlog.title;
                        $scope.blogpost.content = lastSavedBlog.content;
                        $scope.blogpost.coverPhoto = lastSavedBlog.coverPhoto;
                        $scope.blogpost.blogTags = lastSavedBlog.blogTags;
                        $scope.blogpost.blogSeries = lastSavedBlog.blogSeries;
                        $scope.blogpost.exams = lastSavedBlog.exams;
                        $scope.blogpost.coachingGroups = lastSavedBlog.coachingGroups;
                        $scope.blogpost.active = lastSavedBlog.active;

                        if($scope.blogpost.coverPhoto){
                            $scope.thisBlogCover = $scope.blogpost.coverPhoto;
                        }else{
                            $scope.thisBlogCover = defaultBlogCover;
                        }
                        
                        
                        Notification.success({message: "Blog restored to last user save by " + savedBy.basic.name + " on " + _date,  positionY: 'top', positionX: 'right', delay: 10000});
                    }
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
            };
           
            $rootScope.pageTitle = $scope.blogpost.title + " | Exambazaar.com";
            
            
            $scope.removePic = function(image){
                
                var confirm = $mdDialog.confirm()
                .title('Would you like to delete this image?')
                .textContent('You will not be able to restore it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    var newPicForm ={
                        image: image,
                        userId: $scope.user._id
                    }; UserService.removeBlogGalleryPic(newPicForm).success(function (data, status, headers) {
                        UserService.getBlogger($scope.user._id).success(function (data, status, headers) {
                            var userGallery = data.blogger.gallery;
                            //console.log(userGallery);
                            $scope.blogGallery = userGallery;
                            $scope.showBlogGalleryDialog();
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                }, function() {
                  //nothing
                }); 
            };
            
            $scope.setInfographic = function(image){
                
                var confirm = $mdDialog.confirm()
                .title('Would you like to set this image as the blog infographic?')
                .textContent('You can always change this')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.blogpost.infographic = image;
                    Notification.primary({message: "All set! Remember to save the blog now!",  positionY: 'top', positionX: 'right', delay: 3000});
                }, function() {
                  //nothing
                }); 
            };
            $scope.setInfographicThumbnail = function(image){
                
                var confirm = $mdDialog.confirm()
                .title('Would you like to set this image as the blog infographic thumbnail?')
                .textContent('You can always change this')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.blogpost.infographicThumbnail = image;
                    Notification.primary({message: "All set! Remember to save the blog now!",  positionY: 'top', positionX: 'right', delay: 3000});
                }, function() {
                  //nothing
                }); 
            };
            $scope.removeAllBlogGallery = function(image){
                
                var confirm = $mdDialog.confirm()
                .title('Would you like to delete all images from your blog gallery?')
                .textContent('You will not be able to restore it later')
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    var newPicForm ={
                        userId: $scope.user._id
                    }; UserService.removeAllBlogGallery(newPicForm).success(function (data, status, headers) {
                        UserService.getBlogger($scope.user._id).success(function (data, status, headers) {
                            var userGallery = data.blogger.gallery;
                            $scope.blogGallery = userGallery;
                            $scope.showBlogGalleryDialog();
                            
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                        
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                }, function() {
                  //nothing
                }); 
            };
            $scope.uploadPic = function (newPic) {
                //var pic = $scope.newPic;
                var pic = [newPic];
                var nFiles = pic.length;

                var counter = 0;
                //console.log(JSON.stringify($scope.user));
                var userId = $scope.user._id;
                if (pic && pic.length) {

                pic.forEach(function(thisFile, index){
                var fileInfo = {
                    filename: thisFile.name,
                    contentType: thisFile.type
                }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                var s3Request = {};
                var allParams = data.params;
                for (var key in allParams) {
                  if (allParams.hasOwnProperty(key)) {
                    s3Request[key] = allParams[key];
                  }
                }

                s3Request.file = thisFile;
                Upload.upload({
                    url: data.endpoint_url,
                    data: s3Request
                }).then(function (resp) {
                    console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                    var picLink = $(resp.data).find('Location').text();
                    console.log(picLink);
                    

                    var newPicForm ={
                        image: picLink,
                        userId: userId
                    }; UserService.addBlogGalleryPic(newPicForm).success(function (data, status, headers) {
                        UserService.getBlogger($scope.user._id).success(function (data, status, headers) {
                            var userGallery = data.blogger.gallery;
                            //console.log(userGallery);
                            $scope.blogGallery = userGallery;
                        })
                        .error(function (data, status, header, config) {
                            console.log("Error ");
                        });
                        //$state.reload();
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    }, function (resp) {
                        console.log('Error status: ' + resp.status);
                    }, function (evt) {

                    });

                })
                .error(function (data, status, header, config) {
                    console.log("Error");
                });   

                });
                }
             };
            
            $scope.refreshPage = function(){
                $state.reload();    
            };
            $scope.uploadCover = function (coverPic) {
                var pic = [coverPic];
                var nFiles = pic.length;

                var counter = 0;
                var blogId = $scope.blogpost._id;
                if (pic && pic.length) {

                pic.forEach(function(thisFile, index){
                var fileInfo = {
                    filename: thisFile.name,
                    contentType: thisFile.type
                }; ImageService.s3Credentials(fileInfo).success(function (data, status, headers) {
                var s3Request = {};
                var allParams = data.params;
                for (var key in allParams) {
                  if (allParams.hasOwnProperty(key)) {
                    s3Request[key] = allParams[key];
                  }
                }

                s3Request.file = thisFile;
                Upload.upload({
                    url: data.endpoint_url,
                    data: s3Request
                }).then(function (resp) {
                    //console.log('Success ' + thisFile.name + 'uploaded. Response: ' + resp.data);
                    var picLink = $(resp.data).find('Location').text();
                    //console.log(picLink);
                    
                    var coverPicForm ={
                        image: picLink,
                        blogId: blogId
                    };
                     blogpostService.changeCover(coverPicForm).success(function (data, status, headers) {
                        console.log('Done');
                        if(data){
                            $scope.blogpost = data;
                            
                            if($scope.blogpost.coverPhoto){
                                $scope.thisBlogCover = $scope.blogpost.coverPhoto;
                            }else{
                                $scope.thisBlogCover = defaultBlogCover;
                            }
                            $scope.showCoverSavedDialog();
                            
                        }else{
                            console.log('Something went wrong in uploading cover photo!');
                        }
                    })
                    .error(function (data, status, header, config) {
                        console.log("Error ");
                    });
                    }, function (resp) {
                        console.log('Error status: ' + resp.status);
                    }, function (evt) {

                    });

                })
                .error(function (data, status, header, config) {
                    console.log("Error");
                });   

                });
                }
             };
            
            
             $scope.showCopiedDialog = function(text, ev) {
                $scope.copiedText = text;
                $mdDialog.show({
                  contentElement: '#copiedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            $scope.showSavedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#savedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
                $timeout(function(){
                    $mdDialog.cancel();
                },1000)
            };
            $scope.showCoverSavedDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#coverSavedDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: true
                });
            };
            $scope.showUrlslugDialog = function(ev) {
                $mdDialog.show({
                  contentElement: '#urlslugDialog',
                  parent: angular.element(document.body),
                  targetEvent: ev,
                  clickOutsideToClose: false,
                  escapeToClose: false,
                });
            };
            
            $scope.replaceHTML = function(){
                
                var nOccurences = ($scope.editHTML.match(new RegExp($scope.toreplaceText , "g")) || []).length;
                
                //console.log(nOccurences);
                
                var confirm = $mdDialog.confirm()
                .title('Would you like to replace the following ' + nOccurences + ' occurences ?')
                .textContent('Replace ' + $scope.toreplaceText + ' with: ' + $scope.replacingText)
                .ariaLabel('Lucky day')
                .targetEvent()
                .clickOutsideToClose(true)
                .ok('Confirm')
                .cancel('Cancel');
                $mdDialog.show(confirm).then(function() {
                    $scope.blogpost.content = $scope.editHTML.replace(new RegExp($scope.toreplaceText, 'g'), $scope.replacingText);
                    console.log($scope.editHTML);
                    
                    $scope.showHTMLDialog();
                }, function() {
                  //nothing
                });
            };
            
            
            
    }]);
    
    exambazaar.controller("showblogController", 
        [ '$scope','$http','$state', '$stateParams', '$document','blogpostService', 'thisblog', '$rootScope', 'Socialshare', '$location', '$window', 'pageTimer', 'viewService','$cookies', 'upvoteService', 'upvoteCount', 'commentService', 'thisblogComments', 'recommenedBlogs', function($scope,$http, $state, $stateParams, $document, blogpostService, thisblog, $rootScope, Socialshare, $location, $window, pageTimer, viewService,$cookies, upvoteService, upvoteCount, commentService, thisblogComments, recommenedBlogs){
            $scope.blogpost = thisblog.data;
            $scope.blogAuthors= null;
            if($scope.blogpost.user.facebookId){
                var profileId = $scope.blogpost.user.facebookId;
                
                /*if(profileId == '1721194871277063'){
                    profileId = "poulomi.mandal1";
                }
                if(profileId == '987472631384895'){
                    profileId = "Ayushjn1995";
                }*/
                if($scope.blogpost.user.blogger.facebookProfile){
                    $rootScope.blogAuthors = $scope.blogpost.user.blogger.facebookProfile;
                }else{
                    $rootScope.blogAuthors = "https://www.facebook.com/" + profileId;
                }
                
                //$rootScope.blogAuthors = profileId;
            }
            //$rootScope.blogAuthors = "https://www.facebook.com/exambazaar/";
            //console.log($rootScope.blogAuthors);   
            
            $scope.recommenedBlogs = recommenedBlogs.data;
            //console.log($scope.recommenedBlogs);
            $scope.suggestedBlogs = [];
            if($scope.recommenedBlogs.examBlogs){
                $scope.suggestedBlogs = $scope.suggestedBlogs.concat($scope.recommenedBlogs.examBlogs);
            }
            if($scope.recommenedBlogs.blogSeries){
                $scope.suggestedBlogs = $scope.suggestedBlogs.concat($scope.recommenedBlogs.blogSeries);
            }
            if($scope.recommenedBlogs.coachingBlogs){
                $scope.suggestedBlogs = $scope.suggestedBlogs.concat($scope.recommenedBlogs.coachingBlogs);
            }
            if($scope.recommenedBlogs.blogAuthor){
                $scope.suggestedBlogs = $scope.suggestedBlogs.concat($scope.recommenedBlogs.blogAuthor);
            }
            if($scope.suggestedBlogs.length > 6){
                $scope.suggestedBlogs = $scope.suggestedBlogs.slice(0, 6);
            }
            
            
            var suggestedBlogURLs = [];
            if($scope.suggestedBlogs && $scope.suggestedBlogs.length > 0){
                suggestedBlogURLs = $scope.suggestedBlogs.map(function(a) {return a.urlslug;});
            }
            suggestedBlogURLs.forEach(function(thisURL, uIndex){
                suggestedBlogURLs[uIndex] = "https://www.exambazaar.com/blogpost/" + thisURL;
            });
            //console.log(suggestedBlogURLs);
            
            if(suggestedBlogURLs && suggestedBlogURLs.length > 0){
                
                $rootScope.pageSeeAlso = suggestedBlogURLs;
            }
            
            
            $scope.blogComments = thisblogComments.data;
            $scope.blogpost.upvotes = upvoteCount.data;
            
            $scope.lockContent = false;
            $scope.addedUpvoteIds = [];
            $scope.userUpvotes = [];
            
            $scope.newComment = {
                blogpost: $scope.blogpost._id,
                comment: '',
            };
            $scope.commentPlaceholder = 'Type in your comment here';
            
            if($cookies.getObject('sessionuser')){
                $scope.user = $cookies.getObject('sessionuser');
                upvoteService.blogpostUserUpvotes($scope.user._id).success(function (data, status, headers) {
                    $scope.userUpvotes = data;
                })
                .error(function (data, status, header, config) {
                    console.log();
                });
                if($scope.user){
                    $scope.newComment.user = $scope.user
                }
                
               var commentForm = {
                   user: $scope.user._id,
                   blogpost: $scope.blogpost._id,
               };
                commentService.userBlogpostcomment(commentForm).success(function (data, status, headers) {
                    $scope.thisUserComment = data;
                    if(!$scope.thisUserComment){
                        $scope.thisUserComment = $scope.newComment;
                    }
                    //console.log($scope.thisUserComment);
                })
                .error(function (data, status, header, config) {
                    console.log();
                });
                
                
            }else{
                if($scope.lockContent){
                    var nContent = $scope.blogpost.content.length;
                    var cutoff = Math.round(nContent/4);
                    var cutoff2 = Math.round(2*nContent/4);
                    var cutoff3 = Math.round(3*nContent/4);
                    $scope.blogpost.lockedcontent1 = $scope.blogpost.content.substring(cutoff, cutoff2);

                    $scope.blogpost.lockedcontent2 = $scope.blogpost.content.substring(cutoff2, cutoff3);
                    $scope.blogpost.lockedcontent3 = $scope.blogpost.content.substring(cutoff3, nContent);

                    $scope.blogpost.content = $scope.blogpost.content.substring(0, cutoff);

                    //console.log($scope.blogpost.lockedcontent);

                    
                }
                if(!$scope.thisUserComment){
                    $scope.thisUserComment = $scope.newComment;
                }
                $scope.thisUserComment.user = {
                    basic: {
                        name: 'New User'
                    },
                    image: 'images/user.png',
                }
            }
            
            if(!$scope.blogpost){
                window.location = "http://www.exambazaar.com/error";
            }
            
            $scope.goToBlog = function(blog){
                console.log(blog);
                var url = $state.href('showblog', {blogpostSlug: blog.urlslug});
                window.open(url,'_blank');  
            };
            $scope.goToRankerWall = function(rankerWall){
                window.open(rankerWall.link,'_blank');    
            };
            $scope.editBlogPost = function(blogpost){
                
                var blogpostId = blogpost._id;
                var url = $state.href('editblog', {blogpostId: blogpostId});
                window.open(url,'_blank');
            };
            $scope.rankerWalls = [
                {
                    title: 'NEET 2017 Rankers Wall',
                    subtitle: 'Check out the standouts, the makers of history. NEET 2017 Top 100 Rankers and their Coachings!',
                    coverPhoto: 'https://exambazaar.s3.amazonaws.com/58230ffc8814bc38104336952fcefd1f.PNG',
                    readingTime: {
                        text: '3 min read'
                    },
                    link: 'https://exambazaar.com/rankerswall/NEET%20UG/2017',
                },
                {
                    title: 'JEE Advanced 2017 Rankers Wall',
                    subtitle: 'Check out the standouts, the makers of history. JEE Advance 2017 Top 100 Rankers and their Coachings!',
                    coverPhoto: 'https://exambazaar.s3.amazonaws.com/506113959c79568cc8329504a61111a6.PNG',
                    readingTime: {
                        text: '2 min read'
                    },
                    link: 'https://exambazaar.com/rankerswall/NEET%20UG/2017',
                },
                
            ];
            
            var defaultBlogCover = "images/background/examinfo.jpg";
            if($scope.blogpost.coverPhoto){
                $scope.thisBlogCover = $scope.blogpost.coverPhoto;
            }else{
                $scope.thisBlogCover = defaultBlogCover;
            }
            
            
            $scope.shareText = "Hi! Read the exam preparation blog at Exambazaar! ";
            $scope.shareText2 = $scope.shareText;
            $scope.currURL = $location.absUrl();
            $scope.prefix = "https://exambazaar.com/blogpost/";
            $scope.shareURL = function(blogpost){
                return ($scope.prefix + blogpost.urlslug);
            };
            $scope.shareBlogText = function(blogpost){
                return ('"' + blogpost.title + '"' + " | Read all about exam preparation ");
            };
            $scope.postFacebook = function(blogpost){
                Socialshare.share({
                  'provider': 'facebook',
                  'attrs': {
                    'socialshareType': 'feed',
                    'socialshareUrl': $scope.shareURL(blogpost),
                    'socialshareVia':"1236747093103286",  'socialshareRedirectUri': 'https://www.exambazaar.com',
                  }
                });    
            };
            $scope.shareFacebook = function(){
                Socialshare.share({
                  'provider': 'facebook',
                  'attrs': {
                    'socialshareType': 'send',
                    'socialshareUrl': $scope.currURL,
                    'socialshareVia':"1236747093103286",  'socialshareRedirectUri': 'https://www.exambazaar.com',
                  }
                });
            };
           
            $scope.continueReading = function(){
                $rootScope.$emit("CallBlogLogin", {});    
            };
            $scope.upvoteExists = function(blogpost){
                var uIndex = $scope.userUpvotes.indexOf(blogpost._id);
                if(uIndex == -1){
                    return false;
                }else{
                    return true;
                }
            };
            
            $scope.saveupvote = function(blogpost){
                var upvoteForm = {
                    blogpost: blogpost._id,
                };
                if($scope.user && $scope.user._id){
                    upvoteForm.user = $scope.user._id;
                }
                upvoteService.saveupvote(upvoteForm).success(function (savedata, status, headers) {    
                    upvoteService.blogpostUpvoteCount(blogpost.urlslug).success(function (data, status, headers) {
                         $scope.userUpvotes.push(blogpost._id);
                         blogpost.upvotes = data;

                    })
                    .error(function (data, status, header, config) {
                        console.log();
                    });
                })
                .error(function (data, status, header, config) {
                    console.log();
                });
            };
            
            $scope.removeupvote = function(blogpost){
                if($scope.user && $scope.user._id){
                    var removeupvoteForm = {
                        blogpost: blogpost._id,
                        user: $scope.user._id,
                    };
                     upvoteService.removeupvote(removeupvoteForm).success(function (data, status, headers) {
                        upvoteService.blogpostUpvoteCount(blogpost.urlslug).success(function (sdata, status, headers) {    
                         upvoteService.blogpostUserUpvotes($scope.user._id).success(function (data, status, headers) {
                                $scope.userUpvotes = data;
                                blogpost.upvotes = sdata;
                            })
                            .error(function (data, status, header, config) {
                                console.log();
                            });

                        })
                        .error(function (data, status, header, config) {
                            console.log();
                        });
                    })
                    .error(function (data, status, header, config) {
                        console.log();
                    });   
                }
            };
            
            $rootScope.pageTitle = $scope.blogpost.title + " | Exambazaar.com";
            $rootScope.pageImage = $scope.thisBlogCover;
            
            $rootScope.pageDescription =  $scope.blogpost.seoDescription;
            $rootScope.pageKeywords =  $scope.blogpost.seoKeywords;
            
            var viewForm = {
                state: $state.current.name,
                claim: false,
                url: $location.url()
            };
            if($scope.user && $scope.user.userId){
                viewForm.user = $scope.user.userId
            }
            //console.log(JSON.stringify(viewForm));
            if($cookies.getObject('ip')){
                var ip = $cookies.getObject('ip');
                viewForm.ip = ip;
            }
            viewService.saveview(viewForm).success(function (data, status, headers) {
                //console.log('View Marked');
            })
            .error(function (data, status, header, config) {
                console.log();
            });
            
            $scope.backToBlog = function(){
                $state.go('blog');    
            };
            
            $rootScope.$on("userset", function(){
                if($cookies.getObject('sessionuser')){
                    $scope.user = $cookies.getObject('sessionuser');
                    upvoteService.blogpostUserUpvotes($scope.user._id).success(function (data, status, headers) {
                        $scope.userUpvotes = data;
                    })
                    .error(function (data, status, header, config) {
                        console.log();
                    });
                    if($scope.user){
                        $scope.newComment.user = $scope.user
                    }

                   var commentForm = {
                       user: $scope.user._id,
                       blogpost: $scope.blogpost._id,
                   };
                    commentService.userBlogpostcomment(commentForm).success(function (data, status, headers) {
                        $scope.thisUserComment = data;
                        if(!$scope.thisUserComment){
                            $scope.thisUserComment = $scope.newComment;
                        }
                        //console.log($scope.thisUserComment);
                    })
                    .error(function (data, status, header, config) {
                        console.log();
                    });
                    
                    console.log($scope.user);
                    $scope.submitComment();
                }
                
            });
            $scope.submitComment = function(){
                
                var commentForm = $scope.thisUserComment;
                commentForm.user = null;
                if($scope.user && $scope.user._id){
                    commentForm.user = $scope.user._id;
                }
                if(!commentForm.user){
                    console.log('User not set');
                    $rootScope.$emit("CallBlogLogin", {});
                    
                    
                }else{
                    commentService.savecomment(commentForm).success(function (savedata, status, headers) { 
                        $scope.thisUserComment = savedata;
                       
                        commentService.blogpostComments($stateParams.blogpostSlug).success(function (data, status, headers) {
                            $scope.blogComments = data;
                        })
                        .error(function (data, status, header, config) {
                            console.log('Error');
                        });
                    })
                    .error(function (data, status, header, config) {
                        console.log('Error');
                    });
                }
            };
            /*$document.on('mouseleave', leaveFromTop);

            function leaveFromTop(e){
                if( e.clientY < 0 && !$rootScope.fblikeDialog && $scope.t.counts > 10){
                    //console.log($rootScope.fblikeDialog);
                    $rootScope.showfblikeDialog();
                }
                //console.log($scope.t.counts);
            };*/
            $scope.t = pageTimer(1000);
    }]);
    exambazaar.controller("userSurveyController", 
        [ '$scope','$http','$state','UserService', 'thisuser', 'allUsers', '$rootScope', function($scope,$http, $state, UserService, thisuser, allUsers, $rootScope){
            $scope.user = thisuser.data;
            $scope.allTypeUsers = allUsers.data;
            $scope.allUsers = [];
            
            $scope.allTypeUsers.forEach(function(thisUser, uIndex){
                if(!thisUser.basic || !thisUser.basic.name){
                    //console.log(thisUser._id);
                }
                $scope.allUsers.push(thisUser);
                /*if(thisUser.userType == 'Master'){
                    $scope.allUsers.push(thisUser);
                }*/
            });
            
            $scope.selectedUsers = [];
            
            $scope.addAllUsers = function(){
                $scope.selectedUsers = $scope.allUsers;
            };
            $scope.addUser = function(newuser){
                var userIds = $scope.selectedUsers.map(function(a) {return a._id;});
                var uIndex = userIds.indexOf(newuser._id);
                
                if(uIndex == -1){
                    $scope.selectedUsers.push(newuser);
                }else{
                    console.log('Already added!');
                }
                
            };
            
            $scope.selectedBackground = function(thisuser){
                var userIds = $scope.selectedUsers.map(function(a) {return a._id;});
                var uIndex = userIds.indexOf(thisuser._id);
                
                if(uIndex == -1){
                    return false;
                }else{
                    return true;
                }
            };
            
            $scope.sendSurvey = function(){
                console.log("Sending survey to " + $scope.selectedUsers.length + " users");
                
                UserService.userSurvey($scope.selectedUsers).success(function (data, status, headers) {
                    
                    console.log("Done");
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                
            };
            
            $rootScope.pageTitle = "User Survey";
    }]); 
        
    exambazaar.controller("userMarketingController", 
        [ '$scope','$http','$state','UserService', 'thisuser', 'allUsers', '$rootScope', function($scope,$http, $state, UserService, thisuser, allUsers, $rootScope){
            $scope.user = thisuser.data;
            $scope.allTypeUsers = allUsers.data;
            $scope.allUsers = [];
            
            $scope.allTypeUsers.forEach(function(thisUser, uIndex){
                if(!thisUser.basic || !thisUser.basic.name){
                    console.log(thisUser._id);
                }
                if((thisUser.userType == 'Student' || thisUser.userType == 'Intern - Business Development')){
                    $scope.allUsers.push(thisUser);
                }
            });
            
            $scope.selectedUsers = [];
            
            $scope.addAllUsers = function(){
                $scope.selectedUsers = $scope.allUsers;
            };
            $scope.addUser = function(newuser){
                var userIds = $scope.selectedUsers.map(function(a) {return a._id;});
                var uIndex = userIds.indexOf(newuser._id);
                
                if(uIndex == -1){
                    $scope.selectedUsers.push(newuser);
                }else{
                    console.log('Already added!');
                }
                
            };
            
            $scope.selectedBackground = function(thisuser){
                var userIds = $scope.selectedUsers.map(function(a) {return a._id;});
                var uIndex = userIds.indexOf(thisuser._id);
                
                if(uIndex == -1){
                    return false;
                }else{
                    return true;
                }
            };
            
            $scope.sendMarketing = function(){
                console.log("Sending marketing to " + $scope.selectedUsers.length + " users");
                
                UserService.userMarketing($scope.selectedUsers).success(function (data, status, headers) {
                    
                    console.log("Done");
                })
                .error(function (data, status, header, config) {
                    console.log("Error ");
                });
                
            };
            
            $rootScope.pageTitle = "User Marketing";
    }]);    
        
        
    exambazaar.config(function($mdDateLocaleProvider) {
    $mdDateLocaleProvider.formatDate = function(date) {
       return moment(date).format('MMM DD YYYY');
        };
    });
    exambazaar.factory('pageTimer', function($interval){
        return function(delay){
            var initialMs= (new Date()).getTime();
            var result = {totalMilliseconds:0, counts:0};                
            $interval(function() {
                result.totalMilliseconds = (new Date()).getTime() - initialMs;
                result.counts++;
            }, delay);
            return result;
        };
     });
        
    /*exambazaar.factory('metaService', function () {
        var title = 'Exambazaar: Select the stream you want to study',
        description = 'Exambazaar is Indiaâ€™s biggest and largest education discovery platform and is the fastest way to discover best coaching classes in your city. Our easy-to-use website shows you all the coaching classes based on study streams, along with courses, photos, vidoes and results. Exambazaar also provides comprehensive information for test prep for entrance exams in India, colleges, courses, universities and career options. You can find information about more than 50 exams and coaching classes to succeed',
        service = {
            title: getTitle,
            setTitle: setTitle,
            description: getDescription,
            setDescription: setDescription
        };
        return service;
        function getTitle() {
            return title;
        }
        function setTitle(newTitle) {
            //alert(newTitle);
            title = newTitle;
        }
        function getDescription() {
            return description;
        }
        function setDescription(newDescription) {
            description = newDescription;
        }
    });  
    */
    exambazaar.config(function ($httpProvider) {
        $httpProvider.interceptors.push(function($q, $location) {
          return {
            response: function(response) {
              // do something on success
                return response;
            },
            responseError: function(response) {
              if (response.status === 401)
                $location.url('/login');
              return $q.reject(response);
            }
          };
        });
    });
        

    var checkLoggedin = function($q, $timeout, $http, $location, $rootScope){
      // Initialize a new promise
      var deferred = $q.defer();

      // Make an AJAX call to check if the user is logged in
      $http.get('/loggedin').success(function(user){
        // Authenticated
        if (user !== '0'){
          deferred.resolve();
        }
        // Not Authenticated
        else {
          $rootScope.message = 'You need to log in.';
          deferred.reject();
          $location.url('/login');
        }
      });
      return deferred.promise;
    };
    exambazaar.config(function($stateProvider, $urlRouterProvider,$locationProvider) {
    $urlRouterProvider.otherwise('/thankyou');
    $stateProvider
        .state('landing', {
            url: '/',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'p0.html',
                    controller: 'p0Controller'
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            }
        })
        
        .state('login', {
            url: '/login',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'login.html',
                    controller: 'loginController'
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            }
        })
        .state('main', {
            url: '/stream',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'p1.html',
                    controller: 'streamController'
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                stream: function() { return {}; }
            }
        })
        .state('signup', {
                url: '/signup',
                views: {
                    'header':{
                        templateUrl: 'header.html',
                        
                    },
                    'body':{
                        templateUrl: 'signup.html',
                        controller: 'signupController'
                    },
                    'footer': {
                        templateUrl: 'footer.html'
                    }
                }
            })
        .state('category', {
            url: '/stream/:categoryName',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'p2.html',
                    controller: 'categoryController'
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                examList: ['ExamService','$stateParams',
                    function(ExamService,$stateParams){
                    return ExamService.getStreamExams($stateParams.categoryName);
                }],
                exam: function() { return {}; }
            }
        })
        .state('city', {
            url: '/stream/:categoryName/:subCategoryName',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'p3.html',
                    controller: 'cityController'
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisStream: ['StreamService','$stateParams',
                    function(StreamService,$stateParams){
                    return StreamService.getStreamByName($stateParams.categoryName);
                }],
                thisExam: ['ExamService','$stateParams',
                    function(ExamService,$stateParams){
                    return ExamService.getExamBasicByName($stateParams.subCategoryName);
                }],
            }
        
        
        })
        .state('topCoaching', {
            url: '/topCoaching/:categoryName/:subCategoryName',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'topCoaching.html',
                    controller: 'topCoachingController'
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisStream: ['StreamService','$stateParams',
                    function(StreamService,$stateParams){
                    return StreamService.getStreamByName($stateParams.categoryName);
                }],
                thisExam: ['ExamService','$stateParams',
                    function(ExamService,$stateParams){
                    return ExamService.getExamBasicByName($stateParams.subCategoryName);
                }],
                topCoachings: ['blogpostService','$stateParams',
                    function(blogpostService,$stateParams){
                    return blogpostService.topCoaching($stateParams.subCategoryName);
                }],
                
            }
        
        
        })
        .state('findCoaching', {
            url: '/stream/:categoryName/:subCategoryName/:cityName',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'p4.html',
                    controller: 'p4Controller',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisStream: ['StreamService','$stateParams',
                    function(StreamService,$stateParams){
                    return StreamService.getStreamByName($stateParams.categoryName);
                }],
                thisExam: ['ExamService','$stateParams',
                    function(ExamService,$stateParams){
                    return ExamService.getExamBasicByName($stateParams.subCategoryName);
                }],
                streamExams: ['ExamService','$stateParams',
                    function(ExamService,$stateParams){
                    return ExamService.getStreamExams($stateParams.categoryName);
                }],
                
                /*targetStudyProvidersList: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {
                    var cityCourse = {
                        city: $stateParams.cityName,
                        course: $stateParams.subCategoryName
                    };
                        
                    return targetStudyProviderService.getCourseProviders(cityCourse);
                       
                }],*/
                suggestedblogs: ['blogpostService','$stateParams',
                    function(blogpostService,$stateParams){
                    return blogpostService.suggestedblogs($stateParams.subCategoryName);
                }],
                loadInfiniteScroll: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['infiniteScroll'], {serie: true});
                }],
                
                
            }
        })
        .state('showCoaching', {
            url: '/stream/:categoryName/:subCategoryName/:cityName/:coachingId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'showCoaching.html',
                    controller: 'showCoachingController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisStream: ['StreamService','$stateParams',
                    function(StreamService,$stateParams){
                    return StreamService.getStreamByName($stateParams.categoryName);
                }],
                thisExam: ['ExamService','$stateParams',
                    function(ExamService,$stateParams){
                    return ExamService.getExamByName($stateParams.subCategoryName);
                }],
                thisProvider: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {  
                    return targetStudyProviderService.getProvider($stateParams.coachingId);
                }],
                
                
            }
        })
        .state('availDiscount', {
            url: '/availDiscount/:categoryName/:subCategoryName/:cityName/:groupName',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'availDiscount.html',
                    controller: 'availDiscountController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisGroup: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {
                    var groupCity = {
                        groupName: $stateParams.groupName,
                        cityName: $stateParams.cityName,
                    };
                    return targetStudyProviderService.getGroupCity(groupCity);
                }],
                thisExam: ['ExamService','$stateParams',
                    function(ExamService,$stateParams){
                    return ExamService.getExamByName($stateParams.subCategoryName);
                }],
                /*thisStream: ['StreamService','$stateParams',
                    function(StreamService,$stateParams){
                    return StreamService.getStreamByName($stateParams.categoryName);
                }],
                thisExam: ['ExamService','$stateParams',
                    function(ExamService,$stateParams){
                    return ExamService.getExamByName($stateParams.subCategoryName);
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                
                thisGroupResults: ['resultService','$stateParams',
                    function(resultService,$stateParams) {
                    var groupCity = {
                        groupName: $stateParams.groupName,
                        cityName: $stateParams.cityName,
                        examName: $stateParams.subCategoryName
                    };
                    return resultService.groupResults(groupCity);
                }],
                bootstrapAffix: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['bootstrapAffix'], {serie: true});
                }],*/
                
                
                
            }
        })
        .state('showGroup', {
            url: '/group/:categoryName/:subCategoryName/:cityName/:groupName',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'p5.html',
                    controller: 'p5Controller',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisStream: ['StreamService','$stateParams',
                    function(StreamService,$stateParams){
                    return StreamService.getStreamByName($stateParams.categoryName);
                }],
                thisExam: ['ExamService','$stateParams',
                    function(ExamService,$stateParams){
                    return ExamService.getExamByName($stateParams.subCategoryName);
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                thisGroup: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {
                    var groupCity = {
                        groupName: $stateParams.groupName,
                        cityName: $stateParams.cityName,
                    };
                    return targetStudyProviderService.getGroupCity(groupCity);
                }],
                thisGroupResults: ['resultService','$stateParams',
                    function(resultService,$stateParams) {
                    var groupCity = {
                        groupName: $stateParams.groupName,
                        cityName: $stateParams.cityName,
                        examName: $stateParams.subCategoryName
                    };
                    return resultService.groupResults(groupCity);
                }],
                bootstrapAffix: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['bootstrapAffix'], {serie: true});
                }],
                
                
                
            }
        })
        .state('claim', {
            url: '/claim/:coachingId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'claim.html',
                    controller: 'claimController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisProvider: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {  
                    return targetStudyProviderService.getProvider($stateParams.coachingId);
                }],
                thisGroupInfo: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {  
                    return targetStudyProviderService.getGroupInfo($stateParams.coachingId);
                }],
                imageMediaTagList:['MediaTagService','$stateParams',
                    function(MediaTagService) {  
                    return MediaTagService.getMediaTagByType('Image');
                }],
                videoMediaTagList:['MediaTagService','$stateParams',
                    function(MediaTagService) {  
                    return MediaTagService.getMediaTagByType('Video');
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                cisavedUsersList: ['targetStudyProviderService', '$stateParams',
                    function(targetStudyProviderService,$stateParams) {  
                    return targetStudyProviderService.cisavedUsers($stateParams.coachingId);
                }],
                loadHandsontable: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngHandsontable'], {serie: true});
                }],
                    
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],
                bootstrapAffix: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['bootstrapAffix'], {serie: true});
                }],
                
            }
        })
        .state('offers', {
            url: '/ebinternal/partner/:coachingId/offers',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'offers.html',
                    controller: 'offersController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisProvider: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {  
                    return targetStudyProviderService.getProvider($stateParams.coachingId);
                }],
                offersList: ['offerService','$stateParams',
                    function(offerService,$stateParams) {  
                    return offerService.getProviderOffers($stateParams.coachingId);
                }],
                couponsList: ['couponService',
                    function(couponService) {  
                    return couponService.getAllCodes();
                }],
                thisGroupInfo: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {  
                    return targetStudyProviderService.getGroupInfo($stateParams.coachingId);
                }],
                loadHandsontable: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngHandsontable'], {serie: true});
                }],
                
                
                
            }
        })
        .state('verifyClaim', {
            url: '/verifyClaim/:coachingId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'verifyClaim.html',
                    controller: 'verifyClaimController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisProvider: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {  
                    return targetStudyProviderService.getProvider($stateParams.coachingId);
                }],
                
                
            }
        })
        .state('verifyEmail', {
            url: '/verifyEmail/:userId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'verifyEmail.html',
                    controller: 'verifyEmailController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisUserEmailVerification: ['UserService','$stateParams',
                    function(UserService,$stateParams) {  
                    return UserService.verifyEmail($stateParams.userId);
                }],
                
                
            }
        })
        .state('socialLogin', {
            url: '/ebinternal/socialLogin',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'socialLogin.html',
                    controller: 'socialLoginController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                loadInfiniteScroll: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['infiniteScroll'], {serie: true});
                }],
            }
        })
        .state('contacts', {
            url: '/ebinternal/contacts',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'contacts.html',
                    controller: 'contactsController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                contactsSummary: ['targetStudyProviderService',
                    function(targetStudyProviderService) {
                    return targetStudyProviderService.contacts();
                }],
                
                
            }
        })
        .state('charting', {
            url: '/ebinternal/charting',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'charting.html',
                    controller: 'chartingController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                
                viewSummary: ['viewService',
                    function(viewService) {
                    return viewService.dailySummary();
                }],
                blogDailySummary: ['viewService',
                    function(viewService) {
                    return viewService.blogDailySummary();
                }],
                
                viewHourlyHeatmap: ['viewService',
                    function(viewService) {
                    return viewService.hourlyHeatmap();
                }],
                userSummary: ['UserService',
                    function(UserService) {
                    return UserService.dailySummary();
                }],
                userHourlyHeatmap: ['UserService',
                    function(UserService) {
                    return UserService.hourlyHeatmap();
                }],
                providerSummary: ['targetStudyProviderService',
                    function(targetStudyProviderService) {
                    return targetStudyProviderService.dailySummary();
                }],
                reviewSummary: ['reviewService',
                    function(reviewService) {
                    return reviewService.dailySummary();
                }],
                loadCharting: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['charting'], {serie: true});
                }],
                
                
                
            }
        })
        .state('activeUsers', {
            url: '/ebinternal/activeUsers/:userId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'activeUsers.html',
                    controller: 'activeUsersController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                activeUsers: ['UserService',
                    function(UserService) {   
                    return UserService.activeUsers(7);
                }],
                
                
            }
        })
        .state('allTests', {
            url: '/ebinternal/allTests',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'allTests.html',
                    controller: 'allTestsController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                testList: ['testService',
                    function(testService){
                    return testService.getTests();
                }],
                testswithQuestions: ['testService',
                    function(testService){
                    return testService.testsWithQuestions();
                }],
                
                
            }
        })
        .state('scheduleQAD', {
            url: '/ebinternal/scheduleQAD/:userId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'scheduleQAD.html',
                    controller: 'scheduleQADController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                allPages: ['socialMediaCredentialService',
                    function(socialMediaCredentialService){
                    return socialMediaCredentialService.getSocialMediaCredentials();
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                
            }
        })
        .state('eqad', {
            url: '/ebinternal/eqad/:examName/:eqadDate',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'eqad.html',
                    controller: 'eqadController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                /*thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                allPages: ['socialMediaCredentialService',
                    function(socialMediaCredentialService){
                    return socialMediaCredentialService.getSocialMediaCredentials();
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],*/
                thisexam: ['ExamService', '$stateParams',
                    function(ExamService,$stateParams) {
                    return ExamService.getExamByName($stateParams.examName);    
                }],
                ngSticky: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngSticky'], {serie: true});
                }],
            }
        })
        /*.state('aptitude', {
            url: '/career/aptitude',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'k21.html',
                    controller: 'k21Controller',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thistest: ['testService',
                    function(testService) {
                    return testService.getk21Test();    
                }],
                thistest: ['testService','$stateParams',
                    function(testService, $stateParams){
                    return testService.getTest('5a17f5f617cb4c07c5dd7f5b');
                }],
                thisTestQuestions: ['questionService','$stateParams',
                    function(questionService, $stateParams){
                        var testId = '5a17f5f617cb4c07c5dd7f5b';
                    return questionService.getTestQuestions(testId);
                }],
                angularTimer: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['angularTimer'], {serie: true});
                }],
            }
        })*/
        .state('careertest', {
            url: '/career/:domainName',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'careertest.html',
                    controller: 'careertestController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
        })
        .state('assessment', {
            url: '/assessment/:testId',
            views: {
                /*'header':{
                    templateUrl: 'header.html',
                    
                },*/
                'body':{
                    templateUrl: 'assessment.html',
                    controller: 'assessmentController',
                },
                /*'footer': {
                    templateUrl: 'footer.html'
                }*/
            },
            resolve: {
                thistest: ['testService','$stateParams',
                    function(testService, $stateParams){
                    return testService.getTest($stateParams.testId);
                }],
                thisTestQuestions: ['questionService','$stateParams',
                    function(questionService, $stateParams){
                        return questionService.getTestQuestions($stateParams.testId);
                }],
                angularTimer: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['angularTimer'], {serie: true});
                }],
                angularScreenfull: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['angularScreenfull'], {serie: true});
                }],
                
            }
        })
        .state('reportassessment', {
            url: '/reportassessment/:testId',
            views: {
                /*'header':{
                    templateUrl: 'header.html',
                    
                },*/
                'body':{
                    templateUrl: 'reportassessment.html',
                    controller: 'reportassessmentController',
                },
                /*'footer': {
                    templateUrl: 'footer.html'
                }*/
            },
            resolve: {
                thistest: ['testService','$stateParams',
                    function(testService, $stateParams){
                    return testService.getTest($stateParams.testId);
                }],
                thisanswerkey: ['testService','$stateParams',
                    function(testService, $stateParams){
                    return testService.answerKey($stateParams.testId);
                }],
                
                thisTestQuestions: ['questionService','$stateParams',
                    function(questionService, $stateParams){
                        return questionService.getTestQuestions($stateParams.testId);
                }],
                angularScreenfull: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['angularScreenfull'], {serie: true});
                }],
                
            }
        })
        .state('k21Test', {
            url: '/k21Test',
            views: {
                'header':{
                    /*templateUrl: 'header.html',*/
                    
                },
                'body':{
                    templateUrl: 'k21Test.html',
                    controller: 'k21TestController',
                },
                'footer': {
                    /*templateUrl: 'footer.html'*/
                }
            },
            resolve: {
                thistest: ['testService',
                    function(testService) {
                    return testService.getk21Test();    
                }],
                thisTestQuestions: ['questionService','$stateParams',
                    function(questionService, $stateParams){
                        var testId = '5a17f5f617cb4c07c5dd7f5b';
                    return questionService.getTestQuestions(testId);
                }],
                angularTimer: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['angularTimer'], {serie: true});
                }],
            }
        })
        .state('aroundme', {
            url: '/aroundme',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'aroundme.html',
                    controller: 'aroundmeController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExamsBasic();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }]
                
            }
        
            
        })
        .state('postBlog', {
            url: '/ebinternal/postBlog',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'postBlog.html',
                    controller: 'postBlogController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                allBloggers: ['UserService',
                    function(UserService){
                    return UserService.allBloggers();
                }],
                
                allBlogsUpvotesCount: ['upvoteService',
                    function(upvoteService) {
                    return upvoteService.allBlogsUpvotesCount();
                }],
                mediumEditor: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['mediumEditor'], {serie: true});
                }],
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],
                
            }
        })
        .state('allOffers', {
            url: '/ebinternal/allOffers',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'allOffers.html',
                    controller: 'allOffersController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                allOffers: ['offerService', '$stateParams',
                    function(offerService,$stateParams){
                    return offerService.getOffers();
                }],
                
                
            }
        })
        .state('allreviews', {
            url: '/ebinternal/allreviews',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'allreviews.html',
                    controller: 'allreviewsController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                allReviews: ['reviewService',
                    function(reviewService) {   
                    return reviewService.getreviews();
                }],
                
                
            }
        })
        .state('testAssessmentResult', {
            url: '/ebinternal/testAssessment',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'testAssessmentResult.html',
                    controller: 'testAssessmentResultController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                assessments: ['assessmentService',
                    function(assessmentService) {   
                    return assessmentService.getAssessments();
                }],
                
                
            }
        })
        .state('allblogtags', {
            url: '/ebinternal/allblogtags',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'allblogtags.html',
                    controller: 'allblogtagsController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                allblogtags: ['blogTagService',
                    function(blogTagService) {   
                    return blogTagService.getblogTags();
                }],
                blogTagsSummary: ['blogTagService',
                    function(blogTagService) {   
                    return blogTagService.blogTagsSummary();
                }],
            }
        })
        .state('extractEmails', {
            url: '/ebinternal/extractEmails',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'extractEmails.html',
                    controller: 'extractEmailsController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            }
        })
        .state('coachingGroupSummary', {
            url: '/ebinternal/coachingGroupSummary',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'coachingGroupSummary.html',
                    controller: 'coachingGroupSummaryController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                groupSummary: ['targetStudyProviderService',
                    function(targetStudyProviderService){
                    return targetStudyProviderService.groupSummaryService();
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
            }
        })
        .state('rankerswall', {
            url: '/rankerswall/:examName/:year',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'rankerswall.html',
                    controller: 'rankerswallController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisExam: ['ExamService','$stateParams',
                    function(ExamService,$stateParams){
                    return ExamService.getExamByName($stateParams.examName);
                }],
                allResults: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService, $stateParams) {   
                    return targetStudyProviderService.allResults($stateParams.examName);
                }],
                
                
            }
        })
        .state('search', {
            url: '/ebinternal/search',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'search.html',
                    controller: 'searchController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                targetStudyProvidersList: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService) {   
                    return targetStudyProviderService.coachingAddressService();
                }],
                
                
            }
        })
        .state('suggestCoaching', {
            url: '/ebinternal/user/:userId/suggestCoaching',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'suggestCoaching.html',
                    controller: 'suggestCoachingController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                
                suggestedList: ['suggestCoachingService','$stateParams',
                    function(suggestCoachingService) {   
                    return suggestCoachingService.getsuggestCoachings();
                }],
                
                
            }
        })
    
        .state('colleges', {
            url: '/ebinternal/colleges',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'colleges.html',
                    controller: 'collegesController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                internList: ['UserService',
                    function(UserService) {
                    return UserService.getInterns();
                }],
                AllIds: ['tofillcollegeService',
                    function(tofillcollegeService) {
                    return tofillcollegeService.getAllIds();
                }],
                
                
            }
        })
        .state('editCollege', {
            url: '/ebinternal/editCollege/:collegeId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'editCollege.html',
                    controller: 'editCollegeController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisCollege: ['collegeService', '$stateParams',
                    function(collegeService,$stateParams){
                    return collegeService.getCollege($stateParams.collegeId);
                }],
                
            }
        })
        .state('coachingGroup', {
            url: '/ebinternal/user/:userId/coachingGroup',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'coachingGroup.html',
                    controller: 'coachingGroupController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                loadHandsontable: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngHandsontable'], {serie: true});
                }],
                
            }
        })
        .state('review', {
            url: '/review',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'review.html',
                    controller: 'reviewController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                allcities: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService) {
                    return targetStudyProviderService.getCities();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                
                
            }
        })
        .state('profile', {
            url: '/ebinternal/profile',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'profile.html',
                    controller: 'profileController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],
                bootstrapAffix: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['bootstrapAffix'], {serie: true});
                }],
            }
        })
        .state('reviewed', {
        ///ebinternal/user/:userId/reviewed
            url: '/ebinternal/reviewed',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'reviewed.html',
                    controller: 'reviewedController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                /*thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                thisuserReviewed: ['reviewService', '$stateParams',
                    function(reviewService, $stateParams){
                    return reviewService.getuserReviews($stateParams.userId);
                }],
                
                activeOffers: ['offerService', '$stateParams',
                    function(offerService,$stateParams){
                    return offerService.getActiveOffersMedium();
                }],
                */
            }
        })
        .state('userInstitutes', {
            url: '/ebinternal/userInstitutes',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'userInstitutes.html',
                    controller: 'userInstitutesController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
            }
        })
        .state('academics', {
            url: '/ebinternal/academics',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'academics.html',
                    controller: 'academicsController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
            }
        })
        .state('cirf', {
            url: '/ebinternal/cirf',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'cirf.html',
                    controller: 'cirfController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExamsBasic();
                }],
            }
        })
        .state('addedInstitutes', {
            url: '/ebinternal/user/:userId/addedInstitutes',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addedInstitutes.html',
                    controller: 'addedInstitutesController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                ebteam: ['UserService',
                    function(UserService){
                    return UserService.getEBTeam();
                }],
                addedInstitutes: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getAddedInstitutes($stateParams.userId);
                }],
                
            }
        })
        .state('addedQuestions', {
            url: '/ebinternal/user/:userId/addedQuestions',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addedQuestions.html',
                    controller: 'addedQuestionsController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                ebteam: ['UserService',
                    function(UserService){
                    return UserService.getEBTeam();
                }],
                addedQuestions: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getAddedQuestions($stateParams.userId);
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
            }
        })
        .state('filledColleges', {
            url: '/ebinternal/user/:userId/filledColleges',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'filledColleges.html',
                    controller: 'filledCollegesController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                ebteam: ['UserService',
                    function(UserService){
                    return UserService.getEBTeam();
                }],
                filledColleges: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getFilledColleges($stateParams.userId);
                }],
            }
        })
        .state('analytics', {
            url: '/ebinternal/analytics',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'analytics.html',
                    controller: 'analyticsController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                
                
                
                
            }
        
        })
        .state('blog', {
            url: '/blog',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'blog.html',
                    controller: 'blogController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                /*allBlogs: ['blogpostService',
                    function(blogpostService) {   
                    return blogpostService.blogstream({skip:0});
                }],*/
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                loadInfiniteScroll: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['infiniteScroll'], {serie: true});
                }],
                allBlogsUpvotesCount: ['upvoteService',
                    function(upvoteService) {
                    return upvoteService.allBlogsUpvotesCount();
                }],
                
                
            }
        })
        .state('showblog', {
            url: '/blogpost/:blogpostSlug',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'showblog.html',
                    controller: 'showblogController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisblog: ['blogpostService', '$stateParams',
                    function(blogpostService,$stateParams){
                    return blogpostService.getblogpostFromSlug($stateParams.blogpostSlug);
                }],
                recommenedBlogs: ['blogpostService', '$stateParams',
                    function(blogpostService,$stateParams){
                    return blogpostService.recommenedBlogs($stateParams.blogpostSlug);
                }],
                
                thisblogComments: ['commentService', '$stateParams',
                    function(commentService,$stateParams){
                    return commentService.blogpostComments($stateParams.blogpostSlug);
                }],
                upvoteCount: ['upvoteService','$stateParams',
                    function(upvoteService,$stateParams) {
                    return upvoteService.blogpostUpvoteCount($stateParams.blogpostSlug);
                }],
                mediumEditor: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['mediumEditor'], {serie: true});
                }],
                
            }
        })
        .state('editblog', {
            url: '/ebinternal/editblog/:blogpostId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'editblog.html',
                    controller: 'editblogController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisblog: ['blogpostService', '$stateParams',
                    function(blogpostService,$stateParams){
                    return blogpostService.getblogpost($stateParams.blogpostId);
                }],
                allBloggers: ['UserService',
                    function(UserService){
                    return UserService.allBloggers();
                }],
                /*
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                allTags: ['blogTagService',
                    function(blogTagService){
                    return blogTagService.getblogTags();
                }],
                */
                mediumEditor: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['mediumEditor'], {serie: true});
                }],
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],
            }
        })
        .state('availOffer', {
            url: '/ebinternal/user/:userId/:reviewId/availoffer',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'availOffer.html',
                    controller: 'availOfferController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                activeOfferInstitutes: ['offerService',
                    function(offerService){
                    return offerService.getActiveOffersMedium();
                }],
                activeCoupons: ['couponService',
                    function(couponService){
                    return couponService.getOneOfEachActiveCoupon();
                }],
                thisReview: ['reviewService', '$stateParams',
                    function(reviewService, $stateParams){
                    return reviewService.getreview($stateParams.reviewId);
                }],
                
                
            }
        })
        .state('thankyou', {
            url: '/thankyou',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'thankyou.html',
                    controller: 'thankyouController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            }
        })
        .state('error', {
            url: '/ebinternal/error',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'error.html',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            }
        })
        .state('sandbox2', {
            url: '/ebinternal/master/:masterId/sandbox2/:cityName',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'sandbox2.html',
                    controller: 'sandbox2Controller',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                targetStudyProvidersList: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {
                    return targetStudyProviderService.sandbox2Service($stateParams.cityName);
                }],
                cityProviderCount: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {
                    return targetStudyProviderService.getCityProviderCount($stateParams.cityName);
                }],
                targetStudyCities: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService) {
                    return targetStudyProviderService.getCities();
                }],
                
                
            }
        })
        .state('eligibility', {
            url: '/exam-eligibility',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'eligibility.html',
                    controller: 'eligibilityController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                eligibilityList: ['EligibilityService',
                    function(EligibilityService){
                    return EligibilityService.getEligibilities();
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                
            }
        })
        .state('privacy', {
            url: '/privacy',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'privacyPolicy.html',
                    
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            }
        })
        .state('why', {
            url: '/ebinternal/why',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'p0.html',
                    controller: 'whyReviewController'
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            }
        })
        .state('about', {
            url: '/about',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'aboutus.html',
                    controller: 'aboutController'
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            }
        })
        .state('contact', {
            url: '/contact',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'contact.html',
                    controller: 'contactController'
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            }
        })
        .state('calendar', {
            url: '/ebinternal/calendar',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'calendar.html',
                    controller: 'calendarCtrl'
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            }
        })
    
        .state('emailToPublications', {
            url: '/ebinternal/emailToPublications',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'emailToPublications.html',
                    controller: 'emailToPublicationsController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                allEmails: ['PublicationEmailService',
                    function(PublicationEmailService){
                    return PublicationEmailService.getPublicationEmails();
                }],
                
                
            }
        })
        .state('sendEmail', {
            url: '/ebinternal/user/:userId/sendEmail',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'sendEmail.html',
                    controller: 'sendEmailController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                thisuserEmails: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getEmails($stateParams.userId);
                }],
                user: function() { return {}; }
            }
        })
        .state('userMarketing', {
            url: '/ebinternal/user/:userId/userMarketing',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'userMarketing.html',
                    controller: 'userMarketingController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                allUsers: ['UserService',
                    function(UserService){
                    return UserService.getUsers();
                }],
                user: function() { return {}; }
            }
        })
        .state('userSurvey', {
            url: '/ebinternal/user/:userId/userSurvey',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'userSurvey.html',
                    controller: 'userSurveyController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                allUsers: ['UserService',
                    function(UserService){
                    return UserService.getUsers();
                }],
                user: function() { return {}; }
            }
        })
        .state('providers', {
            url: '/ebinternal/coaching/database2/:city',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'getCoaching.html',
                    controller: 'mastergetCoachingController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                
                /*thismaster: ['MasterService', '$stateParams',
                    function(MasterService,$stateParams){
                    return MasterService.getMaster($stateParams.masterId);
                }],
                master: function() { return {}; },*/
                providersList: ['ProviderService','$stateParams',
                    function(ProviderService,$stateParams) {
                    return ProviderService.getProviders($stateParams.city);
                }],
                
            }   
        })
        .state('editTargetStudyProvider', {
            url: '/ebinternal/edit/database1/:coachingId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'editTargetStudyCoaching.html',
                    controller: 'editTargetStudyCoachingController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisTargetStudyProvider: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {
                    return targetStudyProviderService.getProvider($stateParams.coachingId);
                }],
                imageMediaTagList:['MediaTagService','$stateParams',
                    function(MediaTagService) {  
                    return MediaTagService.getMediaTagByType('Image');
                }],
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],
                
            }
        })
        .state('providersWithAreas', {
            url: '/ebinternal/coaching/providersWithAreas',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'providersWithAreas.html',
                    controller: 'providersWithAreasController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                targetStudyProvidersList: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {
                    return targetStudyProviderService.getProvidersWithAreas();
                }],
                
            }
        })
        .state('targetStudyProviders', {
            url: '/ebinternal/coaching/database1/:city',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'getTargetStudyCoaching.html',
                    controller: 'getTargetStudyCoachingController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                locationsList: ['LocationService','$stateParams',
                    function(LocationService,$stateParams) {
                    return LocationService.getCityLocations($stateParams.city);
                }],
                targetStudyProvidersList: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService,$stateParams) {   
                    return targetStudyProviderService.getProviders($stateParams.city);
                }],
                institutesSavedList: ['cisavedService',
                    function(cisavedService) {   
                    return cisavedService.institutesSaved();
                }],
                institutesFilledList: ['tofillciService',
                    function(tofillciService) {   
                    return tofillciService.institutesFilled();
                }],
                emailList: ['EmailService',
                    function(EmailService) {   
                    return EmailService.getEmails();
                }],
                targetStudyCities: ['targetStudyProviderService','$stateParams',
                    function(targetStudyProviderService) {
                    return targetStudyProviderService.getCities();
                }],
                loadAngularFileSaver: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['angularFileSaver'], {serie: true});
                }],
                
            }
        })
        .state('master-dashboard', {
            url: '/ebinternal/master/:masterId/dashboard',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'master-dashboard.html',
                    controller: 'masterDashboardController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                usersCount: ['UserService',
                    function(UserService) {
                    return UserService.getUsersCount();
                }],
                verifiedUsersCount: ['UserService',
                    function(UserService) {
                    return UserService.getVerfiedUsersCount();
                }],
                studentCount: ['UserService',
                    function(UserService) {
                    return UserService.getStudentCount();
                }],
                masterViewSummary: ['viewService',
                    function(viewService) {
                    return viewService.masterViewSummary();
                }],
                internList: ['UserService',
                    function(UserService) {
                    return UserService.getInterns();
                }],
                coachingCount: ['targetStudyProviderService',
                    function(targetStudyProviderService) {
                    return targetStudyProviderService.getCount();
                }],
                coachingSavedCount: ['cisavedService',
                    function(cisavedService) {
                    return cisavedService.savedCount();
                }],
                filledCount: ['tofillciService',
                    function(tofillciService) {
                    return tofillciService.filledCount();
                }],
                reviewsCount: ['reviewService',
                    function(reviewService) {
                    return reviewService.reviewsCount();
                }],
                couponsCount: ['couponService',
                    function(couponService) {
                    return couponService.couponsCount();
                }],
                issuedcouponsCount: ['couponService',
                    function(couponService) {
                    return couponService.issuedcouponsCount();
                }],
                tofillciList: ['tofillciService',
                    function(tofillciService) {
                    return tofillciService.gettofillcis();
                }],
                toverifyciList: ['toverifyciService',
                    function(toverifyciService) {
                    return toverifyciService.gettoverifycis();
                }],
                addContactInfoList: ['addContactInfoService',
                    function(addContactInfoService) {
                    return addContactInfoService.getaddContactInfos();
                }],
                rateInstituteList: ['rateInstituteService',
                    function(rateInstituteService) {
                    return rateInstituteService.getrateInstitutes();
                }],
                verifiedCount: ['toverifyciService',
                    function(toverifyciService) {
                    return toverifyciService.verifiedCount();
                }],
            }
        })
        .state('partner-dashboard', {
            url: '/ebinternal/partner/:userId/dashboard',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'partner-dashboard.html',
                    controller: 'partnerDashboardController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                //DEF
                thisPartner: ['UserService','$stateParams',
                    function(UserService,$stateParams) {  
                    return UserService.getPartner($stateParams.userId);
                }],
                
            }
        })
        .state('shortlisted', {
            url: '/ebinternal/user/:userId/shortlisted',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'shortlisted.html',
                    controller: 'shortlistedController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                thisuserShortlisted: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUserShortlisted($stateParams.userId);
                }],
                
                user: function() { return {}; }
            }
        })
        .state('viewed', {
            url: '/ebinternal/user/:userId/viewed',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'viewed.html',
                    controller: 'viewedController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                //DEF
                thisuserViewed: ['viewService', '$stateParams',
                    function(viewService,$stateParams){
                    return viewService.getuserviews($stateParams.userId);
                }],
                
                user: function() { return {}; }
            }
        })
        .state('filled', {
            url: '/ebinternal/user/:userId/filled',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'filled.html',
                    controller: 'filledCIController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                thisuserFilled: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUserFilled($stateParams.userId);
                }],
                
                user: function() { return {}; }
            }
        })
        .state('assigned', {
            url: '/ebinternal/fci',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'fci.html',
                    controller: 'fciController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                ebteam: ['UserService',
                    function(UserService){
                    return UserService.getEBTeam();
                }],
                tofillciList: ['tofillciService',
                    function(tofillciService) {
                    return tofillciService.gettofillcis();
                }],
            }
        })
        .state('assignedToVerify', {
            url: '/ebinternal/user/:userId/assignedToVerify',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'assignedToVerify.html',
                    controller: 'assignedToVerifyController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                thisuserAssignedToVerify: ['toverifyciService', '$stateParams',
                    function(toverifyciService,$stateParams){
                    return toverifyciService.getusertoverifycis($stateParams.userId);
                        
                }],
                
                user: function() { return {}; }
            }
        })
        .state('assignedToRate', {
            url: '/ebinternal/user/:userId/assignedToRate',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'assignedToRate.html',
                    controller: 'assignedToRateController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                thisuserAssignedToRate: ['rateInstituteService', '$stateParams',
                    function(rateInstituteService,$stateParams){
                    return rateInstituteService.getuserrateInstitute($stateParams.userId);
                        
                }],
                
                user: function() { return {}; }
            }
        })
        .state('assignedToAddContactInfo', {
            url: '/ebinternal/user/:userId/assignedToAddContactInfo',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'assignedToAddContactInfo.html',
                    controller: 'assignedToAddContactInfoController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                thisuserAssignedToAddContactInfo: ['addContactInfoService', '$stateParams',
                    function(addContactInfoService,$stateParams){
                    return addContactInfoService.getuseraddContactInfos($stateParams.userId);
                        
                }],
                
                user: function() { return {}; }
            }
        })
        .state('filledAll', {
            url: '/ebinternal/user/:userId/filledAll',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'filled.html',
                    controller: 'filledCIController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                thisuserFilled: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUserFilled('all');
                }],
                
                user: function() { return {}; }
            }
        })
        .state('group', {
            url: '/ebinternal/user/:userId/group',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'group.html',
                    controller: 'groupController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                user: function() { return {}; }
            }
        })
        
        .state('checkLogo', {
            url: '/ebinternal/user/:userId/checkLogo/:pageNumber/',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'checkLogo.html',
                    controller: 'checkLogoController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                logoList: ['targetStudyProviderService', '$stateParams',
                    function(targetStudyProviderService, $stateParams) {
                    return targetStudyProviderService.checkLogo($stateParams.pageNumber);
                }],
                
                user: function() { return {}; }
            }
        })
        .state('addStream', {
            url: '/ebinternal/addStream',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addStream.html',
                    controller: 'addStreamController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],
            }
        })
        .state('addOffer', {
            url: '/ebinternal/addOffer',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addOffer.html',
                    controller: 'addOfferController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                offersList: ['offerService',
                    function(offerService){
                    return offerService.getOffers();
                }],
                stream: function() { return {}; }
            }
        })
        .state('addLocation', {
            url: '/ebinternal/addLocation',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addLocation.html',
                    controller: 'addLocationController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                locationList: ['LocationService',
                    function(LocationService){
                    return LocationService.getLocations();
                }],
                cityList: ['LocationService',
                    function(LocationService){
                    return LocationService.getCities();
                }],
                loadHandsontable: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngHandsontable'], {serie: true});
                }],
            }
        })
        .state('addMediaTag', {
            url: '/ebinternal/addMediaTag',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addMediaTag.html',
                    controller: 'addMediaTagController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                mediaTagList: ['MediaTagService',
                    function(MediaTagService){
                    return MediaTagService.getMediaTags();
                }],
                mediaTypeList: ['MediaTagService',
                    function(MediaTagService){
                    return MediaTagService.getMediaTypes();
                }],
                loadHandsontable: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngHandsontable'], {serie: true});
                }],
            }
        })
        .state('addGroup', {
            url: '/ebinternal/addGroup',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addGroup.html',
                    controller: 'addGroupController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                groupList: ['GroupService',
                    function(GroupService){
                    return GroupService.getGroups();
                }],
                loadHandsontable: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngHandsontable'], {serie: true});
                }],
            }
        })
        .state('addSendGridCredential', {
            url: '/ebinternal/addSendGridCredential',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addSendGrid.html',
                    controller: 'addSendGridController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                sendGridCredentialList: ['SendGridService',
                    function(SendGridService){
                    return SendGridService.getSendGridCredentials();
                }],
                sendGridCredential: function() { return {}; }
            }
        })
        .state('addAwsCredential', {
            url: '/ebinternal/addAwsCredential',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addAwsCredential.html',
                    controller: 'addAwsCredentialController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                awsCredentialList: ['AwsCredentialService',
                    function(AwsCredentialService){
                    return AwsCredentialService.getAwsCredentials();
                }],
                awsCredential: function() { return {}; }
            }
        })
        .state('addSubscriber', {
            url: '/ebinternal/addSubscriber',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addSubscriber.html',
                    controller: 'addSubscriberController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                subscribersList: ['subscriberService',
                    function(subscriberService){
                    return subscriberService.getSubscribers();
                }],
                loadHandsontable: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngHandsontable'], {serie: true});
                }],
            }
        })
        .state('addExam', {
            url: '/ebinternal/addExam',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addExam.html',
                    controller: 'addExamController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                /*markTrueFalse: ['ExamService',
                    function(ExamService){
                    return ExamService.markTrueFalse();
                }],*/
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],
            }
        })
        .state('editExam', {
            url: '/ebinternal/editExam/:examId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'editExam.html',
                    controller: 'editExamController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisexam: ['ExamService', '$stateParams',
                    function(ExamService,$stateParams) {
                    return ExamService.getExam($stateParams.examId);    
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                testList: ['testService', '$stateParams',
                    function(testService, $stateParams){
                    return testService.getExamTests($stateParams.examId);
                }],
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],
            }
        })
        .state('exam', {
            url: '/exam/:examName',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'exam.html',
                    controller: 'examController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisexam: ['ExamService', '$stateParams',
                    function(ExamService,$stateParams) {
                    return ExamService.getExamByName($stateParams.examName);    
                }],
                thisExamPattern: ['ExamService', '$stateParams',
                    function(ExamService,$stateParams) {
                    return ExamService.getExamPatternByName($stateParams.examName);    
                }],
                thisExamBooks: ['ExamService', '$stateParams',
                    function(ExamService,$stateParams) {
                    return ExamService.getExamBooksByName($stateParams.examName);    
                }],
                thisExamDegrees: ['ExamService', '$stateParams',
                    function(ExamService,$stateParams) {
                    return ExamService.getDegreesByName($stateParams.examName);    
                }],
                testList: ['testService', '$stateParams',
                    function(testService, $stateParams){
                    return testService.getExamTestsByExamName($stateParams.examName);
                }],
                loadAngularTimeline: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['angularTimeline'], {serie: true});
                }],
                loadUICarousel: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['UICarousel'], {serie: true});
                }],
                
                /*
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],*/
                suggestedblogs: ['blogpostService','$stateParams',
                    function(blogpostService,$stateParams){
                    return blogpostService.suggestedblogs($stateParams.examName);
                }],
                bootstrapAffix: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['bootstrapAffix'], {serie: true});
                }],
            }
        })
        
        .state('questionpapers', {
            url: '/questionpapers/:examName',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'officialpapers.html',
                    controller: 'officialPapersController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisexam: ['ExamService', '$stateParams',
                    function(ExamService,$stateParams) {
                    return ExamService.getExamByName($stateParams.examName);    
                }],
                
                /*thisExamPattern: ['ExamService', '$stateParams',
                    function(ExamService,$stateParams) {
                    return ExamService.getExamPatternByName($stateParams.examName);    
                }],
                thisExamBooks: ['ExamService', '$stateParams',
                    function(ExamService,$stateParams) {
                    return ExamService.getExamBooksByName($stateParams.examName);    
                }],
                thisExamDegrees: ['ExamService', '$stateParams',
                    function(ExamService,$stateParams) {
                    return ExamService.getDegreesByName($stateParams.examName);    
                }],*/
                officialPapersStreamExam: ['testService', '$stateParams',
                    function(testService){
                    return testService.officialPapersStreamExam();
                }],
                officialPapers: ['testService', '$stateParams',
                    function(testService, $stateParams){
                    return testService.officialPapersByExamName($stateParams.examName);
                }],
                /*loadAngularTimeline: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['angularTimeline'], {serie: true});
                }],*/
                loadUICarousel: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['UICarousel'], {serie: true});
                }],
                
                /*
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],
                suggestedblogs: ['blogpostService','$stateParams',
                    function(blogpostService,$stateParams){
                    return blogpostService.suggestedblogs($stateParams.examName);
                }],*/
                /*bootstrapAffix: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['bootstrapAffix'], {serie: true});
                }],*/
            }
        })
        .state('addQuestion', {
            url: '/ebinternal/addQuestion/:testId',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addQuestion.html',
                    controller: 'addQuestionController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisTest: ['testService','$stateParams',
                    function(testService, $stateParams){
                    return testService.getTest($stateParams.testId);
                }],
                thisTestQuestions: ['questionService','$stateParams',
                    function(questionService, $stateParams){
                    return questionService.getTestQuestions($stateParams.testId);
                }],
                ngFileUpload: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngFileUpload'], {serie: true});
                }],
            }
        })
        .state('addEligibility', {
            url: '/ebinternal/addEligibility',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addEligibility.html',
                    controller: 'addEligibilityController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                eligibilityList: ['EligibilityService',
                    function(EligibilityService){
                    return EligibilityService.getEligibilities();
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                loadHandsontable: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngHandsontable'], {serie: true});
                }],
            }
        })
        .state('addMaster', {
            url: '/ebinternal/master/:masterId/addMaster',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addMaster.html',
                    controller: 'addMasterController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
            }
        })
        .state('manageUsers', {
            url: '/ebinternal/master/:masterId/manageUsers',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'manageUsers.html',
                    controller: 'manageUsersController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
            }
        })
        .state('addInstitute', {
            url: '/ebinternal/master/:userId/addInstitute',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addInstitute.html',
                    controller: 'addInstituteController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                //GHI
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                examList: ['ExamService',
                    function(ExamService){
                    return ExamService.getExams();
                }],
                streamList: ['StreamService',
                    function(StreamService){
                    return StreamService.getStreams();
                }],
                loadHandsontable: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngHandsontable'], {serie: true});
                }],
                
            }
        })
        .state('bulkDisable', {
            url: '/ebinternal/master/:userId/bulkDisable',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'bulkDisable.html',
                    controller: 'bulkDisableController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                //GHI
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                loadHandsontable: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['ngHandsontable'], {serie: true});
                }],
                
                user: function() { return {}; }
            }
        })
        .state('addIntern', {
            url: '/ebinternal/user/:userId/addIntern',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'addIntern.html',
                    controller: 'addInternController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
            }
        })
        .state('sitemap', {
            url: '/ebinternal/sitemap',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'generateSitemap.html',
                    controller: 'sitemapController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                p0: ['sitemapService',
                    function(sitemapService){
                    return sitemapService.getp0();
                }],
                p1: ['sitemapService',
                    function(sitemapService){
                    return sitemapService.getp1();
                }],
                p2: ['sitemapService',
                    function(sitemapService){
                    return sitemapService.getp2();
                }],
                p3: ['sitemapService',
                    function(sitemapService){
                    return sitemapService.getp3();
                }],
                p3Aggregate: ['sitemapService',
                    function(sitemapService){
                    return sitemapService.getp3Aggregate();
                }],
                p5: ['sitemapService',
                    function(sitemapService){
                    return sitemapService.getp5();
                }],
                blogurls: ['sitemapService',
                    function(sitemapService){
                    return sitemapService.getblogurls();
                }],
                exams: ['sitemapService',
                    function(sitemapService){
                    return sitemapService.getexams();
                }],
                loadAngularFileSaver: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['angularFileSaver'], {serie: true});
                }],
            }
        })
        .state('blogsitemap', {
            url: '/ebinternal/blogsitemap',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'blogsitemap.html',
                    controller: 'blogsitemapController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                blogurls: ['sitemapService',
                    function(sitemapService){
                    return sitemapService.getblogrss();
                }],
                loadAngularFileSaver: ['$ocLazyLoad', function($ocLazyLoad) {
                     return $ocLazyLoad.load(['angularFileSaver'], {serie: true});
                }],
            }
        })
        .state('verify', {
            url: '/ebinternal/verify/:userId/',
            views: {
                'header':{
                    templateUrl: 'header.html',
                    
                },
                'body':{
                    templateUrl: 'verify.html',
                    controller: 'verifyController',
                },
                'footer': {
                    templateUrl: 'footer.html'
                }
            },
            resolve: {
                thisuser: ['UserService', '$stateParams',
                    function(UserService,$stateParams){
                    return UserService.getUser($stateParams.userId);
                }],
                user: function() { return {}; }
            }
        });
        
            //$locationProvider.html5Mode(true).hashPrefix('#');
            $locationProvider.html5Mode(true);
            //$locationProvider.hashPrefix("!");
        });
        
    })();

exambazaar.run(function($rootScope,$mdDialog, $location, $window, $transitions, $anchorScroll, $state, $cookies, $mdDialog) {
    
    
    
    $rootScope.navBarTitle = 'Exambazaar: Exclusive Deals and Videos for test preparation';
    $rootScope.message = '';
    $rootScope.imageUrl = '';
    //moment.tz.link("Asia/Calcutta|Asia/Kolkata");
    $rootScope.today = moment().toDate();
    moment.tz.add("Asia/Calcutta|HMT BURT IST IST|-5R.k -6u -5u -6u|01232|-18LFR.k 1unn.k HB0 7zX0");
    moment.tz.link("Asia/Calcutta|Asia/Kolkata");
    var onlyMasterStates = [
        "offers",
        "socialLogin",
        "contacts",
        "charting",
        "activeUsers",
        "allOffers",
        "allreviews",
        "allblogtags",
        "extractEmails",
        "sandbox2",
        "sendEmail",
        "userMarketing",
        "userSurvey",
        "editTargetStudyProvider",
        "providersWithAreas",
        "master-dashboard",
        "filledAll",
        "checkLogo",
        "addStream",
        "addOffer",
        "addLocation",
        "addMediaTag",
        "addSendGridCredential",
        "addAwsCredential",
        "addSubscriber",
        
        "addEligibility",
        "addMaster",
        "manageUsers",
        "addIntern",
        "sitemap",
        "blogsitemap",
        "analytics",

    ];
    var atleastInternState = [
        "allTests",
        "coachingGroupSummary",
        "coachingGroup",
        "colleges",
        "addExam",
        "scheduleQAD",
        "suggestCoaching",
        "addedInstitutes",
        "addedQuestions",
        "providers",
        "targetStudyProviders",
        "filled",
        "assigned",
        "assignedToVerify",
        "assignedToRate",
        "assignedToAddContactInfo",
        "addGroup",
        "editExam",
        "addQuestion",
        "addInstitute",
        "bulkDisable",
        "k21Test",
        "editCollege",
        "filledColleges",
    ];
    $transitions.onStart( {}, function($transition$) {
        //stateTo === $transition$.$to();
        
        
        
        
    });
    
    
                                                   
    $transitions.onSuccess({}, function($transition$) {
        
        
                
        $window.scrollTo(0, 0);
        var stateTo = $transition$.$to();
        var stateToURL = stateTo.url.pattern;
        var filterPattern = '/ebinternal/';
        
        var fIndex = stateToURL.indexOf(filterPattern);
        
        if(stateTo != 'claim' && stateTo != 'eligibility'  && stateTo != 'showGroup'){
            $mdDialog.hide();
        }
        
        
        
        if(fIndex != -1){
            //console.log(stateTo.name);
            //console.log(stateTo.url.pattern);
            
            var mIndex = onlyMasterStates.indexOf(stateTo.name);
            var aIndex = atleastInternState.indexOf(stateTo.name);
            
            if($cookies.getObject('sessionuser')){
                var user = $cookies.getObject('sessionuser');
                
                var userType = user.userType;
                if(userType == 'Master'){
                    console.log('SEO Title: ' + $rootScope.pageTitle);
                    console.log('SEO Description: ' + $rootScope.pageDescription);
                    console.log('SEO Keywords: ' + $rootScope.pageKeywords);
                }
                
                if(mIndex != -1 && userType != 'Master'){
                    $cookies.remove('sessionuser');
                    //$state.reload();
                    $rootScope.$emit("ForcedLogin", {});
                }
                
                if(aIndex != -1 && (userType != 'Master' && userType != 'Intern - Business Development')){
                    $cookies.remove('sessionuser');
                    //$state.reload();
                    $rootScope.$emit("ForcedLogin", {});
                }
                
            }else{
                console.log('Could not find user');
                $cookies.remove('sessionuser');
                $rootScope.$emit("ForcedLogin", {});
                
            }
            
        }else{
            //console.log('Not EB Internal');
        }
        if(stateTo == 'assessment'){
            if($cookies.getObject('sessionuser')){
                
                
            }else{
                
                $cookies.remove('sessionuser');
                $rootScope.$emit("ForcedLogin", {});
                
            }
        }
        
        /*if(cookies.getObject('sessionuser')){
            var user = cookies.getObject('sessionuser');
            console.log(user);
        }else{
            console.log('Could not find user');
        }*/
        
        window.prerenderReady = true;
    });
    
    
    //window.prerenderReady = true;
    
    var currURL = $location.absUrl();
    $rootScope.pageURL = currURL;
    $rootScope.pageImage = 'https://www.exambazaar.com/images/logo/eb.jpg';
    
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.9&appId=1236747093103286";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    
    
    
    // If we've already installed the SDK, we're done
     if (document.getElementById('facebook-jssdk')) {return;}

     // Get the first script element, which we'll use to find the parent node
     var firstScriptElement = document.getElementsByTagName('script')[0];

     // Create a new script element and set its id
     var facebookJS = document.createElement('script'); 
     facebookJS.id = 'facebook-jssdk';

     // Set the new script's source to the source of the Facebook JS SDK
     facebookJS.src = '//connect.facebook.net/en_US/all.js';

     // Insert the Facebook JS SDK into the DOM
     firstScriptElement.parentNode.insertBefore(facebookJS, firstScriptElement);
    
    
    /*Carousel.setOptions({
        arrows: true,
        autoplay: false,
        autoplaySpeed: 3000,
        cssEase: 'ease',
        dots: false,

        easing: 'linear',
        fade: false,
        infinite: true,
        initialSlide: 0,

        slidesToShow: 1,
        slidesToScroll: 1,
        speed: 500,
    });*/
    
});


function generateOtp(min, max) {
    min = 1000;
    max = 9999;
    return Math.floor(Math.random() * (max - min + 1)) + min;
};

function compare(dateTimeA, dateTimeB) {
    var momentA = moment(dateTimeA,"DD/MM/YYYY");
    var momentB = moment(dateTimeB,"DD/MM/YYYY");
    if (momentA > momentB) return 1;
    else if (momentA < momentB) return -1;
    else return 0;
};





exambazaar.directive('focusMe', ['$timeout', '$parse', function ($timeout, $parse) {
    return {
        //scope: true,   // optionally create a child scope
        link: function (scope, element, attrs) {
            var model = $parse(attrs.focusMe);
            scope.$watch(model, function (value) {
                //console.log('value=', value);
                if (value === true) {
                    $timeout(function () {
                        element[0].focus();
                    });
                }
            });
            // to address @blesh's comment, set attribute value to 'false'
            // on blur event:
            element.bind('blur', function () {
                //console.log('blur');
                /*scope.$apply(model.assign(scope, false));*/
            });
        }
    };
}]);

/*var ngCloakDirective = ngDirective({
  compile: function(element, attr) {
    attr.$set('ngCloak', undefined);
    element.removeClass('ng-cloak');
      console.log('ng-cloak removed');
  }
});
exambazaar.config(['$provide', function ($provide) {
  $provide.decorator('ngCloakDirective', ['$delegate', function ($delegate) {
      console.log($delegate);
    //$delegate[0].priority = -1000;
    return $delegate;
  }]);
}]);*/



exambazaar.directive('affixer', function ($window) {
    return {
        restrict: 'A',
        link: function ($scope, $element) {
            var win = angular.element($window);
            var topOffset = $element[0].offsetTop;
            
            function affixElement() {              
                
                console.log($window.pageYOffset);
                
                if ($window.pageYOffset > topOffset) {
                    $element.css('position', 'fixed');
                    $element.css('top', '0px');
                } else {
                    $element.css('position', '');
                    $element.css('top', '');
                }
            }
            
            $scope.$on('$routeChangeStart', function() {
                win.unbind('scroll', affixElement);
            });
            win.bind('scroll', affixElement);                        
        }
    };
});

exambazaar.directive('scrollpercentage', function ($window) {
    return {
        restrict: 'A',
        link: function ($scope, $element) {
            angular.element($window).bind('scroll', function() {

                var offSet = $window.pageYOffset,
                height = $window.innerHeight,
                scrolledPercentage = (offSet / height * 100);
                //console.log(scrolledPercentage);
                if (scrolledPercentage >= 60) {
                  console.log(scrolledPercentage + ' over 60');
                }
            });                      
        }
    };
});

exambazaar.directive('onlyDigits', function () {
    return {
      require: 'ngModel',
      restrict: 'A',
      link: function (scope, element, attr, ctrl) {
        function inputValue(val) {
          if (val) {
            var digits = val.replace(/[^0-9]/g, '');

            if (digits !== val) {
              ctrl.$setViewValue(digits);
              ctrl.$render();
            }
            return parseInt(digits,10);
          }
          return undefined;
        }            
        ctrl.$parsers.push(inputValue);
      }
    };
});


exambazaar.directive('decimalOrInteger', function () {
    return {
      require: 'ngModel',
      restrict: 'A',
      link: function (scope, element, attr, ctrl) {
        function inputValue(val) {
          if (val) {
            var digits = val.replace(/[0-9]+(\.[0-9][0-9]?)?/g, '');

            if (digits !== val) {
              ctrl.$setViewValue(digits);
              ctrl.$render();
            }
            return parseInt(digits,10);
          }
          return undefined;
        }            
        ctrl.$parsers.push(inputValue);
      }
    };
});

exambazaar.directive('onlyLetters', function () {
    return {
    require: 'ngModel',
    link: function(scope, element, attr, ngModelCtrl) {
      function fromUser(text) {
        var transformedInput = text.replace(/[^a-z A-Z]/g, '');
        //console.log(transformedInput);
        if (transformedInput !== text) {
          ngModelCtrl.$setViewValue(transformedInput);
          ngModelCtrl.$render();
        }
        return transformedInput;
      }
      ngModelCtrl.$parsers.push(fromUser);
    }
  };
});


exambazaar.directive("limitTo", [function() {
    return {
        restrict: "A",
        link: function(scope, elem, attrs) {
            var limit = parseInt(attrs.limitTo);
            angular.element(elem).on("keypress", function(e) {
                if (this.value.length == limit) e.preventDefault();
            });
        }
    }
}]);



exambazaar.directive("moveNextOnMaxlength", function() {
    return {
        restrict: "A",
        link: function($scope, element) {
            element.on("input", function(e) {
                if(element.val().length == element.attr("ng-maxlength")) {
                    var $nextElement = element.next();
                    if($nextElement.length) {
                        $nextElement[0].focus();
                    }
                }
            });
        }
    }
});

exambazaar.directive('www.exambazaar.com', function(){
    return {
        scope: {},
        link:function(scope,element){
            element.on('copy', function (event) {
              event.preventDefault();
            });
            element.on('select', function (event) {
              event.preventDefault();
            });
        }
    };
});


